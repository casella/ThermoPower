package PowerPlants 
  import SI = Modelica.SIunits;
  import ThermoPower.Choices.Init.Options;
annotation (uses(ThermoPower(version="2"), Modelica(version="3.0-development")));
  
  package Gasifier   
  end Gasifier;
  
  package GasTurbine 
    package Interfaces 
      partial model GT "Base class for Gas Turbine" 
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        
        Gas.FlangeA FuelInlet( redeclare package Medium = FuelMedium) 
          annotation (extent=[-10,80; 10,100]);
        Gas.FlangeA AirInlet( redeclare package Medium = AirMedium) 
          annotation (extent=[-116,64; -84,96]);
        Gas.FlangeB FlueGasOutlet( redeclare package Medium = FlueGasMedium) 
          annotation (extent=[84,64; 116,96]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b shaft_b 
          annotation (extent=[90,-10; 110,10]);
        annotation (Diagram,                 Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=76,
                rgbcolor={170,170,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-80,8; 100,-8],   style(
                color=76,
                rgbcolor={170,170,255},
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-20,80; 20,40], style(
                color=9,
                rgbcolor={175,175,175},
                gradient=3,
                fillColor=1,
                rgbfillColor={255,0,0})),
            Polygon(points=[-20,18; -28,24; -28,64; -20,64; -20,18], style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255})),
            Polygon(points=[20,18; 28,24; 28,64; 20,64; 20,18], style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255})),
            Polygon(points=[-80,60; -72,54; -72,84; -100,84; -100,76; -80,76; -80,60],
                style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255})),
            Polygon(points=[80,60; 72,54; 72,84; 100,84; 100,76; 80,76; 80,60], style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255})),
            Polygon(points=[-80,70; -20,30; -20,-30; -80,-70; -80,70], style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255})),
            Polygon(points=[80,70; 20,30; 20,-30; 80,-70; 80,-70; 80,70], style(
                color=10,
                rgbcolor={135,135,135},
                gradient=3,
                fillColor=76,
                rgbfillColor={170,170,255}))));
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
      end GT;
    end Interfaces;
    
    package Components 
      model HydraulicClutch 
       extends Modelica.Mechanics.Rotational.Interfaces.Compliant;
       SI.AngularVelocity w_rel 
          " relative angular velocity between flange_b and flange_a";
       Modelica.Blocks.Interfaces.RealInput friction " viscous friction" 
                                                     annotation (extent=[-10,60; 10,80], rotation=270);
         annotation (Icon(
            Rectangle(extent=[10, 60; 30, -60], style(
                gradient=2,
                fillColor=8,
                fillPattern=1)),
            Rectangle(extent=[-30, 60; -10, -60], style(
                gradient=2,
                fillColor=8,
                fillPattern=1)),
            Rectangle(extent=[30,10; 100,-10],  style(
                gradient=2,
                fillColor=8,
                fillPattern=1)),
            Rectangle(extent=[-100,10; -30,-10],  style(
                gradient=2,
                fillColor=8,
                fillPattern=1))), uses(Modelica(version="2.2")));
      equation 
        w_rel = der(phi_rel) " relative angular velocity";
        tau = friction*w_rel "torque";
      end HydraulicClutch;
      
      model GTunit "Gas Turbine" 
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        extends ThermoPower.Gas.GTunitBase(
                      redeclare package Exhaust = FlueGasMedium,
                      redeclare package Air = AirMedium,
                      redeclare package Fuel = FuelMedium);
        import ThermoPower.Choices.TurboMachinery.TableTypes;
        parameter Boolean constantCompositionExhaust = false 
          "Assume exhaust composition equal to reference_X";
        Real wcomb(final quantity="MolarFlowRate", unit="mol/s") 
          "Molar Combustion rate (CH4)";
        Real lambda 
          "Stoichiometric ratio (>1 if air flow is greater than stoichiometric)";
        parameter Real tableHI[:,:]=fill(0,0,2) "Table for HI = f(beta, alfa)";
        parameter Real tablePR[:,:]=fill(0,0,2) "Table for PR = g(beta, alfa)";
        parameter Real tableW[:,:]=fill(0,0,2) "Table for wia = h(beta, alfa)";
        parameter Real tableZLP[:,:]=fill(0,0,2) 
          "Table for ZLP = k(beta, alfa)";
        parameter Real tableN[:,:]=fill(0,0,2) "Table for N = j(beta,alfa)";
        parameter String fileName="noName" "File where matrix is stored";
        parameter TableTypes.Temp Table 
          "Selection of the way of definition of table matrix";
        Real alfa(start=integer(size(tablePR,1)/2));
        Real beta(start=integer(size(tablePR,1)/2));
        Modelica.Blocks.Tables.CombiTable2D PowerIn( tableOnFile= if (Table==0) then false else true,
                          table=tableHI, tableName=if (Table==0) then "NoName" else "tabHI",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,36; 8,56]);
        Modelica.Blocks.Tables.CombiTable2D PressRatio( tableOnFile = if (Table==0) then false else true,
                          table=tablePR, tableName=if (Table==0) then "NoName" else "tabPR",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,8; 8,28]);
        Modelica.Blocks.Tables.CombiTable2D MassFlowRate( tableOnFile= if (Table==0) then false else true,
                          table=tableW, tableName=if (Table==0) then "NoName" else "tabW",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-20; 8,0]);
        Modelica.Blocks.Tables.CombiTable2D PowerOut(tableOnFile= if (Table==0) then false else true,
                          table=tableZLP, tableName=if (Table==0) then "NoName" else "tabZLP",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-48; 8,-28]);
        Modelica.Blocks.Tables.CombiTable2D Omega(tableOnFile=if (Table == 0) then false else true,
                          table=tableN,tableName=if (Table == 0) then "NoName" else "tabN",
                          fileName=if (Table == 0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-76; 8,-56]);
        
      equation 
        wcomb=wif*Fuel_in.XBA[3]/Fuel.data[3].MM "Combustion molar flow rate";
        lambda= (wia*Air_in.XBA[1]/Air.data[1].MM) / (2 * wcomb);
        assert(lambda >= 1, "Not enough oxygen flow");
        if constantCompositionExhaust then
          FlueGas_out.XBA[1:Exhaust.nXi] = Exhaust.reference_X[1:Exhaust.nXi] 
            "Reference value for exhaust compostion";
        else
        // True mass balances
          0 = wia*Air_in.XBA[1] + wout*FlueGas_out.XBA[1] - 2*wcomb*Exhaust.data[1].MM "oxygen";
          0 = wia*Air_in.XBA[3] + wout*FlueGas_out.XBA[2] "argon";
          0 = wia*Air_in.XBA[2] + wout*FlueGas_out.XBA[3] + 2*wcomb*Exhaust.data[3].MM "water";
          0 = wout*FlueGas_out.XBA[4] + wif*Fuel_in.XBA[2] + wcomb*Exhaust.data[4].MM 
            "carbondioxide";
          0 = wia*Air_in.XBA[4] + wout*FlueGas_out.XBA[5] + wif*Fuel_in.XBA[1] 
            "nitrogen";
        end if;
        // HI = f(beta, alfa)
        PowerIn.u1=beta;
        PowerIn.u2=alfa;
        PowerIn.y=HI;
        
        // PR = g(beta, alfa)
        PressRatio.u1=beta;
        PressRatio.u2=alfa;
        PressRatio.y=PR;
        
        // wia = h(beta, alfa)
        MassFlowRate.u1=beta;
        MassFlowRate.u2=alfa;
        MassFlowRate.y=wia;
        
        // ZLP = k(beta, alfa)
        PowerOut.u1=beta;
        PowerOut.u2=alfa;
        PowerOut.y=ZLPout;
        
        // N = j(beta,alfa)
        Omega.u1=beta;
        Omega.u2=alfa;
        Omega.y=omega;
       annotation (Icon, Diagram,
          Documentation(info="<html>
This model adds the performance characteristics to the GTunitExhaustBase model, by means of 2D interpolation tables.
<p>Unit performance is a function of two parameters, i.e. alfa and beta. The performance is thus specified by five functions[1]:
<ul><li>HI = f(alfa, beta)</li>
<li>PR = g(alfa, beta)</li>
<li>wia = h(alfa, beta)</li>
<li>N = l(alfa, beta)</li>
<li>ZLPout = m(alfa, beta)</li>
</ul>
<p>which in turn are specified by five tables, in the format of Modelica.Blocks.Tables.CombiTable2D:
<ol><li><tt>tableHI</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>
<li><tt>tablePR</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>
<li> <tt>tableW</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
<li> <tt>tableN</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
<li> <tt>tableZLP</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
 respectively.</li></ol>
<p><b>Modelling options</b></p>
The packages Medium are redeclared and a mass balance determines the composition of the outgoing gas.
<p>The following options are available to select the way of definition of the table:
<ul><li><tt>Table = 0</tt>: the table is explicitly supplied as matrix parameter.
<li><tt>Table = 1</tt>: the table is read from a file; the string <tt>fileName</tt> contains the path to the files where tables are stored, either in ASCII or Matlab binary format.
</ul>
<p><b>References:</b></p>
<ol>
<li>P. P. Walsh, P. Fletcher: <i>Gas Turbine Performance</i>, 2nd ed., Oxford, Blackwell, 2004, pp. 646.
</ol> 
</html>",     revisions="<html>
<ul>
<li><i>7 Jun 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Model restructured by inheritance.</li>
<li><i>19 Apr 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       GT unit model restructured using inheritance.</li>
<br>   First release.
</li>
</ul>
</html>"));
      end GTunit;
      
      model GTunitBV "Gas Turbine" 
        extends ThermoPower.Gas.GTunitExhaustBase;
        import ThermoPower.Choices.TurboMachinery.TableTypes;
        
        parameter Real tableHI[:,:]=fill(0,0,2) "Table for HI = f(beta, alfa)";
        parameter Real tablePR[:,:]=fill(0,0,2) "Table for PR = g(beta, alfa)";
        parameter Real tableW[:,:]=fill(0,0,2) "Table for wia = h(beta, alfa)";
        parameter Real tableZLP[:,:]=fill(0,0,2) 
          "Table for ZLP = k(beta, alfa)";
        parameter Real tableN[:,:]=fill(0,0,2) "Table for N = j(beta,alfa)";
        parameter String fileName="noName" "File where matrix is stored";
        parameter TableTypes.Temp Table 
          "Selection of the way of definition of table matrix";
        Real alfa(start=integer(size(tablePR,1)/2));
        Real beta(start=integer(size(tablePR,1)/2));
        
        Modelica.Blocks.Tables.CombiTable2D PowerIn( tableOnFile= if (Table==0) then false else true,
                          table=tableHI, tableName=if (Table==0) then "NoName" else "tabHI",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,36; 8,56]);
        Modelica.Blocks.Tables.CombiTable2D PressRatio( tableOnFile = if (Table==0) then false else true,
                          table=tablePR, tableName=if (Table==0) then "NoName" else "tabPR",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,8; 8,28]);
        Modelica.Blocks.Tables.CombiTable2D MassFlowRate( tableOnFile= if (Table==0) then false else true,
                          table=tableW, tableName=if (Table==0) then "NoName" else "tabW",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-20; 8,0]);
        Modelica.Blocks.Tables.CombiTable2D PowerOut(tableOnFile= if (Table==0) then false else true,
                          table=tableZLP, tableName=if (Table==0) then "NoName" else "tabZLP",
                          fileName=if (Table==0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-48; 8,-28]);
        Modelica.Blocks.Tables.CombiTable2D Omega(tableOnFile=if (Table == 0) then false else true,
                          table=tableN,tableName=if (Table == 0) then "NoName" else "tabN",
                          fileName=if (Table == 0) then "NoName" else fileName,
          smoothness=Modelica.Blocks.Types.Smoothness.ContinuousDerivative) 
          annotation (extent=[-12,-76; 8,-56]);
        
        Modelica.Blocks.Interfaces.RealInput BV 
          annotation (extent=[-100,40; -80,60], rotation=270);
      equation 
        
        // HI = f(beta, alfa)
        PowerIn.u1=beta;
        PowerIn.u2=alfa;
        PowerIn.y=HI;
        
        // PR = g(beta, alfa)
        PressRatio.u1=beta;
        PressRatio.u2=alfa;
        PressRatio.y=PR;
        
        // wia = h(beta, alfa)
        MassFlowRate.u1=beta;
        MassFlowRate.u2=alfa;
        MassFlowRate.y=(1-BV)*wia 
          "la portata è ridotta considerando quella spillata";
        
        // ZLP = k(beta, alfa)
        PowerOut.u1=beta;
        PowerOut.u2=alfa;
        PowerOut.y=ZLPout;
        
        // N = j(beta,alfa)
        Omega.u1=beta;
        Omega.u2=alfa;
        Omega.y=omega;
       annotation (Icon, Diagram,
          Documentation(info="<html>
This model adds the performance characteristics to the GTunitExhaustBase model, by means of 2D interpolation tables.
<p>Unit performance is a function of two parameters, i.e. alfa and beta. The performance is thus specified by five functions[1]:
<ul><li>HI = f(alfa, beta)</li>
<li>PR = g(alfa, beta)</li>
<li>wia = h(alfa, beta)</li>
<li>N = l(alfa, beta)</li>
<li>ZLPout = m(alfa, beta)</li>
</ul>
<p>which in turn are specified by five tables, in the format of Modelica.Blocks.Tables.CombiTable2D:
<ol><li><tt>tableHI</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>
<li><tt>tablePR</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>
<li> <tt>tableW</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
<li> <tt>tableN</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
<li> <tt>tableZLP</tt>, where <tt>beta</tt> is the first column and <tt>alfa</tt> the first row</li>,
 respectively.</li></ol>
<p>The signal BV regulates the massflowrate <tt>wia</tt> by openinng or closing the Bleed Valves.
<p><b>Modelling options</b></p>
The packages Medium are redeclared and a mass balance determines the composition of the outgoing gas.
<p>The following options are available to select the way of definition of the table:
<ul><li><tt>Table = 0</tt>: the table is explicitly supplied as matrix parameter.
<li><tt>Table = 1</tt>: the table is read from a file; the string <tt>fileName</tt> contains the path to the files where tables are stored, either in ASCII or Matlab binary format.
</ul>
<p><b>References:</b></p>
<ol>
<li>P. P. Walsh, P. Fletcher: <i>Gas Turbine Performance</i>, 2nd ed., Oxford, Blackwell, 2004, pp. 646.
</ol> 
</html>",     revisions="<html>
<ul>
<li><i>7 Jun 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Model restructured by inheritance.</li>
<li><i>19 Apr 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       GT unit model restructured using inheritance.</li>
<br>   First release.
</li>
</ul>
</html>"),uses(ThermoPower(version="2"), Modelica(version="2.2")));
      end GTunitBV;
      
      package Table_finali 
      //valori presi da BILANCIO-FINALE, considerando anche la portata delle Bleed Valve
        
        record Data 
          Real tabPR[:,:];
          Real tabW[:,:];
          Real tabHI[:,:];
          Real tabZLP[:,:];
          Real tabN[:,:];
        end Data;
        
        constant Data GT20Data(
      tabN=[0,        1,      2,       3,     4,       5,     6,       7,     8,     9,     10,    11;
            1,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            2,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            3,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            4,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            5,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            6,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            7,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            8,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
            9,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18;
           10,   517.94, 464.64, 387.04, 305.68, 256.35, 187.03, 101.05,  85.97,  63.36,  41.89,   37.18],
      tabW=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11;
            1,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            2,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            3,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            4,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            5,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            6,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            7,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            8,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
            9,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48;
           10,   164.24,  89.32,  63.07,  43.47,  30.80,  24.31,  22.8,   18.72,   14.56,   12.48,   12.48],
      tabPR=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11;
            1,   12.061,  10.023,  6.457,  4.283,  3.292,  2.340,  1.453,  1.387,  1.250,  1.141,   1.121;
            2,   11.419,   9.468,  6.022,  3.965,  3.041,  2.175,  1.381,  1.381,  1.328,  1.119,   1.102;
            3,   10.455,   8.643,  5.369,  3.489,  2.664,  1.928,  1.272,  1.272,  1.241,  1.085,   1.073;
            4,    9.598,   7.893,  4.788,  3.066,  2.329,  1.708,  1.176,  1.176,  1.163,  1.055,   1.048;
            5,    9.274,   7.613,  4.569,  2.906,  2.203,  1.625,  1.140,  1.140,  1.134,  1.044,   1.039;
            6,    9.041,   7.411,  4.411,  2.790,  2.112,  1.565,  1.113,  1.113,  1.113,  1.036,   1.032;
            7,    8.805,   7.207,  4.251,  2.674,  2.020,  1.505,  1.087,  1.087,  1.091,  1.028,   1.025;
            8,    8.548,   6.985,  4.077,  2.547,  1.919,  1.439,  1.058,  1.058,  1.068,  1.019,   1.017;
            9,    8.454,   6.903,  4.013,  2.500,  1.882,  1.415,  1.047,  1.047,  1.060,  1.016,   1.014;
           10,    8.205,   6.688,  3.845,  2.377,  1.785,  1.351,  1.019,  1.019,  1.037,  1.007,   1.007],
      tabZLP=[0,  1,   2,       3,     4,      5,       6,       7, 8,  9,  10, 11;
              1, 4.432E7, 4.249e7, 3.474E7, 2.556E7, 2.124E7, 1.433E7, 6.682E6, 5.341E6, 3.598E6, 2.086E6, 1.784E6;
              2, 3.410E7, 3.366e7, 2.782E7, 2.051E7, 1.725E7, 1.171E7, 5.532E6, 4.414E6, 2.982E6, 1.731E6, 1.482E6;
              3, 1.877E7, 2.040e7, 1.744E7, 1.293E7, 1.126E7, 7.782E6, 3.806E6, 3.024E6, 2.057E6, 1.199E6, 1.028E6;
              4, 5.149E6, 8.613e6, 8.205E6, 6.202E6, 5.941E6, 4.290E6, 2.273E6, 1.789E6, 1.236E6, 7.269E5, 6.256E5;
              5, 5.678E3, 4.165e6, 4.720E6, 3.660E6, 3.932E6, 2.972E6, 1.694E6, 1.322E6, 9.256E5, 5.485E5, 4.735E5;
              6,-3.707E6, 9.533e5, 2.205E6, 1.825E6, 2.482E6, 2.021E6, 1.276E6, 9.857E5, 7.017E5, 4.197E5, 3.637E5;
              7,-7.454E6,-2.287e6,-3.335E5,-2.677E4, 1.018E6, 1.061E6, 8.544E5, 6.459E5, 4.758E5, 2.898E5, 2.529E5;
              8,-1.154E7,-5.823e6,-3.103E6,-2.047E6,-5.784E5, 1.296E4, 3.943E5, 2.752E5, 2.293E5, 1.480E5, 1.320E5;
              9,-1.304E7,-7.119e6,-4.118E6,-2.787E6,-1.164E6,-3.711E5, 2.257E5, 1.393E5, 1.389E5, 9.600E4, 8.769E4;
             10,-1.699E7,-1.054e7,-6.795E6,-4.740E6,-2.707E6,-1.384E6,-2.191E5,-2.191E5,-9.934E4,-4.105E4,-2.915E4],
      tabHI=[ 0,  1,   2,       3,     4,      5,       6,       7, 8,  9,  10, 11;
              1, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8, 1.349E8;
              2, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8, 1.124E8;
              3, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7, 7.869E7;
              4, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7, 4.871E7;
              5, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7, 3.740E7;
              6, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7, 2.923E7;
              7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7, 2.098E7;
              8, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7, 1.199E7;
              9, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6, 8.693E6;
             10, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0, 0.000e0]);
        
      /* tabW = [0,      1,      2,      3,      4,      5,      6,      7,      8,   9,    10, 11;
          1, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          2, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          3, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          4, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          5, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          6, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          7, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          8, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
          9, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48;
         10, 164.24, 138.66, 106.90,  72.44,  56.01,  37.40,  22.88,  18.75,  14.58,  12.48,  12.48],
// tabW senza considerare la presenza delle Bleed Valve
*/
        
      end Table_finali;
      
      package Table_sper 
      //da bilancio_mecc2, considerando anche la portata di Bleed; 
      //i punti considerati rispetto a table_finali sono di meno
        
        record Data 
          Real tabPR[:,:];
          Real tabW[:,:];
          Real tabHI[:,:];
          Real tabZLP[:,:];
          Real tabN[:,:];
        end Data;
        
        constant Data GT20Data(
      tabPR=[ 0,       1,    2,     3,     4,      5,       6,      7,      8,     9;
              1, 12.061,  6.285,  4.042,  3.033,  2.094,  1.291,  1.068,  1.057,      1;
              2, 11.419,  5.888,  3.773,  2.831,  1.974,  1.248,  1.053,  1.049,      1;
              3, 10.455,  5.291,  3.369,  2.529,  1.794,  1.182,  1.043,  1.036,      1;
              4,  9.598,  4.761,  3.009,  2.260,  1.635,  1.125,  1.029,  1.025,      1;
              5,  9.274,  4.561,  2.874,  2.159,  1.574,  1.103,  1.024,  1.021,      1;
              6,  9.041,  4.417,  2.776,  2.086,  1.531,  1.087,  1.020,  1.018,      1;
              7,  8.805,  4.271,  2.569,  2.012,  1.487,  1.071,  1.017,  1.015,      1;
              8,  8.548,  4.112,  2.530,  1.931,  1.439,  1.054,  1.012,  1.011,      1;
              9,  8.454,  4.054,  2.478,  1.902,  1.421,  1.047,  1.011,  1.010,      1;
             10,  8.205,  3.900,  2.426,  1.824,  1.375,  1.030,  1.007,  1.007,      1],
      tabZLP=[0,      1,       2,       3,       4,       5,       6,       7,       8,     9;
              1, 4.432E7, 3.201E7, 2.173E7, 1.713E7, 1.042E7, 4.101E6, 9.286E5, 7.672E5,    0;
              2, 3.410E7, 2.569E7, 1.744E7, 1.392E7, 8.517E6, 3.411E6, 7.670E5, 6.345E5,    0;
              3, 1.877E7, 1.621E7, 1.102E7, 9.118E6, 5.659E6, 2.375E6, 5.246E5, 4.354E5,    0;
              4, 5.149E6, 7.778E6, 5.308E6, 4.846E6, 3.118E6, 1.455E6, 3.091E5, 2.584E5,    0;
              5, 5.678E3, 4.597E6, 3.152E6, 3.233E6, 2.159E6, 1.107E6, 2.277E5, 1.916E5,    0;
              6,-3.707E6, 2.300E6, 1.596E6, 2.068E6, 1.467E6, 8.565E5, 1.690E5, 1.434E5,    0;
              7,-7.454E6,-1.777E4, 2.571E4, 8.935E5, 7.683E5, 6.033E5, 1.098E5, 9.474E4,    0;
              8,-1.154E7,-2.546E6,-1.688E6,-3.883E5, 6.220E3, 3.272E5, 4.514E4, 4.164E4,    0;
              9,-1.304E7,-3.473E6,-2.316E6,-8.583E5,-2.732E5, 2.259E5, 2.144E4, 2.218E4,    0;
             10,-1.699E7,-5.917E6,-3.972E6,-2.097E6,-1.010E6,-4.105E4,-4.105E4, -2.915E4,   0],
      tabW=[0,        1,      2,      3,       4,     5,     6,       7,       8,     9;
            1,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            2,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            3,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            4,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            5,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            6,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            7,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            8,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
            9,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
           10,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0],
       tabHI = [0,        1,        2,        3,        4,        5,        6,        7,       8,     9;
                 1,  1.349e8,  1.349e8,  1.349e8,  1.349e8,  1.349e8,  1.349e8,  1.349e8,  1.349e8,    0;
                 2,  1.124e8,  1.244e8,  1.124e8,  1.244e8,  1.124e8,  1.244e8,  1.124e8,  1.244e8,    0;
                 3,  7.869e7,  7.869e7,  7.869e7,  7.869e7,  7.869e7,  7.869e7,  7.869e7,  7.869e7,    0;
                 4,  4.871e7,  4.871e7,  4.871e7,  4.871e7,  4.871e7,  4.871e7,  4.871e7,  4.871e7,    0;
                 5,  3.740e7,  3.740e7,  3.740e7,  3.740e7,  3.740e7,  3.740e7,  3.740e7,  3.740e7,    0;
                 6,  2.923e7,  2.923e7,  2.923e7,  2.923e7,  2.923e7,  2.923e7,  2.923e7,  2.923e7,    0;
                 7,  2.098e7,  2.098e7,  2.098e7,  2.098e7,  2.098e7,  2.098e7,  2.098e7,  2.098e7,    0;
                 8,  1.199e7,  1.199e7,  1.199e7,  1.199e7,  1.199e7,  1.199e7,  1.199e7,  1.199e7,    0;
                 9,  8.693e6,  8.693e6,  8.693e6,  8.693e6,  8.693e6,  8.693e6,  8.693e6,  8.693e6,    0;
                10,        0,        0,        0,        0,        0,        0,        0,        0,    0],
        tabN = [0,      1,      2,      3,      4,      5,      6,      7,      8,    9;
                1, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                2, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                3, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                4, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                5, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                6, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                7, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                8, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
                9, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0;
               10, 517.94, 387.04, 305.68, 256.35, 187.03, 101.05,  41.89,  37.18,    0]);
        
      /*tabW=[0,        1,      2,      3,       4,     5,     6,       7,       8,     9;
      1,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      2,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      3,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      4,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      5,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      6,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      7,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      8,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
      9,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0;
     10,   164.24,  63.35,  40.64,  30.34,  24.55,  22.88,   10.28,  12.28,     0],
 */
        
      /*  tabW = [0,      1,      2,      3,      4,      5,      6,      7,      8,   9;
          1, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          2, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          3, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          4, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          5, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          6, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          7, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          8, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
          9, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0;
         10, 164.24, 106.90,  72.44,  56.01,  37.40,  22.88,  12.48,  12.48,   0],
*/
        
      end Table_sper;
    end Components;
    
    package Examples 
      model PlantUNIT__finale 
      // dati relativi all'avviamento
      // le tabelle sono Table_finali
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        
        parameter SI.Power nominalElectricalPower=50e9;
        parameter SI.Frequency fn=50;
        parameter SI.MassFraction Xexhaust[GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        parameter SI.AngularVelocity omega_sync=
            Modelica.SIunits.Conversions.from_rpm(4949);
        annotation (uses(ThermoPower(version="2"), Modelica(version="2.2")), Diagram,
          Icon(Rectangle(extent=[-100,100; 100,-100], style(color=3, rgbcolor={0,0,255})), Text(
              extent=[-70,52; 62,-48],
              style(color=3, rgbcolor={0,0,255}),
              string="GT")),
          Documentation(info="<html>
I dati fanno riferimento all'avviamento della GT20.
<p>Le tabelle di interpolazione usate per definire le prestazioni della macchina sono <tt>GTStartup_finale.Data.Table_finali</tt>, considerando come portata di aria transitante la portata passante dalle valvole di Bleed.
</html>"));
        ThermoPower.Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-106,-68; -78,-40]);
        ThermoPower.Gas.PressDrop OutPressDrop(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          Tstart=495,
          pstart=1.025e5,
          dpnom=1175,
          Kf=0.0288,
          rhonom=0.7,
          wnom=585.5)                        annotation (extent=[16,28; 38,52],
            rotation=90);
        ThermoPower.Gas.PressDrop InletPressDrop(
          redeclare package Medium = AirMedium,
          pstart=1.01325e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=1.2,
          Tstart=282.15,
          Kf=0.116,
          dpnom=3738,
          wnom=585.5)                        annotation (extent=[-70,-66; -44,-42]);
        ThermoPower.Gas.Valve fuelValve(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          CvData=ThermoPower.Choices.Valve.CvTypes.Av,
          pnom=20e5,
          Av=0.0022,
          dpnom=7.5e5)               annotation (extent=[-74,40; -58,60]);
        ThermoPower.Gas.SourceP fuelSource(redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[-102,38; -80,60]);
        Modelica.Mechanics.Rotational.Inertia GTInertia(     J=7000, w(start=316.14/2)) 
          annotation (extent=[14,-18; 28,2]);
        ThermoPower.Gas.SensT exhaust(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[54,50; 74,70]);
        ThermoPower.Electrical.Generator generator(
          eta=0.98,
          f(start=50),
          shaft(phi(start=0)),
          J=3500)                                   annotation (extent=[56,-18; 74,
              2]);
        ThermoPower.Electrical.Breaker breaker  annotation (extent=[80,-8; 64,12],
            rotation=90);
        ThermoPower.Electrical.Grid Grid(
          Pn=nominalElectricalPower,
          fn=fn,
          droop=0.05)                     annotation (extent=[94,6; 76,24],
            rotation=180);
        ThermoPower.Gas.Plenum fuelPlenum(redeclare package Medium = 
              FuelMedium,
          pstart=12.5e5,
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          V=0.5)                            annotation (extent=[-48,40; -26,62]);
        ThermoPower.Gas.PressDrop fuelPressDrop(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          pstart=12.5e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=8.18,
          Kf=213336,
          dpnom=3.45e5) 
          annotation (extent=[-22,18; 0,46],   rotation=270);
        ThermoPower.Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          Xnom=Xexhaust,
          p0=1.01325e5)                  annotation (extent=[76,44; 102,72]);
        Components.HydraulicClutch Clutch 
                                   annotation (extent=[-58,-16; -44,0]);
        Modelica.Blocks.Interfaces.RealInput GTHeatRate "Per Unit" 
          annotation (extent=[-122,66; -102,86]);
        Modelica.Blocks.Interfaces.RealInput clutchFriction "Per Unit" 
          annotation (extent=[-120,8; -100,28]);
        Modelica.Blocks.Interfaces.BooleanInput breakerClosed 
          annotation (extent=[-114,-92; -94,-72]);
        Control.ToScale valveOpeningScale(yHigh=0.7) 
                                  annotation (extent=[-94,64; -70,88]);
        Control.ToScale clutchFrictionScale(yHigh=34.937) 
                                   annotation (extent=[-90,6; -66,30]);
        ThermoPower.Gas.SensT bladePath(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[12,6; 32,26], rotation=90);
        Modelica.Blocks.Interfaces.RealOutput exhaust_T 
          annotation (extent=[96,70; 116,90]);
        Modelica.Blocks.Interfaces.RealOutput bladePath_T 
          annotation (extent=[96,20; 116,40]);
        Modelica.Blocks.Interfaces.RealOutput frequency "Per Unit" 
          annotation (extent=[96,-90; 116,-70]);
        Modelica.Blocks.Interfaces.RealOutput electricalPower "Per Unit" 
          annotation (extent=[94,-56; 116,-32]);
        Control.ServoActuator servoValve(
          Tt=20,
          T=2,
          yLow=0.1,
          steadyStateInit=true)              annotation (extent=[-64,68; -50,84]);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          HH=37.47e6,
          pstart=0.9758e5,
          Tstart=282.15,
          tableHI=Components.Table_finali.GT20Data.tabHI,
          tablePR=Components.Table_finali.GT20Data.tabPR,
          tableW=Components.Table_finali.GT20Data.tabW,
          tableZLP=Components.Table_finali.GT20Data.tabZLP,
          tableN=Components.Table_finali.GT20Data.tabN) 
          annotation (extent=[-28,-28; 4,12]);
        Modelica.Mechanics.Rotational.IdealGear Gear(ratio=(4949/60)/(25)) 
          annotation (extent=[34,-16; 50,0]);
        ThermoPower.Gas.Header Silencer(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          initOpt=ThermoPower.Choices.Init.Options.steadyStateNoP,
          Tmstart=300,
          gamma=4500*4000,
          Cm=20e6,
          V=0.0875,
          S=0.0098) 
          annotation (extent=[36,50; 52,66]);
        ThermoPower.Gas.SensP ComprPressure(redeclare package Medium = 
              FuelMedium)                   annotation (extent=[-52,-2; -18,28]);
        Modelica.Mechanics.Rotational.Speed Motor 
          annotation (extent=[-84,-18; -62,4]);
        Modelica.Blocks.Sources.Ramp MotorSpeed(
          duration=1,
          startTime=65,
          height=395 - 110,
          offset=110) annotation (extent=[-118,-18; -98,2]);
        Modelica.Blocks.Interfaces.RealOutput comprPressure 
          annotation (extent=[94,-20; 114,0]);
      equation 
        electricalPower = generator.powerConnection.W/nominalElectricalPower;
        frequency = generator.powerConnection.f/fn;
        connect(InletAtmosphere.flange, InletPressDrop.inlet) 
                                                   annotation (points=[-78,-54; -70,
              -54],   style(color=76, rgbcolor={159,159,223}));
        connect(fuelSource.flange, fuelValve.inlet) 
                                               annotation (points=[-80,49; -78,49;
              -78,50; -74,50],
            style(color=76, rgbcolor={159,159,223}));
        connect(generator.powerConnection, breaker.connection1) 
          annotation (points=[72.74,-8; 72,-8; 72,-6.6],
                                                 style(pattern=0, thickness=2));
        connect(breaker.connection2, Grid.connection) 
          annotation (points=[72,10.6; 72,15; 77.26,15],
                                                   style(pattern=0, thickness=2));
        connect(fuelValve.outlet, fuelPlenum.inlet) 
                                              annotation (points=[-58,50; -56,50;
              -56,51; -48,51],
            style(color=76, rgbcolor={159,159,223}));
        connect(fuelPlenum.outlet, fuelPressDrop.inlet) 
                                                  annotation (points=[-26,51;
              -10,51; -10,46; -11,46],
            style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.outlet, OutAtmosphere.flange) 
                                              annotation (points=[70,56; 74,56; 74,
              58; 76,58],
            style(color=76, rgbcolor={159,159,223}));
        connect(GTHeatRate, valveOpeningScale.u) annotation (points=[-112,76;
              -96.4,76],
                   style(color=74, rgbcolor={0,0,127}));
        connect(breakerClosed, breaker.closed) annotation (points=[-104,-82; 80,
              -82; 80,2; 78.4,2],
                             style(color=5, rgbcolor={255,0,255}));
        connect(bladePath.outlet, OutPressDrop.inlet) 
                                                    annotation (points=[26,22; 26,
              28; 27,28],
                   style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.T, exhaust_T) annotation (points=[71,66; 78,66; 78,80; 106,
              80], style(color=74, rgbcolor={0,0,127}));
        connect(bladePath.T, bladePath_T) annotation (points=[16,23; 16,30; 106,30],
            style(color=74, rgbcolor={0,0,127}));
        connect(clutchFrictionScale.y, Clutch.friction)        annotation (points=[-64.8,18;
              -51,18; -51,-2.4],           style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction, clutchFrictionScale.u) annotation (points=[-110,18;
              -92.4,18], style(color=74, rgbcolor={0,0,127}));
        connect(valveOpeningScale.y, servoValve.u) annotation (points=[-68.8,76;
              -63.65,76], style(color=74, rgbcolor={0,0,127}));
        connect(servoValve.y, fuelValve.theta) annotation (points=[-49.16,76; -40,
              76; -40,64; -66,64; -66,57.2],
                                         style(color=74, rgbcolor={0,0,127}));
        connect(GTunit.FlueGas_out, bladePath.inlet)  annotation (points=[2.4,-2;
              14.5,-2; 14.5,10; 26,10],
                                      style(color=76, rgbcolor={159,159,223}));
        connect(GTunit.shaft_b, GTInertia.flange_a) 
          annotation (points=[3.68,-8; 14,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Clutch.flange_b, GTunit.shaft_b)         annotation (points=[-44,-8;
              -44,-22; 4,-22; 4,-8; 3.68,-8], style(color=0, rgbcolor={0,0,0}));
        connect(fuelPressDrop.outlet, GTunit.Fuel_in)  annotation (points=[-11,18;
              -12,18; -12,6.4], style(color=76, rgbcolor={159,159,223}));
        connect(InletPressDrop.outlet, GTunit.Air_in) 
                                                   annotation (points=[-44,-54; -42,
              -54; -42,-2; -26.4,-2], style(color=76, rgbcolor={159,159,223}));
        connect(GTInertia.flange_b, Gear.flange_a) 
          annotation (points=[28,-8; 34,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Gear.flange_b, generator.shaft) 
          annotation (points=[50,-8; 57.26,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Silencer.outlet, exhaust.inlet) 
                                               annotation (points=[52,58; 56,58; 56,
              56; 58,56],
                      style(color=76, rgbcolor={159,159,223}));
        connect(OutPressDrop.outlet, Silencer.inlet) 
                                                  annotation (points=[27,52; 27,58;
              36,58], style(color=76, rgbcolor={159,159,223}));
        connect(ComprPressure.flange, GTunit.Fuel_in)  annotation (points=[-35,7;
              -35,6.4; -12,6.4],           style(color=3, rgbcolor={0,0,255}));
        connect(Motor.flange_b, Clutch.flange_a)  annotation (points=[-62,-7; -60,
              -7; -60,-8; -58,-8],  style(color=0, rgbcolor={0,0,0}));
        connect(MotorSpeed.y, Motor.w_ref) 
                                       annotation (points=[-97,-8; -90,-8; -90,-7;
              -86.2,-7],
            style(color=74, rgbcolor={0,0,127}));
        connect(ComprPressure.p, comprPressure) annotation (points=[-25.82,22; 80,
              22; 80,-10; 104,-10], style(color=74, rgbcolor={0,0,127}));
      end PlantUNIT__finale;
      
      model PlantUNIT__avv 
      // dati relativi all'avviamento
      // le tabelle sono Table_sper
        annotation (uses(ThermoPower(version="2"), Modelica(version="2.2")), Diagram,
          Icon(Rectangle(extent=[-100,100; 100,-100], style(color=3, rgbcolor={0,0,255})), Text(
              extent=[-70,52; 62,-48],
              style(color=3, rgbcolor={0,0,255}),
              string="GT")),
          Documentation(info="<html>I dati fanno riferimento all'avviamento della GT20.
<p>Le tabelle di interpolazione usate per definire le prestazioni della macchina sono <tt>GTStartup_finale.Data.Table_finali</tt>, considerando come portata di aria transitante la portata passante dalle valvole di Bleed, con un numero di punti considerati minori rispetto a <tt>GTStartup_finale.Data.Table_finali</tt>.
</html>"));
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        
        parameter Modelica.SIunits.Power nominalElectricalPower=50e9;
        parameter Modelica.SIunits.Frequency fn=50;
        parameter Modelica.SIunits.MassFraction Xexhaust[GTunit.Exhaust.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        parameter Modelica.SIunits.AngularVelocity omega_sync=
            Modelica.SIunits.Conversions.from_rpm(4949);
        ThermoPower.Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=281.15)                      annotation (extent=[-106,-68; -78,-40]);
        ThermoPower.Gas.PressDrop OutPressDrop(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          Tstart=495,
          wnom=168.9,
          pstart=1.025e5,
          dpnom=1175,
          Kf=0.0288,
          rhonom=0.7)                        annotation (extent=[16,28; 38,52],
            rotation=90);
        ThermoPower.Gas.PressDrop InletPressDrop(
          redeclare package Medium = AirMedium,
          pstart=1.01325e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          dpnom=2650,
          rhonom=1.2,
          Tstart=282.15,
          wnom=165.3,
          Kf=0.116)                          annotation (extent=[-70,-66; -44,-42]);
        ThermoPower.Gas.Valve fuelValve(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          CvData=ThermoPower.Choices.Valve.CvTypes.Av,
          pnom=20e5,
          Av=0.0022,
          dpnom=7.5e5)               annotation (extent=[-74,40; -58,60]);
        ThermoPower.Gas.SourceP fuelSource(redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[-102,38; -80,60]);
        Modelica.Mechanics.Rotational.Inertia GTInertia(             w(start=
                Modelica.SIunits.Conversions.from_rpm(360)), J=7000) 
          annotation (extent=[14,-18; 28,2]);
        ThermoPower.Gas.SensT exhaust(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[54,50; 74,70]);
        ThermoPower.Electrical.Generator generator(
          eta=0.98,
          f(start=50),
          shaft(phi(start=0)),
          J=3500)                                   annotation (extent=[56,-18; 74,
              2]);
        ThermoPower.Electrical.Breaker breaker  annotation (extent=[80,-8; 64,12],
            rotation=90);
        ThermoPower.Electrical.Grid Grid(
          Pn=nominalElectricalPower,
          fn=fn,
          droop=0.05)                     annotation (extent=[94,6; 76,24],
            rotation=180);
        ThermoPower.Gas.Plenum fuelPlenum(redeclare package Medium = 
              FuelMedium,
          pstart=12.5e5,
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          V=0.5)                            annotation (extent=[-48,40; -26,62]);
        ThermoPower.Gas.PressDrop fuelPressDrop(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          pstart=12.5e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=8.18,
          Kf=213336,
          dpnom=3.38e5) 
          annotation (extent=[-22,18; 0,46],   rotation=270);
        ThermoPower.Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          Xnom=Xexhaust,
          p0=1.01325e5)                  annotation (extent=[76,44; 102,72]);
        Components.HydraulicClutch Clutch 
                                   annotation (extent=[-58,-16; -44,0]);
        Modelica.Blocks.Interfaces.RealInput GTHeatRate "Per Unit" 
          annotation (extent=[-122,66; -102,86]);
        Modelica.Blocks.Interfaces.RealInput clutchFriction "Per Unit" 
          annotation (extent=[-120,10; -100,30]);
        Modelica.Blocks.Interfaces.BooleanInput breakerClosed 
          annotation (extent=[-114,-92; -94,-72]);
        Control.ToScale valveOpeningScale(yHigh=0.7) 
                                  annotation (extent=[-94,64; -70,88]);
        Control.ToScale clutchFrictionScale(yHigh=34.937) 
                                   annotation (extent=[-90,6; -66,30]);
        ThermoPower.Gas.SensT bladePath(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[14,6; 34,26], rotation=90);
        Modelica.Blocks.Interfaces.RealOutput exhaust_T 
          annotation (extent=[96,70; 116,90]);
        Modelica.Blocks.Interfaces.RealOutput bladePath_T 
          annotation (extent=[96,20; 116,40]);
        Modelica.Blocks.Interfaces.RealOutput frequency "Per Unit" 
          annotation (extent=[96,-90; 116,-70]);
        Modelica.Blocks.Interfaces.RealOutput electricalPower "Per Unit" 
          annotation (extent=[94,-56; 116,-32]);
        Control.ServoActuator servoValve(
          Tt=20,
          T=2,
          yLow=0.1,
          steadyStateInit=true)              annotation (extent=[-64,68; -50,84]);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          pstart=0.98e5,
          HH=37.47e6,
          tableHI=Components.Table_sper.GT20Data.tabHI,
          tablePR=Components.Table_sper.GT20Data.tabPR,
          tableW=Components.Table_sper.GT20Data.tabW,
          tableZLP=Components.Table_sper.GT20Data.tabZLP,
          tableN=Components.Table_sper.GT20Data.tabN,
          Tstart=282.15) 
          annotation (extent=[-26,-26; 6,14]);
        Modelica.Mechanics.Rotational.IdealGear Gear(ratio=(4949/60)/(25)) 
          annotation (extent=[34,-16; 50,0]);
        ThermoPower.Gas.Header Silencer(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          initOpt=ThermoPower.Choices.Init.Options.steadyStateNoP,
          Tmstart=300,
          gamma=4500*4000,
          Cm=20e6,
          V=0.0875,
          S=0.0098) 
          annotation (extent=[36,50; 52,66]);
        ThermoPower.Gas.SensP ComprPressure(redeclare package Medium = 
              FuelMedium)                   annotation (extent=[-52,0; -18,30]);
        Modelica.Mechanics.Rotational.Speed Motor 
          annotation (extent=[-84,-18; -62,4]);
        Modelica.Blocks.Sources.Ramp MotorSpeed(
          duration=1,
          startTime=65,
          height=395 - 110,
          offset=110) annotation (extent=[-118,-18; -98,2]);
        Modelica.Blocks.Interfaces.RealOutput comprPressure 
          annotation (extent=[94,-20; 118,2]);
      equation 
        electricalPower = generator.powerConnection.W/nominalElectricalPower;
        frequency = generator.powerConnection.f/fn;
        
        connect(InletAtmosphere.flange, InletPressDrop.inlet) 
                                                   annotation (points=[-78,-54; -70,
              -54],   style(color=76, rgbcolor={159,159,223}));
        connect(fuelSource.flange, fuelValve.inlet) 
                                               annotation (points=[-80,49; -78,49;
              -78,50; -74,50],
            style(color=76, rgbcolor={159,159,223}));
        connect(generator.powerConnection, breaker.connection1) 
          annotation (points=[72.74,-8; 72,-8; 72,-6.6],
                                                 style(pattern=0, thickness=2));
        connect(breaker.connection2, Grid.connection) 
          annotation (points=[72,10.6; 72,15; 77.26,15],
                                                   style(pattern=0, thickness=2));
        connect(fuelValve.outlet, fuelPlenum.inlet) 
                                              annotation (points=[-58,50; -56,50;
              -56,51; -48,51],
            style(color=76, rgbcolor={159,159,223}));
        connect(fuelPlenum.outlet, fuelPressDrop.inlet) 
                                                  annotation (points=[-26,51;
              -10,51; -10,46; -11,46],
            style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.outlet, OutAtmosphere.flange) 
                                              annotation (points=[70,56; 74,56; 74,
              58; 76,58],
            style(color=76, rgbcolor={159,159,223}));
        connect(GTHeatRate, valveOpeningScale.u) annotation (points=[-112,76; -96.4,
              76], style(color=74, rgbcolor={0,0,127}));
        connect(breakerClosed, breaker.closed) annotation (points=[-104,-82; 80,
              -82; 80,2; 78.4,2],
                             style(color=5, rgbcolor={255,0,255}));
        connect(bladePath.outlet, OutPressDrop.inlet) 
                                                    annotation (points=[28,22; 28,
              28; 27,28],
                   style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.T, exhaust_T) annotation (points=[71,66; 78,66; 78,80; 106,
              80], style(color=74, rgbcolor={0,0,127}));
        connect(bladePath.T, bladePath_T) annotation (points=[18,23; 18,30; 106,30],
            style(color=74, rgbcolor={0,0,127}));
        connect(clutchFrictionScale.y, Clutch.friction)        annotation (points=[-64.8,18;
              -51,18; -51,-2.4],           style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction, clutchFrictionScale.u) annotation (points=[-110,20;
              -100,20; -100,18; -92.4,18],
                         style(color=74, rgbcolor={0,0,127}));
        connect(valveOpeningScale.y, servoValve.u) annotation (points=[-68.8,76;
              -63.65,76], style(color=74, rgbcolor={0,0,127}));
        connect(servoValve.y, fuelValve.theta) annotation (points=[-49.16,76; -40,
              76; -40,64; -66,64; -66,57.2],
                                         style(color=74, rgbcolor={0,0,127}));
        connect(GTunit.FlueGas_out, bladePath.inlet)  annotation (points=[4.4,0;
              14.5,0; 14.5,10; 28,10],style(color=76, rgbcolor={159,159,223}));
        connect(GTunit.shaft_b, GTInertia.flange_a) 
          annotation (points=[5.68,-6; 10,-6; 10,-8; 14,-8],
                                               style(color=0, rgbcolor={0,0,0}));
        connect(Clutch.flange_b, GTunit.shaft_b)         annotation (points=[-44,-8;
              -44,-22; 4,-22; 4,-6; 5.68,-6], style(color=0, rgbcolor={0,0,0}));
        connect(fuelPressDrop.outlet, GTunit.Fuel_in)  annotation (points=[-11,18;
              -10,18; -10,8.4], style(color=76, rgbcolor={159,159,223}));
        connect(InletPressDrop.outlet, GTunit.Air_in) 
                                                   annotation (points=[-44,-54; -42,
              -54; -42,0; -24.4,0],   style(color=76, rgbcolor={159,159,223}));
        connect(GTInertia.flange_b, Gear.flange_a) 
          annotation (points=[28,-8; 34,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Gear.flange_b, generator.shaft) 
          annotation (points=[50,-8; 57.26,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Silencer.outlet, exhaust.inlet) 
                                               annotation (points=[52,58; 56,58; 56,
              56; 58,56],
                      style(color=76, rgbcolor={159,159,223}));
        connect(OutPressDrop.outlet, Silencer.inlet) 
                                                  annotation (points=[27,52; 27,58;
              36,58], style(color=76, rgbcolor={159,159,223}));
        connect(ComprPressure.flange, GTunit.Fuel_in)  annotation (points=[-35,9;
              -35,8.4; -10,8.4],           style(color=3, rgbcolor={0,0,255}));
        connect(Motor.flange_b, Clutch.flange_a)  annotation (points=[-62,-7; -60,
              -7; -60,-8; -58,-8],  style(color=0, rgbcolor={0,0,0}));
        connect(MotorSpeed.y, Motor.w_ref) 
                                       annotation (points=[-97,-8; -90,-8; -90,-7;
              -86.2,-7],
            style(color=74, rgbcolor={0,0,127}));
        connect(ComprPressure.p, comprPressure) annotation (points=[-25.82,24; 80,
              24; 80,-9; 106,-9],   style(color=74, rgbcolor={0,0,127}));
      end PlantUNIT__avv;
      
      model GT_2 
        extends ThermoPower.PowerPlants.GasTurbine.Interfaces.GT;
        parameter SI.MassFraction Xexhaust[GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        Gas.PressDrop OutPressDrop(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          Tstart=495,
          pstart=1.025e5,
          dpnom=1175,
          Kf=0.0288,
          rhonom=0.7,
          wnom=585.5)                        annotation (extent=[30,10; 50,30],
            rotation=90);
        Gas.PressDrop InletPressDrop(
          redeclare package Medium = AirMedium,
          pstart=1.01325e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=1.2,
          Tstart=282.15,
          Kf=0.116,
          dpnom=3738,
          wnom=585.5)                        annotation (extent=[-60,-22; -40,
              -2], rotation=270);
        Gas.Valve fuelValve(            redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          CvData=ThermoPower.Choices.Valve.CvTypes.Av,
          pnom=20e5,
          Av=0.0022,
          dpnom=7.5e5)               annotation (extent=[10,50; -10,70],
            rotation=270);
        Gas.SensT T_exhaust(redeclare package Medium = FlueGasMedium) 
                                     annotation (extent=[50,74; 70,94]);
        Gas.Plenum fuelPlenum(            redeclare package Medium = 
              FuelMedium,
          pstart=12.5e5,
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          V=0.5)                            annotation (extent=[-10,20; 10,40],
            rotation=270);
        Gas.PressDrop fuelPressDrop(            redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          pstart=12.5e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=8.18,
          Kf=213336,
          dpnom=3.45e5) 
          annotation (extent=[-10,-8; 10,12],  rotation=270);
        Gas.SensT T_bladePath(redeclare package Medium = FlueGasMedium) 
                                     annotation (extent=[26,-20; 46,0],rotation=90);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          HH=37.47e6,
          pstart=0.9758e5,
          Tstart=282.15,
          tableHI=Components.Table_finali.GT20Data.tabHI,
          tablePR=Components.Table_finali.GT20Data.tabPR,
          tableW=Components.Table_finali.GT20Data.tabW,
          tableZLP=Components.Table_finali.GT20Data.tabZLP,
          tableN=Components.Table_finali.GT20Data.tabN) 
          annotation (extent=[-20,-62; 20,-22]);
        Gas.Header Silencer(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          initOpt=ThermoPower.Choices.Init.Options.steadyStateNoP,
          Tmstart=300,
          gamma=4500*4000,
          Cm=20e6,
          V=0.0875,
          S=0.0098) 
          annotation (extent=[30,44; 50,64], rotation=90);
        Gas.SensP p_fuelCompr(redeclare package Medium = FuelMedium) 
                                            annotation (extent=[-38,-12; -18,8]);
        annotation (Diagram);
        Modelica.Mechanics.Rotational.Sensors.SpeedSensor omega_shaft 
          annotation (extent=[40,-76; 60,-56]);
      equation 
        connect(GTunit.FlueGas_out, T_bladePath.inlet) annotation (points=[18,
              -36; 40,-36; 40,-16], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(T_bladePath.outlet, OutPressDrop.inlet) annotation (points=[40,
              -4; 40,10], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(T_exhaust.outlet, FlueGasOutlet) annotation (points=[66,80; 100,
              80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(OutPressDrop.outlet, Silencer.inlet) annotation (points=[40,30;
              40,44], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(Silencer.outlet, T_exhaust.inlet) annotation (points=[40,64; 40,
              80; 54,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(GTunit.Fuel_in, fuelPressDrop.outlet) annotation (points=[0,
              -27.6; 0,-8; -1.83691e-015,-8], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(fuelPressDrop.inlet, fuelPlenum.outlet) annotation (points=[
              1.83691e-015,12; -1.83691e-015,12; -1.83691e-015,20], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(fuelPlenum.inlet, fuelValve.outlet) annotation (points=[
              1.83691e-015,40; -4.69266e-022,46; 1.83691e-015,46; 1.83691e-015,
              50], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(fuelValve.inlet, FuelInlet) annotation (points=[-1.83691e-015,
              70; 0,70; 0,90], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(GTunit.Air_in, InletPressDrop.outlet) annotation (points=[-18,
              -36; -50,-36; -50,-22], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(InletPressDrop.inlet, AirInlet) annotation (points=[-50,-2; -50,
              80; -100,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(p_fuelCompr.flange, fuelPressDrop.outlet) annotation (points=[
              -28,-6; -28,-20; 0,-20; 0,-8; -1.83691e-015,-8], style(
            color=76,
            rgbcolor={170,170,255},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(omega_shaft.flange_a, GTunit.shaft_b) annotation (points=[40,
              -66; 34,-66; 34,-42; 19.6,-42], style(
            color=0,
            rgbcolor={0,0,0},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(shaft_b, GTunit.shaft_b) annotation (points=[100,0; 60,0; 60,
              -42; 19.6,-42], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(SensorsBus.omega_shaft, omega_shaft.w) annotation (points=[98,
              -40; 76,-40; 76,-66; 61,-66], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(SensorsBus.T_bladePath, T_bladePath.T) annotation (points=[98,
              -40; 76,-40; 76,4; 30,4; 30,-3], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(SensorsBus.T_exhaust, T_exhaust.T) annotation (points=[98,-40;
              76,-40; 76,90; 67,90], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(SensorsBus.p_fuelCompr, p_fuelCompr.p) annotation (points=[98,
              -40; 76,-40; 76,4; 14,4; 14,-16; -16,-16; -16,4; -22.6,4], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(ActuatorsBus.theta_fuelValve, fuelValve.theta) annotation (
            points=[98,-72; -72,-72; -72,60; -7.2,60], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
      end GT_2;
      
      model GT 
        extends Interfaces.GT;
        parameter SI.Power nominalElectricalPower=50e9;
        parameter SI.Frequency fn=50;
        parameter SI.MassFraction Xexhaust[GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        parameter SI.AngularVelocity omega_sync=
            Modelica.SIunits.Conversions.from_rpm(4949);
        Gas.PressDrop OutPressDrop(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          Tstart=495,
          pstart=1.025e5,
          dpnom=1175,
          Kf=0.0288,
          rhonom=0.7,
          wnom=585.5)                        annotation (extent=[14,20; 34,40],
            rotation=90);
        Gas.PressDrop InletPressDrop(
          redeclare package Medium = AirMedium,
          pstart=1.01325e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=1.2,
          Tstart=282.15,
          Kf=0.116,
          dpnom=3738,
          wnom=585.5)                        annotation (extent=[-90,-10; -70,
              10], rotation=270);
        Gas.Valve fuelValve(            redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          CvData=ThermoPower.Choices.Valve.CvTypes.Av,
          pnom=20e5,
          Av=0.0022,
          dpnom=7.5e5)               annotation (extent=[0,48; -20,68],
            rotation=270);
        Modelica.Mechanics.Rotational.Inertia GTInertia(     J=7000, w(start=316.14/2)) 
          annotation (extent=[26,-50; 40,-30]);
        Gas.SensT exhaust(            redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[50,64; 70,84]);
        Electrical.Generator generator(
          eta=0.98,
          f(start=50),
          shaft(phi(start=0)),
          J=3500)                                   annotation (extent=[62,-36;
              82,-16], rotation=90);
        Electrical.Breaker breaker              annotation (extent=[80,0; 64,20],
            rotation=90);
        Electrical.Grid Grid(
          Pn=nominalElectricalPower,
          fn=fn,
          droop=0.05)                     annotation (extent=[82,28; 62,48],
            rotation=90);
        Gas.Plenum fuelPlenum(            redeclare package Medium = 
              FuelMedium,
          pstart=12.5e5,
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          V=0.5)                            annotation (extent=[-20,16; 0,36],
            rotation=270);
        Gas.PressDrop fuelPressDrop(            redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          pstart=12.5e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=8.18,
          Kf=213336,
          dpnom=3.45e5) 
          annotation (extent=[-20,-14; 0,6],   rotation=270);
        Components.HydraulicClutch Clutch 
                                   annotation (extent=[-40,-92; -24,-74]);
        Control.ToScale valveOpeningScale(yHigh=0.7) 
                                  annotation (extent=[-76,46; -52,70]);
        Control.ToScale clutchFrictionScale(yHigh=34.937) 
                                   annotation (extent=[-64,-66; -48,-50]);
        Gas.SensT bladePath(            redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[10,-18; 30,2],rotation=90);
        Control.ServoActuator servoValve(
          Tt=20,
          T=2,
          yLow=0.1,
          steadyStateInit=true)              annotation (extent=[-44,50; -30,66]);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          HH=37.47e6,
          pstart=0.9758e5,
          Tstart=282.15,
          tableHI=Components.Table_finali.GT20Data.tabHI,
          tablePR=Components.Table_finali.GT20Data.tabPR,
          tableW=Components.Table_finali.GT20Data.tabW,
          tableZLP=Components.Table_finali.GT20Data.tabZLP,
          tableN=Components.Table_finali.GT20Data.tabN) 
          annotation (extent=[-30,-60; 10,-20]);
        Modelica.Mechanics.Rotational.IdealGear Gear(ratio=(4949/60)/(25)) 
          annotation (extent=[46,-48; 62,-32]);
        Gas.Header Silencer(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          initOpt=ThermoPower.Choices.Init.Options.steadyStateNoP,
          Tmstart=300,
          gamma=4500*4000,
          Cm=20e6,
          V=0.0875,
          S=0.0098) 
          annotation (extent=[28,62; 44,78]);
        Gas.SensP ComprPressure(            redeclare package Medium = 
              FuelMedium)                   annotation (extent=[-50,0; -30,20]);
        Modelica.Mechanics.Rotational.Speed Motor 
          annotation (extent=[-66,-94; -44,-72]);
        Modelica.Blocks.Sources.Ramp MotorSpeed(
          duration=1,
          startTime=65,
          height=395 - 110,
          offset=110) annotation (extent=[-98,-92; -80,-74]);
        annotation (Diagram);
      equation 
        connect(clutchFrictionScale.y,Clutch. friction)        annotation (points=[-47.2,
              -58; -32,-58; -32,-76.7],    style(color=74, rgbcolor={0,0,127}));
        connect(valveOpeningScale.y,servoValve. u) annotation (points=[-50.8,58;
              -43.65,58], style(color=74, rgbcolor={0,0,127}));
        connect(servoValve.y,fuelValve. theta) annotation (points=[-29.16,58;
              -17.2,58],                 style(color=74, rgbcolor={0,0,127}));
        connect(Motor.flange_b,Clutch. flange_a)  annotation (points=[-44,-83;
              -40,-83],             style(color=0, rgbcolor={0,0,0}));
        connect(MotorSpeed.y,Motor. w_ref) 
                                       annotation (points=[-79.1,-83; -68.2,-83],
            style(color=74, rgbcolor={0,0,127}));
        connect(Clutch.flange_b, GTunit.shaft_b) annotation (points=[-24,-83;
              14,-83; 14,-40; 9.6,-40], style(
            color=0,
            rgbcolor={0,0,0},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTunit.Air_in, InletPressDrop.outlet) annotation (points=[-28,
              -34; -80,-34; -80,-10], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(InletPressDrop.inlet, AirInlet) annotation (points=[-80,10; -80,
              40; -100,40; -100,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTInertia.flange_a, GTunit.shaft_b) annotation (points=[26,-40;
              9.6,-40], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(generator.shaft, Gear.flange_b) annotation (points=[72,-34.6;
              72,-40; 62,-40], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(generator.powerConnection, breaker.connection1) annotation (
            points=[72,-17.4; 72,1.4], style(
            pattern=0,
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Grid.connection, breaker.connection2) annotation (points=[72,
              29.4; 72,18.6], style(
            pattern=0,
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTunit.FlueGas_out, bladePath.inlet) annotation (points=[8,-34;
              24,-34; 24,-14], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(bladePath.outlet, OutPressDrop.inlet) annotation (points=[24,-2;
              24,20], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Silencer.inlet, OutPressDrop.outlet) annotation (points=[28,70;
              24,70; 24,40], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Silencer.outlet, exhaust.inlet) annotation (points=[44,70; 54,
              70], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(exhaust.outlet, FlueGasOutlet) annotation (points=[66,70; 74,70;
              74,80; 100,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelPressDrop.inlet, fuelPlenum.outlet) annotation (points=[-10,
              6; -10,7.5; -10,7.5; -10,9; -10,16; -10,16], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelPressDrop.outlet, GTunit.Fuel_in) annotation (points=[-10,
              -14; -10,-19.8; -10,-19.8; -10,-25.6], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelValve.outlet, fuelPlenum.inlet) annotation (points=[-10,48;
              -10,44; -10,44; -10,40; -10,36; -10,36], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelValve.inlet, FuelInlet) annotation (points=[-10,68; -10,76;
              0,76; 0,90], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(ComprPressure.flange, GTunit.Fuel_in) annotation (points=[-40,6;
              -40,-20; -10,-20; -10,-25.6], style(
            color=76,
            rgbcolor={170,170,255},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Gear.flange_a, GTInertia.flange_b) annotation (points=[46,-40;
              40,-40], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(ActuatorsBus.breakerClosed, breaker.closed) annotation (points=
              [98,-72; 86,-72; 86,10; 78,10], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(ActuatorsBus.clutchFriction, clutchFrictionScale.u) annotation (
           points=[98,-72; -74,-72; -74,-58; -65.6,-58], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(ActuatorsBus.GTHeatRate, valveOpeningScale.u) annotation (
            points=[98,-72; -74,-72; -74,44; -92,44; -92,58; -80,58], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end GT;
      
      model GT_simp 
        extends Interfaces.GT;
        annotation (Diagram);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          HH=37.47e6,
          pstart=0.9758e5,
          Tstart=282.15,
          tableHI=Components.Table_finali.GT20Data.tabHI,
          tablePR=Components.Table_finali.GT20Data.tabPR,
          tableW=Components.Table_finali.GT20Data.tabW,
          tableZLP=Components.Table_finali.GT20Data.tabZLP,
          tableN=Components.Table_finali.GT20Data.tabN) 
          annotation (extent=[-20,-20; 20,20]);
      equation 
        connect(GTunit.shaft_b, shaft_b) annotation (points=[19.6,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTunit.FlueGas_out, FlueGasOutlet) annotation (points=[18,6; 62,
              6; 62,80; 100,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTunit.Fuel_in, FuelInlet) annotation (points=[0,14.4; 0,14.4;
              0,90], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTunit.Air_in, AirInlet) annotation (points=[-18,6; -60,6; -60,
              80; -100,80], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end GT_simp;
    end Examples;
    
    package Tests 
      model TestServoActuator 
        GTStartup_finale.Control.ServoActuator Servo(
          T=1,
          yLow=-1,
          yHigh=1,
          steadyStateInit=true,
          Tt=10)                annotation (extent=[40,-20; 60,0]);
        Modelica.Blocks.Sources.Step Step1(             height=2,
          startTime=5,
          offset=0)   annotation (extent=[-80,40; -60,60]);
        annotation (Diagram, experiment(
            StopTime=50,
            fixedstepsize=0.01,
            Algorithm=""),
          Documentation(info="<html>
This model tests the <tt>ServoActuator</tt> model.
<p>Run the simulation for 50 seconds.
<ul>
<li>The simulation starts at steady state with an output of 0.1. 
<li>At time t = 1 s, the input is changed stepwise to zero, and the output follows with a time constant of 1 s. 
<li>At time t = 5 s, a step change of +2 is applied; the output follows at the maximum allowed speed, until it saturates at the upper limit of 1.
<li>At time t = 15s, the input is reduced rampwise to zero; after about 1 s, the output starts reducing at the maximum speed. The end of the transient is the usual first-order dynamics with a time constant of 1 s.
<li>At time t = 25 s, a negative step of amplitude -2 is applied, and the output saturates on the lower limit of -1
<li>At time t = 35 s, the input is changed stepwise to +2; the output follows with the maximum speed (total travel time = 10 s) and then saturates again at +1.
</ul>
</html>",     revisions="<html>
<ul>
<li><i>1 Jun 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       First release.</li>
</ul>
</html>"));
        Modelica.Blocks.Sources.Ramp Ramp1(              height=-2, startTime=15) 
          annotation (extent=[-80,0; -60,20]);
        Modelica.Blocks.Sources.Step Step2(height=-2, startTime=25) 
          annotation (extent=[-80,-40; -60,-20]);
        Modelica.Blocks.Math.Add Add2 annotation (extent=[-40,-60; -20,-40]);
        Modelica.Blocks.Math.Add ServoInput 
                                      annotation (extent=[0,-20; 20,0]);
        Modelica.Blocks.Sources.Step Step3(height=4, startTime=35) 
          annotation (extent=[-80,-80; -60,-60]);
        Modelica.Blocks.Math.Add3 Add3_1 annotation (extent=[-40,38; -20,58]);
        Modelica.Blocks.Sources.Step Step(
          startTime=1,
          offset=0.1,
          height=-0.1) 
                      annotation (extent=[-80,80; -60,100]);
      equation 
        connect(Step2.y,Add2. u1) annotation (points=[-59,-30; -50,-30; -50,-44;
              -42,-44], style(color=74, rgbcolor={0,0,127}));
        connect(Add2.y, ServoInput.u2) 
                                 annotation (points=[-19,-50; -12,-50; -12,-16; -2,
              -16],
            style(color=74, rgbcolor={0,0,127}));
        connect(ServoInput.y, Servo.u) 
                                 annotation (points=[21,-10; 30.75,-10; 30.75,-10;
              40.5,-10],                                              style(color=
                74, rgbcolor={0,0,127}));
        connect(Step3.y, Add2.u2) annotation (points=[-59,-70; -48,-70; -48,-56;
              -42,-56], style(color=74, rgbcolor={0,0,127}));
        connect(Ramp1.y, Add3_1.u3) annotation (points=[-59,10; -52,10; -52,40; -42,
              40], style(color=74, rgbcolor={0,0,127}));
        connect(Step1.y, Add3_1.u2) annotation (points=[-59,50; -52,50; -52,48; -42,
              48], style(color=74, rgbcolor={0,0,127}));
        connect(Add3_1.y, ServoInput.u1) annotation (points=[-19,48; -12,48; -12,-4;
              -2,-4], style(color=74, rgbcolor={0,0,127}));
        connect(Step.y, Add3_1.u1) annotation (points=[-59,90; -52,90; -52,56; -42,
              56], style(color=74, rgbcolor={0,0,127}));
      end TestServoActuator;
      
      model temperature 
        annotation (uses(ThermoPower(version="2"), Modelica(version="2.2")), Diagram,
          Documentation(info="<html>
test per valutare quale sarebbe la temperatura in ingresso alla turbina non considerando la presenza di spillamenti.
</html>"));
        parameter Real Xnom[5]={0.18592,0.0133,0.02482,0.03315,0.74280};
        ThermoPower.Gas.SourceW Wcompressor(redeclare package Medium = 
              ThermoPower.Media.Air) 
          annotation (extent=[-70,-10; -50,10]);
        ThermoPower.Gas.CombustionChamber CombustionChamber1(
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          HH=41.6e6,
          V=0.05,
          S=0.05,
          Xstart=Xnom,
          pstart=10.216e5) annotation (extent=[-20,-10; 0,10]);
        ThermoPower.Gas.SourceW Wfuel(redeclare package Medium = 
              ThermoPower.Media.NaturalGas) 
          annotation (extent=[-28,28; -8,48]);
        ThermoPower.Gas.SinkP PressureTurbine(
          redeclare package Medium = ThermoPower.Media.FlueGas,
          Xnom=Xnom,
          p0=9.828e5) annotation (extent=[84,-10; 104,10]);
        Modelica.Blocks.Sources.Constant Constant1(k=2) 
          annotation (extent=[-52,66; -32,86]);
        Modelica.Blocks.Sources.Constant Constant2(k=575.95) 
          annotation (extent=[-96,36; -76,56]);
        ThermoPower.Gas.PressDrop PressDrop1(
          redeclare package Medium = ThermoPower.Media.FlueGas,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.OpPoint,
          rhonom=3,
          Xstart=Xnom,
          pstart=10.216e5,
          wnom=166.8,
          dpnom=0.388e5)  annotation (extent=[24,-10; 44,10]);
        ThermoPower.Gas.SensT SensT1(redeclare package Medium = 
              ThermoPower.Media.FlueGas) annotation (extent=[54,-6; 74,14]);
        Modelica.Blocks.Sources.Constant Constant3(k=164.8) 
          annotation (extent=[-104,6; -84,26]);
      equation 
        connect(Wfuel.flange, CombustionChamber1.inf) annotation (points=[-8,38; -8,
              10; -10,10],style(color=76, rgbcolor={159,159,223}));
        connect(Wcompressor.flange, CombustionChamber1.ina) annotation (points=[-50,
              0; -20,0],
                      style(color=76, rgbcolor={159,159,223}));
        connect(Constant1.y, Wfuel.in_w0) annotation (points=[-31,76; -28,76; -28,43;
              -24,43], style(color=74, rgbcolor={0,0,127}));
        connect(Constant2.y, Wcompressor.in_T) annotation (points=[-75,46; -60,46;
              -60,5], style(color=74, rgbcolor={0,0,127}));
        connect(CombustionChamber1.out, PressDrop1.inlet) 
          annotation (points=[0,0; 24,0], style(color=76, rgbcolor={159,159,223}));
        connect(PressDrop1.outlet, SensT1.inlet) 
          annotation (points=[44,0; 58,0], style(color=76, rgbcolor={159,159,223}));
        connect(SensT1.outlet, PressureTurbine.flange) 
          annotation (points=[70,0; 84,0], style(color=76, rgbcolor={159,159,223}));
        connect(Constant3.y, Wcompressor.in_w0) annotation (points=[-83,16; -74,16;
              -74,5; -66,5], style(color=74, rgbcolor={0,0,127}));
      end temperature;
      
      model TestPlantUNIT5__finale 
        
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        GTStartup_finale.Components.PlantUNIT__finale plant(
            nominalElectricalPower =                                               50e9) 
                    annotation (extent=[50,-42; 92,0]);
        Modelica.Blocks.Sources.Ramp valvolaAvviamento(
          startTime=103,
          offset=0,
          duration=295 - 103,
          height=0.127 - 0.064)                 annotation (extent=[-98,60; -76,82]);
        Modelica.Blocks.Sources.BooleanStep breakerClosed(               startValue=
             false, startTime=820) 
          annotation (extent=[-12,-80; 8,-60]);
        annotation (Diagram, uses(Modelica(version="2.2")),
          experiment(StopTime=1000),
          Documentation(info="<html>
test per ricostruire l'andamento delle grandezze caratteristiche in avviamento, suddividendo la portata di combustibile in una somma di rampe che schematizzano la portata immessa per accendere la macchina, la portata immmessa dalla valvola di avviamento a cui fa seguito una valvola principale, a sua volta suddivisa in una parte che considera la connessione e il momento del distacco del motore e la finale presa di giri.
<p>una volta avvenuta la sincronizzazione alla rete, non si ha nessun incremento di combustibile</p>
<p>il modello di impianto considerato è <tt>GTStartup_finale.Components.PlantUnit__finale</tt>
</html>"));
        Modelica.Blocks.Sources.Ramp Accensione(
          offset=0.00088,
          height=0.064 - 0.00088,
          duration=13,
          startTime=90)   annotation (extent=[-62,74; -42,94]);
        Modelica.Blocks.Math.Add3 GTHeatRate 
                                         annotation (extent=[-20,60; 0,80]);
        Modelica.Blocks.Sources.Ramp MotoreConnesso(
          offset=0,
          startTime=295,
          height=0.174 - 0.127,
          duration=408 - 295)                   annotation (extent=[-122,28; -100,
              50]);
        
        Real wiso "portata di aria elaborata";
        Real wcomb "portata di combustibile";
        Real omega "velocità gruppo turbogas";
        Real TbladePath;
        Real Texhaust;
        Real Press_compr;
        
        Modelica.Blocks.Math.Add valvolaPrincipale 
          annotation (extent=[-52,26; -32,46]);
        Modelica.Blocks.Sources.Ramp PresaGiri(
          offset=0,
          startTime=415,
          duration=528 - 415,
          height=0.269 - 0.1898)                annotation (extent=[-82,-20; -60,2]);
        Modelica.Blocks.Sources.Ramp clutchFriction(
          height=-1,
          offset=1,
          duration=2,
          startTime=411) 
          annotation (extent=[-24,-26; -4,-6]);
        Modelica.Blocks.Math.Add Connessione 
          annotation (extent=[-82,28; -62,48]);
        Modelica.Blocks.Sources.Ramp DistaccoMotore(
          offset=0,
          duration=415 - 408,
          startTime=408,
          height=0.1898 - 0.174)                annotation (extent=[-122,-4; -100,
              18]);
      equation 
        
        wiso=plant.GTunit.wia*sqrt(plant.GTunit.gas.T/Tiso)/(plant.GTunit.gas.p/piso);
        wcomb=plant.GTunit.wif;
        omega=plant.GTunit.omega*60/(2*Modelica.Constants.pi);
        TbladePath=plant.bladePath.gas.T_degC;
        Texhaust=plant.exhaust_T-273.15;
        Press_compr=plant.comprPressure;
        
        connect(breakerClosed.y, plant.breakerClosed) annotation (points=[9,-70; 20,
              -70; 20,-38.22; 49.16,-38.22],
                                           style(color=5, rgbcolor={255,0,255}));
        
      initial equation 
       plant.generator.shaft.phi=0;
        
      // plant.GTInertia.w=omega0_n*plant.omega_sync;
      // der(plant.motor.omega)=0;
      // der(plant.GTInertia.w)=0;
      equation 
        connect(Accensione.y,GTHeatRate. u1) 
                                         annotation (points=[-41,84; -40,84; -40,78;
              -22,78],
                   style(color=74, rgbcolor={0,0,127}));
        connect(valvolaAvviamento.y,GTHeatRate. u2) 
                                     annotation (points=[-74.9,71; -66,71; -66,70;
              -22,70], style(color=74, rgbcolor={0,0,127}));
        connect(valvolaPrincipale.y,GTHeatRate. u3)       annotation (points=[-31,
              36; -28,36; -28,62; -22,62], style(color=74, rgbcolor={0,0,127}));
        connect(PresaGiri.y, valvolaPrincipale.u2)            annotation (points=[
              -58.9,-9; -58,-9; -58,30; -54,30],
                                               style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction.y, plant.clutchFriction) annotation (points=[-3,-16;
              0,-16; 0,-16.8; 47.9,-16.8], style(color=74, rgbcolor={0,0,127}));
        connect(Connessione.y, valvolaPrincipale.u1)        annotation (points=[-61,
              38; -54,38; -54,42],     style(color=74, rgbcolor={0,0,127}));
        connect(DistaccoMotore.y, Connessione.u2)        annotation (points=[-98.9,
              7; -98.9,22; -88,22; -88,32; -84,32],
                                                  style(color=74, rgbcolor={0,0,127}));
        connect(MotoreConnesso.y, Connessione.u1)        annotation (points=[-98.9,
              39; -84.45,39; -84.45,44; -84,44], style(color=74, rgbcolor={0,0,127}));
        connect(GTHeatRate.y, plant.GTHeatRate) annotation (points=[1,70; 22,70;
              22,-5.04; 47.48,-5.04],
                            style(color=74, rgbcolor={0,0,127}));
      end TestPlantUNIT5__finale;
      
      model TestPlantUNIT5__finaleCARICO 
      // unità di misura fatte per avere riscontro con le grandezze reali
        
        Time Tempo=time/60;
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        constant Real density=0.82;
        GTStartup_finale.Components.PlantUNIT__finale plant(
            nominalElectricalPower =                                               50e9) 
                    annotation (extent=[54,-42; 96,0]);
        Modelica.Blocks.Sources.Ramp valvolaAvviamento(
          startTime=103,
          offset=0,
          duration=295 - 103,
          height=0.127 - 0.064)                 annotation (extent=[-98,60; -76,82]);
        Modelica.Blocks.Sources.BooleanStep breakerClosed(
          startValue=false,
          startTime=800) 
          annotation (extent=[-10,-74; 10,-54]);
        annotation (Diagram, uses(Modelica(version="2.2")),
          experiment(StopTime=1000),
          Documentation(info="<html>
test per ricostruire l'andamento delle grandezze caratteristiche in avviamento, suddividendo la portata di combustibile in una somma di rampe che schematizzano la portata immessa per accendere la macchina, la portata immmessa dalla valvola di avviamento a cui fa seguito una valvola principale, a sua volta suddivisa in una parte che considera la connessione e il momento del distacco del motore e la finale presa di giri.
<p>una volta avvenuta la sincronizzazione alla rete, si ha nessun incremento di combustibile, schematizzato dalla rampa <tt>CARICO</tt></p>
<p>il modello di impianto considerato è <tt>GTStartup_finale.Components.PlantUnit__finale</tt></p>
<p>le grandezze di interesse, <tt>wiso</tt> pari alla portata di aria elaborata, <tt>wcomb</tt> pari alla portata di combustibile, <tt>omega</tt> pari alla velocità del gruppo turbogas, <tt>TbladePath</tt> pari alla temperatura di BladePath, <tt>Texhaust</tt> pari alla temperatura di Exhaust, <tt>Press_compr</tt> pari alla pressione relativa di mandata compressore possono essere rappresentate in funzione del tempo espresso in minuti così da avere un maggior riscontro con le grandezze reali misurate
</html>"));
        Modelica.Blocks.Sources.Ramp Accensione(
          offset=0.00088,
          height=0.064 - 0.00088,
          duration=13,
          startTime=90)   annotation (extent=[-62,76; -42,96]);
        Modelica.Blocks.Sources.Ramp MotoreConnesso(
          offset=0,
          startTime=295,
          height=0.174 - 0.127,
          duration=408 - 295)                   annotation (extent=[-122,28; -100,
              50]);
        Modelica.Blocks.Math.Add valvolaPrincipale 
          annotation (extent=[-50,26; -30,46]);
        Modelica.Blocks.Sources.Ramp PresaGiri(
          offset=0,
          startTime=415,
          duration=528 - 415,
          height=0.27 - 0.1898)                 annotation (extent=[-82,-20; -60,2]);
        Modelica.Blocks.Sources.Ramp clutchFriction(
          height=-1,
          offset=1,
          duration=2,
          startTime=411) 
          annotation (extent=[-12,-30; 8,-10]);
        Modelica.Blocks.Math.Add Connessione 
          annotation (extent=[-82,28; -62,48]);
        Modelica.Blocks.Sources.Ramp DistaccoMotore(
          offset=0,
          duration=415 - 408,
          startTime=408,
          height=0.1898 - 0.174)                annotation (extent=[-122,-4; -100,
              18]);
        Modelica.Blocks.Math.Add3 AVVIAMENTO 
                                         annotation (extent=[-14,56; 6,76]);
        Modelica.Blocks.Sources.Ramp CARICO(
          offset=0,
          duration=150,
          height=0.99 - 0.266,
          startTime=800) 
                      annotation (extent=[-14,18; 6,38]);
        Modelica.Blocks.Math.Add GTHeatRate1 
          annotation (extent=[22,40; 42,60]);
        
        Real wiso(final unit="kg/s") "portata di aria elaborata";
        Real wcomb(final unit="l/s") "portata di combustibile";
        Real omega(final unit="rpm") "velocità gruppo turbogas";
        Real TbladePath(final unit="°C") "temperatura di BladePath";
        Real Texhaust(final unit="°C") "temperatura di Exhaust";
        Real Press_compr(final unit="bar") 
          "pressione relativa mandata compressore";
        
      equation 
        wiso=plant.GTunit.wia*sqrt(plant.GTunit.gas.T/Tiso)/(plant.GTunit.gas.p/piso);
        wcomb=plant.GTunit.wif/density;
        omega=plant.GTunit.omega*60/(2*Modelica.Constants.pi);
        TbladePath=plant.bladePath.gas.T_degC;
        Texhaust=Modelica.SIunits.Conversions.to_degC(plant.exhaust_T);
        Press_compr=Modelica.SIunits.Conversions.to_bar(plant.comprPressure-piso);
        
        connect(breakerClosed.y, plant.breakerClosed) annotation (points=[11,-64;
              20,-64; 20,-38.22; 53.16,-38.22],
                                           style(color=5, rgbcolor={255,0,255}));
        
      initial equation 
       plant.generator.shaft.phi=0;
        
      // plant.GTInertia.w=omega0_n*plant.omega_sync;
      // der(plant.motor.omega)=0;
      // der(plant.GTInertia.w)=0;
      equation 
        connect(PresaGiri.y, valvolaPrincipale.u2)            annotation (points=[
              -58.9,-9; -58,-9; -58,30; -52,30],
                                               style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction.y, plant.clutchFriction) annotation (points=[9,-20;
              20,-20; 20,-16.8; 51.9,-16.8],
                                           style(color=74, rgbcolor={0,0,127}));
        connect(MotoreConnesso.y, Connessione.u1)        annotation (points=[-98.9,
              39; -88.45,39; -88.45,44; -84,44], style(color=74, rgbcolor={0,0,127}));
        connect(AVVIAMENTO.y, GTHeatRate1.u1) annotation (points=[7,66; 16,66; 16,
              56; 20,56],
            style(color=74, rgbcolor={0,0,127}));
        connect(CARICO.y, GTHeatRate1.u2) annotation (points=[7,28; 14,28; 14,44;
              20,44], style(color=74, rgbcolor={0,0,127}));
        connect(Accensione.y, AVVIAMENTO.u1) annotation (points=[-41,86; -30,86;
              -30,74; -16,74], style(color=74, rgbcolor={0,0,127}));
        connect(valvolaAvviamento.y, AVVIAMENTO.u2) annotation (points=[-74.9,71;
              -39.45,71; -39.45,66; -16,66], style(color=74, rgbcolor={0,0,127}));
        connect(valvolaPrincipale.y, AVVIAMENTO.u3) annotation (points=[-29,36; -24,
              36; -24,58; -16,58], style(color=74, rgbcolor={0,0,127}));
        connect(plant.GTHeatRate, GTHeatRate1.y) annotation (points=[51.48,
              -5.04; 46,-5.04; 46,50; 43,50],
                                       style(color=74, rgbcolor={0,0,127}));
        connect(Connessione.u2, DistaccoMotore.y) annotation (points=[-84,32; -88,
              32; -88,7; -98.9,7], style(color=74, rgbcolor={0,0,127}));
        connect(valvolaPrincipale.u1, Connessione.y) annotation (points=[-52,42;
              -56,42; -56,38; -61,38], style(color=74, rgbcolor={0,0,127}));
      end TestPlantUNIT5__finaleCARICO;
      
      model TestPlantUNIT5___compl 
        
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        GTStartup_finale.Components.PlantUNIT__avv plant(nominalElectricalPower=50e9) 
                    annotation (extent=[50,-42; 92,0]);
        Modelica.Blocks.Sources.Ramp valvolaAvviamento(
          startTime=103,
          offset=0,
          duration=295 - 103,
          height=0.127 - 0.064)                 annotation (extent=[-98,60; -76,82]);
        Modelica.Blocks.Sources.BooleanStep breakerClosed(               startValue=
             false, startTime=900) 
          annotation (extent=[-12,-80; 8,-60]);
        annotation (Diagram, uses(Modelica(version="2.2")),
          experiment(StopTime=1200),
          Documentation(info="<html>
test per ricostruire l'andamento delle grandezze caratteristiche in avviamento, suddividendo la portata di combustibile in una somma di rampe che schematizzano la portata immessa per accendere la macchina, la portata immmessa dalla valvola di avviamento a cui fa seguito una valvola principale, a sua volta suddivisa in una parte che considera la connessione e il momento del distacco del motore e la finale presa di giri.
<p>una volta avvenuta la sincronizzazione alla rete, si ha nessun incremento di combustibile, schematizzato dalla rampa <tt>CARICO</tt></p>
<p>il modello di impianto considerato è <tt>GTStartup_finale.Components.PlantUnit__avv</tt>
</html>"));
        Modelica.Blocks.Sources.Ramp Accensione(
          offset=0.00088,
          height=0.064 - 0.00088,
          duration=13,
          startTime=90)   annotation (extent=[-62,74; -42,94]);
        Modelica.Blocks.Math.Add3 AVVIAMENTO 
                                         annotation (extent=[-20,60; 0,80]);
        Modelica.Blocks.Sources.Ramp MotoreConnesso(
          offset=0,
          startTime=295,
          height=0.174 - 0.127,
          duration=408 - 295)                   annotation (extent=[-122,28; -100,
              50]);
        
        Real wiso "portata di aria elaborata";
        Real wcomb "portata di combustibile";
        Real omega "velocità gruppo turbogas";
        Real TbladePath;
        Real Texhaust;
        Real PressureCompr;
        
        Modelica.Blocks.Math.Add valvolaPrincipale 
          annotation (extent=[-52,26; -32,46]);
        Modelica.Blocks.Sources.Ramp PresaGiri(
          offset=0,
          startTime=415,
          duration=528 - 415,
          height=0.2695 - 0.1898)               annotation (extent=[-82,-20; -60,2]);
        Modelica.Blocks.Sources.Ramp clutchFriction(
          height=-1,
          offset=1,
          duration=2,
          startTime=411) 
          annotation (extent=[-12,-26; 8,-6]);
        Modelica.Blocks.Math.Add Connessione 
          annotation (extent=[-82,28; -62,48]);
        Modelica.Blocks.Sources.Ramp DistaccoMotore(
          offset=0,
          duration=415 - 408,
          startTime=408,
          height=0.1898 - 0.174)                annotation (extent=[-122,-4; -100,
              18]);
        Modelica.Blocks.Sources.Ramp CARICO(
          offset=0,
          duration=150,
          height=0.7 - 0.266,
          startTime=900) 
                      annotation (extent=[-20,24; 0,44]);
        Modelica.Blocks.Math.Add GTHeatRate 
          annotation (extent=[12,30; 32,50]);
      equation 
        
        wiso=plant.GTunit.wia*sqrt(plant.GTunit.gas.T/Tiso)/(plant.GTunit.gas.p/piso);
        wcomb=plant.GTunit.wif;
        omega=plant.GTunit.omega*60/(2*Modelica.Constants.pi);
        TbladePath=plant.bladePath.gas.T_degC;
        Texhaust=plant.exhaust_T-273.15;
        PressureCompr=plant.comprPressure-piso;
        
        connect(breakerClosed.y, plant.breakerClosed) annotation (points=[9,-70; 20,
              -70; 20,-38.22; 49.16,-38.22],
                                           style(color=5, rgbcolor={255,0,255}));
        
      initial equation 
       plant.generator.shaft.phi=0;
        
      equation 
        connect(Accensione.y,AVVIAMENTO. u1) 
                                         annotation (points=[-41,84; -40,84; -40,78;
              -22,78],
                   style(color=74, rgbcolor={0,0,127}));
        connect(valvolaAvviamento.y,AVVIAMENTO. u2) 
                                     annotation (points=[-74.9,71; -66,71; -66,70;
              -22,70], style(color=74, rgbcolor={0,0,127}));
        connect(valvolaPrincipale.y,AVVIAMENTO. u3)       annotation (points=[-31,
              36; -28,36; -28,62; -22,62], style(color=74, rgbcolor={0,0,127}));
        connect(PresaGiri.y, valvolaPrincipale.u2)            annotation (points=[
              -58.9,-9; -58,-9; -58,30; -54,30],
                                               style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction.y, plant.clutchFriction) annotation (points=[9,-16; 0,
              -16; 0,-16.8; 47.9,-16.8],   style(color=74, rgbcolor={0,0,127}));
        connect(Connessione.y, valvolaPrincipale.u1)        annotation (points=[-61,
              38; -54,38; -54,42],     style(color=74, rgbcolor={0,0,127}));
        connect(DistaccoMotore.y, Connessione.u2)        annotation (points=[-98.9,
              7; -98.9,12.5; -84,12.5; -84,32],   style(color=74, rgbcolor={0,0,127}));
        connect(MotoreConnesso.y, Connessione.u1)        annotation (points=[-98.9,
              39; -84.45,39; -84.45,44; -84,44], style(color=74, rgbcolor={0,0,127}));
        connect(AVVIAMENTO.y, GTHeatRate.u1) annotation (points=[1,70; 10,70; 10,46],
                                                                                    style(
              color=74, rgbcolor={0,0,127}));
        connect(CARICO.y, GTHeatRate.u2) 
                                        annotation (points=[1,34; 10,34],
            style(color=74, rgbcolor={0,0,127}));
        connect(GTHeatRate.y, plant.GTHeatRate) annotation (points=[33,40; 40,
              40; 40,-5.04; 47.48,-5.04],
                                      style(color=74, rgbcolor={0,0,127}));
      end TestPlantUNIT5___compl;
      
      model TestGT 
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        parameter SI.MassFraction Xexhaust[gasTurbine.GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        parameter SI.Power nominalElectricalPower=50e9;
        parameter SI.Frequency fn=50;
        parameter SI.AngularVelocity omega_sync=
            Modelica.SIunits.Conversions.from_rpm(4949);
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        
        Real wiso "portata di aria elaborata";
        Real wcomb "portata di combustibile";
        Real omega "velocità gruppo turbogas";
        Real TbladePath;
        Real Texhaust;
        Real Press_compr;
        
        ThermoPower.PowerPlants.GasTurbine.Examples.GT_2 gasTurbine 
          annotation (extent=[-66,16; -2,80]);
        annotation (Diagram);
        Gas.SourceP fuelSource(            redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[-58,82; -42,98]);
        Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-94,66; -80,80]);
        Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          p0=1.01325e5,
          Xnom=Xexhaust)                 annotation (extent=[20,66; 34,80]);
      protected 
        Buses.Actuators actuators annotation (extent=[-20,-10; 0,10]);
      public 
        Components.HydraulicClutch Clutch 
                                   annotation (extent=[44,30; 24,10]);
        Control.ToScale clutchFrictionScale(yHigh=34.937) 
                                   annotation (extent=[10,-34; 24,-20]);
        Modelica.Mechanics.Rotational.Speed Motor 
          annotation (extent=[74,10; 54,30]);
        Modelica.Blocks.Sources.Ramp MotorSpeed(
          duration=1,
          startTime=65,
          height=395 - 110,
          offset=110) annotation (extent=[48,-20; 68,0]);
        Modelica.Mechanics.Rotational.Inertia GTInertia(     J=7000, w(start=316.14/2)) 
          annotation (extent=[18,38; 32,58]);
        Electrical.Generator generator(
          eta=0.98,
          f(start=50),
          shaft(phi(start=0)),
          J=3500)                                   annotation (extent=[60,38;
              78,58]);
        Electrical.Breaker breaker              annotation (extent=[84,48; 68,
              68],
            rotation=90);
        Electrical.Grid Grid(
          Pn=nominalElectricalPower,
          fn=fn,
          droop=0.05)                     annotation (extent=[98,62; 80,80],
            rotation=180);
        Modelica.Mechanics.Rotational.IdealGear Gear(ratio=(4949/60)/(25)) 
          annotation (extent=[38,40; 54,56]);
        Control.ToScale valveOpeningScale(yHigh=0.7) 
                                  annotation (extent=[-68,-8; -52,8]);
        Control.ServoActuator servoValve(
          Tt=20,
          T=2,
          yLow=0.1,
          steadyStateInit=true)              annotation (extent=[-44,-8; -30,8]);
        Modelica.Blocks.Sources.BooleanStep breakerClosed(               startValue=
             false, startTime=820) 
          annotation (extent=[48,-52; 68,-32]);
        Modelica.Blocks.Sources.Ramp clutchFriction(
          height=-1,
          offset=1,
          duration=2,
          startTime=411) 
          annotation (extent=[-34,-34; -20,-20]);
        Modelica.Blocks.Sources.Ramp valvolaAvviamento(
          startTime=103,
          offset=0,
          duration=295 - 103,
          height=0.127 - 0.064)                 annotation (extent=[0,-60; -14,
              -46]);
        Modelica.Blocks.Sources.Ramp Accensione(
          offset=0.00088,
          height=0.064 - 0.00088,
          duration=13,
          startTime=90)   annotation (extent=[24,-72; 10,-58]);
        Modelica.Blocks.Math.Add3 GTHeatRate 
                                         annotation (extent=[-56,-68; -72,-52]);
        Modelica.Blocks.Sources.Ramp MotoreConnesso(
          offset=0,
          startTime=295,
          height=0.174 - 0.127,
          duration=408 - 295)                   annotation (extent=[84,-72; 70,
              -58]);
        Modelica.Blocks.Math.Add valvolaPrincipale 
          annotation (extent=[-24,-94; -38,-80]);
        Modelica.Blocks.Sources.Ramp PresaGiri(
          offset=0,
          startTime=415,
          duration=528 - 415,
          height=0.269 - 0.1898)                annotation (extent=[6,-86; -8,
              -72]);
        Modelica.Blocks.Math.Add Connessione 
          annotation (extent=[40,-98; 26,-84]);
        Modelica.Blocks.Sources.Ramp DistaccoMotore(
          offset=0,
          duration=415 - 408,
          startTime=408,
          height=0.1898 - 0.174)                annotation (extent=[86,-96; 72,
              -82]);
      equation 
        
        wiso=gasTurbine.GTunit.wia*sqrt(gasTurbine.GTunit.gas.T/Tiso)/(gasTurbine.GTunit.gas.p/piso);
        wcomb=gasTurbine.GTunit.wif;
        omega=gasTurbine.GTunit.omega*60/(2*Modelica.Constants.pi);
        TbladePath=gasTurbine.T_bladePath.gas.T_degC;
        Texhaust=gasTurbine.T_exhaust-273.15;
        Press_compr=gasTurbine.p_fuelCompr;
        
        connect(InletAtmosphere.flange, gasTurbine.AirInlet) annotation (points=
             [-80,73; -80,73.6; -66,73.6], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelSource.flange, gasTurbine.FuelInlet) annotation (points=[
              -42,90; -34,90; -34,76.8], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(OutAtmosphere.flange, gasTurbine.FlueGasOutlet) annotation (
            points=[20,73; 20,73.6; -2,73.6], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(actuators, gasTurbine.ActuatorsBus) annotation (points=[-10,0;
              8,0; 8,24.96; -2.64,24.96], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(clutchFrictionScale.y,Clutch. friction)        annotation (points=[24.7,-27;
              34,-27; 34,13],              style(color=74, rgbcolor={0,0,127}));
        connect(Motor.flange_b,Clutch. flange_a)  annotation (points=[54,20; 44,
              20],                  style(color=0, rgbcolor={0,0,0}));
        connect(MotorSpeed.y,Motor. w_ref) 
                                       annotation (points=[69,-10; 84,-10; 84,
              20; 76,20],
            style(color=74, rgbcolor={0,0,127}));
        connect(generator.powerConnection,breaker. connection1) 
          annotation (points=[76.74,48; 76,48; 76,49.4],
                                                 style(pattern=0, thickness=2));
        connect(breaker.connection2,Grid. connection) 
          annotation (points=[76,66.6; 76,71; 81.26,71],
                                                   style(pattern=0, thickness=2));
        connect(GTInertia.flange_b,Gear. flange_a) 
          annotation (points=[32,48; 38,48], style(color=0, rgbcolor={0,0,0}));
        connect(Gear.flange_b,generator. shaft) 
          annotation (points=[54,48; 61.26,48], style(color=0, rgbcolor={0,0,0}));
        connect(GTInertia.flange_a, gasTurbine.shaft_b) annotation (points=[18,
              48; -2,48], style(
            color=0,
            rgbcolor={0,0,0},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(valveOpeningScale.y,servoValve. u) annotation (points=[-51.2,0;
              -52,0; -52,1.42109e-016; -43.65,1.42109e-016],
                          style(color=74, rgbcolor={0,0,127}));
        connect(servoValve.y, actuators.theta_fuelValve) annotation (points=[
              -29.16,0; -10,0], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Clutch.flange_b, gasTurbine.shaft_b) annotation (points=[24,20;
              12,20; 12,48; -2,48], style(
            color=0,
            rgbcolor={0,0,0},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(breakerClosed.y, breaker.closed) annotation (points=[69,-42; 94,
              -42; 94,58; 82.4,58], style(
            color=5,
            rgbcolor={255,0,255},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(clutchFriction.y, clutchFrictionScale.u) annotation (points=[
              -19.3,-27; 8.6,-27], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(valvolaAvviamento.y, GTHeatRate.u1) annotation (points=[-14.7,
              -53; -54.4,-53; -54.4,-53.6], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Accensione.y, GTHeatRate.u2) annotation (points=[9.3,-65; -28,
              -65; -28,-60; -54.4,-60], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(valvolaPrincipale.y, GTHeatRate.u3) annotation (points=[-38.7,
              -87; -48,-87; -48,-66.4; -54.4,-66.4], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(PresaGiri.y, valvolaPrincipale.u1) annotation (points=[-8.7,-79;
              -14,-79; -14,-82.8; -22.6,-82.8], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(Connessione.y, valvolaPrincipale.u2) annotation (points=[25.3,
              -91; 1.65,-91; 1.65,-91.2; -22.6,-91.2], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(MotoreConnesso.y, Connessione.u1) annotation (points=[69.3,-65;
              52,-65; 52,-86.8; 41.4,-86.8], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(DistaccoMotore.y, Connessione.u2) annotation (points=[71.3,-89;
              56,-89; 56,-95.2; 41.4,-95.2], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTHeatRate.y, valveOpeningScale.u) annotation (points=[-72.8,
              -60; -86,-60; -86,0; -69.6,0], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      initial equation 
       generator.shaft.phi=0;
        
      // plant.GTInertia.w=omega0_n*plant.omega_sync;
      // der(plant.motor.omega)=0;
      // der(plant.GTInertia.w)=0;
      end TestGT;
      
      model TestGT_identico 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        parameter SI.MassFraction Xexhaust[gasTurbine.GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        Modelica.Blocks.Sources.Ramp valvolaAvviamento(
          startTime=103,
          offset=0,
          duration=295 - 103,
          height=0.127 - 0.064)                 annotation (extent=[-98,60; -76,82]);
        Modelica.Blocks.Sources.BooleanStep breakerClosed(               startValue=
             false, startTime=820) 
          annotation (extent=[-50,-96; -30,-76]);
        annotation (Diagram, uses(Modelica(version="2.2")),
          experiment(StopTime=1000),
          Documentation(info="<html>
test per ricostruire l'andamento delle grandezze caratteristiche in avviamento, suddividendo la portata di combustibile in una somma di rampe che schematizzano la portata immessa per accendere la macchina, la portata immmessa dalla valvola di avviamento a cui fa seguito una valvola principale, a sua volta suddivisa in una parte che considera la connessione e il momento del distacco del motore e la finale presa di giri.
<p>una volta avvenuta la sincronizzazione alla rete, non si ha nessun incremento di combustibile</p>
<p>il modello di impianto considerato è <tt>GTStartup_finale.Components.PlantUnit__finale</tt>
</html>"));
        Modelica.Blocks.Sources.Ramp Accensione(
          offset=0.00088,
          height=0.064 - 0.00088,
          duration=13,
          startTime=90)   annotation (extent=[-62,74; -42,94]);
        Modelica.Blocks.Math.Add3 GTHeatRate 
                                         annotation (extent=[-20,48; 0,68]);
        Modelica.Blocks.Sources.Ramp MotoreConnesso(
          offset=0,
          startTime=295,
          height=0.174 - 0.127,
          duration=408 - 295)                   annotation (extent=[-122,28; -100,
              50]);
        Modelica.Blocks.Math.Add valvolaPrincipale 
          annotation (extent=[-52,26; -32,46]);
        Modelica.Blocks.Sources.Ramp PresaGiri(
          offset=0,
          startTime=415,
          duration=528 - 415,
          height=0.269 - 0.1898)                annotation (extent=[-82,-20; -60,2]);
        Modelica.Blocks.Sources.Ramp clutchFriction(
          height=-1,
          offset=1,
          duration=2,
          startTime=411) 
          annotation (extent=[-50,-64; -30,-44]);
        Modelica.Blocks.Math.Add Connessione 
          annotation (extent=[-82,28; -62,48]);
        Modelica.Blocks.Sources.Ramp DistaccoMotore(
          offset=0,
          duration=415 - 408,
          startTime=408,
          height=0.1898 - 0.174)                annotation (extent=[-122,-4; -100,
              18]);
        Examples.GT gasTurbine annotation (extent=[20,-26; 80,34]);
        Gas.SourceP fuelSource(            redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[24,52; 40,68]);
        Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-8,22; 6,36]);
        Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          p0=1.01325e5,
          Xnom=Xexhaust)                 annotation (extent=[86,52; 100,66]);
      protected 
        Buses.Actuators actuators annotation (extent=[42,-64; 62,-44]);
      initial equation 
       gasTurbine.generator.shaft.phi=0;
        
      // plant.GTInertia.w=omega0_n*plant.omega_sync;
      // der(plant.motor.omega)=0;
      // der(plant.GTInertia.w)=0;
        
      equation 
        connect(Accensione.y,GTHeatRate. u1) 
                                         annotation (points=[-41,84; -40,84;
              -40,66; -22,66],
                   style(color=74, rgbcolor={0,0,127}));
        connect(valvolaAvviamento.y,GTHeatRate. u2) 
                                     annotation (points=[-74.9,71; -66,71; -66,
              58; -22,58],
                       style(color=74, rgbcolor={0,0,127}));
        connect(valvolaPrincipale.y,GTHeatRate. u3)       annotation (points=[-31,36;
              -28,36; -28,50; -22,50],     style(color=74, rgbcolor={0,0,127}));
        connect(PresaGiri.y, valvolaPrincipale.u2)            annotation (points=[
              -58.9,-9; -58,-9; -58,30; -54,30],
                                               style(color=74, rgbcolor={0,0,127}));
        connect(Connessione.y, valvolaPrincipale.u1)        annotation (points=[-61,
              38; -54,38; -54,42],     style(color=74, rgbcolor={0,0,127}));
        connect(DistaccoMotore.y, Connessione.u2)        annotation (points=[-98.9,
              7; -98.9,22; -88,22; -88,32; -84,32],
                                                  style(color=74, rgbcolor={0,0,127}));
        connect(MotoreConnesso.y, Connessione.u1)        annotation (points=[-98.9,
              39; -84.45,39; -84.45,44; -84,44], style(color=74, rgbcolor={0,0,127}));
        connect(InletAtmosphere.flange, gasTurbine.AirInlet) annotation (points=[6,29; 8,28;
              20,28], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelSource.flange, gasTurbine.FuelInlet) annotation (points=[40,
              60; 50,60; 50,31], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(OutAtmosphere.flange, gasTurbine.FlueGasOutlet) annotation (
            points=[86,59; 86,28; 80,28], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(actuators, gasTurbine.ActuatorsBus) annotation (points=[52,-54;
              90,-54; 90,-17.6; 79.4,-17.6], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(breakerClosed.y, actuators.breakerClosed) annotation (points=[
              -29,-86; 14,-86; 14,-54; 52,-54], style(
            color=5,
            rgbcolor={255,0,255},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(clutchFriction.y, actuators.clutchFriction) annotation (points=
              [-29,-54; 52,-54], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(GTHeatRate.y, actuators.GTHeatRate) annotation (points=[1,58;
              14,58; 14,-54; 52,-54], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end TestGT_identico;
      
      model TestGT_identico_prova 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        constant Modelica.SIunits.Temperature Tiso=288.15;
        constant Modelica.SIunits.AbsolutePressure piso=1.01325e5;
        parameter SI.MassFraction Xexhaust[gasTurbine.GTunit.FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        Modelica.Blocks.Sources.BooleanStep breakerClosed(               startValue=
             false, startTime=0) 
          annotation (extent=[-50,-96; -30,-76]);
        annotation (Diagram, uses(Modelica(version="2.2")),
          experiment(StopTime=1000),
          Documentation(info="<html>
test per ricostruire l'andamento delle grandezze caratteristiche in avviamento, suddividendo la portata di combustibile in una somma di rampe che schematizzano la portata immessa per accendere la macchina, la portata immmessa dalla valvola di avviamento a cui fa seguito una valvola principale, a sua volta suddivisa in una parte che considera la connessione e il momento del distacco del motore e la finale presa di giri.
<p>una volta avvenuta la sincronizzazione alla rete, non si ha nessun incremento di combustibile</p>
<p>il modello di impianto considerato è <tt>GTStartup_finale.Components.PlantUnit__finale</tt>
</html>"));
        Modelica.Blocks.Sources.Ramp clutchFriction(
          offset=1,
          duration=2,
          height=0,
          startTime=0) 
          annotation (extent=[-50,-64; -30,-44]);
        Examples.GT gasTurbine annotation (extent=[20,-26; 80,34]);
        Gas.SourceP fuelSource(            redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[24,52; 40,68]);
        Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-8,22; 6,36]);
        Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          p0=1.01325e5,
          Xnom=Xexhaust)                 annotation (extent=[86,52; 100,66]);
      protected 
        Buses.Actuators actuators annotation (extent=[42,-64; 62,-44]);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP 
          annotation (extent=[-28,-2; -48,-22], rotation=180);
      initial equation 
       gasTurbine.generator.shaft.phi=0;
        
      // plant.GTInertia.w=omega0_n*plant.omega_sync;
      // der(plant.motor.omega)=0;
      // der(plant.GTInertia.w)=0;
        
      equation 
        connect(InletAtmosphere.flange, gasTurbine.AirInlet) annotation (points=
             [6,29; 8,28; 20,28], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(fuelSource.flange, gasTurbine.FuelInlet) annotation (points=[40,
              60; 50,60; 50,31], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(OutAtmosphere.flange, gasTurbine.FlueGasOutlet) annotation (
            points=[86,59; 86,28; 80,28], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(actuators, gasTurbine.ActuatorsBus) annotation (points=[52,-54;
              90,-54; 90,-17.6; 79.4,-17.6], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(breakerClosed.y, actuators.breakerClosed) annotation (points=[
              -29,-86; 14,-86; 14,-54; 52,-54], style(
            color=5,
            rgbcolor={255,0,255},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(clutchFriction.y, actuators.clutchFriction) annotation (points=
              [-29,-54; 52,-54], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(com_valveHP.y, actuators.GTHeatRate) annotation (points=[-27,
              -12; 14,-12; 14,-54; 52,-54], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end TestGT_identico_prova;
      
      model TestGT_simp 
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        parameter SI.MassFraction Xexhaust[FlueGasMedium.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        annotation (Diagram);
        Gas.SourceP fuelSource(            redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[-28,52; -12,68]);
        Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-66,10; -46,30]);
        Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          p0=1.01325e5,
          Xnom=Xexhaust)                 annotation (extent=[40,10; 60,30]);
        Examples.GT_simp gT_simp(GTunit(HH=4.72e7)) 
          annotation (extent=[-20,-60; 20,-20]);
        Modelica.Blocks.Sources.Ramp ramp(
          height=314.16/2,
          duration=200,
          offset=0,
          startTime=0) annotation (extent=[6,-90; 26,-70]);
        Modelica.Mechanics.Rotational.Speed speed 
          annotation (extent=[52,-90; 72,-70]);
      equation 
        connect(gT_simp.FlueGasOutlet, OutAtmosphere.flange) annotation (points=
             [20,-24; 30,-24; 30,20; 40,20], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(gT_simp.AirInlet, InletAtmosphere.flange) annotation (points=[
              -20,-24; -34,-24; -34,20; -46,20], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(gT_simp.FuelInlet, fuelSource.flange) annotation (points=[0,-22;
              0,60; -12,60], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(speed.w_ref, ramp.y) annotation (points=[50,-80; 27,-80], style(
            color=74,
            rgbcolor={0,0,127},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(speed.flange_b, gT_simp.shaft_b) annotation (points=[72,-80; 90,
              -80; 90,-40; 20,-40], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end TestGT_simp;
    end Tests;
    
    package Control 
      block Selector 
        Modelica.Blocks.Interfaces.RealInput u[2] annotation (extent=[-114,50; -94,70]);
        Modelica.Blocks.Interfaces.RealOutput y annotation (extent=[92,10; 112,30]);
        annotation (Diagram, Icon(
                            Rectangle(extent=[-100,100; 100,-100], style(color=3,
                  rgbcolor={0,0,255})), Text(
              extent=[-52,36; 46,-46],
              style(color=3, rgbcolor={0,0,255}),
              string="SEL")));
        Modelica.Blocks.Interfaces.IntegerInput select 
          annotation (extent=[-114,-50; -94,-30]);
      equation 
        assert(select>0 and select <= size(u,1), "Selection out of range");
        y = u[select];
      end Selector;
      
      model ToScale 
                    extends Modelica.Blocks.Interfaces.SISO;
        parameter Real uLow = 0;
        parameter Real uHigh = 1;
        parameter Real yLow = 0;
        parameter Real yHigh = 1;
      equation 
        y = (u - uLow)/(uHigh-uLow)*(yHigh-yLow) + yLow;
        annotation (Icon(
            Polygon(points=[-52,88; -60,66; -44,66; -52,88],
                                                          style(color=8,
                  fillColor=8)),
            Line(points=[-52,-2; -24,-2], style(color=9, rgbcolor={175,175,175})),
            Polygon(points=[96,-66; 74,-58; 74,-74; 96,-66],
                                                          style(color=8,
                  fillColor=8)),
            Line(points=[-84,-66; 74,-66],
                                         style(color=8)),
            Line(points=[-52,-80; -52,68],
                                         style(color=8)),
            Line(points=[-24,-2; 54,24],    style(color=0)),
            Rectangle(extent=[-54,-62; -50,-68],
                                             style(
                color=0,
                fillColor=0,
                fillPattern=1)),
            Line(points=[-24,-2; -24,-66], style(color=9, rgbcolor={175,175,175})),
            Line(points=[54,24; 54,-66], style(color=9, rgbcolor={175,175,175})),
            Line(points=[54,24; -52,24], style(color=9, rgbcolor={175,175,175}))));
      end ToScale;
      
      block ServoActuator 
        parameter Time Tt "Total travel time";
        parameter Time T "Small-signal time constant";
        parameter Real yLow = 0 "Lower limit of actuator action";
        parameter Real yHigh = 1 "Upper limit of actuator action";
        parameter Boolean steadyStateInit = false "Steady-state initialisation";
        Modelica.Blocks.Interfaces.RealInput u annotation (extent=[-108,-14; -82,14]);
        Modelica.Blocks.Interfaces.RealOutput y annotation (extent=[100,-12; 124,12]);
        Modelica.Blocks.Interfaces.BooleanOutput satHigh 
          "Actuator saturated in the high position" 
          annotation (extent=[100,48; 124,72]);
        Modelica.Blocks.Interfaces.BooleanOutput satLow 
          "Actuator saturated in the low" annotation (extent=[100,-72; 124,-48]);
      protected 
        output Integer state(start=0) "0: running, +1 sat High, -1 sat Low";
        output Real der_y;
        output Real der_y_vlim;
      equation 
        der_y = 1/T*(u-y) "Required der(y) without limitation";
        der_y_vlim = smooth(0, if der_y < -(yHigh-yLow)/Tt then -(yHigh-yLow)/Tt else 
                               if der_y > (yHigh-yLow)/Tt then (yHigh-yLow)/Tt else der_y) 
          "der(y) after velocity limitation";
        der(y) = if state == 0 then der_y_vlim else 0 
          "der(y) accounting for saturation";
        satHigh = (state == +1);
        satLow = (state == -1);
      algorithm 
        when pre(state) == 0 and y > yHigh and der_y > 0 then
          state := +1;
        elsewhen pre(state) == 0 and y < yLow and der_y < 0 then
          state := -1;
        elsewhen pre(state) == +1 and der_y < 0 then
          state :=0;
        elsewhen pre(state) == -1 and der_y > 0 then
          state :=0;
        end when;
        annotation (Icon(Rectangle(extent=[-100,100; 100,-100], style(color=3,
                  rgbcolor={0,0,255})),
                         Text(
              extent=[-42,46; 44,-38],
              style(color=3, rgbcolor={0,0,255}),
              string="A")), Diagram,
          Documentation(info="<html>
This model describes a typical servo-actuator dynamics. For small variations of the input, the system responds as a first-order linear system with a time constant of <tt>T</tt>. For larger variations of the input, the system is subject to two constraints:
<ul>
<li>the rate of change of the output <tt>y</tt> cannot exceed plus or minus <tt>(yHigh-yLow)/Tt</tt>;
<li>the output y cannot get greater than <tt>yHigh</tt> or less than <tt>yLow</tt>.
</ul>
When the actuator is stuck at the <tt>yHigh</tt> (resp. <tt>yLow</tt>) value, the boolean output <tt>satHigh</tt> (resp. <tt>satLow</tt>) becomes true.
<p>
If <tt>steadyStateInit = true</tt>, steady-state initial conditions are enforced.
</html>",     revisions="<html>
<ul>
<li><i>1 Jun 2005</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       First release.</li>
</ul>
</html>"));
      initial equation 
        if steadyStateInit then
          der(y) = 0;
          state = 0;
        end if;
      end ServoActuator;
    end Control;
    
    package copie 
      model PlantUNIT__finale 
      // dati relativi all'avviamento
      // le tabelle sono Table_finali
        annotation (uses(ThermoPower(version="2"), Modelica(version="2.2")), Diagram,
          Icon(Rectangle(extent=[-100,100; 100,-100], style(color=3, rgbcolor={0,0,255})), Text(
              extent=[-70,52; 62,-48],
              style(color=3, rgbcolor={0,0,255}),
              string="GT")),
          Documentation(info="<html>
I dati fanno riferimento all'avviamento della GT20.
<p>Le tabelle di interpolazione usate per definire le prestazioni della macchina sono <tt>GTStartup_finale.Data.Table_finali</tt>, considerando come portata di aria transitante la portata passante dalle valvole di Bleed.
</html>"));
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package AirMedium = ThermoPower.Media.Air extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FuelMedium = ThermoPower.Media.NaturalGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        
        parameter SI.Power nominalElectricalPower=50e9;
        parameter SI.Frequency fn=50;
        parameter SI.MassFraction Xexhaust[GTunit.Exhaust.nX]={0.16342,0.01323,0.03444,0.04988,0.73904} 
          " turbine gas exhaust composition ";
        parameter SI.AngularVelocity omega_sync=
            Modelica.SIunits.Conversions.from_rpm(4949);
        ThermoPower.Gas.SourceP InletAtmosphere(
          redeclare package Medium = AirMedium,
          p0=1.01325e5,
          T=282.15)                      annotation (extent=[-106,-68; -78,-40]);
        ThermoPower.Gas.PressDrop OutPressDrop(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          Tstart=495,
          wnom=168.9,
          pstart=1.025e5,
          dpnom=1175,
          Kf=0.0288,
          rhonom=0.7)                        annotation (extent=[16,28; 38,52],
            rotation=90);
        ThermoPower.Gas.PressDrop InletPressDrop(
          redeclare package Medium = AirMedium,
          pstart=1.01325e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=1.2,
          Tstart=282.15,
          wnom=165.3,
          Kf=0.116,
          dpnom=3738)                        annotation (extent=[-70,-66; -44,-42]);
        ThermoPower.Gas.Valve fuelValve(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          CvData=ThermoPower.Choices.Valve.CvTypes.Av,
          pnom=20e5,
          Av=0.0022,
          dpnom=7.5e5)               annotation (extent=[-74,40; -58,60]);
        ThermoPower.Gas.SourceP fuelSource(redeclare package Medium = 
              FuelMedium, p0=20e5)       annotation (extent=[-102,38; -80,60]);
        Modelica.Mechanics.Rotational.Inertia GTInertia(             w(start=
                Modelica.SIunits.Conversions.from_rpm(360)), J=7000) 
          annotation (extent=[14,-18; 28,2]);
        
        ThermoPower.Gas.SensT exhaust(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[54,50; 74,70]);
        ThermoPower.Electrical.Generator generator(
          eta=0.98,
          f(start=50),
          shaft(phi(start=0)),
          J=3500)                                   annotation (extent=[56,-18; 74,
              2]);
        ThermoPower.Electrical.Breaker breaker  annotation (extent=[80,-8; 64,12],
            rotation=90);
        ThermoPower.Electrical.Grid Grid(
          Pn=nominalElectricalPower,
          fn=fn,
          droop=0.05)                     annotation (extent=[94,6; 76,24],
            rotation=180);
        ThermoPower.Gas.Plenum fuelPlenum(redeclare package Medium = 
              FuelMedium,
          pstart=12.5e5,
          initOpt=ThermoPower.Choices.Init.Options.steadyState,
          V=0.5)                            annotation (extent=[-48,40; -26,62]);
        ThermoPower.Gas.PressDrop fuelPressDrop(redeclare package Medium = 
              FuelMedium,
          wnom=3.6,
          pstart=12.5e5,
          FFtype=ThermoPower.Choices.PressDrop.FFtypes.Kf,
          rhonom=8.18,
          Kf=213336,
          dpnom=3.45e5) 
          annotation (extent=[-22,18; 0,46],   rotation=270);
        ThermoPower.Gas.SinkP OutAtmosphere(
          redeclare package Medium = FlueGasMedium,
          Xnom=Xexhaust,
          p0=1.01325e5)                  annotation (extent=[76,44; 102,72]);
        Components.HydraulicClutch Clutch 
                                   annotation (extent=[-58,-16; -44,0]);
        Modelica.Blocks.Interfaces.RealInput GTHeatRate "Per Unit" 
          annotation (extent=[-122,66; -102,86]);
        Modelica.Blocks.Interfaces.RealInput clutchFriction "Per Unit" 
          annotation (extent=[-120,8; -100,28]);
        Modelica.Blocks.Interfaces.BooleanInput breakerClosed 
          annotation (extent=[-114,-92; -94,-72]);
        Control.ToScale valveOpeningScale(yHigh=0.7) 
                                  annotation (extent=[-94,64; -70,88]);
        Control.ToScale clutchFrictionScale(yHigh=34.937) 
                                   annotation (extent=[-90,6; -66,30]);
        ThermoPower.Gas.SensT bladePath(redeclare package Medium = 
              FlueGasMedium)         annotation (extent=[12,6; 32,26], rotation=90);
        Modelica.Blocks.Interfaces.RealOutput exhaust_T 
          annotation (extent=[96,70; 116,90]);
        Modelica.Blocks.Interfaces.RealOutput bladePath_T 
          annotation (extent=[96,20; 116,40]);
        Modelica.Blocks.Interfaces.RealOutput frequency "Per Unit" 
          annotation (extent=[96,-90; 116,-70]);
        Modelica.Blocks.Interfaces.RealOutput electricalPower "Per Unit" 
          annotation (extent=[94,-56; 116,-32]);
        Control.ServoActuator servoValve(
          Tt=20,
          T=2,
          yLow=0.1,
          steadyStateInit=true)              annotation (extent=[-64,68; -50,84]);
        Components.GTunit GTunit(
          eta_mech=0.985,
          beta(start=3),
          Table=ThermoPower.Choices.TurboMachinery.TableTypes.matrix,
          HH=37.47e6,
          pstart=0.9758e5,
          Tstart=282.15,
          tableHI=GTStartup_finale.Data.Table_finali.GT20Data.tabHI,
          tablePR=GTStartup_finale.Data.Table_finali.GT20Data.tabPR,
          tableW=GTStartup_finale.Data.Table_finali.GT20Data.tabW,
          tableZLP=GTStartup_finale.Data.Table_finali.GT20Data.tabZLP,
          tableN=GTStartup_finale.Data.Table_finali.GT20Data.tabN) 
          annotation (extent=[-28,-28; 4,12]);
        Modelica.Mechanics.Rotational.IdealGear Gear(ratio=(4949/60)/(25)) 
          annotation (extent=[34,-16; 50,0]);
        ThermoPower.Gas.Header Silencer(
          redeclare package Medium = FlueGasMedium,
          Xstart=Xexhaust,
          initOpt=ThermoPower.Choices.Init.Options.steadyStateNoP,
          Tmstart=300,
          gamma=4500*4000,
          Cm=20e6,
          V=0.0875,
          S=0.0098) 
          annotation (extent=[36,50; 52,66]);
        ThermoPower.Gas.SensP ComprPressure(redeclare package Medium = 
              FuelMedium)                   annotation (extent=[-52,-2; -18,28]);
        Modelica.Mechanics.Rotational.Speed Motor 
          annotation (extent=[-84,-18; -62,4]);
        Modelica.Blocks.Sources.Ramp MotorSpeed(
          duration=1,
          startTime=65,
          height=395 - 110,
          offset=110) annotation (extent=[-118,-18; -98,2]);
        Modelica.Blocks.Interfaces.RealOutput comprPressure 
          annotation (extent=[94,-20; 114,0]);
      equation 
        electricalPower = generator.powerConnection.W/nominalElectricalPower;
        frequency = generator.powerConnection.f/fn;
        connect(InletAtmosphere.flange, InletPressDrop.inlet) 
                                                   annotation (points=[-78,-54; -70,
              -54],   style(color=76, rgbcolor={159,159,223}));
        connect(fuelSource.flange, fuelValve.inlet) 
                                               annotation (points=[-80,49; -78,49;
              -78,50; -74,50],
            style(color=76, rgbcolor={159,159,223}));
        connect(generator.powerConnection, breaker.connection1) 
          annotation (points=[72.74,-8; 72,-8; 72,-6.6],
                                                 style(pattern=0, thickness=2));
        connect(breaker.connection2, Grid.connection) 
          annotation (points=[72,10.6; 72,15; 77.26,15],
                                                   style(pattern=0, thickness=2));
        connect(fuelValve.outlet, fuelPlenum.inlet) 
                                              annotation (points=[-58,50; -56,50;
              -56,51; -48,51],
            style(color=76, rgbcolor={159,159,223}));
        connect(fuelPlenum.outlet, fuelPressDrop.inlet) 
                                                  annotation (points=[-26,51;
              -10,51; -10,46; -11,46],
            style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.outlet, OutAtmosphere.flange) 
                                              annotation (points=[70,56; 74,56; 74,
              58; 76,58],
            style(color=76, rgbcolor={159,159,223}));
        connect(GTHeatRate, valveOpeningScale.u) annotation (points=[-112,76; -96.4,
              76], style(color=74, rgbcolor={0,0,127}));
        connect(breakerClosed, breaker.closed) annotation (points=[-104,-82; 80,
              -82; 80,2; 78.4,2],
                             style(color=5, rgbcolor={255,0,255}));
        connect(bladePath.outlet, OutPressDrop.inlet) 
                                                    annotation (points=[26,22; 26,
              28; 27,28],
                   style(color=76, rgbcolor={159,159,223}));
        connect(exhaust.T, exhaust_T) annotation (points=[71,66; 78,66; 78,80; 106,
              80], style(color=74, rgbcolor={0,0,127}));
        connect(bladePath.T, bladePath_T) annotation (points=[16,23; 16,30; 106,30],
            style(color=74, rgbcolor={0,0,127}));
        connect(clutchFrictionScale.y, Clutch.friction)        annotation (points=[-64.8,18;
              -51,18; -51,-2.4],           style(color=74, rgbcolor={0,0,127}));
        connect(clutchFriction, clutchFrictionScale.u) annotation (points=[-110,18;
              -92.4,18], style(color=74, rgbcolor={0,0,127}));
        connect(valveOpeningScale.y, servoValve.u) annotation (points=[-68.8,76;
              -63.65,76], style(color=74, rgbcolor={0,0,127}));
        connect(servoValve.y, fuelValve.theta) annotation (points=[-49.16,76; -40,
              76; -40,64; -66,64; -66,57.2],
                                         style(color=74, rgbcolor={0,0,127}));
        connect(GTunit.FlueGas_out, bladePath.inlet)  annotation (points=[2.4,-2;
              14.5,-2; 14.5,10; 26,10],
                                      style(color=76, rgbcolor={159,159,223}));
        connect(GTunit.shaft_b, GTInertia.flange_a) 
          annotation (points=[3.68,-8; 14,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Clutch.flange_b, GTunit.shaft_b)         annotation (points=[-44,-8;
              -44,-22; 4,-22; 4,-8; 3.68,-8], style(color=0, rgbcolor={0,0,0}));
        connect(fuelPressDrop.outlet, GTunit.Fuel_in)  annotation (points=[-11,18;
              -12,18; -12,6.4], style(color=76, rgbcolor={159,159,223}));
        connect(InletPressDrop.outlet, GTunit.Air_in) 
                                                   annotation (points=[-44,-54; -42,
              -54; -42,-2; -26.4,-2], style(color=76, rgbcolor={159,159,223}));
        connect(GTInertia.flange_b, Gear.flange_a) 
          annotation (points=[28,-8; 34,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Gear.flange_b, generator.shaft) 
          annotation (points=[50,-8; 57.26,-8], style(color=0, rgbcolor={0,0,0}));
        connect(Silencer.outlet, exhaust.inlet) 
                                               annotation (points=[52,58; 56,58; 56,
              56; 58,56],
                      style(color=76, rgbcolor={159,159,223}));
        connect(OutPressDrop.outlet, Silencer.inlet) 
                                                  annotation (points=[27,52; 27,58;
              36,58], style(color=76, rgbcolor={159,159,223}));
        connect(ComprPressure.flange, GTunit.Fuel_in)  annotation (points=[-35,7;
              -35,6.4; -12,6.4],           style(color=3, rgbcolor={0,0,255}));
        connect(Motor.flange_b, Clutch.flange_a)  annotation (points=[-62,-7; -60,
              -7; -60,-8; -58,-8],  style(color=0, rgbcolor={0,0,0}));
        connect(MotorSpeed.y, Motor.w_ref) 
                                       annotation (points=[-97,-8; -90,-8; -90,-7;
              -86.2,-7],
            style(color=74, rgbcolor={0,0,127}));
        connect(ComprPressure.p, comprPressure) annotation (points=[-25.82,22; 80,
              22; 80,-10; 104,-10], style(color=74, rgbcolor={0,0,127}));
      end PlantUNIT__finale;
    end copie;
  end GasTurbine;
  
  package HRSG 
    package Interfaces 
      partial model HeatExchanger "Base class for heat exchanger fluid - gas" 
        
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium "Flue gas model";
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance "Fluid model";
        
        parameter Integer N_G=2 "Number of node of the gas side";
        parameter Integer N_F=2 "Number of node of the fluid side";
        
        //Nominal parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.MassFlowRate fluidNomFlowRate 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        parameter SI.Pressure fluidNomPressure 
          "Nominal pressure in the fluid side inlet";
        
        //Physical Parameter
        parameter SI.Area exchSurface_G 
          "Exchange surface between gas - metal tube";
        parameter SI.Area exchSurface_F 
          "Exchange surface between metal tube - fluid";
        parameter SI.Area extSurfaceTub "Total external surface of the tubes";
        parameter SI.Volume gasVol "Gas volume";
        parameter SI.Volume fluidVol "Fluid volume";
        parameter SI.Volume metalVol "Volume of the metal part in the tubes";
        parameter Real rhomcm "Metal heat capacity per unit volume [J/m^3.K]";
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal (density by specific heat capacity)";
        
        //Start value
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        
        parameter SI.Temperature Tstart_G_In 
          "Inlet gas temperature start value"            annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_G_Out 
          "Outlet gas temperature start value"           annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_G[N_G]=linspace(Tstart_G_In,Tstart_G_Out,N_G) 
          "Start value of gas temperature vector (initialized by default)" annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstart_G=gasNomPressure 
          "Pressure start value, gas side" 
                                          annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_In 
          "Inlet metal wall temperature start value"       annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_Out 
          "Outlet metal wall temperature start value"      annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M[N_F]=linspace(Tstart_M_In,Tstart_M_Out,N_F) 
          "Start value of metal wall temperature vector (initialized by default)"
                                                                                  annotation(Dialog(tab = "Initialization"));
        
        parameter SI.Temperature Tstart_F_In=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_In) 
          "Inlet fluid temperature start value"             annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_F_Out=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_Out) 
          "Outlet fluid temperature start value"            annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_F[N_F]=linspace(Tstart_F_In,Tstart_F_Out,N_F) 
          "Start value of fluid temperature vector (initialized by default)" 
                                                                          annotation(Dialog(tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_In) 
          "Inlet fluid specific enthalpy start value"                   annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value"                  annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_F[N_F]=linspace(hstart_F_In,hstart_F_Out,N_F) 
          "Start value of fluid enthalpy vector (initialized by default)" annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstartin_F=fluidNomPressure 
          "Inlet fluid pressure start value"                annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstartout_F=fluidNomPressure 
          "Outlet fluid pressure start value"                annotation(Dialog(tab = "Initialization"));
        
        annotation (Diagram, Icon(Rectangle(extent=[-80,80; 80,-80],  style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})), Line(points=[0,-80; 0,-40; 40,-20; -40,
                  20; 0,40; 0,80],           style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-100,-115; 100,-145],
              string="%name",
              style(color=71, rgbcolor={85,170,255}))));
        Gas.FlangeA gasIn(redeclare package Medium = FlueGasMedium) 
                            annotation (extent=[-100,-20; -60,20]);
        Gas.FlangeB gasOut(redeclare package Medium = FlueGasMedium) 
                            annotation (extent=[60,-20; 100,20]);
        Water.FlangeA waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-20,60; 20,100]);
        Water.FlangeB waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-20,-100; 20,-60]);
        
      end HeatExchanger;
      
      partial model ParallelHE 
        "Base class for Parallel Heat Exchanger (two fluid with one gas)" 
        
        annotation (Diagram, Icon(
            Rectangle(extent=[-80,80; 80,-80], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Line(points=[-40,80; -40,60; -10,60; -10,42; -42,20; 20,-20; -10,-40; -10,
                  -60; -40,-60; -40,-80],           style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[40,80; 40,60; 10,60; 10,40; -20,20; 42,-20; 10,-40; 10,-60;
                  40,-60; 40,-80],          style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-100,-115; 100,-145],
              string="%name",
              style(color=71, rgbcolor={85,170,255}))));
        ThermoPower.Gas.FlangeA gasIn(redeclare package Medium = FlueGasMedium)
                            annotation (extent=[-100,-20; -60,20]);
        ThermoPower.Gas.FlangeB gasOut(redeclare package Medium = FlueGasMedium)
                            annotation (extent=[60,-20; 100,20]);
        ThermoPower.Water.FlangeA waterInA(redeclare package Medium = 
              FluidMedium) "water/steam first inlet" 
          annotation (extent=[-60,60; -20,100]);
        ThermoPower.Water.FlangeB waterOutA(redeclare package Medium = 
              FluidMedium) "water/steam first outlet" 
          annotation (extent=[-60,-100; -20,-60]);
        ThermoPower.Water.FlangeA waterInB(redeclare package Medium = 
              FluidMedium) "water/steam second inlet" 
          annotation (extent=[20,60; 60,100]);
        ThermoPower.Water.FlangeB waterOutB(redeclare package Medium = 
              FluidMedium) "water/steam second outlet" 
          annotation (extent=[20,-100; 60,-60]);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        parameter Integer N_G=2 "Number of node of the gas side";
        parameter Integer N_F_A=2 "Number of node of the fluid side"   annotation (Dialog(group = "side A"));
        parameter Integer N_F_B=2 "Number of node of the fluid side"   annotation (Dialog(group = "side B"));
        
        //Nominal parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.MassFlowRate fluidNomFlowRate_A 
          "Nominal flow rate through the fluid side"     annotation (Dialog(group = "side A"));
        parameter SI.MassFlowRate fluidNomFlowRate_B 
          "Nominal flow rate through the fluid side"     annotation (Dialog(group = "side B"));
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        parameter SI.Pressure fluidNomPressure_A 
          "Nominal pressure in the fluid side inlet"     annotation (Dialog(group = "side A"));
        parameter SI.Pressure fluidNomPressure_B 
          "Nominal pressure in the fluid side inlet"     annotation (Dialog(group = "side B"));
        
        //Physical Parameter
        parameter SI.Area exchSurface_G_A 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(group = "side A"));
        parameter SI.Area exchSurface_G_B 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(group = "side B"));
        parameter SI.Area exchSurface_F_A 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(group = "side A"));
        parameter SI.Area exchSurface_F_B 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(group = "side B"));
        parameter SI.Area extSurfaceTub_A "Total external surface of the tubes"
                                                             annotation (Dialog(group = "side A"));
        parameter SI.Area extSurfaceTub_B "Total external surface of the tubes"
                                                             annotation (Dialog(group = "side B"));
        parameter SI.Volume gasVol "Gas volume";
        parameter SI.Volume fluidVol_A "Fluid volume"     annotation (Dialog(group = "side A"));
        parameter SI.Volume fluidVol_B "Fluid volume"     annotation (Dialog(group = "side B"));
        parameter SI.Volume metalVol_A "Volume of the metal part in the tube"     annotation (Dialog(group = "side A"));
        parameter SI.Volume metalVol_B "Volume of the metal part in the tube"     annotation (Dialog(group = "side B"));
        parameter Real rhomcm_A "Metal heat capacity per unit volume [J/m^3.K]"
                                                                                annotation (Dialog(group = "side A"));
        parameter Real rhomcm_B "Metal heat capacity per unit volume [J/m^3.K]"
                                                                                annotation (Dialog(group = "side B"));
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal (density by specific heat capacity)";
        
        //Initialization conditions
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy"
             annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        //Start value
        parameter SI.Temperature Tstart_G_In 
          "Inlet gas temperature start value" 
            annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_G_Out 
          "Outlet gas temperature start value" 
            annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_G[N_G]=linspace(
                  Tstart_G_In,
                  Tstart_G_Out,
                  N_G) 
          "Start value of gas temperature vector (initialized by default)" annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstart_G=gasNomPressure 
          "Pressure start value, gas side" 
            annotation(Dialog(tab = "Initialization"));
        //A
        parameter SI.Temperature Tstart_M_A_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A[N_F_A]=linspace(
                  Tstart_M_A_In,
                  Tstart_M_A_Out,
                  N_F_A) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization",
                              group = "side A"));
        parameter SI.Temperature Tstart_F_A_In=FluidMedium.temperature_ph(
            fluidNomPressure_A, hstart_F_A_In) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A_Out=FluidMedium.temperature_ph(
            fluidNomPressure_A, hstart_F_A_Out) 
          "Outlet fluid temperature start value"       annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A[N_F_A]=linspace(
                  Tstart_F_A_In,
                  Tstart_F_A_Out,
                  N_F_A) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization",
                                                                                                   group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_In=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A, Tstart_F_A_In) 
          "Inlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization",
                                                                               group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_Out=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A, Tstart_F_A_Out) 
          "Outlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization",
                                                                                group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A[N_F_A]=linspace(
                  hstart_F_A_In,
                  hstart_F_A_Out,
                  N_F_A) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization",
                                                                                                group = "side A"));
        parameter SI.Pressure pstartin_F_A=fluidNomPressure_A 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side A"));
        parameter SI.Pressure pstartout_F_A=fluidNomPressure_A 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side A"));
        //B
        parameter SI.Temperature Tstart_M_B_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B[N_F_B]=linspace(
                  Tstart_M_B_In,
                  Tstart_M_B_Out,
                  N_F_B) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization",
                              group = "side B"));
        parameter SI.Temperature Tstart_F_B_In=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_In) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization",
                                                                         group = "side B"));
        parameter SI.Temperature Tstart_F_B_Out=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_Out) 
          "Outlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                          tab = "Initialization",
                                                                          group = "side B"));
        parameter SI.Temperature Tstart_F_B[N_F_B]=linspace(
                  Tstart_F_B_In,
                  Tstart_F_B_Out,
                  N_F_B) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization",
                                                                                                   group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_In=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B, Tstart_F_B_In) 
          "Inlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization",
                                                                               group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_Out=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B, Tstart_F_B_Out) 
          "Outlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization",
                                                                                group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B[N_F_B]=linspace(
                  hstart_F_B_In,
                  hstart_F_B_Out,
                  N_F_B) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization",
                                                                                                group = "side B"));
        parameter SI.Pressure pstartin_F_B=fluidNomPressure_B 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side B"));
        parameter SI.Pressure pstartout_F_B=fluidNomPressure_B 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization",
                              group = "side B"));
        
      end ParallelHE;
      
      partial model ParallelHE_Att 
        "Base class for parallel Heat Exchanger (two fluid with one gas) with attemperation" 
        
        annotation (Diagram, Icon(
            Rectangle(extent=[-80,80; 80,-80], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Line(points=[-40,80; -40,60; -10,60; -10,42; -42,20; 20,-20; -10,-40; -10,
                  -60; -40,-60; -40,-80],           style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[40,80; 40,60; 10,60; 10,40; -20,20; 42,-20; 10,-40; 10,-60;
                  40,-60; 40,-80],          style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-100,-115; 100,-145],
              string="%name",
              style(color=71, rgbcolor={85,170,255})),
            Polygon(points=[-34,-38; -44,-30; -22,-24; -32,-16; -34,-38],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-40,-34; -48,-42; -78,-42],
                                               style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[-4,2; -26,-20],
                                       style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1))));
        ThermoPower.Gas.FlangeA gasIn(redeclare package Medium = FlueGasMedium)
                            annotation (extent=[-100,-20; -60,20]);
        ThermoPower.Gas.FlangeB gasOut(redeclare package Medium = FlueGasMedium)
                            annotation (extent=[60,-20; 100,20]);
        ThermoPower.Water.FlangeA waterInA(redeclare package Medium = 
              FluidMedium) "water/steam first inlet" 
          annotation (extent=[-60,60; -20,100]);
        ThermoPower.Water.FlangeB waterOutA(redeclare package Medium = 
              FluidMedium) "water/steam first outlet" 
          annotation (extent=[-60,-100; -20,-60]);
        ThermoPower.Water.FlangeA waterInB(redeclare package Medium = 
              FluidMedium) "water/steam second inlet " 
          annotation (extent=[20,60; 60,100]);
        ThermoPower.Water.FlangeB waterOutB(redeclare package Medium = 
              FluidMedium) "water/steam second outlet" 
          annotation (extent=[20,-100; 60,-60]);
        ThermoPower.Water.FlangeA LiquidWaterIn(redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-90,-52; -70,-32]);
        Modelica.Blocks.Interfaces.RealOutput T_intermedA 
          "Intermediate temperature of the HE_A" 
          annotation (extent=[76,52; 90,66]);
        Modelica.Blocks.Interfaces.RealOutput T_intermedB 
          "Intermediate temperature of the HE_B" 
          annotation (extent=[76,32; 90,46]);
        Modelica.Blocks.Interfaces.RealInput theta_valveA 
          annotation (extent=[88,-50; 74,-34]);
        Modelica.Blocks.Interfaces.RealInput theta_valveB 
          annotation (extent=[88,-70; 74,-56]);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Nominal parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.MassFlowRate fluidNomFlowRate_A 
          "Nominal flow rate through the fluid side "    annotation (Dialog(group = "side A"));
        parameter SI.MassFlowRate fluidNomFlowRate_B 
          "Nominal flow rate through the fluid side"     annotation (Dialog(group = "side B"));
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        parameter SI.Pressure fluidNomPressure_A 
          "Nominal pressure in the fluid side inlet"     annotation (Dialog(group = "side A"));
        parameter SI.Pressure fluidNomPressure_B 
          "Nominal pressure in the fluid side inlet"     annotation (Dialog(group = "side B"));
        
        //Other common parameter
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal (density by specific heat capacity)";
        
        //Parameter for first parallel heat exchangers
        parameter Integer N_G_p1=2 "Number of node of the gas side" 
                                                                  annotation (Dialog(tab = "pHE-1"));
        parameter Integer N_F_A_p1=2 "Number of node of the fluid side"   annotation (Dialog(tab = "pHE-1",
                                                                                             group = "side A"));
        parameter Integer N_F_B_p1=2 "Number of node of the fluid side"   annotation (Dialog(tab = "pHE-1",
                                                                                             group = "side B"));
        //Physical Parameter
        parameter SI.Area exchSurface_G_A_p1 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(tab = "pHE-1",
                                                                              group = "side A"));
        parameter SI.Area exchSurface_G_B_p1 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(tab = "pHE-1",
                                                                              group = "side B"));
        parameter SI.Area exchSurface_F_A_p1 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(tab = "pHE-1",
                                                                                group = "side A"));
        parameter SI.Area exchSurface_F_B_p1 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(tab = "pHE-1",
                                                                                group = "side B"));
        parameter SI.Area extSurfaceTub_A_p1 
          "Total external surface of the tubes"                                        annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side A"));
        parameter SI.Area extSurfaceTub_B_p1 
          "Total external surface of the tubes"                                        annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side B"));
        parameter SI.Volume gasVol_p1 "Gas volume" annotation (Dialog(tab = "pHE-1"));
        parameter SI.Volume fluidVol_A_p1 "Fluid volume"     annotation (Dialog(tab = "pHE-1",
                                                                                group = "side A"));
        parameter SI.Volume fluidVol_B_p1 "Fluid volume"     annotation (Dialog(tab = "pHE-1",
                                                                                group = "side B"));
        parameter SI.Volume metalVol_A_p1 
          "Volume of the metal part in the tube"                                     annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side A"));
        parameter SI.Volume metalVol_B_p1 
          "Volume of the metal part in the tube"                                     annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side B"));
        parameter Real rhomcm_A_p1 
          "Metal heat capacity per unit volume [J/m^3.K]"                          annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side A"));
        parameter Real rhomcm_B_p1 
          "Metal heat capacity per unit volume [J/m^3.K]"                          annotation (Dialog(tab = "pHE-1",
                                                                                                    group = "side B"));
        
        //Parameter for second parallel heat exchangers
        parameter Integer N_G_p2=2 "Number of node of the gas side" 
                                                                  annotation (Dialog(tab = "pHE-2"));
        parameter Integer N_F_A_p2=2 "Number of node of the fluid side"   annotation (Dialog(tab = "pHE-2",
                                                                                             group = "side A"));
        parameter Integer N_F_B_p2=2 "Number of node of the fluid side"   annotation (Dialog(tab = "pHE-2",
                                                                                             group = "side B"));
        //Physical Parameter
        parameter SI.Area exchSurface_G_A_p2 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(tab = "pHE-2",
                                                                              group = "side A"));
        parameter SI.Area exchSurface_G_B_p2 
          "Exchange surface between gas - metal tube,"     annotation (Dialog(tab = "pHE-2",
                                                                              group = "side B"));
        parameter SI.Area exchSurface_F_A_p2 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(tab = "pHE-2",
                                                                                group = "side A"));
        parameter SI.Area exchSurface_F_B_p2 
          "Exchange surface between metal tube - fluid,"     annotation (Dialog(tab = "pHE-2",
                                                                                group = "side B"));
        parameter SI.Area extSurfaceTub_A_p2 
          "Total external surface of the tubes"                                        annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side A"));
        parameter SI.Area extSurfaceTub_B_p2 
          "Total external surface of the tubes"                                        annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side B"));
        parameter SI.Volume gasVol_p2 "Gas volume" annotation (Dialog(tab = "pHE-2"));
        parameter SI.Volume fluidVol_A_p2 "Fluid volume"     annotation (Dialog(tab = "pHE-2",
                                                                                group = "side A"));
        parameter SI.Volume fluidVol_B_p2 "Fluid volume"     annotation (Dialog(tab = "pHE-2",
                                                                                group = "side B"));
        parameter SI.Volume metalVol_A_p2 
          "Volume of the metal part in the tube"                                     annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side A"));
        parameter SI.Volume metalVol_B_p2 
          "Volume of the metal part in the tube"                                     annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side B"));
        parameter Real rhomcm_A_p2 
          "Metal heat capacity per unit volume [J/m^3.K]"                          annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side A"));
        parameter Real rhomcm_B_p2 
          "Metal heat capacity per unit volume [J/m^3.K]"                          annotation (Dialog(tab = "pHE-2",
                                                                                                    group = "side B"));
        
        //Initialization conditions
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        //Start value pHE1
        parameter SI.Temperature Tstart_G_In_p1 
          "Inlet gas temperature start value"    annotation(Dialog(tab = "Initialization (pHE-1)"));
        parameter SI.Temperature Tstart_G_Out_p1 
          "Outlet gas temperature start value"    annotation(Dialog(tab = "Initialization (pHE-1)"));
        parameter SI.Temperature Tstart_G_p1[N_G_p1]=linspace(
                  Tstart_G_In_p1,
                  Tstart_G_Out_p1,
                  N_G_p1) 
          "Start value of gas temperature vector (initialized by default)" annotation(Dialog(tab = "Initialization (pHE-1)"));
        parameter SI.Pressure pstart_G_p1=gasNomPressure 
          "Pressure start value, gas side" annotation(Dialog(tab = "Initialization (pHE-1)"));
        //A
        parameter SI.Temperature Tstart_M_A_In_p1 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A_Out_p1 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A_p1[N_F_A_p1]=linspace(
                  Tstart_M_A_In_p1,
                  Tstart_M_A_Out_p1,
                  N_F_A_p1) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side A"));
        parameter SI.Temperature Tstart_F_A_In_p1=FluidMedium.temperature_ph(fluidNomPressure_A, hstart_F_A_In_p1) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-1)",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A_Out_p1=FluidMedium.temperature_ph(fluidNomPressure_A, hstart_F_A_Out_p1) 
          "Outlet fluid temperature start value"       annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-1)",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A_p1[N_F_A_p1]=linspace(
                  Tstart_F_A_In_p1,
                  Tstart_F_A_Out_p1,
                  N_F_A_p1) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-1)",
                                                                                                   group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_In_p1=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_In_p1) 
          "Inlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization (pHE-1)",
                                                                               group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_Out_p1=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_Out_p1) 
          "Outlet fluid specific enthalpy start value"        annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization (pHE-1)",
                                                                                group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_p1[N_F_A_p1]=linspace(
                  hstart_F_A_In_p1,
                  hstart_F_A_Out_p1,
                  N_F_A_p1) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-1)",
                                                                                                group = "side A"));
        parameter SI.Pressure pstartin_F_A_p1=fluidNomPressure_A 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side A"));
        parameter SI.Pressure pstartout_F_A_p1=fluidNomPressure_A 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side A"));
        //B
        parameter SI.Temperature Tstart_M_B_In_p1 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B_Out_p1 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B_p1[N_F_B_p1]=linspace(
                  Tstart_M_B_In_p1,
                  Tstart_M_B_Out_p1,
                  N_F_B_p1) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side B"));
        parameter SI.Temperature Tstart_F_B_In_p1=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_In_p1) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-1)",
                                                                         group = "side B"));
        parameter SI.Temperature Tstart_F_B_Out_p1=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_Out_p1) 
          "Outlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                          tab = "Initialization (pHE-1)",
                                                                          group = "side B"));
        parameter SI.Temperature Tstart_F_B_p1[N_F_B_p1]=linspace(
                  Tstart_F_B_In_p1,
                  Tstart_F_B_Out_p1,
                  N_F_B_p1) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-1)",
                                                                                                   group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_In_p1=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,
            Tstart_F_B_In_p1) "Inlet fluid specific enthalpy start value" 
                                                             annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization (pHE-1)",
                                                                               group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_Out_p1=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,
            Tstart_F_B_Out_p1) "Outlet fluid specific enthalpy start value" 
                                                              annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization (pHE-1)",
                                                                                group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_p1[N_F_B_p1]=linspace(
                  hstart_F_B_In_p1,
                  hstart_F_B_Out_p1,
                  N_F_B_p1) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-1)",
                                                                                                group = "side B"));
        parameter SI.Pressure pstartin_F_B_p1=fluidNomPressure_B 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side B"));
        parameter SI.Pressure pstartout_F_B_p1=fluidNomPressure_B 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-1)",
                              group = "side B"));
        
        //Start value pHE2
        parameter SI.Temperature Tstart_G_In_p2 
          "Inlet gas temperature start value"    annotation(Dialog(tab = "Initialization (pHE-2)"));
        parameter SI.Temperature Tstart_G_Out_p2 
          "Outlet gas temperature start value"    annotation(Dialog(tab = "Initialization (pHE-2)"));
        parameter SI.Temperature Tstart_G_p2[N_G_p2]=linspace(
                  Tstart_G_In_p2,
                  Tstart_G_Out_p2,
                  N_G_p2) 
          "Start value of gas temperature vector (initialized by default)" annotation(Dialog(tab = "Initialization (pHE-2)"));
        parameter SI.Pressure pstart_G_p2=gasNomPressure 
          "Pressure start value, gas side" annotation(Dialog(tab = "Initialization (pHE-2)"));
        //A
        parameter SI.Temperature Tstart_M_A_In_p2 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A_Out_p2 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side A"));
        parameter SI.Temperature Tstart_M_A_p2[N_F_A_p2]=linspace(
                  Tstart_M_A_In_p2,
                  Tstart_M_A_Out_p2,
                  N_F_A_p2) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side A"));
        parameter SI.Temperature Tstart_F_A_In_p2=FluidMedium.temperature_ph(
            fluidNomPressure_A, hstart_F_A_In_p1) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-2)",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A_Out_p2=FluidMedium.temperature_ph(
            fluidNomPressure_A, hstart_F_A_Out_p2) 
          "Outlet fluid temperature start value"       annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-2)",
                                                                         group = "side A"));
        parameter SI.Temperature Tstart_F_A_p2[N_F_A_p2]=linspace(
                  Tstart_F_A_In_p2,
                  Tstart_F_A_Out_p2,
                  N_F_A_p2) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-2)",
                                                                                                   group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_In_p2=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,
            Tstart_F_A_In_p2) "Inlet fluid specific enthalpy start value" 
                                                             annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization (pHE-2)",
                                                                               group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_Out_p2=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,
            Tstart_F_A_Out_p2) "Outlet fluid specific enthalpy start value" 
                                                              annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization (pHE-2)",
                                                                                group = "side A"));
        parameter SI.SpecificEnthalpy hstart_F_A_p2[N_F_A_p2]=linspace(
                  hstart_F_A_In_p2,
                  hstart_F_A_Out_p2,
                  N_F_A_p2) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-2)",
                                                                                                group = "side A"));
        parameter SI.Pressure pstartin_F_A_p2=fluidNomPressure_A 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side A"));
        parameter SI.Pressure pstartout_F_A_p2=fluidNomPressure_A 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side A"));
        //B
        parameter SI.Temperature Tstart_M_B_In_p2 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B_Out_p2 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side B"));
        parameter SI.Temperature Tstart_M_B_p2[N_F_B_p2]=linspace(
                  Tstart_M_B_In_p2,
                  Tstart_M_B_Out_p2,
                  N_F_B_p2) 
          "Start value of metal wall temperature vector (initialized by default)"
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side B"));
        parameter SI.Temperature Tstart_F_B_In_p2=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_In_p2) 
          "Inlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                         tab = "Initialization (pHE-2)",
                                                                         group = "side B"));
        parameter SI.Temperature Tstart_F_B_Out_p2=FluidMedium.temperature_ph(
            fluidNomPressure_B, hstart_F_B_Out_p2) 
          "Outlet fluid temperature start value"        annotation(Dialog(enable = use_T,
                                                                          tab = "Initialization (pHE-2)",
                                                                          group = "side B"));
        parameter SI.Temperature Tstart_F_B_p2[N_F_B_p2]=linspace(
                  Tstart_F_B_In_p2,
                  Tstart_F_B_Out_p2,
                  N_F_B_p2) 
          "Start value of fluid temperature vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-2)",
                                                                                                   group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_In_p2=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,
            Tstart_F_B_In_p2) "Inlet fluid specific enthalpy start value" 
                                                             annotation(Dialog(enable = not use_T,
                                                                               tab = "Initialization (pHE-2)",
                                                                               group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_Out_p2=
            FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,
            Tstart_F_B_Out_p2) "Outlet fluid specific enthalpy start value" 
                                                              annotation(Dialog(enable = not use_T,
                                                                                tab = "Initialization (pHE-2)",
                                                                                group = "side B"));
        parameter SI.SpecificEnthalpy hstart_F_B_p2[N_F_B_p2]=linspace(
                  hstart_F_B_In_p2,
                  hstart_F_B_Out_p2,
                  N_F_B_p2) 
          "Start value of fluid enthalpy vector (initialized by default)"     annotation(Dialog(tab = "Initialization (pHE-2)",
                                                                                                group = "side B"));
        parameter SI.Pressure pstartin_F_B_p2=fluidNomPressure_B 
          "Inlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side B"));
        parameter SI.Pressure pstartout_F_B_p2=fluidNomPressure_B 
          "Outlet fluid pressure start value" 
            annotation(Dialog(tab = "Initialization (pHE-2)",
                              group = "side B"));
        
      end ParallelHE_Att;
      
      partial model HEG_2L 
        "Base class for Heat Exchangers Group with two pressure levels" 
        
        Water.FlangeA LiquidWaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,54; -94,66]);
        Water.FlangeA Sh_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,94; -74,106]);
        Water.FlangeB Ev_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,94; -58,106]);
        Water.FlangeA Ev_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-54,94; -42,106]);
        Water.FlangeB Ec_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,94; -26,106]);
        Water.FlangeA Ec_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-22,94; -10,106]);
        Water.FlangeA Sh_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[10,94; 22,106]);
        Water.FlangeB Ev_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[26,94; 38,106]);
        Water.FlangeA Ev_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[42,94; 54,106]);
        Water.FlangeB Ec_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[58,94; 70,106]);
        Water.FlangeA Ec_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,94; 86,106]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-66,-106; -54,-94]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[54,-106; 66,-94]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-108,-6; -94,8]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[94,-6; 108,8]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,60; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,60; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,60; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,60; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,2; -66,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,6; -68,-6; -62,0; -68,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,2; 8,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,6; 6,-6; 12,0; 6,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,2; 78,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,6; 76,-6; 82,0; 76,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-100,86; 0,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="HP"),
            Text(
              extent=[0,86; 100,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Text(
              extent=[-100,-70; 100,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out"),
            Text(
              extent=[-120,60; -40,40],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="W")),  Diagram);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Common Parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        
        //Nominal parameter
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Pressure fluidHPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab = "HP", group= "Sh"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Pressure fluidHPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Pressure fluidHPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab = "HP", group= "Ec"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab = "LP", group= "Sh"));
        parameter SI.Pressure fluidLPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab = "LP", group= "Sh"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab = "LP", group= "Ev"));
        parameter SI.Pressure fluidLPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Pressure fluidLPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab = "LP", group = "Ec"));
        
        //Physical Parameter
        //Sh2_HP
        parameter Integer Sh2_HP_N_G=2 "Number of node of the gas side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh2_HP_N_F=2 "Number of node of the fluid side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_gasVol "Gas volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_fluidVol "Fluid volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_metalVol 
          "Volume of the metal part in the tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        //Sh1_HP
        parameter Integer Sh1_HP_N_G=2 "Number of node of the gas side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh1_HP_N_F=2 "Number of node of the fluid side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_gasVol "Gas volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_fluidVol "Fluid volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_metalVol 
          "Volume of the metal part in the tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        //Ev_HP
        parameter Integer Ev_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "HP",group = "Ev"));
        parameter Integer Ev_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_gasVol "Gas volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_fluidVol "Fluid volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ev"));
        //Ec_HP
        parameter Integer Ec_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab= "HP", group= "Ec"));
        parameter Integer Ec_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_gasVol "Gas volume" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_fluidVol "Fluid volume" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ec"));
        //Sh_LP
        parameter Integer Sh_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter Integer Sh_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Sh"));
        //Ev_LP
        parameter Integer Ev_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter Integer Ev_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ev"));
        //Ec_LP
        parameter Integer Ec_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter Integer Ec_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ec"));
        
        //Initialization conditions
        parameter Boolean use_T_Sh = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Superheaters (Reheater)"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ev = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Evaporators"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ec = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Economizers"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        
        //Start values
        //Sh2_HP
        parameter SI.Temperature Sh2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Sh1_HP
        parameter SI.Temperature Sh1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Ev_HP
        parameter SI.Temperature Ev_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                           tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (HP)", group = "Ev"));
        
        //Ec_HP
        parameter SI.Temperature Ec_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        
        //Sh_LP
        parameter SI.Temperature Sh_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (LP)", group = "Sh"));
        //Ev_LP
        parameter SI.Temperature Ev_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (LP)", group = "Ev"));
        //Ec_LP
        parameter SI.Temperature Ec_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (LP)", group = "Ec"));
        
      end HEG_2L;
      
      partial model HEG_2LRh 
        "Base class for Heat Exchangers Group with two pressure levels and reheat" 
        
        Water.FlangeA LiquidWaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,54; -94,66]);
        Water.FlangeA Sh_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,94; -74,106]);
        Water.FlangeB Ev_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,94; -58,106]);
        Water.FlangeA Ev_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-54,94; -42,106]);
        Water.FlangeB Ec_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,94; -26,106]);
        Water.FlangeA Ec_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-22,94; -10,106]);
        Water.FlangeA Sh_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[10,94; 22,106]);
        Water.FlangeB Ev_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[26,94; 38,106]);
        Water.FlangeA Ev_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[42,94; 54,106]);
        Water.FlangeB Ec_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[58,94; 70,106]);
        Water.FlangeA Ec_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,94; 86,106]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-66,-106; -54,-94]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[54,-106; 66,-94]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-108,-6; -94,8]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[94,-6; 108,8]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,60; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,60; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,60; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,60; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,2; -66,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,6; -68,-6; -62,0; -68,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,2; 8,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,6; 6,-6; 12,0; 6,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,2; 78,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,6; 76,-6; 82,0; 76,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-100,86; 0,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="HP"),
            Text(
              extent=[0,86; 100,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Text(
              extent=[-100,-70; 100,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Text(
              extent=[-120,60; -40,40],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="W")),  Diagram);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,-106; -14,-94]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[14,-106; 26,-94]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Common Parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        
        //Nominal parameter
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.Pressure fluidHPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.Pressure fluidHPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.Pressure fluidHPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Rh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.Pressure fluidIPNomPressure_Rh "Nominal pressure" annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.Pressure fluidLPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.Pressure fluidLPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ec"));
        parameter SI.Pressure fluidLPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ec"));
        
        //Physical Parameter
        //Sh2_HP
        parameter Integer Sh2_HP_N_G=2 "Number of node of the gas side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh2_HP_N_F=2 "Number of node of the fluid side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_gasVol "Gas volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_fluidVol "Fluid volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_metalVol 
          "Volume of the metal part in the tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        //Sh1_HP
        parameter Integer Sh1_HP_N_G=2 "Number of node of the gas side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh1_HP_N_F=2 "Number of node of the fluid side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_gasVol "Gas volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_fluidVol "Fluid volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_metalVol 
          "Volume of the metal part in the tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        //Ev_HP
        parameter Integer Ev_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "HP",group = "Ev"));
        parameter Integer Ev_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_gasVol "Gas volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_fluidVol "Fluid volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ev"));
        //Ec_HP
        parameter Integer Ec_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab= "HP", group= "Ec"));
        parameter Integer Ec_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Area Ec_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_gasVol "Gas volume" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_fluidVol "Fluid volume" annotation (Dialog(tab= "HP", group= "Ec"));
        parameter SI.Volume Ec_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ec"));
        //Rh2_IP
        parameter Integer Rh2_IP_N_G=2 "Number of node of the gas side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh2_IP_N_F=2 "Number of node of the fluid side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_gasVol "Gas volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_fluidVol "Fluid volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_metalVol 
          "Volume of the metal part in the tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        //Rh1_IP
        parameter Integer Rh1_IP_N_G=2 "Number of node of the gas side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh1_IP_N_F=2 "Number of node of the fluid side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh1"                                      annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_gasVol "Gas volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_fluidVol "Fluid volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_metalVol 
          "Volume of the metal part in the tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        //Sh_LP
        parameter Integer Sh_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter Integer Sh_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Sh"));
        //Ev_LP
        parameter Integer Ev_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter Integer Ev_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ev"));
        //Ec_LP
        parameter Integer Ec_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter Integer Ec_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ec"));
        
        //Initialization conditions
        parameter Boolean use_T_Sh = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Superheaters (Reheater)"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ev = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Evaporators"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ec = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Economizers"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        
        //Start values
        //Sh2_HP
        parameter SI.Temperature Sh2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Sh1_HP
        parameter SI.Temperature Sh1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Ev_HP
        parameter SI.Temperature Ev_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                           tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (HP)", group = "Ev"));
        
        //Ec_HP
        parameter SI.Temperature Ec_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        //Rh2_IP
        parameter SI.Temperature Rh2_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        //Rh1_HP
        parameter SI.Temperature Rh1_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        
        //Sh_LP
        parameter SI.Temperature Sh_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (LP)", group = "Sh"));
        //Ev_LP
        parameter SI.Temperature Ev_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (LP)", group = "Ev"));
        //Ec_LP
        parameter SI.Temperature Ec_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (LP)", group = "Ec"));
      end HEG_2LRh;
      
      partial model HEG_3LRh 
        "Base class for Heat Exchangers Group with three pressure levels and reheat" 
        
        Water.FlangeA LiquidWaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,54; -94,66]);
        Water.FlangeA Sh_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,94; -82,106]);
        Water.FlangeB Ev_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,94; -66,106]);
        Water.FlangeA Ev_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,94; -50,106]);
        Water.FlangeB Ec_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,94; -34,106]);
        Water.FlangeA Ec_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,94; -18,106]);
        Water.FlangeA Sh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,94; 12,106]);
        Water.FlangeB Ev_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,94; 28,106]);
        Water.FlangeA Ev_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,94; 44,106]);
        Water.FlangeB Ec_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,94; 60,106]);
        Water.FlangeA Ec_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,94; 76,106]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,-106; -74,-94]);
        Water.FlangeB Sh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[34,-106; 46,-94]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-108,-6; -94,8]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[94,-6; 108,8]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,60; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,60; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,60; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,60; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,2; -66,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,6; -68,-6; -62,0; -68,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,2; 8,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,6; 6,-6; 12,0; 6,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,2; 78,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,6; 76,-6; 82,0; 76,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-104,86; -4,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="HP"),
            Text(
              extent=[28,62; 128,42],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Text(
              extent=[-100,-70; 100,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Text(
              extent=[-120,60; -40,40],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="W"),
            Text(
              extent=[-12,86; 88,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="IP")),
            Diagram);
        Water.FlangeA Sh_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,80; 106,92]);
        Water.FlangeB Ev_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,64; 106,76]);
        Water.FlangeA Ev_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,48; 106,60]);
        Water.FlangeB Ec_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,32; 106,44]);
        Water.FlangeA Ec_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,16; 106,28]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-106; 6,-94]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,-106; 86,-94]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Common Parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        
        //Nominal parameter
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.Pressure fluidHPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.Pressure fluidHPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.Pressure fluidHPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Rh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.Pressure fluidIPNomPressure_Rh "Nominal pressure" annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Sh"));
        parameter SI.Pressure fluidIPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "IP", group = "Sh"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Ev"));
        parameter SI.Pressure fluidIPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "IP", group = "Ev"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Ec"));
        parameter SI.Pressure fluidIPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "IP", group = "Ec"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.Pressure fluidLPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.Pressure fluidLPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ec"));
        parameter SI.Pressure fluidLPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ec"));
        
        //Physical Parameter
        //Sh2_HP
        parameter Integer Sh2_HP_N_G=2 "Number of node of the gas side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh2_HP_N_F=2 "Number of node of the fluid side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_gasVol "Gas volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_fluidVol "Fluid volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_metalVol 
          "Volume of the metal part in the tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        //Sh1_HP
        parameter Integer Sh1_HP_N_G=2 "Number of node of the gas side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh1_HP_N_F=2 "Number of node of the fluid side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_gasVol "Gas volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_fluidVol "Fluid volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_metalVol 
          "Volume of the metal part in the tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        //Ev_HP
        parameter Integer Ev_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "HP",group = "Ev"));
        parameter Integer Ev_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_gasVol "Gas volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_fluidVol "Fluid volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ev"));
        //Ec2_HP
        parameter Integer Ec2_HP_N_G=2 "Number of node of the gas side, Ec2" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter Integer Ec2_HP_N_F=2 "Number of node of the fluid side, Ec2" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_extSurfaceTub 
          "Total external surface of the tubes, Ec2" 
                                                annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_gasVol "Gas volume, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_fluidVol "Fluid volume, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_metalVol 
          "Volume of the metal part in the tube, Ec2" 
                                                 annotation (Dialog(tab = "HP", group = "Ec"));
        //Ec1_HP
        parameter Integer Ec1_HP_N_G=2 "Number of node of the gas side, Ec1" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter Integer Ec1_HP_N_F=2 "Number of node of the fluid side, Ec1" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_extSurfaceTub 
          "Total external surface of the tubes, Ec1" 
                                                annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_gasVol "Gas volume, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_fluidVol "Fluid volume, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_metalVol 
          "Volume of the metal part in the tube, Ec1" 
                                                 annotation (Dialog(tab = "HP", group = "Ec"));
        //Rh2_IP
        parameter Integer Rh2_IP_N_G=2 "Number of node of the gas side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh2_IP_N_F=2 "Number of node of the fluid side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_gasVol "Gas volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_fluidVol "Fluid volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_metalVol 
          "Volume of the metal part in the tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        //Rh1_IP
        parameter Integer Rh1_IP_N_G=2 "Number of node of the gas side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh1_IP_N_F=2 "Number of node of the fluid side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh1"                                      annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_gasVol "Gas volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_fluidVol "Fluid volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_metalVol 
          "Volume of the metal part in the tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        //Sh_IP
        parameter Integer Sh_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Sh"));
        parameter Integer Sh_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_extSurfaceTub 
          "Total external surface of the tube" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Sh"));
        //Ev_IP
        parameter Integer Ev_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Ev"));
        parameter Integer Ev_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Ev"));
        //Ec_IP
        parameter Integer Ec_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Ec"));
        parameter Integer Ec_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_extSurfaceTub 
          "Total external surface of the tube" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Ec"));
        //Sh_LP
        parameter Integer Sh_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter Integer Sh_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Sh"));
        //Ev_LP
        parameter Integer Ev_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter Integer Ev_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ev"));
        //Ec_LP
        parameter Integer Ec_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter Integer Ec_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ec"));
        
        //Initialization conditions
        parameter Boolean use_T_Sh = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Superheaters (Reheater)"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ev = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Evaporators"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ec = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Economizers"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        
        //Start values
        //Sh2_HP
        parameter SI.Temperature Sh2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Sh1_HP
        parameter SI.Temperature Sh1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Ev_HP
        parameter SI.Temperature Ev_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                           tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (HP)", group = "Ev"));
        //Ec2_HP
        parameter SI.Temperature Ec2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Ec2" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Ec2" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Ec2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Ec2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Ec2" annotation(Dialog(enable = use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Ec2" annotation(Dialog(enable = use_T_Ec,
                                                                   tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Ec2" annotation(Dialog(enable = not use_T_Ec,
                                                                        tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Ec2" annotation(Dialog(enable = not use_T_Ec,
                                                                         tab = "Initialization (HP)", group = "Ec"));
        //Ec1_HP
        parameter SI.Temperature Ec1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Ec1" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Ec1" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Ec1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Ec1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Ec1" annotation(Dialog(enable = use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Ec1" annotation(Dialog(enable = use_T_Ec,
                                                                   tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Ec1" annotation(Dialog(enable = not use_T_Ec,
                                                                        tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Ec1" annotation(Dialog(enable = not use_T_Ec,
                                                                         tab = "Initialization (HP)", group = "Ec"));
        //Rh2_IP
        parameter SI.Temperature Rh2_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        //Rh1_HP
        parameter SI.Temperature Rh1_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        //Sh_IP
        parameter SI.Temperature Sh_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Sh,Sh_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Sh,Sh_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (IP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Sh,Sh_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (IP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Sh,Sh_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Sh"));
        //Ev_IP
        parameter SI.Temperature Ev_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,Ev_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,Ev_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                  tab = "Initialization (IP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ev,Ev_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (IP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ev,Ev_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (IP)", group = "Ev"));
        //Ec_IP
        parameter SI.Temperature Ec_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ec,Ec_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ec,Ec_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (IP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ec,Ec_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (IP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ec,Ec_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (IP)", group = "Ec"));
        
        //Sh_LP
        parameter SI.Temperature Sh_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (LP)", group = "Sh"));
        //Ev_LP
        parameter SI.Temperature Ev_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (LP)", group = "Ev"));
        //Ec_LP
        parameter SI.Temperature Ec_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (LP)", group = "Ec"));
        
      end HEG_3LRh;
      
      partial model HEG_3LRh_wa 
        "Base class for Heat Exchangers Group with three pressure levels and reheat, without attemperation" 
        
        Water.FlangeA Sh_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,94; -82,106]);
        Water.FlangeB Ev_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,94; -66,106]);
        Water.FlangeA Ev_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,94; -50,106]);
        Water.FlangeB Ec_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,94; -34,106]);
        Water.FlangeA Ec_HP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,94; -18,106]);
        Water.FlangeA Sh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,94; 12,106]);
        Water.FlangeB Ev_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,94; 28,106]);
        Water.FlangeA Ev_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,94; 44,106]);
        Water.FlangeB Ec_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,94; 60,106]);
        Water.FlangeA Ec_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,94; 76,106]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,-106; -74,-94]);
        Water.FlangeB Sh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[34,-106; 46,-94]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-108,-6; -94,8]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[94,-6; 108,8]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,60; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,60; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,60; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,60; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,2; -66,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,6; -68,-6; -62,0; -68,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,2; 8,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,6; 6,-6; 12,0; 6,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,2; 78,-2], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,6; 76,-6; 82,0; 76,6], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-104,86; -4,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="HP"),
            Text(
              extent=[28,62; 128,42],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Text(
              extent=[-100,-70; 100,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Text(
              extent=[-12,86; 88,66],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="IP")),
            Diagram);
        Water.FlangeA Sh_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,80; 106,92]);
        Water.FlangeB Ev_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,64; 106,76]);
        Water.FlangeA Ev_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,48; 106,60]);
        Water.FlangeB Ec_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,32; 106,44]);
        Water.FlangeA Ec_LP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,16; 106,28]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-106; 6,-94]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,-106; 86,-94]);
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Common Parameter
        parameter SI.MassFlowRate gasNomFlowRate 
          "Nominal flow rate through the gas side";
        parameter SI.Pressure gasNomPressure 
          "Nominal pressure in the gas side inlet";
        
        //Nominal parameter
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.Pressure fluidHPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "HP", group = "Sh"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.Pressure fluidHPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ev"));
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.Pressure fluidHPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "HP", group = "Ec"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Rh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.Pressure fluidIPNomPressure_Rh "Nominal pressure" annotation (Dialog(tab= "IP", group = "Rh"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Sh"));
        parameter SI.Pressure fluidIPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "IP", group = "Sh"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Ev"));
        parameter SI.Pressure fluidIPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "IP", group = "Ev"));
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "IP", group = "Ec"));
        parameter SI.Pressure fluidIPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "IP", group = "Ec"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.Pressure fluidLPNomPressure_Sh "Nominal pressure" annotation (Dialog(tab= "LP", group = "Sh"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.Pressure fluidLPNomPressure_Ev "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ev"));
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec "Nominal mass flowrate"
                                                                                annotation (Dialog(tab= "LP", group = "Ec"));
        parameter SI.Pressure fluidLPNomPressure_Ec "Nominal pressure" annotation (Dialog(tab= "LP", group = "Ec"));
        
        //Physical Parameter
        //Sh2_HP
        parameter Integer Sh2_HP_N_G=2 "Number of node of the gas side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh2_HP_N_F=2 "Number of node of the fluid side, Sh2" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh2_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_gasVol "Gas volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_fluidVol "Fluid volume, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh2_HP_metalVol 
          "Volume of the metal part in the tube, Sh2" annotation (Dialog(tab= "HP", group= "Sh"));
        //Sh1_HP
        parameter Integer Sh1_HP_N_G=2 "Number of node of the gas side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter Integer Sh1_HP_N_F=2 "Number of node of the fluid side, Sh1" 
            annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Area Sh1_HP_extSurfaceTub 
          "Total external surface of the tubes, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_gasVol "Gas volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_fluidVol "Fluid volume, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        parameter SI.Volume Sh1_HP_metalVol 
          "Volume of the metal part in the tube, Sh1" annotation (Dialog(tab= "HP", group= "Sh"));
        //Ev_HP
        parameter Integer Ev_HP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "HP",group = "Ev"));
        parameter Integer Ev_HP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Area Ev_HP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab= "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_gasVol "Gas volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_fluidVol "Fluid volume" annotation (Dialog(tab = "HP", group= "Ev"));
        parameter SI.Volume Ev_HP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab= "HP", group= "Ev"));
        //Ec2_HP
        parameter Integer Ec2_HP_N_G=2 "Number of node of the gas side, Ec2" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter Integer Ec2_HP_N_F=2 "Number of node of the fluid side, Ec2" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec2_HP_extSurfaceTub 
          "Total external surface of the tubes, Ec2" 
                                                annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_gasVol "Gas volume, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_fluidVol "Fluid volume, Ec2" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec2_HP_metalVol 
          "Volume of the metal part in the tube, Ec2" 
                                                 annotation (Dialog(tab = "HP", group = "Ec"));
        //Ec1_HP
        parameter Integer Ec1_HP_N_G=2 "Number of node of the gas side, Ec1" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter Integer Ec1_HP_N_F=2 "Number of node of the fluid side, Ec1" 
            annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_exchSurface_G 
          "Exchange surface between gas - metal tube, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Area Ec1_HP_extSurfaceTub 
          "Total external surface of the tubes, Ec1" 
                                                annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_gasVol "Gas volume, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_fluidVol "Fluid volume, Ec1" annotation (Dialog(tab = "HP", group = "Ec"));
        parameter SI.Volume Ec1_HP_metalVol 
          "Volume of the metal part in the tube, Ec1" 
                                                 annotation (Dialog(tab = "HP", group = "Ec"));
        //Rh2_IP
        parameter Integer Rh2_IP_N_G=2 "Number of node of the gas side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh2_IP_N_F=2 "Number of node of the fluid side, Rh2" 
            annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh2_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_gasVol "Gas volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_fluidVol "Fluid volume, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh2_IP_metalVol 
          "Volume of the metal part in the tube, Rh2" annotation (Dialog(tab = "IP", group = "Rh"));
        //Rh1_IP
        parameter Integer Rh1_IP_N_G=2 "Number of node of the gas side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter Integer Rh1_IP_N_F=2 "Number of node of the fluid side, Rh1"  annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_G 
          "Exchange surface between gas - metal tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Area Rh1_IP_extSurfaceTub 
          "Total external surface of the tubes, Rh1"                                      annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_gasVol "Gas volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_fluidVol "Fluid volume, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        parameter SI.Volume Rh1_IP_metalVol 
          "Volume of the metal part in the tube, Rh1" annotation (Dialog(tab = "IP", group = "Rh"));
        //Sh_IP
        parameter Integer Sh_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Sh"));
        parameter Integer Sh_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Area Sh_IP_extSurfaceTub 
          "Total external surface of the tube" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Sh"));
        parameter SI.Volume Sh_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Sh"));
        //Ev_IP
        parameter Integer Ev_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Ev"));
        parameter Integer Ev_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Area Ev_IP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Ev"));
        parameter SI.Volume Ev_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Ev"));
        //Ec_IP
        parameter Integer Ec_IP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "IP", group = "Ec"));
        parameter Integer Ec_IP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Area Ec_IP_extSurfaceTub 
          "Total external surface of the tube" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_gasVol "Gas volume" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_fluidVol "Fluid volume" annotation (Dialog(tab = "IP", group = "Ec"));
        parameter SI.Volume Ec_IP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "IP", group = "Ec"));
        //Sh_LP
        parameter Integer Sh_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter Integer Sh_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Area Sh_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Sh"));
        parameter SI.Volume Sh_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Sh"));
        //Ev_LP
        parameter Integer Ev_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter Integer Ev_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Area Ev_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ev"));
        parameter SI.Volume Ev_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ev"));
        //Ec_LP
        parameter Integer Ec_LP_N_G=2 "Number of node of the gas side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter Integer Ec_LP_N_F=2 "Number of node of the fluid side" 
            annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_G 
          "Exchange surface between gas - metal tube" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_exchSurface_F 
          "Exchange surface between metal tube - fluid" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Area Ec_LP_extSurfaceTub 
          "Total external surface of the tubes" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_gasVol "Gas volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_fluidVol "Fluid volume" annotation (Dialog(tab = "LP", group = "Ec"));
        parameter SI.Volume Ec_LP_metalVol 
          "Volume of the metal part in the tube" annotation (Dialog(tab = "LP", group = "Ec"));
        
        //Initialization conditions
        parameter Boolean use_T_Sh = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Superheaters (Reheater)"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ev = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Evaporators"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean use_T_Ec = true 
          "Select -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the Economizers"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        
        //Start values
        //Sh2_HP
        parameter SI.Temperature Sh2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh2" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Sh1_HP
        parameter SI.Temperature Sh1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Sh1" annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Sh1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (HP)", group = "Sh"));
        parameter SI.Temperature Sh1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Sh,Sh1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Sh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (HP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Sh,Sh1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Sh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (HP)", group = "Sh"));
        //Ev_HP
        parameter SI.Temperature Ev_HP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                           tab = "Initialization (HP)", group = "Ev"));
        parameter SI.Temperature Ev_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,Ev_HP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (HP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ev,Ev_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (HP)", group = "Ev"));
        //Ec2_HP
        parameter SI.Temperature Ec2_HP_Tstart_G_In 
          "Intlet gas temperature start value of Ec2" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Ec2" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Ec2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Ec2" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec2_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Ec2" annotation(Dialog(enable = use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec2_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec2_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Ec2" annotation(Dialog(enable = use_T_Ec,
                                                                   tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec2_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Ec2" annotation(Dialog(enable = not use_T_Ec,
                                                                        tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec2_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Ec2" annotation(Dialog(enable = not use_T_Ec,
                                                                         tab = "Initialization (HP)", group = "Ec"));
        //Ec1_HP
        parameter SI.Temperature Ec1_HP_Tstart_G_In 
          "Intlet gas temperature start value of Ec1" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_G_Out 
          "Outlet gas temperature start value of Ec1" annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_M_In 
          "Inlet metal wall temperature start value of Ec1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Ec1" 
            annotation(Dialog(tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_F_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec1_HP_hstart_F_In) 
          "Inlet fluid temperature start value of Ec1" annotation(Dialog(enable = use_T_Ec,
                                                                  tab = "Initialization (HP)", group = "Ec"));
        parameter SI.Temperature Ec1_HP_Tstart_F_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ec,Ec1_HP_hstart_F_Out) 
          "Outlet fluid temperature start value of Ec1" annotation(Dialog(enable = use_T_Ec,
                                                                   tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec1_HP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Ec1" annotation(Dialog(enable = not use_T_Ec,
                                                                        tab = "Initialization (HP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidHPNomPressure_Ec,Ec1_HP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Ec1" annotation(Dialog(enable = not use_T_Ec,
                                                                         tab = "Initialization (HP)", group = "Ec"));
        //Rh2_IP
        parameter SI.Temperature Rh2_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh2" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh2" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh2_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh2_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh2" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh2_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh2" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        //Rh1_HP
        parameter SI.Temperature Rh1_IP_Tstart_G_In 
          "Intlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_G_Out 
          "Outlet gas temperature start value of Rh1" annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_In 
          "Inlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value of Rh1" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_In) 
          "Inlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Rh"));
        parameter SI.Temperature Rh1_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Rh,Rh1_IP_hstart_F_Out) 
          "Outlet fluid temperature start value of Rh1" annotation(Dialog(enable = use_T_Sh,
                                                                   tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                        tab = "Initialization (IP)", group = "Rh"));
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Rh,Rh1_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value of Rh1" annotation(Dialog(enable = not use_T_Sh,
                                                                         tab = "Initialization (IP)", group = "Rh"));
        //Sh_IP
        parameter SI.Temperature Sh_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Sh,Sh_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (IP)", group = "Sh"));
        parameter SI.Temperature Sh_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Sh,Sh_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (IP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Sh,Sh_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (IP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Sh,Sh_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (IP)", group = "Sh"));
        //Ev_IP
        parameter SI.Temperature Ev_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,Ev_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (IP)", group = "Ev"));
        parameter SI.Temperature Ev_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,Ev_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                  tab = "Initialization (IP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ev,Ev_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (IP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ev,Ev_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (IP)", group = "Ev"));
        //Ec_IP
        parameter SI.Temperature Ec_IP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_F_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ec,Ec_IP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (IP)", group = "Ec"));
        parameter SI.Temperature Ec_IP_Tstart_F_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ec,Ec_IP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (IP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ec,Ec_IP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (IP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidIPNomPressure_Ec,Ec_IP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (IP)", group = "Ec"));
        
        //Sh_LP
        parameter SI.Temperature Sh_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                           tab = "Initialization (LP)", group = "Sh"));
        parameter SI.Temperature Sh_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Sh,Sh_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Sh,
                                                            tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                 tab = "Initialization (LP)", group = "Sh"));
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Sh,Sh_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Sh,
                                                                  tab = "Initialization (LP)", group = "Sh"));
        //Ev_LP
        parameter SI.Temperature Ev_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.Temperature Ev_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,Ev_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ev,
                                                            tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                 tab = "Initialization (LP)", group = "Ev"));
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ev,Ev_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ev,
                                                                  tab = "Initialization (LP)", group = "Ev"));
        //Ec_LP
        parameter SI.Temperature Ec_LP_Tstart_G_In 
          "Intlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_G_Out 
          "Outlet gas temperature start value" annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_In 
          "Inlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_M_Out 
          "Outlet metal wall temperature start value" 
            annotation(Dialog(tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_In) 
          "Inlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                           tab = "Initialization (LP)", group = "Ec"));
        parameter SI.Temperature Ec_LP_Tstart_F_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ec,Ec_LP_hstart_F_Out) 
          "Outlet fluid temperature start value" annotation(Dialog(enable = use_T_Ec,
                                                            tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_In) 
          "Inlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                 tab = "Initialization (LP)", group = "Ec"));
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidLPNomPressure_Ec,Ec_LP_Tstart_F_Out) 
          "Outlet fluid specific enthalpy start value" annotation(Dialog(enable = not use_T_Ec,
                                                                  tab = "Initialization (LP)", group = "Ec"));
        
      end HEG_3LRh_wa;
      
      partial model DG_2L "Base class for Drums Group with two pressure levels" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB LiquidWaterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,44; -94,56]);
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,-106; -74,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,-106; -58,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-54,-106; -42,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,-106; -26,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-22,-106; -10,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[10,-106; 22,-94]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[26,-106; 38,-94]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[42,-106; 54,-94]);
        Water.FlangeA Feed_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[58,-106; 70,-94]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,-106; 86,-94]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,44; 106,56]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[28,0; 68,-40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[28,-20; 68,-20; 68,-16; 66,-12; 64,-8; 62,-6; 60,-4; 56,
                  -2; 52,0; 48,0; 44,0; 40,-2; 36,-4; 32,-8; 30,-12; 28,-16; 28,-20],
                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Ellipse(extent=[-68,80; -28,40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-68,60; -28,60; -28,64; -30,68; -32,72; -34,74; -36,76;
                  -40,78; -44,80; -48,80; -52,80; -56,78; -60,76; -64,72; -66,68; -68,
                  64; -68,60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[60,-36; 64,-40; 64,-96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[48,-40; 48,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[16,-96; 16,8; 48,8; 48,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-68,0; -28,-40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-68,-20; -28,-20; -28,-16; -30,-12; -32,-8; -34,-6; -36,
                  -4; -40,-2; -44,0; -48,0; -52,0; -56,-2; -60,-4; -64,-8; -66,-12;
                  -68,-16; -68,-20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-36,-36; -32,-40; -32,-96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-48,-40; -48,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-80,-96; -80,8; -48,8; -48,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[70,40; 90,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[70,34; 80,20; 90,34; 80,20; 80,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[80,40; 80,50; 96,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-64,50; -96,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[80,20; 80,-100],style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-16,-96; -16,-70; 48,-70; 48,-70], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-100,28; 0,8],
              string="HP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Text(
              extent=[-2,28; 98,8],
              string="LP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Text(
              extent=[-40,72; 60,52],
              string="LW",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[-62,-6; -66,-2; -72,-2; -72,-74; -64,-74; -64,-100;
                  -64,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[34,-6; 30,-2; 24,-2; 24,-74; 32,-74; 32,-100; 32,-98],
                style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
      end DG_2L;
      
      partial model DG_3L 
        "Base class for Drums Group with three pressure levels" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //IP drum 
        parameter SI.Pressure fluidIPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rint "Internal radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rext "External radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_L "Length"                annotation (Dialog(group = "IP drum"));
        parameter SI.HeatCapacity IPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "IP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //IP drum
        parameter SI.Pressure IPd_pstart=fluidIPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.Temperature IPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB LiquidWaterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,44; -94,56]);
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,-106; -82,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,-106; -66,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,-106; -50,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-106; -18,-94]);
        Water.FlangeB Steam_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-106; 12,-94]);
        Water.FlangeA FromRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,-106; 28,-94]);
        Water.FlangeB ToRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,-106; 44,-94]);
        Water.FlangeA Feed_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,-106; 60,-94]);
        Water.FlangeB WaterForIP(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,-106; 76,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,-14; 106,-2]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,2; 106,14]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,18; 106,30]);
        Water.FlangeA Feed_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,34; 106,46]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,50; 106,62]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,66; 106,78]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-100,100; 0,80],
              string="LW",
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[18,-30; 58,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[18,-50; 58,-50; 58,-46; 56,-42; 54,-38; 52,-36; 50,
                  -34; 46,-32; 42,-30; 38,-30; 34,-30; 30,-32; 26,-34; 22,-38;
                  20,-42; 18,-46; 18,-50],
                                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Ellipse(extent=[-68,80; -28,40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-68,60; -28,60; -28,64; -30,68; -32,72; -34,74; -36,76;
                  -40,78; -44,80; -48,80; -52,80; -56,78; -60,76; -64,72; -66,68; -68,
                  64; -68,60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[50,-66; 54,-70; 54,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[38,-70; 38,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[6,-100; 6,-22; 38,-22; 38,-30],   style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-76,-30; -36,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-76,-50; -36,-50; -36,-46; -38,-42; -40,-38; -42,
                  -36; -44,-34; -48,-32; -52,-30; -56,-30; -60,-30; -64,-32;
                  -68,-34; -72,-38; -74,-42; -76,-46; -76,-50],
                                              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-44,-66; -40,-70; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-56,-70; -56,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-88,-100; -88,-22; -56,-22; -56,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[56,84; 76,64], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[56,78; 66,64; 76,78; 66,64; 66,84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-64,50; -96,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-12,94; 88,74],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Ellipse(extent=[4,68; 44,28], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[4,48; 44,48; 44,52; 42,56; 40,60; 38,62; 36,64; 32,66; 28,
                  68; 24,68; 20,68; 16,66; 12,64; 8,60; 6,56; 4,52; 4,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[24,68; 24,80; -8,80; -8,-8; 98,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,30; 24,24; 98,24], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[70,24; 70,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-24,-100; -24,-84; 70,-84],style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[42,40; 100,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,64; 66,56; 100,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,84; 66,92; 84,92; 84,72; 98,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-108,0; -8,-20],
              string="HP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Text(
              extent=[2,-10; 102,-30],
              string="IP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[12,64; 8,68; 0,68; 0,8; 10,8; 46,8; 100,8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[24,-36; 20,-32; 14,-32; 14,-72; 22,-72; 22,-100; 22,
                  -100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,-36; -74,-32; -80,-32; -80,-72; -72,-72; -72,-100;
                  -72,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
      end DG_3L;
      
      partial model DG_3L_wa 
        "Base class for Drums Group with three pressure levels, without attemperation" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //IP drum 
        parameter SI.Pressure fluidIPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rint "Internal radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rext "External radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_L "Length"                annotation (Dialog(group = "IP drum"));
        parameter SI.HeatCapacity IPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "IP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //IP drum
        parameter SI.Pressure IPd_pstart=fluidIPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.Temperature IPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,-106; -82,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,-106; -66,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,-106; -50,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-106; -18,-94]);
        Water.FlangeB Steam_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-106; 12,-94]);
        Water.FlangeA FromRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,-106; 28,-94]);
        Water.FlangeB ToRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,-106; 44,-94]);
        Water.FlangeA Feed_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,-106; 60,-94]);
        Water.FlangeB WaterForIP(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,-106; 76,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,-14; 106,-2]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,2; 106,14]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,18; 106,30]);
        Water.FlangeA Feed_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,34; 106,46]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,50; 106,62]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,66; 106,78]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[18,-30; 58,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[18,-50; 58,-50; 58,-46; 56,-42; 54,-38; 52,-36; 50,
                  -34; 46,-32; 42,-30; 38,-30; 34,-30; 30,-32; 26,-34; 22,-38;
                  20,-42; 18,-46; 18,-50],
                                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[50,-66; 54,-70; 54,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[38,-70; 38,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[6,-100; 6,-22; 38,-22; 38,-30],   style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-76,-30; -36,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-76,-50; -36,-50; -36,-46; -38,-42; -40,-38; -42,
                  -36; -44,-34; -48,-32; -52,-30; -56,-30; -60,-30; -64,-32;
                  -68,-34; -72,-38; -74,-42; -76,-46; -76,-50],
                                              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-44,-66; -40,-70; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-56,-70; -56,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-88,-100; -88,-22; -56,-22; -56,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[56,84; 76,64], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[56,78; 66,64; 76,78; 66,64; 66,84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-12,94; 88,74],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Ellipse(extent=[4,68; 44,28], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[4,48; 44,48; 44,52; 42,56; 40,60; 38,62; 36,64; 32,66; 28,
                  68; 24,68; 20,68; 16,66; 12,64; 8,60; 6,56; 4,52; 4,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[24,68; 24,80; -8,80; -8,-8; 98,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,30; 24,24; 98,24], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[70,24; 70,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-24,-100; -24,-84; 70,-84],style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[42,40; 100,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,64; 66,56; 100,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,84; 66,92; 84,92; 84,72; 98,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-108,0; -8,-20],
              string="HP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Text(
              extent=[2,-10; 102,-30],
              string="IP",
              style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[12,64; 8,68; 0,68; 0,8; 10,8; 46,8; 100,8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[24,-36; 20,-32; 14,-32; 14,-72; 22,-72; 22,-100; 22,
                  -100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,-36; -74,-32; -80,-32; -80,-72; -72,-72; -72,-100;
                  -72,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
      end DG_3L_wa;
      
      partial model DG_2L_tap "Base class for Drums Group with two pressure levels and
  tappings of saturated water for external heater" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB LiquidWaterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,44; -94,56]);
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,-106; -74,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,-106; -58,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-54,-106; -42,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,-106; -26,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-22,-106; -10,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[10,-106; 22,-94]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[26,-106; 38,-94]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[42,-106; 54,-94]);
        Water.FlangeA Feed_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[58,-106; 70,-94]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[74,-106; 86,-94]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,34; 106,46]);
        Water.FlangeA HPsteamFromExUse(redeclare package Medium = FluidMedium) 
          "HP steam from external use" 
          annotation (extent=[-16,94; -4,106]);
        Water.FlangeB tapHPwater(redeclare package Medium = FluidMedium) 
          "tapping HP Water for external use" 
          annotation (extent=[34,94; 46,106]);
        Water.FlangeB tapLPwater(redeclare package Medium = FluidMedium) 
          "tapping LP Water for external use" 
          annotation (extent=[54,94; 66,106]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-100,30; 0,10],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="HP"),
            Text(
              extent=[0,30; 100,10],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Text(
              extent=[-54,70; 46,50],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LW"),
            Ellipse(extent=[28,0; 68,-40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[28,-20; 68,-20; 68,-16; 66,-12; 64,-8; 62,-6; 60,-4; 56,
                  -2; 52,0; 48,0; 44,0; 40,-2; 36,-4; 32,-8; 30,-12; 28,-16; 28,-20],
                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Ellipse(extent=[-68,80; -28,40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-68,60; -28,60; -28,64; -30,68; -32,72; -34,74; -36,76;
                  -40,78; -44,80; -48,80; -52,80; -56,78; -60,76; -64,72; -66,68; -68,
                  64; -68,60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[60,-36; 64,-40; 64,-96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[48,-40; 48,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[16,-96; 16,8; 48,8; 48,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-68,0; -28,-40], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-68,-20; -28,-20; -28,-16; -30,-12; -32,-8; -34,-6; -36,
                  -4; -40,-2; -44,0; -48,0; -52,0; -56,-2; -60,-4; -64,-8; -66,-12;
                  -68,-16; -68,-20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-36,-36; -32,-40; -32,-96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-48,-40; -48,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-80,-96; -80,8; -48,8; -48,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[70,30; 90,10], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[70,24; 80,10; 90,24; 80,10; 80,30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[80,30; 80,40; 96,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-64,50; -96,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[80,10; 80,-100],style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-16,-96; -16,-70; 48,-70; 48,-70], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[12,90; 92,72],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="tap"),
            Line(points=[-62,-6; -66,-2; -72,-2; -72,-74; -64,-74; -64,-100;
                  -64,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[34,-4; 30,0; 24,0; 24,-50; 32,-50; 32,-98; 32,-96],
                style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
        
      end DG_2L_tap;
      
      partial model DG_3L_tap "Base class for Drums Group with three pressure levels and
   tappings of saturated water for external heater" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //IP drum 
        parameter SI.Pressure fluidIPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rint "Internal radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rext "External radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_L "Length"                annotation (Dialog(group = "IP drum"));
        parameter SI.HeatCapacity IPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "IP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //IP drum
        parameter SI.Pressure IPd_pstart=fluidIPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.Temperature IPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB LiquidWaterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-106,12; -94,24]);
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,-106; -82,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,-106; -66,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,-106; -50,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-106; -18,-94]);
        Water.FlangeB Steam_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-106; 12,-94]);
        Water.FlangeA FromRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,-106; 28,-94]);
        Water.FlangeB ToRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,-106; 44,-94]);
        Water.FlangeA Feed_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,-106; 60,-94]);
        Water.FlangeB WaterForIP(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,-106; 76,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,-14; 106,-2]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,2; 106,14]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,18; 106,30]);
        Water.FlangeA Fedd_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,34; 106,46]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,50; 106,62]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,66; 106,78]);
        Water.FlangeA HPsteamFromExUse(redeclare package Medium = FluidMedium) 
          "HP steam from external use" 
          annotation (extent=[-90,94; -78,106]);
        Water.FlangeB tapHPwater(redeclare package Medium = FluidMedium) 
          "tapping HP Water for external use" 
          annotation (extent=[-40,94; -28,106]);
        Water.FlangeA IPsteamFromExUse(redeclare package Medium = FluidMedium) 
          "IP steam from external use" 
          annotation (extent=[-70,94; -58,106]);
        Water.FlangeB tapIPwater(redeclare package Medium = FluidMedium) 
          "tapping IP Water for external use" 
          annotation (extent=[-20,94; -8,106]);
        Water.FlangeB tapLPwater(redeclare package Medium = FluidMedium) 
          "tapping LP Water for external use" 
          annotation (extent=[0,94; 12,106]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-108,0; -8,-20],
              string="HP",
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Text(
              extent=[2,-12; 102,-32],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="IP"),
            Text(
              extent=[-100,72; 0,52],
              string="LW",
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[18,-30; 58,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[18,-50; 58,-50; 58,-46; 56,-42; 54,-38; 52,-36; 50,
                  -34; 46,-32; 42,-30; 38,-30; 34,-30; 30,-32; 26,-34; 22,-38;
                  20,-42; 18,-46; 18,-50],
                                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Ellipse(extent=[-70,46; -30,6],  style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-70,28; -30,28; -30,32; -32,36; -34,40; -36,42; -38,
                  44; -42,46; -46,48; -50,48; -54,48; -58,46; -62,44; -66,40;
                  -68,36; -70,32; -70,28], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255})),
            Line(points=[50,-66; 54,-70; 54,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[38,-70; 38,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[6,-100; 6,-22; 38,-22; 38,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-76,-30; -36,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-76,-50; -36,-50; -36,-46; -38,-42; -40,-38; -42,
                  -36; -44,-34; -48,-32; -52,-30; -56,-30; -60,-30; -64,-32;
                  -68,-34; -72,-38; -74,-42; -76,-46; -76,-50],
                                              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-44,-66; -40,-70; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-56,-70; -56,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-88,-100; -88,-22; -56,-22; -56,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[56,84; 76,64], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[56,78; 66,64; 76,78; 66,64; 66,84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-64,18; -96,18], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-8,84; 92,64],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Ellipse(extent=[4,68; 44,28], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[4,48; 44,48; 44,52; 42,56; 40,60; 38,62; 36,64; 32,66; 28,
                  68; 24,68; 20,68; 16,66; 12,64; 8,60; 6,56; 4,52; 4,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[24,68; 24,80; -8,80; -8,-8; 98,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,30; 24,24; 98,24], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[70,24; 70,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-24,-100; -24,-84; 70,-84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[42,40; 100,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,64; 66,56; 100,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,84; 66,92; 84,92; 84,72; 98,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,-36; 20,-32; 14,-32; 14,-72; 22,-72; 22,-100; 22,
                  -100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,-36; -74,-32; -80,-32; -80,-72; -72,-72; -72,-100;
                  -72,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[12,64; 8,68; 0,68; 0,8; 10,8; 46,8; 100,8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
        
      end DG_3L_tap;
      
      partial model DG_3L_tap_wa 
        "Base class for Drums Group with three pressure levels and tappings of saturated water for external heater" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Charateristics 
        //HP drum 
        parameter SI.Pressure fluidHPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rint "Internal radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_rext "External radius"                annotation (Dialog(group = "HP drum"));
        parameter SI.Length HPd_L "Length"                annotation (Dialog(group = "HP drum"));
        parameter SI.HeatCapacity HPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "HP drum"));
        //IP drum 
        parameter SI.Pressure fluidIPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rint "Internal radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_rext "External radius"                annotation (Dialog(group = "IP drum"));
        parameter SI.Length IPd_L "Length"                annotation (Dialog(group = "IP drum"));
        parameter SI.HeatCapacity IPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "IP drum"));
        //LP drum 
        parameter SI.Pressure fluidLPNomPressure "Nominal internal pressure" 
                                                     annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rint "Internal radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_rext "External radius"                annotation (Dialog(group = "LP drum"));
        parameter SI.Length LPd_L "Length"                annotation (Dialog(group = "LP drum"));
        parameter SI.HeatCapacity LPd_Cm 
          "Total Heat Capacity of the metal wall"          annotation (Dialog(group = "LP drum"));
        
        //Initialization 
        parameter Boolean SSInit = false "Steady-state initialisation" annotation(Dialog(tab = "Initialisation"));
        //HP drum
        parameter SI.Pressure HPd_pstart=fluidHPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.SpecificEnthalpy HPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        parameter SI.Temperature HPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "HP drum"));
        //IP drum
        parameter SI.Pressure IPd_pstart=fluidIPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.SpecificEnthalpy IPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        parameter SI.Temperature IPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "IP drum"));
        //LP drum
        parameter SI.Pressure LPd_pstart=fluidLPNomPressure 
          "Pressure start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hvstart "Vapour enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.SpecificEnthalpy LPd_hlstart "Liquid enthalpy start value"
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        parameter SI.Temperature LPd_Tmstart=300 
          "Metal wall temperature start value" 
          annotation(Dialog(tab = "Initialisation", group = "LP drum"));
        
        constant Real g=Modelica.Constants.g_n;
        constant Real pi=Modelica.Constants.pi;
        
        Water.FlangeB Steam_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-94,-106; -82,-94]);
        Water.FlangeA FromRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,-106; -66,-94]);
        Water.FlangeB ToRiser_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-62,-106; -50,-94]);
        Water.FlangeA Feed_HP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-106; -34,-94]);
        Water.FlangeB WaterForHP(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-106; -18,-94]);
        Water.FlangeB Steam_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-106; 12,-94]);
        Water.FlangeA FromRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,-106; 28,-94]);
        Water.FlangeB ToRiser_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,-106; 44,-94]);
        Water.FlangeA Feed_IP(redeclare package Medium = FluidMedium) 
          annotation (extent=[48,-106; 60,-94]);
        Water.FlangeB WaterForIP(redeclare package Medium = FluidMedium) 
          annotation (extent=[64,-106; 76,-94]);
        Water.FlangeB Steam_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,-14; 106,-2]);
        Water.FlangeA FromRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,2; 106,14]);
        Water.FlangeB ToRiser_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,18; 106,30]);
        Water.FlangeA Fedd_LP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,34; 106,46]);
        Water.FlangeB WaterForLP(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,50; 106,62]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[94,66; 106,78]);
        Water.FlangeA HPsteamFromExUse(redeclare package Medium = FluidMedium) 
          "HP steam from external use" 
          annotation (extent=[-90,94; -78,106]);
        Water.FlangeB tapHPwater(redeclare package Medium = FluidMedium) 
          "tapping HP Water for external use" 
          annotation (extent=[-40,94; -28,106]);
        Water.FlangeA IPsteamFromExUse(redeclare package Medium = FluidMedium) 
          "IP steam from external use" 
          annotation (extent=[-70,94; -58,106]);
        Water.FlangeB tapIPwater(redeclare package Medium = FluidMedium) 
          "tapping IP Water for external use" 
          annotation (extent=[-20,94; -8,106]);
        Water.FlangeB tapLPwater(redeclare package Medium = FluidMedium) 
          "tapping LP Water for external use" 
          annotation (extent=[0,94; 12,106]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-108,0; -8,-20],
              string="HP",
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Text(
              extent=[2,-12; 102,-32],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="IP"),
            Ellipse(extent=[18,-30; 58,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[18,-50; 58,-50; 58,-46; 56,-42; 54,-38; 52,-36; 50,
                  -34; 46,-32; 42,-30; 38,-30; 34,-30; 30,-32; 26,-34; 22,-38;
                  20,-42; 18,-46; 18,-50],
                                style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[50,-66; 54,-70; 54,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[38,-70; 38,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[6,-100; 6,-22; 38,-22; 38,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-76,-30; -36,-70], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-76,-50; -36,-50; -36,-46; -38,-42; -40,-38; -42,
                  -36; -44,-34; -48,-32; -52,-30; -56,-30; -60,-30; -64,-32;
                  -68,-34; -72,-38; -74,-42; -76,-46; -76,-50],
                                              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[-44,-66; -40,-70; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-56,-70; -56,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-88,-100; -88,-22; -56,-22; -56,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[56,84; 76,64], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[56,78; 66,64; 76,78; 66,64; 66,84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Text(
              extent=[-8,84; 92,64],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="LP"),
            Ellipse(extent=[4,68; 44,28], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[4,48; 44,48; 44,52; 42,56; 40,60; 38,62; 36,64; 32,66; 28,
                  68; 24,68; 20,68; 16,66; 12,64; 8,60; 6,56; 4,52; 4,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1)),
            Line(points=[24,68; 24,80; -8,80; -8,-8; 98,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,30; 24,24; 98,24], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[70,24; 70,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-24,-100; -24,-84; 70,-84], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[42,40; 100,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,64; 66,56; 100,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[66,84; 66,92; 84,92; 84,72; 98,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[24,-36; 20,-32; 14,-32; 14,-72; 22,-72; 22,-100; 22,
                  -100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,-36; -74,-32; -80,-32; -80,-72; -72,-72; -72,-100;
                  -72,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[12,64; 8,68; 0,68; 0,8; 10,8; 46,8; 100,8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1))),
                             Diagram);
        
      end DG_3L_tap_wa;
      
      partial model HRSG_2L 
        "Base class for Heat Recovery Steam Generator with two pressure levels" 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[50,-110; 70,-90]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,-110; -50,-90]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,-110; 10,-90]);
        Gas.FlangeA HotGas(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-110,-20; -90,0]);
        Gas.FlangeB ColdGas(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[90,-20; 110,0]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,58; 108,78]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,26; 88,46]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,40; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,40; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,40; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,40; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,40; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,-8; -66,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,-4; -68,-16; -62,-10; -68,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,-8; 8,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,-4; 6,-16; 12,-10; 6,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,-8; 78,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,-4; 76,-16; 82,-10; 76,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-44,-66; 34,-88],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out"),
            Ellipse(extent=[-34,82; -6,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-32,70; -8,70; -12,62; -16,60; -24,60; -28,62; -32,70],
                style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-32,70; -8,70; -12,76; -16,78; -24,78; -28,76; -32,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[26,82; 54,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[28,70; 52,70; 48,62; 44,60; 36,60; 32,62; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[28,70; 52,70; 48,76; 44,78; 36,78; 32,76; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255}))),
                                  Diagram);
        
      end HRSG_2L;
      
      partial model HRSG_2LRh 
        "Base class for Heat Recovery Steam Generator with two pressure levels and reheat" 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[70,-110; 90,-90]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,-110; -70,-90]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,-110; 50,-90]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-110,-20; -90,0]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[90,-20; 110,0]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,-110; -30,-90]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,-110; 10,-90]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,58; 108,78]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,26; 88,46]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,40; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,40; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,40; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,40; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,40; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,-8; -66,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,-4; -68,-16; -62,-10; -68,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,-8; 8,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,-4; 6,-16; 12,-10; 6,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,-8; 78,-12], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,-4; 76,-16; 82,-10; 76,-4], style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-42,-68; 38,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Ellipse(extent=[26,82; 54,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[28,70; 52,70; 48,62; 44,60; 36,60; 32,62; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[28,70; 52,70; 48,76; 44,78; 36,78; 32,76; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-34,82; -6,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-32,70; -8,70; -12,62; -16,60; -24,60; -28,62; -32,70],
                style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-32,70; -8,70; -12,76; -16,78; -24,78; -28,76; -32,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255}))),
                                  Diagram);
        
      end HRSG_2LRh;
      
      partial model HRSG_3LRh 
        "Base class for Heat Recovery Steam Generator with three pressure levels and reheat" 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[70,-110; 90,-90]);
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,-110; -70,-90]);
        Water.FlangeB Sh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-110; 20,-90]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-110,-20; -90,0]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[90,-20; 110,0]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-60,-110; -40,-90]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-110; -10,-90]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,-110; 50,-90]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,58; 108,78]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,26; 88,46]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,40; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,40; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,40; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,40; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,40; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,-8; -66,-12],
                                              style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,-4; -68,-16; -62,-10; -68,-4],
                                                          style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,-8; 8,-12],
                                           style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,-4; 6,-16; 12,-10; 6,-4],
                                                   style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,-8; 78,-12],
                                            style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,-4; 76,-16; 82,-10; 76,-4],
                                                      style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-62,-66; 18,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Ellipse(extent=[36,84; 64,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[38,72; 62,72; 58,64; 54,62; 46,62; 42,64; 38,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[38,72; 62,72; 58,78; 54,80; 46,80; 42,78; 38,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-14,84; 14,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-12,72; 12,72; 8,64; 4,62; -4,62; -8,64; -12,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-12,72; 12,72; 8,78; 4,80; -4,80; -8,78; -12,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-64,84; -36,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-62,72; -38,72; -42,64; -46,62; -54,62; -58,64; -62,72],
                style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-62,72; -38,72; -42,78; -46,80; -54,80; -58,78; -62,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1))),
            Diagram);
        
      end HRSG_3LRh;
      
      partial model HRSG_2LRh_tap "Base class for Heat Recovery Steam Generator with two pressure levels,
  reheat and tappings of saturated water for external heater " 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,-110; -70,-90]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,-110; -30,-90]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,-110; 10,-90]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,-110; 50,-90]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[70,-110; 90,-90]);
        Water.FlangeA HPsteam_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-70,90; -50,110]);
        Water.FlangeB HPwater_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,90; 10,110]);
        Water.FlangeB LPwater_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,90; 50,110]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-110,-20; -90,0]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[90,-20; 110,0]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,58; 108,78]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,26; 88,46]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,40; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,40; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,40; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,40; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,40; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,-8; -66,-12],
                                              style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,-4; -68,-16; -62,-10; -68,-4],
                                                          style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,-8; 8,-12],
                                           style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,-4; 6,-16; 12,-10; 6,-4],
                                                   style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,-8; 78,-12],
                                            style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,-4; 76,-16; 82,-10; 76,-4],
                                                      style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-42,-66; 38,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Ellipse(extent=[26,82; 54,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[28,70; 52,70; 48,62; 44,60; 36,60; 32,62; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[28,70; 52,70; 48,76; 44,78; 36,78; 32,76; 28,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-34,82; -6,56], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-32,70; -8,70; -12,62; -16,60; -24,60; -28,62; -32,70],
                                                                              style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-32,70; -8,70; -12,76; -16,78; -24,78; -28,76; -32,70], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255}))),
            Diagram);
        
      end HRSG_2LRh_tap;
      
      partial model HRSG_3LRh_tap "Base class for Heat Recovery Steam Generator with three pressure levels,
  reheat and tappings of saturated water for external heater " 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.FlangeB Sh_HP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,-110; -70,-90]);
        Water.FlangeA Rh_IP_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-60,-110; -40,-90]);
        Water.FlangeB Rh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-110; -10,-90]);
        Water.FlangeB Sh_IP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,-110; 20,-90]);
        Water.FlangeB Sh_LP_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,-110; 50,-90]);
        Water.FlangeA WaterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[70,-110; 90,-90]);
        Water.FlangeA HPsteam_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,90; -70,110]);
        Water.FlangeB HPwater_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,90; -30,110]);
        Water.FlangeA IPsteam_In(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,90; 10,110]);
        Water.FlangeB IPwater_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[30,90; 50,110]);
        Water.FlangeB LPwater_Out(redeclare package Medium = FluidMedium) 
          annotation (extent=[70,90; 90,110]);
        Gas.FlangeA GasIn(redeclare package Medium = FlueGasMedium) 
                          annotation (extent=[-110,-20; -90,0]);
        Gas.FlangeB GasOut(redeclare package Medium = FlueGasMedium) 
                           annotation (extent=[90,-20; 110,0]);
        Buses.Sensors SensorsBus 
                              annotation (extent=[88,58; 108,78]);
        Buses.Actuators ActuatorsBus 
                                  annotation (extent=[108,26; 88,46]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,40; -56,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-30,40; -26,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-2,40; 2,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[26,40; 30,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[56,40; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                arrow=1,
                fillPattern=1)),
            Rectangle(extent=[-80,-8; -66,-12],
                                              style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[-68,-4; -68,-16; -62,-10; -68,-4],
                                                          style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[-6,-8; 8,-12],
                                           style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[6,-4; 6,-16; 12,-10; 6,-4],
                                                   style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Rectangle(extent=[64,-8; 78,-12],
                                            style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Polygon(points=[76,-4; 76,-16; 82,-10; 76,-4],
                                                      style(
                pattern=0,
                thickness=2,
                arrow=1,
                fillColor=76,
                rgbfillColor={170,170,255},
                fillPattern=1)),
            Text(
              extent=[-42,-66; 38,-90],
              style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2),
              string="Out & Rh"),
            Ellipse(extent=[36,84; 64,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[38,72; 62,72; 58,64; 54,62; 46,62; 42,64; 38,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[38,72; 62,72; 58,78; 54,80; 46,80; 42,78; 38,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-14,84; 14,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-12,72; 12,72; 8,64; 4,62; -4,62; -8,64; -12,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-12,72; 12,72; 8,78; 4,80; -4,80; -8,78; -12,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255})),
            Ellipse(extent=[-64,84; -36,58], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-62,72; -38,72; -42,64; -46,62; -54,62; -58,64; -62,72],
                style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-62,72; -38,72; -42,78; -46,80; -54,80; -58,78; -62,72], style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=68,
                rgbfillColor={170,213,255}))),
            Diagram);
        
      end HRSG_3LRh_tap;
      
    end Interfaces;
    
    package Components 
      
      model HE "Heat Exchanger fluid - gas" 
        extends Interfaces.HeatExchanger(pstartout_F=fluidNomPressure-dpnom);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F 
          "Constant heat transfer coefficient in the fluid side";
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side";
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side";
        parameter Boolean counterCurrent=true "Counter-current flow";
        parameter SI.Pressure dpnom=0 
          "Nominal pressure drop fluid side (friction term only!)";
        parameter SI.Density rhonom=0 "Nominal inlet density fluid side";
        parameter Boolean gasQuasiStatic=false 
          "Quasi-static model of the flue gas (mass, energy and momentum static balances";
        constant Real pi=Modelica.Constants.pi;
        
      Water.Flow1D fluidFlow(
          Nt=1,
          N=N_F,
          wnom=fluidNomFlowRate,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          L=exchSurface_F^2/(fluidVol*pi*4),
          A=(fluidVol*4/exchSurface_F)^2/4*pi,
          omega=fluidVol*4/exchSurface_F*pi,
          Dhyd=fluidVol*4/exchSurface_F,
          pstartin=pstartin_F,
          pstartout=pstartout_F,
          FFtype=FFtype_F,
          dpnom=dpnom,
          rhonom=rhonom,
          HydraulicCapacitance=HCtype_F,
          hstart=hstart_F,
          hstartin=hstart_F_In,
          hstartout=hstart_F_Out) 
                                 annotation (extent=[-10,-60; 10,-40]);
        Thermal.ConvHT convHT(               N=N_F,
          Tstart11=Tstart_M_In,
          Tstart1N=Tstart_M_Out,
          Tstart21=Tstart_F_In,
          Tstart2N=Tstart_F_Out,
          gamma=gamma_F,
          Tstart1=Tstart_M,
          Tstart2=Tstart_F) 
          annotation (extent=[-10,-40; 10,-20]);
        Thermal.MetalTube metalTube(
          rhomcm=rhomcm,
          lambda=lambda,
          N=N_F,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F^2/(fluidVol*pi*4),
          rint=fluidVol*4/exchSurface_F/2,
          Tstart1=Tstart_M_In,
          TstartN=Tstart_M_Out,
          WallRes=false,
          Tstart=Tstart_M,
          rext=(metalVol + fluidVol)*4/extSurfaceTub/2) 
                 annotation (extent=[-10,-6; 10,-26], rotation=0);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_G,
          A=gasVol/1,
          omega=exchSurface_G/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          QuasiStatic=gasQuasiStatic,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          pstart=pstart_G,
          Tstart=Tstart_G)       annotation (extent=[-12,58; 12,38]);
        annotation (Diagram);
        Thermal.CounterCurrent cC(                                    N=N_F,
            counterCurrent=counterCurrent) 
          annotation (extent=[-10,-10; 10,10]);
        Thermal.HeatFlowDistribution heatFlowDistribution(
          N=N_F,
          A1=exchSurface_G,
          A2=extSurfaceTub) 
          annotation (extent=[-10,4; 10,24]);
        Thermal.ConvHT2N convHT2N(
          N1=N_G,
          N2=N_F,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_In,
          Tstart2N=Tstart_M_Out,
          gamma=gamma_G,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M)    annotation (extent=[-10,20; 10,40]);
      equation 
        connect(fluidFlow.wall, convHT.side2) 
                                           annotation (points=[0,-45; 0,-33.1],
            style(color=45, rgbcolor={255,127,0}));
        connect(gasFlow.infl, gasIn) annotation (points=[-12,48; -80,48; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.outfl, gasOut) annotation (points=[12,48; 80,48; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(fluidFlow.outfl, waterOut) 
                                        annotation (points=[10,-50; 40,-50; 40,
              -80; 0,-80], style(thickness=2));
        connect(fluidFlow.infl, waterIn) 
                                      annotation (points=[-10,-50; -40,-50; -40,
              80; 0,80], style(thickness=2));
        connect(heatFlowDistribution.side2, cC.side1) annotation (points=[0,10.9;
              0,3],           style(
            color=45,
            rgbcolor={255,127,0},
            fillPattern=1));
        connect(convHT2N.side1, gasFlow.wall) annotation (points=[0,33; 0,43],
            style(color=45, rgbcolor={255,127,0}));
        connect(heatFlowDistribution.side1, convHT2N.side2) annotation (points=[0,17; 0,
              26.9],          style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.int, convHT.side1) annotation (points=[0,-19; 0,-27],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.ext, cC.side2) annotation (points=[0,-12.9; 0,-3.1],
            style(color=45, rgbcolor={255,127,0}));
      end HE;
      
      model HE2ph "Heat Exchanger fluid - gas (fluid 2-phase)" 
        extends Interfaces.HeatExchanger(pstartout_F=fluidNomPressure-dpnom);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F 
          "Constant heat transfer coefficient in the fluid side";
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side";
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side";
        parameter Boolean counterCurrent=true "Counter-current flow";
        parameter SI.Pressure dpnom=0 
          "Nominal pressure drop fluid side (friction term only!)";
        parameter SI.Density rhonom=0 "Nominal inlet density fluid side";
        parameter Boolean gasQuasiStatic=false 
          "Quasi-static model of the flue gas (mass, energy and momentum static balances";
        constant Real pi=Modelica.Constants.pi;
        
      Water.Flow1D2ph fluidFlow(
          Nt=1,
          N=N_F,
          wnom=fluidNomFlowRate,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          L=exchSurface_F^2/(fluidVol*pi*4),
          A=(1/exchSurface_F*fluidVol*4)^2/4*pi,
          omega=1/exchSurface_F*fluidVol*4*pi,
          Dhyd=1/exchSurface_F*fluidVol*4,
          pstartin=pstartin_F,
          pstartout=pstartout_F,
          FFtype=FFtype_F,
          dpnom=dpnom,
          rhonom=rhonom,
          HydraulicCapacitance=HCtype_F,
          hstart=hstart_F,
          hstartin=hstart_F_In,
          hstartout=hstart_F_Out) 
                                 annotation (extent=[-10,-58; 10,-38]);
        Thermal.ConvHT convHT(gamma=gamma_F, N=N_F,
          Tstart11=Tstart_M_In,
          Tstart1N=Tstart_M_Out,
          Tstart21=Tstart_F_In,
          Tstart2N=Tstart_F_Out,
          Tstart1=Tstart_M,
          Tstart2=Tstart_F) 
          annotation (extent=[-10,-40; 10,-20]);
        Thermal.MetalTube metalTube(
          rhomcm=rhomcm,
          lambda=lambda,
          N=N_F,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F^2/(fluidVol*pi*4),
          rint=1/exchSurface_F*fluidVol*4/2,
          Tstart1=Tstart_M_In,
          TstartN=Tstart_M_Out,
          WallRes=false,
          Tstart=Tstart_M,
          rext=1/extSurfaceTub*(metalVol + fluidVol)*4/2) 
                 annotation (extent=[-10,-8; 10,-28]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_G,
          A=gasVol/1,
          omega=exchSurface_G/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          pstart=pstart_G,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          Tstart=Tstart_G,
          QuasiStatic=gasQuasiStatic) 
                                 annotation (extent=[-12,58; 12,38]);
        annotation (Diagram);
        Thermal.CounterCurrent cC(     counterCurrent=counterCurrent, N=N_F) 
          annotation (extent=[-10,-10; 10,10]);
        Thermal.HeatFlowDistribution heatFlowDistribution(
          N=N_F,
          A1=exchSurface_G,
          A2=extSurfaceTub) 
          annotation (extent=[-10,6; 10,26]);
        Thermal.ConvHT2N convHT2N(
          N1=N_G,
          N2=N_F,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_In,
          Tstart2N=Tstart_M_Out,
          gamma=gamma_G,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M)    annotation (extent=[-10,22; 10,42]);
      equation 
        connect(fluidFlow.wall, convHT.side2) 
                                           annotation (points=[0,-43; 0,-33.1],
            style(color=45, rgbcolor={255,127,0}));
        connect(gasFlow.infl, gasIn) annotation (points=[-12,48; -80,48; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.outfl, gasOut) annotation (points=[12,48; 80,48; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(fluidFlow.outfl, waterOut) 
                                        annotation (points=[10,-48; 40,-48; 40,
              -80; 0,-80], style(thickness=2));
        connect(fluidFlow.infl, waterIn) 
                                      annotation (points=[-10,-48; -40,-48; -40,
              80; 0,80], style(thickness=2));
        connect(heatFlowDistribution.side2,cC. side1) annotation (points=[0,12.9;
              0,3],           style(
            color=45,
            rgbcolor={255,127,0},
            fillPattern=1));
        connect(convHT2N.side1,gasFlow. wall) annotation (points=[0,35; 0,43],
            style(color=45, rgbcolor={255,127,0}));
        connect(convHT2N.side2, heatFlowDistribution.side1) annotation (points=[0,28.9;
              0,19],          style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.int, convHT.side1) annotation (points=[0,-21; 0,-27],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.ext, cC.side2) annotation (points=[0,-14.9; 0,-3.1],
            style(color=45, rgbcolor={255,127,0}));
      end HE2ph;
      
      model ParHE "Parallel heat exchangers fluid - gas" 
        extends Interfaces.ParallelHE(pstartout_F_A=fluidNomPressure_A-dpnom_A,
                                      pstartout_F_B=fluidNomPressure_B-dpnom_B);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G_A 
          "Constant heat transfer coefficient in the gas side"     annotation (Dialog(group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_G_B 
          "Constant heat transfer coefficient in the gas side"     annotation (Dialog(group = "side B"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_A 
          "Constant heat transfer coefficient in the fluid side"     annotation (Dialog(group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_B 
          "Constant heat transfer coefficient in the fluid side"     annotation (Dialog(group = "side B"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_A=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"     annotation (Dialog(group = "side A"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_B=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"     annotation (Dialog(group = "side B"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_A=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"     annotation (Dialog(group = "side A"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_B=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"     annotation (Dialog(group = "side B"));
        parameter Boolean counterCurrent_A = true "Counter-current flow"     annotation (Dialog(group = "side A"));
        parameter Boolean counterCurrent_B = true "Counter-current flow"     annotation (Dialog(group = "side B"));
        parameter SI.Pressure dpnom_A=0 
          "Nominal pressure drop fluid side (friction term only!)"     annotation (Dialog(group = "side A"));
        parameter SI.Pressure dpnom_B=0 
          "Nominal pressure drop fluid side (friction term only!)"     annotation (Dialog(group = "side B"));
        parameter SI.Density rhonom_A=0 "Nominal inlet density fluid side"     annotation (Dialog(group = "side A"));
        parameter SI.Density rhonom_B=0 "Nominal inlet density fluid side"     annotation (Dialog(group = "side B"));
        parameter Boolean gasQuasiStatic=false 
          "Quasi-static model of the flue gas (mass, energy and momentum static balances";
        constant Real pi=Modelica.Constants.pi;
        
        ConvParallel convParallel(
          N=N_G,
          As=exchSurface_G_A + exchSurface_G_B,
          Aa=exchSurface_G_A,
          Ab=exchSurface_G_B) 
                             annotation (extent=[-10,12; 10,32]);
        annotation (Diagram);
      Water.Flow1D fluidAFlow(
          Nt=1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          N=N_F_A,
          L=exchSurface_F_A^2/(fluidVol_A*pi*4),
          A=(fluidVol_A*4/exchSurface_F_A)^2/4*pi,
          omega=fluidVol_A*4/exchSurface_F_A*pi,
          Dhyd=fluidVol_A*4/exchSurface_F_A,
          pstartin=pstartin_F_A,
          pstartout=pstartout_F_A,
          hstart=hstart_F_A,
          wnom=fluidNomFlowRate_A,
          FFtype=FFtype_F_A,
          dpnom=dpnom_A,
          rhonom=rhonom_A,
          HydraulicCapacitance=HCtype_F_A,
          hstartin=hstart_F_A_In,
          hstartout=hstart_F_A_Out) 
                                 annotation (extent=[-38,-56; -18,-36]);
        Thermal.ConvHT convHT_A(
          N=N_F_A,
          gamma=gamma_F_A,
          Tstart11=Tstart_M_A_In,
          Tstart1N=Tstart_M_A_Out,
          Tstart21=Tstart_F_A_In,
          Tstart2N=Tstart_F_A_Out,
          Tstart1=Tstart_M_A,
          Tstart2=Tstart_F_A) 
          annotation (extent=[-38,-38; -18,-18]);
        Thermal.MetalTube metalTube_A(
          lambda=lambda,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          N=N_F_A,
          L=exchSurface_F_A^2/(fluidVol_A*pi*4),
          rint=fluidVol_A*4/exchSurface_F_A/2,
          Tstart1=Tstart_M_A_In,
          TstartN=Tstart_M_A_Out,
          WallRes=false,
          Tstart=Tstart_M_A,
          rext=(metalVol_A + fluidVol_A)*4/extSurfaceTub_A/2,
          rhomcm=rhomcm_A) 
                 annotation (extent=[-38,-6; -18,-26]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_G,
          A=gasVol/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          omega=(exchSurface_G_A + exchSurface_G_B)/1,
          QuasiStatic=gasQuasiStatic,
          pstart=pstart_G,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          Tstart=Tstart_G)       annotation (extent=[-12,60; 12,40]);
      Water.Flow1D fluidBFlow(
          Nt=1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          N=N_F_B,
          L=exchSurface_F_B^2/(fluidVol_B*pi*4),
          A=(fluidVol_B*4/exchSurface_F_B)^2/4*pi,
          omega=fluidVol_B*4/exchSurface_F_B*pi,
          Dhyd=fluidVol_B*4/exchSurface_F_B,
          wnom=fluidNomFlowRate_B,
          pstartin=pstartin_F_B,
          pstartout=pstartout_F_B,
          hstart=hstart_F_B,
          FFtype=FFtype_F_B,
          dpnom=dpnom_B,
          rhonom=rhonom_B,
          HydraulicCapacitance=HCtype_F_B,
          hstartin=hstart_F_B_In,
          hstartout=hstart_F_B_Out) 
                                 annotation (extent=[38,-56; 18,-36]);
        Thermal.ConvHT convHT_B(
          N=N_F_B,
          gamma=gamma_F_B,
          Tstart11=Tstart_M_B_In,
          Tstart1N=Tstart_M_B_Out,
          Tstart21=Tstart_F_B_In,
          Tstart2N=Tstart_F_B_Out,
          Tstart1=Tstart_M_B,
          Tstart2=Tstart_F_B) 
          annotation (extent=[18,-38; 38,-18]);
        Thermal.MetalTube metalTube_B(
          lambda=lambda,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F_B^2/(fluidVol_B*pi*4),
          rint=fluidVol_B*4/exchSurface_F_B/2,
          N=N_F_B,
          Tstart1=Tstart_M_B_In,
          TstartN=Tstart_M_B_Out,
          WallRes=false,
          Tstart=Tstart_M_B,
          rext=(metalVol_B + fluidVol_B)*4/extSurfaceTub_B/2,
          rhomcm=rhomcm_B) 
                 annotation (extent=[18,-6; 38,-26]);
        Thermal.CounterCurrent cC_A(N=N_F_A, counterCurrent=counterCurrent_A) 
          annotation (extent=[-38,-8; -18,12]);
        Thermal.HeatFlowDistribution heatFlowDistribution_A(
          N=N_F_A,
          A1=exchSurface_G_A,
          A2=extSurfaceTub_A) 
          annotation (extent=[-38,8; -18,28]);
        Thermal.CounterCurrent cC_B(N=N_F_B, counterCurrent=counterCurrent_B) 
          annotation (extent=[18,-8; 38,12]);
        Thermal.HeatFlowDistribution heatFlowDistribution_B(
          N=N_F_B,
          A1=exchSurface_G_B,
          A2=extSurfaceTub_B) 
          annotation (extent=[18,8; 38,28]);
        Thermal.ConvHT2N convHT2N_A(
          N1=N_G,
          N2=N_F_A,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_A_In,
          Tstart2N=Tstart_M_A_Out,
          gamma=gamma_G_A,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M_A)    annotation (extent=[-38,24; -18,44]);
        Thermal.ConvHT2N convHT2N_B(
          N1=N_G,
          N2=N_F_B,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_B_In,
          Tstart2N=Tstart_M_B_Out,
          gamma=gamma_G_B,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M_B)    annotation (extent=[18,24; 38,44]);
      equation 
        connect(heatFlowDistribution_A.side2, cC_A.side1) annotation (points=[-28,14.9;
              -28,5],           style(color=45, rgbcolor={255,127,0}));
        connect(convHT_A.side2, fluidAFlow.wall)    annotation (points=[-28,
              -31.1; -28,-41], style(color=45, rgbcolor={255,127,0}));
        connect(heatFlowDistribution_B.side2, cC_B.side1) annotation (points=[28,14.9;
              28,5],          style(color=45, rgbcolor={255,127,0}));
        connect(convHT_B.side2, fluidBFlow.wall)    annotation (points=[28,-31.1;
              28,-41],        style(color=45, rgbcolor={255,127,0}));
        connect(fluidBFlow.outfl, waterOutB)    annotation (points=[18,-46; 8,
              -46; 8,-80; 40,-80], style(thickness=2));
        connect(fluidAFlow.outfl, waterOutA)    annotation (points=[-18,-46; -8,
              -46; -8,-80; -40,-80], style(thickness=2));
        connect(fluidAFlow.infl, waterInA)    annotation (points=[-38,-46; -50,
              -46; -50,80; -40,80], style(thickness=2));
        connect(fluidBFlow.infl, waterInB)    annotation (points=[38,-46; 52,
              -46; 52,80; 40,80], style(thickness=2));
        connect(gasFlow.outfl, gasOut)   annotation (points=[12,50; 80,50; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.infl, gasIn)   annotation (points=[-12,50; -80,50; -80,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(convParallel.source, gasFlow.wall)   annotation (points=[0,29; 0,
              45],   style(color=45, rgbcolor={255,127,0}));
        connect(heatFlowDistribution_A.side1, convHT2N_A.side2) 
                                                              annotation (
            points=[-28,21; -28,30.9], style(color=45, rgbcolor={255,127,0}));
        connect(convHT2N_A.side1, convParallel.objectA) 
                                                      annotation (points=[-28,37;
              -28,42; -14,42; -14,4; -6,4; -6,19],     style(color=45, rgbcolor=
               {255,127,0}));
        connect(convHT2N_B.side2, heatFlowDistribution_B.side1) 
                                                               annotation (
            points=[28,30.9; 28,21], style(color=45, rgbcolor={255,127,0}));
        connect(convHT2N_B.side1, convParallel.objectB) 
                                                       annotation (points=[28,37;
              28,42; 16,42; 16,4; 6,4; 6,19],           style(color=45,
              rgbcolor={255,127,0}));
        connect(metalTube_B.ext, cC_B.side2) annotation (points=[28,-12.9; 28,
              -1.1], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube_B.int, convHT_B.side1) annotation (points=[28,-19; 28,
              -25], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube_A.int, convHT_A.side1) annotation (points=[-28,-19;
              -28,-25], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube_A.ext, cC_A.side2) annotation (points=[-28,-12.9; -28,
              -1.1], style(color=45, rgbcolor={255,127,0}));
      end ParHE;
      
      model ParHE_att 
        "Parallel Heat Exchanger (two fluid with one gas) with attemperation" 
        extends Interfaces.ParallelHE_Att;
        
        parameter SI.CoefficientOfHeatTransfer gamma_G_A_p1 
          "Constant heat transfer coefficient in the gas side"            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_G_B_p1 
          "Constant heat transfer coefficient in the gas side"            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_A_p1 
          "Constant heat transfer coefficient in the fluid side"            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_B_p1 
          "Constant heat transfer coefficient in the fluid side"            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_A_p1=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_B_p1=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_A_p1=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_B_p1=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter Boolean counterCurrent_A_p1 = true "Counter-current flow" 
                                            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter Boolean counterCurrent_B_p1 = true "Counter-current flow" 
                                            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter SI.Pressure dpnom_A_p1=0 
          "Nominal pressure drop fluid side(friction term only!)"            annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter SI.Pressure dpnom_B_p1=0 
          "Nominal pressure drop fluid side(friction term only!)"            annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter SI.Density rhonom_A_p1=0 "Nominal inlet density fluid side" 
                                                        annotation (Dialog(tab = "pHE-1", group = "side A"));
        parameter SI.Density rhonom_B_p1=0 "Nominal inlet density fluid side" 
                                                        annotation (Dialog(tab = "pHE-1", group = "side B"));
        parameter SI.CoefficientOfHeatTransfer gamma_G_A_p2 
          "Constant heat transfer coefficient in the gas side"            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_G_B_p2 
          "Constant heat transfer coefficient in the gas side"            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_A_p2 
          "Constant heat transfer coefficient in the fluid side"            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_B_p2 
          "Constant heat transfer coefficient in the fluid side"            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_A_p2=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter Choices.Flow1D.FFtypes.Temp FFtype_F_B_p2=ThermoPower.Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type, fluid side"            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_A_p2=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter Choices.Flow1D.HCtypes.Temp HCtype_F_B_p2=ThermoPower.Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance, fluid side"            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter Boolean counterCurrent_A_p2 = true "Counter-current flow" 
                                            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter Boolean counterCurrent_B_p2 = true "Counter-current flow" 
                                            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter SI.Pressure dpnom_A_p2=0 
          "Nominal pressure drop fluid side (friction term only!)"            annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter SI.Pressure dpnom_B_p2=0 
          "Nominal pressure drop fluid side (friction term only!)"            annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter SI.Density rhonom_A_p2=0 "Nominal inlet density fluid side" 
                                                        annotation (Dialog(tab = "pHE-2", group = "side A"));
        parameter SI.Density rhonom_B_p2=0 "Nominal inlet density fluid side" 
                                                        annotation (Dialog(tab = "pHE-2", group = "side B"));
        parameter Boolean gasQuasiStatic=false 
          "Quasi-static model of the flue gas (mass, energy and momentum static balances";
        constant Real pi=Modelica.Constants.pi;
        
        //Valves parameters
        parameter Real Cv_valA "Cv (US) flow coefficient, valve A" annotation (Dialog(group = "Attemperation A"));
        parameter SI.Pressure pnom_valA "Nominal inlet pressure, valve A" annotation (Dialog(group = "Attemperation A"));
        parameter SI.Pressure dpnom_valA "Nominal pressure drop, valve A" annotation (Dialog(group = "Attemperation A"));
        parameter SI.MassFlowRate wnom_valA "Nominal mass flowrate, valve A" annotation (Dialog(group = "Attemperation A"));
        parameter SI.SpecificEnthalpy hstart_valA=1e5 
          "Specific enthalpy start value, valve A" annotation (Dialog(group = "Attemperation A"));
        parameter Real Cv_valB "Cv (US) flow coefficient, valve B" annotation (Dialog(group = "Attemperation B"));
        parameter SI.Pressure pnom_valB "Nominal inlet pressure, valve B" annotation (Dialog(group = "Attemperation B"));
        parameter SI.Pressure dpnom_valB "Nominal pressure drop, valve B" annotation (Dialog(group = "Attemperation B"));
        parameter SI.MassFlowRate wnom_valB "Nominal mass flowrate, valve B" annotation (Dialog(group = "Attemperation B"));
        parameter SI.SpecificEnthalpy hstart_valB=1e5 
          "Specific enthalpy start value, valve B" annotation (Dialog(group = "Attemperation B"));
        
        ParHE pHE1(
          redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=N_G_p1,
          N_F_A=N_F_A_p1,
          N_F_B=N_F_B_p1,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate_A=fluidNomFlowRate_A,
          fluidNomFlowRate_B=fluidNomFlowRate_B,
          gasNomPressure=gasNomPressure,
          fluidNomPressure_A=fluidNomPressure_A,
          fluidNomPressure_B=fluidNomPressure_B,
          exchSurface_G_A=exchSurface_G_A_p1,
          exchSurface_G_B=exchSurface_G_B_p1,
          exchSurface_F_A=exchSurface_F_A_p1,
          exchSurface_F_B=exchSurface_F_B_p1,
          gasVol=gasVol_p1,
          fluidVol_A=fluidVol_A_p1,
          fluidVol_B=fluidVol_B_p1,
          metalVol_A=metalVol_A_p1,
          metalVol_B=metalVol_B_p1,
          gamma_G_A=gamma_G_A_p1,
          gamma_G_B=gamma_G_B_p1,
          gamma_F_A=gamma_F_A_p1,
          gamma_F_B=gamma_F_B_p1,
          FFtype_F_A=FFtype_F_A_p1,
          FFtype_F_B=FFtype_F_B_p1,
          HCtype_F_A=HCtype_F_A_p1,
          HCtype_F_B=HCtype_F_B_p1,
          counterCurrent_A=counterCurrent_A_p1,
          counterCurrent_B=counterCurrent_B_p1,
          dpnom_A=dpnom_A_p1,
          dpnom_B=dpnom_B_p1,
          rhonom_A=rhonom_A_p1,
          rhonom_B=rhonom_B_p1,
          gasQuasiStatic=gasQuasiStatic,
          lambda=lambda,
          extSurfaceTub_A=extSurfaceTub_A_p1,
          extSurfaceTub_B=extSurfaceTub_B_p1,
          use_T=use_T,
          SSInit=SSInit,
          Tstart_G_In=Tstart_G_In_p1,
          Tstart_G_Out=Tstart_G_Out_p1,
          Tstart_M_A_In=Tstart_M_A_In_p1,
          Tstart_M_A_Out=Tstart_M_A_Out_p1,
          Tstart_M_A=Tstart_M_A_p1,
          Tstart_F_A_In=Tstart_F_A_In_p1,
          Tstart_F_A_Out=Tstart_F_A_Out_p1,
          Tstart_F_A=Tstart_F_A_p1,
          hstart_F_A_In=hstart_F_A_In_p1,
          hstart_F_A_Out=hstart_F_A_Out_p1,
          hstart_F_A=hstart_F_A_p1,
          Tstart_M_B_In=Tstart_M_B_In_p1,
          Tstart_M_B_Out=Tstart_M_B_Out_p1,
          Tstart_F_B_In=Tstart_F_B_In_p1,
          Tstart_F_B=Tstart_F_B_p1,
          hstart_F_B_In=hstart_F_B_In_p1,
          hstart_F_B_Out=hstart_F_B_Out_p1,
          hstart_F_B=hstart_F_B_p1,
          pstart_G=pstart_G_p1,
          pstartin_F_A=pstartin_F_A_p1,
          pstartout_F_A=pstartout_F_A_p1,
          pstartin_F_B=pstartin_F_B_p1,
          pstartout_F_B=pstartout_F_B_p1,
          rhomcm_A=rhomcm_A_p1,
          rhomcm_B=rhomcm_B_p1,
          Tstart_M_B=Tstart_M_B_p1,
          Tstart_F_B_Out=Tstart_F_B_Out_p1) 
          annotation (extent=[-46,28; -26,48]);
        annotation (Diagram);
        Water.ValveLiq valve_A(
          redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=Cv_valA,
          pnom=pnom_valA,
          dpnom=dpnom_valA,
          wnom=wnom_valA,
          CheckValve=true,
          hstart=hstart_valA)  annotation (extent=[-18,-32; -34,-16],
                                                                  rotation=180);
        Water.ValveLiq valveB(
          redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=Cv_valB,
          pnom=pnom_valB,
          dpnom=dpnom_valB,
          wnom=wnom_valB,
          CheckValve=true,
          hstart=hstart_valB) annotation (extent=[-18,-2; -34,14],
                                                                 rotation=180);
        Water.FlowJoin flowJoin(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-10,-18; 10,2],
                                                                  rotation=0);
        Water.FlowJoin flowJoin1(redeclare package Medium = FluidMedium) 
          annotation (extent=[-10,6; 10,26], rotation=0);
        Water.FlowSplit flowSplit(redeclare package Medium = FluidMedium) 
          annotation (extent=[-66,-30; -46,-10],
                                             rotation=0);
        ParHE pHE2(
          redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=N_G_p2,
          N_F_A=N_F_A_p2,
          N_F_B=N_F_B_p2,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate_A=fluidNomFlowRate_A,
          fluidNomFlowRate_B=fluidNomFlowRate_B,
          gasNomPressure=gasNomPressure,
          fluidNomPressure_A=fluidNomPressure_A,
          fluidNomPressure_B=fluidNomPressure_B,
          exchSurface_G_A=exchSurface_G_A_p2,
          exchSurface_G_B=exchSurface_G_B_p2,
          exchSurface_F_A=exchSurface_F_A_p2,
          exchSurface_F_B=exchSurface_F_B_p2,
          gasVol=gasVol_p2,
          fluidVol_A=fluidVol_A_p2,
          fluidVol_B=fluidVol_B_p2,
          metalVol_A=metalVol_A_p2,
          metalVol_B=metalVol_B_p2,
          gamma_G_A=gamma_G_A_p2,
          gamma_G_B=gamma_G_B_p2,
          gamma_F_A=gamma_F_A_p2,
          gamma_F_B=gamma_F_B_p2,
          FFtype_F_A=FFtype_F_A_p2,
          FFtype_F_B=FFtype_F_B_p2,
          HCtype_F_A=HCtype_F_A_p2,
          HCtype_F_B=HCtype_F_B_p2,
          counterCurrent_A=counterCurrent_A_p2,
          counterCurrent_B=counterCurrent_B_p2,
          dpnom_A=dpnom_A_p2,
          dpnom_B=dpnom_B_p2,
          rhonom_A=rhonom_A_p2,
          rhonom_B=rhonom_B_p2,
          gasQuasiStatic=gasQuasiStatic,
          lambda=lambda,
          extSurfaceTub_A=extSurfaceTub_A_p2,
          extSurfaceTub_B=extSurfaceTub_B_p2,
          use_T=use_T,
          SSInit=SSInit,
          Tstart_G_In=Tstart_G_In_p2,
          Tstart_G_Out=Tstart_G_Out_p2,
          Tstart_M_A_In=Tstart_M_A_In_p2,
          Tstart_M_A_Out=Tstart_M_A_Out_p2,
          Tstart_M_A=Tstart_M_A_p2,
          Tstart_F_A_In=Tstart_F_A_In_p2,
          Tstart_F_A_Out=Tstart_F_A_Out_p2,
          Tstart_F_A=Tstart_F_A_p2,
          hstart_F_A_In=hstart_F_A_In_p2,
          hstart_F_A_Out=hstart_F_A_Out_p2,
          hstart_F_A=hstart_F_A_p2,
          Tstart_M_B_In=Tstart_M_B_In_p2,
          Tstart_M_B_Out=Tstart_M_B_Out_p2,
          Tstart_F_B_In=Tstart_F_B_In_p2,
          Tstart_F_B=Tstart_F_B_p2,
          hstart_F_B_In=hstart_F_B_In_p2,
          hstart_F_B_Out=hstart_F_B_Out_p2,
          hstart_F_B=hstart_F_B_p2,
          pstart_G=pstart_G_p2,
          pstartin_F_A=pstartin_F_A_p2,
          pstartout_F_A=pstartout_F_A_p2,
          pstartin_F_B=pstartin_F_B_p2,
          pstartout_F_B=pstartout_F_B_p2,
          rhomcm_A=rhomcm_A_p2,
          rhomcm_B=rhomcm_B_p2,
          Tstart_M_B=Tstart_M_B_p2,
          Tstart_F_B_Out=Tstart_F_B_Out_p2) 
          annotation (extent=[26,-36; 46,-16], style(thickness=2));
        Water.SensT intermediate_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,12; 30,26]);
        Water.SensT intermediate_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,-12; 30,2]);
      equation 
        connect(pHE1.waterInB, waterInB)  annotation (points=[-32,46; -32,54;
              12,54; 12,80; 40,80], style(thickness=2));
        connect(pHE1.waterInA, waterInA) 
          annotation (points=[-40,46; -40,80], style(thickness=2));
        connect(pHE1.gasIn, gasIn)  annotation (points=[-44,38; -80,38; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(pHE2.gasOut, gasOut) annotation (points=[44,-26; 80,-26; 80,0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(pHE2.gasIn, pHE1.gasOut) annotation (points=[28,-26; 14,-26; 14,
              38; -28,38],
                   style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(flowSplit.out2, valve_A.inlet) annotation (points=[-50,-24; -34,
              -24],                                                                   style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(valve_A.outlet, flowJoin.in2) annotation (points=[-18,-24; -14,
              -24; -14,-12; -6,-12],                                               style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(flowJoin.in1, pHE1.waterOutA) annotation (points=[-6,-4; -14,-4;
              -14,16; -40,16; -40,30],
                       style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(flowJoin1.in1, pHE1.waterOutB) annotation (points=[-6,20; -32,
              20; -32,30],            style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(valveB.outlet, flowJoin1.in2) annotation (points=[-18,6; -10,6;
              -10,12; -6,12],      style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(valveB.inlet, flowSplit.out1) annotation (points=[-34,6; -42,6;
              -42,-15.8; -50,-15.8],      style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(LiquidWaterIn, flowSplit.in1) annotation (points=[-80,-42; -74,
              -42; -74,-44; -66,-44; -66,-20; -62,-20], style(
            thickness=2,
            fillColor=62,
            rgbfillColor={0,127,127},
            fillPattern=1));
        connect(intermediate_A.outlet, pHE2.waterInA) 
          annotation (points=[27.2,-7.8; 32,-7.8; 32,-18], style(thickness=2));
        connect(intermediate_A.inlet, flowJoin.out) 
          annotation (points=[18.8,-7.8; 18.8,-8; 6,-8], style(thickness=2));
        connect(intermediate_B.inlet, flowJoin1.out) annotation (points=[18.8,
              16.2; 19.4,16.2; 19.4,16; 6,16], style(thickness=2));
        connect(intermediate_B.outlet, pHE2.waterInB) annotation (points=[27.2,
              16.2; 27.2,16; 40,16; 40,-18], style(thickness=2));
        connect(waterOutB, pHE2.waterOutB) 
          annotation (points=[40,-80; 40,-34], style(thickness=2));
        connect(pHE2.waterOutA, waterOutA) annotation (points=[32,-34; 32,-50;
              -40,-50; -40,-80], style(thickness=2));
        connect(T_intermedB, intermediate_B.T) annotation (points=[83,39; 40,39;
              40,23.2; 28.6,23.2], style(color=74, rgbcolor={0,0,127}));
        connect(intermediate_A.T, T_intermedA) annotation (points=[28.6,-0.8;
              52,-0.8; 52,59; 83,59], style(color=74, rgbcolor={0,0,127}));
        connect(theta_valveA, valve_A.theta) annotation (points=[81,-42; -26,
              -42; -26,-30.4], style(color=74, rgbcolor={0,0,127}));
        connect(theta_valveB, valveB.theta) annotation (points=[81,-63; 60,-63;
              60,-46; -36,-46; -36,-10; -26,-10; -26,-0.4], style(color=74,
              rgbcolor={0,0,127}));
      end ParHE_att;
      
      model HE_simp "Simplified Heat Exchanger fluid - gas" 
        extends Interfaces.HeatExchanger(extSurfaceTub = exchSurface_G);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F 
          "Constant heat transfer coefficient in the fluid side";
        constant Real pi=Modelica.Constants.pi;
        
      Water.Flow1D fluidFlow(
          Nt=1,
          N=N_F,
          wnom=fluidNomFlowRate,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          L=exchSurface_F^2/(fluidVol*pi*4),
          A=(fluidVol*4/exchSurface_F)^2/4*pi,
          omega=fluidVol*4/exchSurface_F*pi,
          Dhyd=fluidVol*4/exchSurface_F,
          pstartin=pstartin_F,
          pstartout=pstartout_F,
          hstart=hstart_F,
          hstartin=hstart_F_In,
          hstartout=hstart_F_Out) 
                                 annotation (extent=[-10,-50; 10,-30]);
        Thermal.ConvHT convHT(gamma=gamma_F, N=N_F,
          Tstart11=Tstart_M_In,
          Tstart1N=Tstart_M_Out,
          Tstart21=Tstart_F_In,
          Tstart2N=Tstart_F_Out,
          Tstart1=Tstart_M,
          Tstart2=Tstart_F) 
          annotation (extent=[-10,-30; 10,-10]);
        Thermal.MetalTube metalTube(
          rhomcm=rhomcm,
          lambda=lambda,
          N=N_F,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F^2/(fluidVol*pi*4),
          rint=fluidVol*4/exchSurface_F/2,
          Tstart1=Tstart_M_In,
          TstartN=Tstart_M_Out,
          WallRes=false,
          Tstart=Tstart_M,
          rext=(metalVol + fluidVol)*4/extSurfaceTub/2) 
                 annotation (extent=[-10,10; 10,-10]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          QuasiStatic=true,
          N=N_G,
          A=gasVol/1,
          omega=exchSurface_G/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          pstart=pstart_G,
          Tstart=Tstart_G)       annotation (extent=[-12,50; 12,30]);
        annotation (Diagram);
        Thermal.ConvHT2N convHT2N(
          N1=N_G,
          N2=N_F,
          gamma=gamma_G,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_In,
          Tstart2N=Tstart_M_Out,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M)    annotation (extent=[-10,10; 10,30]);
      equation 
        connect(fluidFlow.wall, convHT.side2) 
                                           annotation (points=[0,-35; 0,-23.1],
            style(color=45, rgbcolor={255,127,0}));
        connect(gasFlow.infl, gasIn) annotation (points=[-12,40; -80,40; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.outfl, gasOut) annotation (points=[12,40; 80,40; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(fluidFlow.outfl, waterOut) 
                                        annotation (points=[10,-40; 60,-40; 60,
              -80; 0,-80], style(thickness=2));
        connect(fluidFlow.infl, waterIn) 
                                      annotation (points=[-10,-40; -40,-40; -40,
              80; 0,80], style(thickness=2));
        connect(convHT2N.side1,gasFlow. wall) annotation (points=[0,23; 0,35],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.int, convHT.side1) annotation (points=[0,-3; 0,-17],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.ext, convHT2N.side2) annotation (points=[0,3.1; 0,
              16.9], style(color=45, rgbcolor={255,127,0}));
      end HE_simp;
      
      model HE2ph_simp "Simplified Heat Exchanger fluid - gas (fluid 2-phase)" 
        extends Interfaces.HeatExchanger(extSurfaceTub = exchSurface_G);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F 
          "Constant heat transfer coefficient in the fluid side";
        constant Real pi=Modelica.Constants.pi;
        
      Water.Flow1D2ph fluidFlow(
          Nt=1,
          N=N_F,
          wnom=fluidNomFlowRate,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          L=exchSurface_F^2/(fluidVol*pi*4),
          A=(1/exchSurface_F*fluidVol*4)^2/4*pi,
          omega=1/exchSurface_F*fluidVol*4*pi,
          Dhyd=1/exchSurface_F*fluidVol*4,
          pstartin=pstartin_F,
          pstartout=pstartout_F,
          hstart=hstart_F,
          hstartin=hstart_F_In,
          hstartout=hstart_F_Out) 
                                 annotation (extent=[-10,-50; 10,-30]);
        Thermal.ConvHT convHT(gamma=gamma_F, N=N_F,
          Tstart11=Tstart_M_In,
          Tstart1N=Tstart_M_Out,
          Tstart21=Tstart_F_In,
          Tstart2N=Tstart_F_Out,
          Tstart1=Tstart_M,
          Tstart2=Tstart_F) 
          annotation (extent=[-10,-30; 10,-10]);
        Thermal.MetalTube metalTube(
          rhomcm=rhomcm,
          lambda=lambda,
          N=N_F,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F^2/(fluidVol*pi*4),
          rint=1/exchSurface_F*fluidVol*4/2,
          WallRes=false,
          Tstart1=Tstart_M_In,
          TstartN=Tstart_M_Out,
          Tstart=Tstart_M,
          rext=1/extSurfaceTub*(metalVol + fluidVol)*4/2) 
                 annotation (extent=[-10,10; 10,-10]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          QuasiStatic=true,
          N=N_G,
          A=gasVol/1,
          omega=exchSurface_G/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          pstart=pstart_G,
          Tstart=Tstart_G)       annotation (extent=[-12,50; 12,30]);
        annotation (Diagram);
        Thermal.ConvHT2N convHT2N(
          N1=N_G,
          N2=N_F,
          gamma=gamma_G,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_In,
          Tstart2N=Tstart_M_Out,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M)    annotation (extent=[-10,10; 10,30]);
      equation 
        connect(fluidFlow.wall, convHT.side2) 
                                           annotation (points=[0,-35; 0,-23.1],
            style(color=45, rgbcolor={255,127,0}));
        connect(gasFlow.infl, gasIn) annotation (points=[-12,40; -80,40; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.outfl, gasOut) annotation (points=[12,40; 80,40; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(fluidFlow.outfl, waterOut) 
                                        annotation (points=[10,-40; 60,-40; 60,
              -80; 0,-80], style(thickness=2));
        connect(fluidFlow.infl, waterIn) 
                                      annotation (points=[-10,-40; -40,-40; -40,
              80; 0,80], style(thickness=2));
        connect(convHT2N.side1,gasFlow. wall) annotation (points=[0,23; 0,35],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.int, convHT.side1) annotation (points=[0,-3; 0,-17],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.ext, convHT2N.side2) annotation (points=[0,3.1; 0,
              16.9], style(color=45, rgbcolor={255,127,0}));
      end HE2ph_simp;
      
      model ParHE_simp "Simplified parallel heat exchangers fluid - gas" 
        extends Interfaces.ParallelHE(extSurfaceTub_A = exchSurface_G_A,
                                      extSurfaceTub_B = exchSurface_G_B);
        
        parameter SI.CoefficientOfHeatTransfer gamma_G_A 
          "Constant heat transfer coefficient in the gas side"     annotation (Dialog(group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_G_B 
          "Constant heat transfer coefficient in the gas side"     annotation (Dialog(group = "side B"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_A 
          "Constant heat transfer coefficient in the fluid side"     annotation (Dialog(group = "side A"));
        parameter SI.CoefficientOfHeatTransfer gamma_F_B 
          "Constant heat transfer coefficient in the fluid side"     annotation (Dialog(group = "side B"));
        constant Real pi=Modelica.Constants.pi;
        
        annotation (Diagram);
        ConvParallel convParallel(
          N=N_G,
          As=exchSurface_G_A + exchSurface_G_B,
          Aa=exchSurface_G_A,
          Ab=exchSurface_G_B) 
                             annotation (extent=[-10,16; 10,36]);
      Water.Flow1D fluidAFlow(
          Nt=1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_F_A,
          L=exchSurface_F_A^2/(fluidVol_A*pi*4),
          A=(fluidVol_A*4/exchSurface_F_A)^2/4*pi,
          omega=fluidVol_A*4/exchSurface_F_A*pi,
          Dhyd=fluidVol_A*4/exchSurface_F_A,
          pstartin=pstartin_F_A,
          pstartout=pstartout_F_A,
          hstart=hstart_F_A,
          wnom=fluidNomFlowRate_A,
          hstartin=hstart_F_A_In,
          hstartout=hstart_F_A_Out) 
                                 annotation (extent=[-38,-52; -18,-32]);
        Thermal.ConvHT convHT_A(
          N=N_F_A,
          gamma=gamma_F_A,
          Tstart11=Tstart_M_A_In,
          Tstart1N=Tstart_M_A_Out,
          Tstart21=Tstart_F_A_In,
          Tstart2N=Tstart_F_A_Out,
          Tstart1=Tstart_M_A,
          Tstart2=Tstart_F_A) 
          annotation (extent=[-38,-30; -18,-10]);
        Thermal.MetalTube metalTube_A(
          lambda=lambda,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          N=N_F_A,
          L=exchSurface_F_A^2/(fluidVol_A*pi*4),
          rint=fluidVol_A*4/exchSurface_F_A/2,
          WallRes=false,
          Tstart1=Tstart_M_A_In,
          TstartN=Tstart_M_A_Out,
          Tstart=Tstart_M_A,
          rext=(metalVol_A + fluidVol_A)*4/extSurfaceTub_A/2,
          rhomcm=rhomcm_A) 
                 annotation (extent=[-38,6; -18,-14]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          QuasiStatic=true,
          N=N_G,
          A=gasVol/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          omega=(exchSurface_G_A + exchSurface_G_B)/1,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          pstart=pstart_G,
          Tstart=Tstart_G)       annotation (extent=[-12,64; 12,44]);
      Water.Flow1D fluidBFlow(
          Nt=1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_F_B,
          L=exchSurface_F_B^2/(fluidVol_B*pi*4),
          A=(fluidVol_B*4/exchSurface_F_B)^2/4*pi,
          omega=fluidVol_B*4/exchSurface_F_B*pi,
          Dhyd=fluidVol_B*4/exchSurface_F_B,
          wnom=fluidNomFlowRate_B,
          pstartin=pstartin_F_B,
          pstartout=pstartout_F_B,
          hstart=hstart_F_B,
          hstartin=hstart_F_B_In,
          hstartout=hstart_F_B_Out) 
                                 annotation (extent=[38,-52; 18,-32]);
        Thermal.ConvHT convHT_B(
          N=N_F_B,
          gamma=gamma_F_B,
          Tstart11=Tstart_M_B_In,
          Tstart1N=Tstart_M_B_Out,
          Tstart21=Tstart_F_B_In,
          Tstart2N=Tstart_F_B_Out,
          Tstart1=Tstart_M_B,
          Tstart2=Tstart_F_B) 
          annotation (extent=[18,-30; 38,-10]);
        Thermal.MetalTube metalTube_B(
          lambda=lambda,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F_B^2/(fluidVol_B*pi*4),
          rint=fluidVol_B*4/exchSurface_F_B/2,
          N=N_F_B,
          WallRes=false,
          Tstart1=Tstart_M_B_In,
          TstartN=Tstart_M_B_Out,
          Tstart=Tstart_M_B,
          rext=(metalVol_B + fluidVol_B)*4/extSurfaceTub_B/2,
          rhomcm=rhomcm_B) 
                 annotation (extent=[18,6; 38,-14]);
        Thermal.ConvHT2N convHT2N_A(
          N1=N_G,
          N2=N_F_A,
          gamma=gamma_G_A,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_A_In,
          Tstart2N=Tstart_M_A_Out,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M_A)    annotation (extent=[-38,10; -18,30]);
        Thermal.ConvHT2N convHT2N_B(
          N1=N_G,
          N2=N_F_B,
          gamma=gamma_G_B,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_B_In,
          Tstart2N=Tstart_M_B_Out,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M_B)    annotation (extent=[18,10; 38,30]);
      equation 
        connect(convHT_A.side2, fluidAFlow.wall)    annotation (points=[-28,
              -23.1; -28,-37], style(color=45, rgbcolor={255,127,0}));
        connect(convHT_B.side2, fluidBFlow.wall)    annotation (points=[28,-23.1;
              28,-37],        style(color=45, rgbcolor={255,127,0}));
        connect(fluidBFlow.outfl, waterOutB)    annotation (points=[18,-42; 8,
              -42; 8,-80; 40,-80], style(thickness=2));
        connect(fluidAFlow.outfl, waterOutA)    annotation (points=[-18,-42; -8,
              -42; -8,-80; -40,-80], style(thickness=2));
        connect(fluidAFlow.infl, waterInA)    annotation (points=[-38,-42; -50,
              -42; -50,80; -40,80], style(thickness=2));
        connect(fluidBFlow.infl, waterInB)    annotation (points=[38,-42; 52,
              -42; 52,80; 40,80], style(thickness=2));
        connect(gasFlow.outfl, gasOut)   annotation (points=[12,54; 80,54; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.infl, gasIn)   annotation (points=[-12,54; -80,54; -80,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(convParallel.source, gasFlow.wall)   annotation (points=[0,33; 0,
              49],   style(color=45, rgbcolor={255,127,0}));
        connect(convHT2N_A.side1, convParallel.objectA) 
                                                      annotation (points=[-28,23;
              -28,36; -14,36; -14,6; -6,6; -6,23],     style(color=45, rgbcolor=
               {255,127,0}));
        connect(convParallel.objectB, convHT2N_B.side1) 
                                                       annotation (points=[6,23; 6,
              6; 14,6; 14,36; 28,36; 28,23],   style(color=45, rgbcolor={255,
                127,0}));
        connect(metalTube_A.int, convHT_A.side1) annotation (points=[-28,-7;
              -28,-17], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube_A.ext, convHT2N_A.side2) 
                                                 annotation (points=[-28,-0.9;
              -28,16.9], style(color=45, rgbcolor={255,127,0}));
        connect(convHT_B.side1, metalTube_B.int) annotation (points=[28,-17; 28,
              -7], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube_B.ext, convHT2N_B.side2) 
                                                  annotation (points=[28,-0.9;
              28,16.9], style(color=45, rgbcolor={255,127,0}));
      end ParHE_simp;
      
      model HEhtc_f 
        "Heat Exchanger fluid - gas, with variable heat transfer coefficient only fluid side" 
        extends Interfaces.HeatExchanger;
        
        parameter SI.CoefficientOfHeatTransfer gamma_G 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_nom_F 
          "Nominal h.t.c. coefficient fluid side";
        parameter Real kw_F 
          "Exponent of the mass flow rate in the h.t.c. correlation fluid side";
        parameter Boolean gasQuasiStatic=false 
          "Quasi-static model of the flue gas (mass, energy and momentum static balances";
        parameter Boolean counterCurrent=true "Counter-current flow";
        constant Real pi=Modelica.Constants.pi;
        
        Thermal.MetalTube metalTube(
          rhomcm=rhomcm,
          lambda=lambda,
          N=N_F,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          L=exchSurface_F^2/(fluidVol*pi*4),
          rint=fluidVol*4/exchSurface_F/2,
          WallRes=false,
          Tstart1=Tstart_M_In,
          TstartN=Tstart_M_Out,
          Tstart=Tstart_M,
          rext=(metalVol + fluidVol)*4/extSurfaceTub/2) 
                 annotation (extent=[-10,-4; 10,-24]);
        Gas.Flow1D gasFlow(
          L=1,
          Dhyd=1,
          wnom=gasNomFlowRate,
          FFtype=ThermoPower.Choices.Flow1D.FFtypes.NoFriction,
          N=N_G,
          A=gasVol/1,
          omega=exchSurface_G/1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FlueGasMedium,
          Tstartin=Tstart_G_In,
          Tstartout=Tstart_G_Out,
          pstart=pstart_G,
          QuasiStatic=gasQuasiStatic) 
                                 annotation (extent=[-12,60; 12,40]);
        annotation (Diagram);
        Thermal.CounterCurrent cC(counterCurrent=counterCurrent, N=N_F) 
          annotation (extent=[-10,-8; 10,12]);
        Thermal.HeatFlowDistribution heatFlowDistribution(
          N=N_F,
          A1=exchSurface_G,
          A2=extSurfaceTub) 
          annotation (extent=[-10,8; 10,28]);
        ThermoPower.PowerPlants.HRSG.Components.Flow1Dhtc fluidFlow_Extension(
                                                  Nt=1,
          N=N_F,
          wnom=fluidNomFlowRate,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          L=exchSurface_F^2/(fluidVol*pi*4),
          A=(fluidVol*4/exchSurface_F)^2/4*pi,
          omega=fluidVol*4/exchSurface_F*pi,
          Dhyd=fluidVol*4/exchSurface_F,
          pstartin=pstartin_F,
          pstartout=pstartout_F,
          hstart=hstart_F,
          hstartin=hstart_F_In,
          hstartout=hstart_F_Out,
          gamma_nom=gamma_nom_F,
          kw=kw_F) 
          annotation (extent=[-10,-56; 10,-36]);
        Thermal.ConvHT_htc convHT_htc(
          N=N_F,
          TstartF1=Tstart_M_In,
          TstartFN=Tstart_M_Out,
          TstartO1=Tstart_F_In,
          TstartON=Tstart_F_Out,
          TstartF=Tstart_M,
          TstartO=Tstart_F)    annotation (extent=[-10,-20; 10,-40], rotation=0);
        Thermal.ConvHT2N convHT2N(
          N1=N_G,
          N2=N_F,
          gamma=gamma_G,
          Tstart11=Tstart_G_In,
          Tstart1N=Tstart_G_Out,
          Tstart21=Tstart_M_In,
          Tstart2N=Tstart_M_Out,
          Tstart1=Tstart_G,
          Tstart2=Tstart_M)    annotation (extent=[-10,24; 10,44]);
      equation 
        connect(gasFlow.infl, gasIn) annotation (points=[-12,50; -80,50; -80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(gasFlow.outfl, gasOut) annotation (points=[12,50; 80,50; 80,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(heatFlowDistribution.side2,cC. side1) annotation (points=[0,14.9;
              0,5],           style(
            color=45,
            rgbcolor={255,127,0},
            fillPattern=1));
        connect(convHT_htc.fluidside, fluidFlow_Extension.wall)   annotation (
            points=[0,-33; 0,-41], style(color=3, rgbcolor={0,0,255}));
        connect(fluidFlow_Extension.infl, waterIn)   annotation (points=[-10,-46;
              -40,-46; -40,80; 0,80],      style(thickness=2));
        connect(fluidFlow_Extension.outfl, waterOut)   annotation (points=[10,-46;
              40,-46; 40,-80; 0,-80],      style(thickness=2));
        connect(convHT2N.side2, heatFlowDistribution.side1) annotation (points=[0,30.9;
              0,21],          style(color=45, rgbcolor={255,127,0}));
        connect(convHT2N.side1,gasFlow. wall) annotation (points=[0,37; 0,45],
            style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.int, convHT_htc.otherside) annotation (points=[0,-17;
              0,-27], style(color=45, rgbcolor={255,127,0}));
        connect(metalTube.ext, cC.side2) annotation (points=[0,-10.9; 0,-1.1],
            style(color=45, rgbcolor={255,127,0}));
      end HEhtc_f;
      
      model DrumSensors 
        extends Water.Drum;
        Modelica.Blocks.Interfaces.RealOutput p_out "Pressure sensor output" 
                                                 annotation (extent=[-26,64;
              -46,84]);
        Modelica.Blocks.Interfaces.RealOutput y_out "Level sensor output" 
                                            annotation (extent=[-58,30; -78,50]);
        annotation (Icon(
            Text(extent=[-76,102; -4,82],
              style(color=0, rgbcolor={0,0,0}),
              string="p"),
            Text(extent=[-106,70; -34,50],
              style(color=0, rgbcolor={0,0,0}),
              string="y")),
                          Diagram);
      equation 
        y_out = y;
        p_out = p;
      end DrumSensors;
      
      model Flow1Dhtc 
        "Extension of the Water.Flow1D for fluid flow model with variable heat transfer coefficient" 
        extends ThermoPower.Water.Flow1D(redeclare ThermoPower.Thermal.DHThtc 
            wall);
        parameter SI.CoefficientOfHeatTransfer gamma_nom 
          "Nominal h.t.c. coefficient";
        parameter Real kw 
          "Exponent of the mass flow rate in the h.t.c. correlation";
      equation 
        for j in 1:N loop
          wall.gamma[j] = gamma_nom*noEvent(abs(infl.w/wnom)^kw);
        end for;
        annotation (Diagram);
      end Flow1Dhtc;
      
      model Flow1D2phhtc 
        "Extension of the Water.Flow1D2ph for fluid flow model with variable heat transfer coefficient" 
        extends ThermoPower.Water.Flow1D2ph(redeclare 
            ThermoPower.Thermal.DHThtc wall);
        parameter SI.CoefficientOfHeatTransfer gamma_nom 
          "Nominal h.t.c. coefficient";
        parameter Real kw 
          "Exponent of the mass flow rate in the h.t.c. correlation";
      equation 
        for j in 1:N loop
          wall.gamma[j] = gamma_nom*noEvent(abs(infl.w/wnom)^kw);
        end for;
        annotation (Diagram);
      end Flow1D2phhtc;
      
      model FlowGas1Dhtc 
        "Extension of the Gas.Flow1D for fluid flow model with variable heat transfer coefficient" 
        extends Gas.Flow1D( redeclare ThermoPower.Thermal.DHThtc wall);
        parameter SI.CoefficientOfHeatTransfer gamma_nom 
          "Nominal h.t.c. coefficient";
        parameter Real kw 
          "Exponent of the mass flow rate in the h.t.c. correlation";
      equation 
        for j in 1:N loop
          wall.gamma[j] = gamma_nom*noEvent(abs(infl.w/wnom)^kw);
        end for;
        annotation (Diagram);
      end FlowGas1Dhtc;
      
      model ConvParallel 
        "Convective heat transfer between one source and two objects in parallel" 
        import Modelica.SIunits.*;
        parameter Integer N=2 "Number of Nodes";
        parameter Area As "Area of source";
        parameter Area Aa "Area of object a";
        parameter Area Ab "Area of object b";
        ThermoPower.Thermal.DHT source(N=N) 
                       annotation (extent=[-40,60; 40,80]);
        ThermoPower.Thermal.DHT objectA(N=N) 
                       annotation (extent=[-100,-40; -20,-20]);
        ThermoPower.Thermal.DHT objectB(N=N) 
                       annotation (extent=[20,-40; 100,-20]);
        annotation (Icon(
            Text(
              extent=[-100,-42; -20,-80],
              style(color=46),
              string="A"),
                         Rectangle(extent=[-100,60; 100,-20], style(
                color=0,
                fillColor=7,
                fillPattern=7)),
            Line(points=[-8,60; -60,-20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[-56,-2; -60,-20; -44,-12], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[60,-2; 62,-20; 48,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[10,60; 62,-20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[26,50; 10,60; 12,42], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[-24,52; -8,60; -12,44], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Text(
              extent=[-110,-74; 112,-100],
              string="%name",
              style(color=46)),
            Text(
              extent=[20,-40; 100,-80],
              style(color=46),
              string="B")),      Documentation(info="<HTML>
<p>The model connected to the <tt>source</tt> connector exchanges power \"in parallel\" with the models connected to the <tt>objectA</tt> and <tt>objectB</tt> connectors.
</HTML>",     revisions=""),
          Diagram);
        
      equation 
        source.phi*As + objectA.phi*Aa + objectB.phi*Ab = zeros(N) 
          "Energy balance";
        source.T = objectA.T;
        source.T = objectB.T;
      end ConvParallel;
      
      model StateReader_water 
        "State reader for the visualization of the state in the simulation (water)" 
        replaceable package Medium = Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance "Medium model";
        SI.Temperature T;
        SI.Pressure p;
        SI.SpecificEnthalpy h;
        SI.MassFlowRate w;
        Medium.BaseProperties fluid;
        
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = Medium) 
                                        annotation (extent=[-80,-20; -40,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = Medium) 
                                         annotation (extent=[40,-20; 80,20]);
        annotation (
          Diagram,
          Icon(Polygon(points=[-80,0; 0,32; 80,0; 0,-32; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)), Text(
              extent=[-80,20; 80,-20],
              string="S",
              style(
                color=7,
                rgbcolor={255,255,255},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
          Documentation(info="<HTML>
<p>This component can be inserted in a hydraulic circuit to measure the temperature of the fluid flowing through it.
<p>Flow reversal is supported.
</HTML>",   revisions="<html>
<ul>
<li><i>16 Dec 2004</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Standard medium definition added.</li>
<li><i>1 Jul 2004</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Adapted to Modelica.Media.</li>
<li><i>1 Oct 2003</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       First release.</li>
</ul>
</html>"));
      equation 
        inlet.w + outlet.w = 0 "Mass balance";
        inlet.p = outlet.p "No pressure drop";
        // Set fluid properties
        fluid.p=inlet.p;
        fluid.h = if inlet.w >= 0 then inlet.hBA else inlet.hAB;
        
        T=fluid.T;
        p=fluid.p;
        h=fluid.h;
        w=inlet.w;
        
        // Boundary conditions
        inlet.hAB = outlet.hAB;
        inlet.hBA = outlet.hBA;
      end StateReader_water;
      
      model StateReader_gas 
        "State reader for the visualization of the state in the simulation (gas)" 
        replaceable package Medium = Modelica.Media.Interfaces.PartialMedium;
        Medium.BaseProperties gas;
        SI.Temperature T;
        SI.Pressure p;
        SI.SpecificEnthalpy h;
        SI.MassFlowRate w;
        Gas.FlangeA inlet(redeclare package Medium = Medium) 
          annotation (extent=[-80,-20; -40,20]);
        Gas.FlangeB outlet(redeclare package Medium = Medium) 
          annotation (extent=[40,-20; 80,20]);
        annotation (Diagram,
          Icon(Polygon(points=[-80,0; 0,30; 80,0; 0,-30; -80,0], style(
                color=76,
                rgbcolor={170,170,255},
                fillColor=76,
                rgbfillColor={170,170,255})),
                                 Text(
              extent=[-80,20; 80,-20],
              string="S",
              style(
                color=7,
                rgbcolor={255,255,255},
                fillColor=76,
                rgbfillColor={170,170,255}))));
      equation 
        inlet.w + outlet.w=0 "Mass balance";
        inlet.p = outlet.p "Momentum balance";
        
        // Energy balance
        inlet.hAB = outlet.hAB;
        inlet.hBA = outlet.hBA;
        
        // Independent composition mass balances
        inlet.XAB = outlet.XAB;
        inlet.XBA = outlet.XBA;
        
        // Set gas properties
        inlet.p=gas.p;
        if inlet.w >= 0 then
          gas.h = inlet.hBA;
          gas.Xi = inlet.XBA;
        else
          gas.h = inlet.hAB;
          gas.Xi = inlet.XAB;
        end if;
        
        T=gas.T;
        p=gas.p;
        h=gas.h;
        w=inlet.w;
      end StateReader_gas;
      
      model PrescribedSpeedPump "Prescribed speed pump" 
        replaceable package WaterMedium = 
            Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalSteamPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalSteamFlow 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        
        function flowCharacteristic = 
            ThermoPower.Functions.PumpCharacteristics.quadraticFlow (
              q_nom = q_nom, head_nom = head_nom);
        
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,62; 58,-58],   style(gradient=3)),
            Polygon(points=[-32,34; -32,-26; 46,2; -32,34],     style(
                pattern=0,
                gradient=2,
                fillColor=7))), Diagram);
        ThermoPower.Water.FlangeA inlet(
          redeclare package Medium = WaterMedium) 
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(
          redeclare package Medium = WaterMedium) 
          annotation (extent=[80,-20; 120,20]);
        Water.Pump feedWaterPump(     redeclare package Medium = 
              WaterMedium,
          redeclare function flowCharacteristic = flowCharacteristic,
          pin_start=nominalCondensationPressure,
          pout_start=nominalSteamPressure,
          wstart=nominalSteamFlow,
          n0=n0,
          hstart=hstart) 
          annotation (extent=[-40,-24; 0,16]);
        Modelica.Blocks.Interfaces.RealInput pumpSpeed_rpm 
                                         annotation (extent=[-128,40; -88,80]);
      equation 
        connect(inlet, feedWaterPump.infl) 
          annotation (points=[-100,0; -67,0; -67,0.4; -36,0.4], style(thickness=
               2));
        connect(pumpSpeed_rpm, feedWaterPump.in_n) annotation (points=[-108,60;
              -25.2,60; -25.2,12], style(color=74, rgbcolor={0,0,127}));
        connect(outlet, feedWaterPump.outfl) annotation (points=[100,0; 10,0;
              10,10.4; -8,10.4], style(thickness=2));
      end PrescribedSpeedPump;
      
      model PumpControlFlowRate "Pump flow rate controlled " 
        import ThermoPower;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalWaterPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalWaterFlowRate 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        
        //PID for flow rate control
        parameter Real Kp=4 "Proportional gain (normalised units)" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time Ti=200 "Integral time" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time Td=0 "Derivative time" 
          annotation (Dialog(tab="PID"));
        parameter Real PVmin=-1 "Minimum value of process variable for scaling"
          annotation (Dialog(tab="PID"));
        parameter Real PVmax=1 "Maximum value of process variable for scaling" 
          annotation (Dialog(tab="PID"));
        parameter Real CSmin=500 "Minimum value of control signal for scaling" 
          annotation (Dialog(tab="PID"));
        parameter Real CSmax=2500 "Maximum value of control signal for scaling"
          annotation (Dialog(tab="PID"));
        parameter Real PVstart=0.5 "Start value of PV (scaled)" 
          annotation (Dialog(tab="PID"));
        parameter Real CSstart=0.5 "Start value of CS (scaled)" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time T_filter=1 "Time Constant of the filter" 
          annotation (Dialog(tab="PID"));
        
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,60; 58,-60],   style(gradient=3)),
            Polygon(points=[-32,32; -32,-28; 46,0; -32,32],     style(
                pattern=0,
                gradient=2,
                fillColor=7)),
            Rectangle(extent=[-88,90; -48,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-86,88; -50,52],
              style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1),
              string="C"),
            Line(points=[-48,70; -2,70; -2,60], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-62,0; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,0; -70,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Polygon(points=[-70,46; -72,40; -68,40; -70,46], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-30,72; -30,68; -24,70; -30,72], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=74,
                rgbfillColor={0,0,127},
                fillPattern=1))),
                                Diagram);
      public 
        ThermoPower.PowerPlants.HRSG.Components.PrescribedSpeedPump pump(
          redeclare package WaterMedium = FluidMedium,
          q_nom=q_nom,
          head_nom=head_nom,
          rho_nom=rho_nom,
          n0=n0,
          nominalSteamPressure=nominalWaterPressure,
          nominalCondensationPressure=nominalCondensationPressure,
          nominalSteamFlow=nominalWaterFlowRate,
          hstart=hstart)        annotation (extent=[-8,16; -40,-16], rotation=180);
        ThermoPower.Water.SensW feed_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[40,14; 20,-6],      rotation=180);
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = FluidMedium)
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = FluidMedium)
          annotation (extent=[80,-20; 120,20]);
        Modelica.Blocks.Interfaces.RealInput setpoint_FlowRate 
                                         annotation (extent=[-120,54; -88,86]);
        ThermoPower.PowerPlants.Control.PID pID(
          Kp=Kp,
          Ti=Ti,
          Td=Td,
          PVmin=PVmin,
          PVmax=PVmax,
          CSmin=CSmin,
          CSmax=CSmax,
          PVstart=PVstart,
          CSstart=CSstart) annotation (extent=[-10,60; 10,40],  rotation=180);
        Modelica.Blocks.Continuous.FirstOrder firstOrder(T=T_filter, y_start=n0) 
          annotation (extent=[-26,40; -46,60], rotation=0);
        
      equation 
        connect(pump.inlet, inlet)          annotation (points=[-40,
              1.95937e-015; -67,1.95937e-015; -67,0; -100,0], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(pump.outlet, feed_w.inlet)          annotation (points=[-8,
              -1.95937e-015; 3,-1.95937e-015; 3,8.88178e-016; 24,8.88178e-016],
                                                                style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(feed_w.outlet, outlet) annotation (points=[36,-8.88178e-016;
              57.8,-8.88178e-016; 57.8,0; 100,0],
                              style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(pID.PV, feed_w.w) annotation (points=[10,46; 60,46; 60,10; 38,
              10],        style(color=74, rgbcolor={0,0,127}));
        connect(pID.SP, setpoint_FlowRate) annotation (points=[10,54; 20,54; 20,
              70; -104,70],    style(color=74, rgbcolor={0,0,127}));
        connect(firstOrder.u, pID.CS) annotation (points=[-24,50; -10.6,50],
            style(color=74, rgbcolor={0,0,127}));
        connect(firstOrder.y, pump.pumpSpeed_rpm)          annotation (points=[-47,50;
              -60,50; -60,9.6; -41.28,9.6],         style(color=74, rgbcolor={0,
                0,127}));
      end PumpControlFlowRate;
      
      model PumpFilter "Pump with filter" 
        import ThermoPower;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalWaterPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalWaterFlowRate 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        parameter SI.Time T_filter=1 "Time Constant of the filter";
        
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,60; 58,-60],   style(gradient=3)),
            Polygon(points=[-32,32; -32,-28; 46,0; -32,32],     style(
                pattern=0,
                gradient=2,
                fillColor=7)),
            Rectangle(extent=[-88,90; -48,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-86,88; -50,52],
              style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1),
              string="F"),
            Line(points=[-48,70; -2,70; -2,60], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-62,0; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Polygon(points=[-30,72; -30,68; -24,70; -30,72], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=74,
                rgbfillColor={0,0,127},
                fillPattern=1))),
                                Diagram);
      public 
        ThermoPower.PowerPlants.HRSG.Components.PrescribedSpeedPump pump(
          redeclare package WaterMedium = FluidMedium,
          q_nom=q_nom,
          head_nom=head_nom,
          rho_nom=rho_nom,
          n0=n0,
          nominalSteamPressure=nominalWaterPressure,
          nominalCondensationPressure=nominalCondensationPressure,
          nominalSteamFlow=nominalWaterFlowRate,
          hstart=hstart)        annotation (extent=[20,20; -20,-20], rotation=180);
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = FluidMedium)
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = FluidMedium)
          annotation (extent=[80,-20; 120,20]);
        Modelica.Blocks.Interfaces.RealInput setpoint_FlowRate 
                                         annotation (extent=[-120,54; -88,86]);
        Modelica.Blocks.Continuous.FirstOrder firstOrder(T=T_filter, y_start=n0) 
          annotation (extent=[-10,40; -30,60], rotation=0);
      equation 
        connect(pump.inlet, inlet)          annotation (points=[-20,
              2.44921e-015; -67,2.44921e-015; -67,0; -100,0], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(firstOrder.y, pump.pumpSpeed_rpm)          annotation (points=[-31,50;
              -60,50; -60,12; -21.6,12],            style(color=74, rgbcolor={0,
                0,127}));
        connect(pump.outlet, outlet)          annotation (points=[20,
              -2.44921e-015; 40,-2.44921e-015; 40,0; 100,0], style(thickness=2));
        connect(firstOrder.u, setpoint_FlowRate) annotation (points=[-8,50; 20,
              50; 20,70; -104,70],style(color=74, rgbcolor={0,0,127}));
      end PumpFilter;
    end Components;
    
    package Control 
      partial model InterfacesControl "Base of class for control" 
        annotation (Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=30,
                rgbfillColor={240,240,240})), Text(
              extent=[-80,80; 80,-80],
              style(color=0, rgbcolor={0,0,0}),
              string="C")), Diagram);
        Buses.Sensors SensorsBus annotation (extent=[-128,-30; -68,30]);
        Buses.Actuators ActuatorsBus annotation (extent=[70,-30; 130,30]);
      end InterfacesControl;
      
      model levelsControl "PID controllers for levels control" 
        extends InterfacesControl;
        
        //PID for level HP control
        parameter Real Kp_levelHP=3 "Proportional gain (normalised units)" 
          annotation (Dialog(tab="PID - level HP"));
        parameter SI.Time Ti_levelHP=400 "Integral time" 
          annotation (Dialog(tab="PID - level HP"));
        parameter SI.Time Td_levelHP=0 "Derivative time" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real PVmin_levelHP=-1 
          "Minimum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real PVmax_levelHP=1 
          "Maximum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real CSmin_levelHP=30 
          "Minimum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real CSmax_levelHP=100 
          "Maximum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real PVstart_levelHP=0.5 "Start value of PV (scaled)" 
          annotation (Dialog(tab="PID - level HP"));
        parameter Real CSstart_levelHP=0.5 "Start value of CS (scaled)" 
          annotation (Dialog(tab="PID - level HP"));
        parameter SI.Length setPoint_levelHP=0 "Set point level of HP drum";
        
        //PID for level IP control
        parameter Real Kp_levelIP=3 "Proportional gain (normalised units)" 
          annotation (Dialog(tab="PID - level IP"));
        parameter SI.Time Ti_levelIP=600 "Integral time" 
          annotation (Dialog(tab="PID - level IP"));
        parameter SI.Time Td_levelIP=0 "Derivative time" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real PVmin_levelIP=-1 
          "Minimum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real PVmax_levelIP=1 
          "Maximum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real CSmin_levelIP=8 
          "Minimum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real CSmax_levelIP=20 
          "Maximum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real PVstart_levelIP=0.5 "Start value of PV (scaled)" 
          annotation (Dialog(tab="PID - level IP"));
        parameter Real CSstart_levelIP=0.5 "Start value of CS (scaled)" 
          annotation (Dialog(tab="PID - level IP"));
        parameter SI.Length setPoint_levelIP=0 "Set point level of IP drum";
        
        //PID for level LP control
        parameter Real Kp_levelLP=3 "Proportional gain (normalised units)" 
          annotation (Dialog(tab="PID - level LP"));
        parameter SI.Time Ti_levelLP=800 "Integral time" 
          annotation (Dialog(tab="PID - level LP"));
        parameter SI.Time Td_levelLP=0 "Derivative time" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real PVmin_levelLP=-1 
          "Minimum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real PVmax_levelLP=1 
          "Maximum value of process variable for scaling" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real CSmin_levelLP=500 
          "Minimum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real CSmax_levelLP=2500 
          "Maximum value of control signal for scaling" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real PVstart_levelLP=0.5 "Start value of PV (scaled)" 
          annotation (Dialog(tab="PID - level LP"));
        parameter Real CSstart_levelLP=0.5 "Start value of CS (scaled)" 
          annotation (Dialog(tab="PID - level LP"));
        parameter SI.Length setPoint_levelLP=0 "Set point level of LP drum";
        
         PowerPlants.Control.PID Level_HP(
          Kp=Kp_levelHP,
          Td=Td_levelHP,
          Ti=Ti_levelHP,
          PVmin=PVmin_levelHP,
          PVmax=PVmax_levelHP,
          CSmin=CSmin_levelHP,
          CSmax=CSmax_levelHP,
          PVstart=PVstart_levelHP,
          CSstart=CSstart_levelHP) 
                      annotation (extent=[20,40; 40,60]);
         PowerPlants.Control.PID Level_IP(
          Kp=Kp_levelIP,
          Td=Td_levelIP,
          Ti=Ti_levelIP,
          PVmin=PVmin_levelIP,
          PVmax=PVmax_levelIP,
          CSmin=CSmin_levelIP,
          CSmax=CSmax_levelIP,
          PVstart=PVstart_levelIP,
          CSstart=CSstart_levelIP) 
                     annotation (extent=[20,-10; 40,10]);
         PowerPlants.Control.PID Level_LP(
          Kp=Kp_levelLP,
          Td=Td_levelLP,
          Ti=Ti_levelLP,
          PVmin=PVmin_levelLP,
          PVmax=PVmax_levelLP,
          CSmin=CSmin_levelLP,
          CSmax=CSmax_levelLP,
          PVstart=PVstart_levelLP,
          CSstart=CSstart_levelLP) 
                     annotation (extent=[20,-54; 40,-34]);
        annotation (Diagram);
      public 
        Modelica.Blocks.Sources.Constant levelHP_SP(k=setPoint_levelHP) 
          annotation (extent=[-20,64; -40,44], rotation=180);
      public 
        Modelica.Blocks.Sources.Constant levelIP_SP(k=setPoint_levelIP) 
          annotation (extent=[-20,14; -40,-6],  rotation=180);
      public 
        Modelica.Blocks.Sources.Constant levelLP_SP(k=setPoint_levelLP) 
          annotation (extent=[-20,-30; -40,-50], rotation=180);
      equation 
        connect(SensorsBus.y_drumHP, Level_HP.PV) annotation (points=[-98,0;
              -60,0; -60,30; 0,30; 0,46; 20,46], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(SensorsBus.y_drumIP, Level_IP.PV) annotation (points=[-98,0;
              -60,0; -60,-20; 0,-20; 0,-4; 20,-4], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(SensorsBus.y_drumLP, Level_LP.PV) annotation (points=[-98,0;
              -60,0; -60,-66; 0,-66; 0,-48; 20,-48], style(
            color=84,
            rgbcolor={255,170,213},
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ActuatorsBus.flowRate_feedIP, Level_IP.CS) annotation (points=[
              100,0; 40.6,0], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ActuatorsBus.flowRate_feedHP, Level_HP.CS) annotation (points=[
              100,0; 60,0; 60,50; 40.6,50], style(
            color=52,
            rgbcolor={213,255,170},
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(levelHP_SP.y, Level_HP.SP) annotation (points=[-19,54; 20,54],
            style(color=74, rgbcolor={0,0,127}));
        connect(levelIP_SP.y, Level_IP.SP) annotation (points=[-19,4; 0.5,4;
              0.5,4; 20,4],                                   style(color=74,
              rgbcolor={0,0,127}));
        connect(levelLP_SP.y, Level_LP.SP) annotation (points=[-19,-40; 20,-40],
                              style(color=74, rgbcolor={0,0,127}));
        connect(ActuatorsBus.nPump_feedLP, Level_LP.CS) annotation (points=[100,
              0; 60,0; 60,-44; 40,-44], style(color=52, rgbcolor={213,255,170}));
      end levelsControl;
      
    end Control;
    
    package Examples 
      
      model HEG_2L "Heat Exchangers Group with two pressure level" 
        extends Interfaces.HEG_2L;
        
        parameter Real rhomcm 
          "Metal heat capacity per unit volume (density by specific heat capacity)[J/m^3.K]";
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal";
        constant Real pi=Modelica.Constants.pi;
        
        //Valve parameter
        
        parameter Real Cv_attShHP 
          "Cv (US) flow coefficient, valve for Sh_HP attemperation" annotation (Dialog(group = "Attemperation"));
        parameter SI.Pressure pnom_attShHP 
          "Nominal inlet pressure, valve for Sh_HP attemperation" annotation (Dialog(group = "Attemperation"));
        parameter SI.Pressure dpnom_attShHP 
          "Nominal pressure drop, valve for Sh_HP attemperation" annotation (Dialog(group = "Attemperation"));
        parameter SI.MassFlowRate wnom_attShHP 
          "Nominal mass flowrate, valve for Sh_HP attemperation" annotation (Dialog(group = "Attemperation"));
        parameter SI.SpecificEnthalpy valShHP_hstart=1e5 
          "Start value of specific enthalpy, valve for Sh_HP attemperation" annotation (Dialog(group = "Attemperation"));
        
        replaceable Components.HE Sh2_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh2_HP_N_G,
          N_F=Sh2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Sh,
          fluidNomPressure=fluidHPNomPressure_Sh,
          exchSurface_G=Sh2_HP_exchSurface_G,
          exchSurface_F=Sh2_HP_exchSurface_F,
          extSurfaceTub=Sh2_HP_extSurfaceTub,
          gasVol=Sh2_HP_gasVol,
          fluidVol=Sh2_HP_fluidVol,
          metalVol=Sh2_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh2_HP_Tstart_G_In,
          Tstart_G_Out=Sh2_HP_Tstart_G_Out,
          Tstart_M_In=Sh2_HP_Tstart_M_In,
          Tstart_M_Out=Sh2_HP_Tstart_M_Out,
          Tstart_F_In=Sh2_HP_Tstart_F_In,
          Tstart_F_Out=Sh2_HP_Tstart_F_Out,
          hstart_F_In=Sh2_HP_hstart_F_In,
          hstart_F_Out=Sh2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh2_HP_N_G,
          N_F=Sh2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Sh,
          exchSurface_G=Sh2_HP_exchSurface_G,
          exchSurface_F=Sh2_HP_exchSurface_F,
          extSurfaceTub=Sh2_HP_extSurfaceTub,
          gasVol=Sh2_HP_gasVol,
          fluidVol=Sh2_HP_fluidVol,
          metalVol=Sh2_HP_metalVol,
          use_T=use_T_Sh,
          SSInit=SSInit,
          Tstart_G_In=Sh2_HP_Tstart_G_In,
          Tstart_G_Out=Sh2_HP_Tstart_G_Out,
          Tstart_M_In=Sh2_HP_Tstart_M_In,
          Tstart_M_Out=Sh2_HP_Tstart_M_Out,
          Tstart_F_In=Sh2_HP_Tstart_F_In,
          Tstart_F_Out=Sh2_HP_Tstart_F_Out,
          hstart_F_In=Sh2_HP_hstart_F_In,
          hstart_F_Out=Sh2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda) 
          annotation (extent=[-70,-70; -50,-50]);
        replaceable Components.HE Sh1_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh1_HP_N_G,
          N_F=Sh1_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Sh,
          exchSurface_G=Sh1_HP_exchSurface_G,
          exchSurface_F=Sh1_HP_exchSurface_F,
          extSurfaceTub=Sh1_HP_extSurfaceTub,
          gasVol=Sh1_HP_gasVol,
          fluidVol=Sh1_HP_fluidVol,
          metalVol=Sh1_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh1_HP_Tstart_G_In,
          Tstart_G_Out=Sh1_HP_Tstart_G_Out,
          Tstart_M_In=Sh1_HP_Tstart_M_In,
          Tstart_M_Out=Sh1_HP_Tstart_M_Out,
          Tstart_F_In=Sh1_HP_Tstart_F_In,
          Tstart_F_Out=Sh1_HP_Tstart_F_Out,
          hstart_F_In=Sh1_HP_hstart_F_In,
          hstart_F_Out=Sh1_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh1_HP_N_G,
          N_F=Sh1_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Sh,
          exchSurface_G=Sh1_HP_exchSurface_G,
          exchSurface_F=Sh1_HP_exchSurface_F,
          extSurfaceTub=Sh1_HP_extSurfaceTub,
          gasVol=Sh1_HP_gasVol,
          fluidVol=Sh1_HP_fluidVol,
          metalVol=Sh1_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh1_HP_Tstart_G_In,
          Tstart_G_Out=Sh1_HP_Tstart_G_Out,
          Tstart_M_In=Sh1_HP_Tstart_M_In,
          Tstart_M_Out=Sh1_HP_Tstart_M_Out,
          Tstart_F_In=Sh1_HP_Tstart_F_In,
          Tstart_F_Out=Sh1_HP_Tstart_F_Out,
          hstart_F_In=Sh1_HP_hstart_F_In,
          hstart_F_Out=Sh1_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
          annotation (extent=[-24,-70; -4,-50]);
        replaceable Components.HE2ph Ev_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
          annotation (extent=[-58,20; -38,40]);
        replaceable Components.HE Ec_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_HP_N_G,
          N_F=Ec_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec_HP_exchSurface_G,
          exchSurface_F=Ec_HP_exchSurface_F,
          extSurfaceTub=Ec_HP_extSurfaceTub,
          gasVol=Ec_HP_gasVol,
          fluidVol=Ec_HP_fluidVol,
          metalVol=Ec_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_HP_Tstart_G_In,
          Tstart_G_Out=Ec_HP_Tstart_G_Out,
          Tstart_M_In=Ec_HP_Tstart_M_In,
          Tstart_M_Out=Ec_HP_Tstart_M_Out,
          Tstart_F_In=Ec_HP_Tstart_F_In,
          Tstart_F_Out=Ec_HP_Tstart_F_Out,
          hstart_F_In=Ec_HP_hstart_F_In,
          hstart_F_Out=Ec_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_HP_N_G,
          N_F=Ec_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec_HP_exchSurface_G,
          exchSurface_F=Ec_HP_exchSurface_F,
          extSurfaceTub=Ec_HP_extSurfaceTub,
          gasVol=Ec_HP_gasVol,
          fluidVol=Ec_HP_fluidVol,
          metalVol=Ec_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_HP_Tstart_G_In,
          Tstart_G_Out=Ec_HP_Tstart_G_Out,
          Tstart_M_In=Ec_HP_Tstart_M_In,
          Tstart_M_Out=Ec_HP_Tstart_M_Out,
          Tstart_F_In=Ec_HP_Tstart_F_In,
          Tstart_F_Out=Ec_HP_Tstart_F_Out,
          hstart_F_In=Ec_HP_hstart_F_In,
          hstart_F_Out=Ec_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
          annotation (extent=[-26,58; -6,78]);
        replaceable Components.HE Sh_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
          annotation (extent=[6,20; 26,40]);
        replaceable Components.HE2ph Ev_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev,
          FFtype_F=ThermoPower.Choices.Flow1D.FFtypes.NoFriction) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         annotation (extent=[38,58; 58,78]);
        replaceable Components.HE Ec_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)                annotation (extent=[70,58; 90,78]);
        Water.FlowJoin flowJoin(redeclare package Medium = FluidMedium) 
          annotation (extent=[-56,-30; -36,-10], rotation=180);
        Water.ValveLiq valveAttSh(
          redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          pnom=pnom_attShHP,
          dpnom=dpnom_attShHP,
          wnom=wnom_attShHP,
          hstart=valShHP_hstart,
          Cv=Cv_attShHP) "valve for attemperation of the Sh" 
                                annotation (extent=[-80,-2; -64,-18]);
        Water.SensT Sh2HPIn_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-26; -66,-46], rotation=90);
        Water.SensT Sh2HPOut_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-46,-72; -66,-92], rotation=90);
        annotation (Diagram);
      equation 
        connect(Ec_HP.waterOut, Ec_HP_Out) annotation (points=[-16,60; -16,50;
              -32,50; -32,100], style(thickness=2));
        connect(Ec_HP.waterIn, Ec_HP_In) 
          annotation (points=[-16,76; -16,100], style(thickness=2));
        connect(Sh_LP.waterIn, Sh_LP_In) 
          annotation (points=[16,38; 16,100], style(thickness=2));
        connect(Ec_LP.waterIn, Ec_LP_In) 
          annotation (points=[80,76; 80,100], style(thickness=2));
        connect(Ec_LP.waterOut, Ec_LP_Out) annotation (points=[80,60; 80,50; 64,
              50; 64,100], style(thickness=2));
        connect(Sh_LP.waterOut, Sh_LP_Out) annotation (points=[16,22; 16,-20;
              60,-20; 60,-100], style(thickness=2));
        connect(Sh1_HP.waterIn, Sh_HP_In) annotation (points=[-14,-52; -14,0;
              -80,0; -80,100], style(thickness=2));
        connect(Ec_LP.gasOut, GasOut) annotation (points=[88,68; 92,68; 92,1;
              101,1], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(GasIn, Sh2_HP.gasIn) annotation (points=[-101,1; -88,1; -88,-60;
              -68,-60], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh2_HP.gasOut, Sh1_HP.gasIn) annotation (points=[-52,-60; -22,
              -60], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh_LP.gasOut, Ec_HP.gasIn) annotation (points=[24,30; 30,30; 30,
              44; -40,44; -40,68; -24,68], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh1_HP.waterOut, flowJoin.in1) annotation (points=[-14,-68; -14,
              -80; -30,-80; -30,-24; -40,-24], style(thickness=2));
        connect(valveAttSh.outlet, flowJoin.in2) 
                                               annotation (points=[-64,-10; -30,
              -10; -30,-16; -40,-16], style(thickness=2));
        connect(valveAttSh.inlet, LiquidWaterIn) 
                                               annotation (points=[-80,-10; -84,
              -10; -84,60; -100,60], style(thickness=2));
        connect(Ev_LP.gasOut, Ec_LP.gasIn) annotation (points=[56,68; 72,68],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.gasIn, Ec_HP.gasOut) annotation (points=[40,68; -8,68],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.waterIn, Ev_LP_In) 
          annotation (points=[48,76; 48,100], style(thickness=2));
        connect(Ev_LP.waterOut, Ev_LP_Out) annotation (points=[48,60; 48,50; 32,
              50; 32,100], style(thickness=2));
        connect(Ev_HP.gasOut, Sh_LP.gasIn) annotation (points=[-40,30; 8,30],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.waterIn, Ev_HP_In) 
          annotation (points=[-48,38; -48,100], style(thickness=2));
        connect(Ev_HP.waterOut, Ev_HP_Out) annotation (points=[-48,22; -48,12;
              -64,12; -64,100],style(thickness=2));
        connect(Ev_HP.gasIn, Sh1_HP.gasOut) annotation (points=[-56,30; -72,30;
              -72,4; 4,4; 4,-60; -6,-60], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh2HPIn_T.outlet, Sh2_HP.waterIn) 
          annotation (points=[-60,-42; -60,-52], style(thickness=2));
        connect(Sh2HPIn_T.inlet, flowJoin.out) 
          annotation (points=[-60,-30; -60,-20; -52,-20], style(thickness=2));
        connect(Sh2HPOut_T.inlet, Sh2_HP.waterOut) 
          annotation (points=[-60,-76; -60,-68], style(thickness=2));
        connect(Sh2HPOut_T.outlet, Sh_HP_Out) 
          annotation (points=[-60,-88; -60,-100], style(thickness=2));
        connect(SensorsBus.T_Sh2HP_In, Sh2HPIn_T.T) annotation (points=[98,-40;
              -40,-40; -40,-50; -50,-50; -50,-44], style(
            color=84,
            rgbcolor={255,170,213},
            thickness=1));
        connect(SensorsBus.T_Sh2HP_Out, Sh2HPOut_T.T) annotation (points=[98,-40;
              30,-40; 30,-96; -50,-96; -50,-90], style(color=84, rgbcolor={255,
                170,213}));
        connect(ActuatorsBus.theta_attShHP, valveAttSh.theta) annotation (
            points=[98,-72; -72,-72; -72,-16.4], style(
            color=52,
            rgbcolor={213,255,170},
            thickness=1));
      end HEG_2L;
      
      model HEG_2LRh "Heat Exchangers Group with two pressure level and reheat" 
        extends Interfaces.HEG_2LRh(Rh1_IP_Tstart_G_In = Sh1_HP_Tstart_G_In,
                                    Rh1_IP_Tstart_G_Out = Sh1_HP_Tstart_G_Out,
                                    Rh2_IP_Tstart_G_In = Sh2_HP_Tstart_G_In,
                                    Rh2_IP_Tstart_G_Out = Sh2_HP_Tstart_G_Out,
                                    Rh2_IP_N_G = Sh2_HP_N_G,
                                    Rh1_IP_N_G = Sh1_HP_N_G,
                                    Rh2_IP_gasVol = Sh2_HP_gasVol,
                                    Rh1_IP_gasVol = Sh1_HP_gasVol);
        
        parameter Real rhomcm 
          "Metal heat capacity per unit volume (density by specific heat capacity) [J/m^3.K]";
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal";
        constant Real pi=Modelica.Constants.pi;
        
        //Valves parameters
        parameter Real Cv_attShHP 
          "Cv (US) flow coefficient, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.Pressure pnom_attShHP 
          "Nominal inlet pressure, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.Pressure dpnom_attShHP 
          "Nominal pressure drop, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.MassFlowRate wnom_attShHP 
          "Nominal mass flowrate, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.SpecificEnthalpy valShHP_hstart 
          "Specific enthalpy start value, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter Real Cv_attRhIP 
          "Cv (US) flow coefficient, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.Pressure pnom_attRhIP 
          "Nominal inlet pressure, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.Pressure dpnom_attRhIP 
          "Nominal pressure drop, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.MassFlowRate wnom_attRhIP 
          "Nominal mass flowrate, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.SpecificEnthalpy valRhIP_hstart 
          "Specific enthalpy start value, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        
        replaceable Components.ParHE_att ShHP_RhIP(
          Cv_valA=Cv_attShHP,
          pnom_valA=pnom_attShHP,
          dpnom_valA=dpnom_attShHP,
          wnom_valA=wnom_attShHP,
          hstart_valA=valShHP_hstart,
          Cv_valB=Cv_attRhIP,
          pnom_valB=pnom_attRhIP,
          dpnom_valB=dpnom_attRhIP,
          wnom_valB=wnom_attRhIP,
          hstart_valB=valRhIP_hstart,
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          rhomcm_A_p1=rhomcm,
          rhomcm_B_p1=rhomcm,
          rhomcm_A_p2=rhomcm,
          rhomcm_B_p2=rhomcm,
          lambda=lambda,
          N_G_p1=Sh1_HP_N_G,
          N_F_A_p1=Sh1_HP_N_F,
          N_F_B_p1=Rh1_IP_N_F,
          exchSurface_G_A_p1=Sh1_HP_exchSurface_G,
          exchSurface_G_B_p1=Rh1_IP_exchSurface_G,
          exchSurface_F_A_p1=Sh1_HP_exchSurface_F,
          exchSurface_F_B_p1=Rh1_IP_exchSurface_F,
          extSurfaceTub_A_p1=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B_p1=Rh1_IP_extSurfaceTub,
          gasVol_p1=Sh1_HP_gasVol,
          fluidVol_A_p1=Sh1_HP_fluidVol,
          fluidVol_B_p1=Rh1_IP_fluidVol,
          metalVol_A_p1=Sh1_HP_metalVol,
          metalVol_B_p1=Rh1_IP_metalVol,
          N_G_p2=Sh2_HP_N_G,
          N_F_A_p2=Sh2_HP_N_F,
          N_F_B_p2=Rh2_IP_N_F,
          exchSurface_G_A_p2=Sh2_HP_exchSurface_G,
          exchSurface_G_B_p2=Rh2_IP_exchSurface_G,
          exchSurface_F_A_p2=Sh2_HP_exchSurface_F,
          exchSurface_F_B_p2=Rh2_IP_exchSurface_F,
          extSurfaceTub_A_p2=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B_p2=Rh2_IP_extSurfaceTub,
          gasVol_p2=Sh2_HP_gasVol,
          fluidVol_A_p2=Sh2_HP_fluidVol,
          fluidVol_B_p2=Rh2_IP_fluidVol,
          metalVol_A_p2=Sh2_HP_metalVol,
          metalVol_B_p2=Rh2_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In_p1=Sh1_HP_Tstart_G_In,
          Tstart_G_Out_p1=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In_p1=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out_p1=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In_p1=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out_p1=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In_p1=Sh1_HP_hstart_F_In,
          hstart_F_A_Out_p1=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In_p1=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out_p1=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In_p1=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out_p1=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In_p1=Rh1_IP_hstart_F_In,
          hstart_F_B_Out_p1=Rh1_IP_hstart_F_Out,
          Tstart_G_In_p2=Sh2_HP_Tstart_G_In,
          Tstart_G_Out_p2=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In_p2=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out_p2=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In_p2=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out_p2=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In_p2=Sh2_HP_hstart_F_In,
          hstart_F_A_Out_p2=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In_p2=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out_p2=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In_p2=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out_p2=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In_p2=Rh2_IP_hstart_F_In,
          hstart_F_B_Out_p2=Rh2_IP_hstart_F_Out,
          use_T=use_T_Sh) extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE_Att(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          rhomcm_A_p1=rhomcm,
          rhomcm_B_p1=rhomcm,
          rhomcm_A_p2=rhomcm,
          rhomcm_B_p2=rhomcm,
          lambda=lambda,
          N_G_p1=Sh1_HP_N_G,
          N_F_A_p1=Sh1_HP_N_F,
          N_F_B_p1=Rh1_IP_N_F,
          exchSurface_G_A_p1=Sh1_HP_exchSurface_G,
          exchSurface_G_B_p1=Rh1_IP_exchSurface_G,
          exchSurface_F_A_p1=Sh1_HP_exchSurface_F,
          exchSurface_F_B_p1=Rh1_IP_exchSurface_F,
          extSurfaceTub_A_p1=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B_p1=Rh1_IP_extSurfaceTub,
          gasVol_p1=Sh1_HP_gasVol,
          fluidVol_A_p1=Sh1_HP_fluidVol,
          fluidVol_B_p1=Rh1_IP_fluidVol,
          metalVol_A_p1=Sh1_HP_metalVol,
          metalVol_B_p1=Rh1_IP_metalVol,
          N_G_p2=Sh2_HP_N_G,
          N_F_A_p2=Sh2_HP_N_F,
          N_F_B_p2=Rh2_IP_N_F,
          exchSurface_G_A_p2=Sh2_HP_exchSurface_G,
          exchSurface_G_B_p2=Rh2_IP_exchSurface_G,
          exchSurface_F_A_p2=Sh2_HP_exchSurface_F,
          exchSurface_F_B_p2=Rh2_IP_exchSurface_F,
          extSurfaceTub_A_p2=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B_p2=Rh2_IP_extSurfaceTub,
          gasVol_p2=Sh2_HP_gasVol,
          fluidVol_A_p2=Sh2_HP_fluidVol,
          fluidVol_B_p2=Rh2_IP_fluidVol,
          metalVol_A_p2=Sh2_HP_metalVol,
          metalVol_B_p2=Rh2_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In_p1=Sh1_HP_Tstart_G_In,
          Tstart_G_Out_p1=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In_p1=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out_p1=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In_p1=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out_p1=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In_p1=Sh1_HP_hstart_F_In,
          hstart_F_A_Out_p1=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In_p1=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out_p1=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In_p1=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out_p1=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In_p1=Rh1_IP_hstart_F_In,
          hstart_F_B_Out_p1=Rh1_IP_hstart_F_Out,
          Tstart_G_In_p2=Sh2_HP_Tstart_G_In,
          Tstart_G_Out_p2=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In_p2=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out_p2=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In_p2=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out_p2=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In_p2=Sh2_HP_hstart_F_In,
          hstart_F_A_Out_p2=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In_p2=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out_p2=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In_p2=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out_p2=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In_p2=Rh2_IP_hstart_F_In,
          hstart_F_B_Out_p2=Rh2_IP_hstart_F_Out,
          use_T=use_T_Sh)         annotation (extent=[-70,-62; -34,-28]);
        replaceable Components.HE2ph Ev_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
          annotation (extent=[-58,22; -38,42]);
        replaceable Components.HE Ec_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_HP_N_G,
          N_F=Ec_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec_HP_exchSurface_G,
          exchSurface_F=Ec_HP_exchSurface_F,
          extSurfaceTub=Ec_HP_extSurfaceTub,
          gasVol=Ec_HP_gasVol,
          fluidVol=Ec_HP_fluidVol,
          metalVol=Ec_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_HP_Tstart_G_In,
          Tstart_G_Out=Ec_HP_Tstart_G_Out,
          Tstart_M_In=Ec_HP_Tstart_M_In,
          Tstart_M_Out=Ec_HP_Tstart_M_Out,
          Tstart_F_In=Ec_HP_Tstart_F_In,
          Tstart_F_Out=Ec_HP_Tstart_F_Out,
          hstart_F_In=Ec_HP_hstart_F_In,
          hstart_F_Out=Ec_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_HP_N_G,
          N_F=Ec_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec_HP_exchSurface_G,
          exchSurface_F=Ec_HP_exchSurface_F,
          extSurfaceTub=Ec_HP_extSurfaceTub,
          gasVol=Ec_HP_gasVol,
          fluidVol=Ec_HP_fluidVol,
          metalVol=Ec_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_HP_Tstart_G_In,
          Tstart_G_Out=Ec_HP_Tstart_G_Out,
          Tstart_M_In=Ec_HP_Tstart_M_In,
          Tstart_M_Out=Ec_HP_Tstart_M_Out,
          Tstart_F_In=Ec_HP_Tstart_F_In,
          Tstart_F_Out=Ec_HP_Tstart_F_Out,
          hstart_F_In=Ec_HP_hstart_F_In,
          hstart_F_Out=Ec_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)          annotation (extent=[-26,62; -6,82]);
        replaceable Components.HE Sh_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          use_T=use_T,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda)           annotation (extent=[6,22; 26,42]);
        replaceable Components.HE2ph Ev_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          use_T=use_T,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda) annotation (extent=[38,62; 58,82]);
        replaceable Components.HE Ec_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)                annotation (extent=[70,62; 90,82]);
        Water.SensT RhIPOut_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-44,-84; -24,-64], style(thickness=2));
        Water.SensT ShHPOut_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-74,-68; -54,-88], rotation=90);
        annotation (Diagram, Icon);
      equation 
        connect(Ec_HP.waterOut, Ec_HP_Out) 
          annotation (points=[-16,64; -16,54; -32,54; -32,100], style(thickness=2));
        connect(Ec_HP.waterIn, Ec_HP_In) 
          annotation (points=[-16,80; -16,100], style(thickness=2));
        connect(Sh_LP.waterIn, Sh_LP_In) 
          annotation (points=[16,40; 16,100], style(thickness=2));
        connect(Ec_LP.waterIn, Ec_LP_In) 
          annotation (points=[80,80; 80,100], style(thickness=2));
        connect(Ec_LP.waterOut, Ec_LP_Out) 
          annotation (points=[80,64; 80,54; 64,54; 64,100], style(thickness=2));
        connect(Sh_LP.waterOut, Sh_LP_Out) 
          annotation (points=[16,24; 16,0; 60,0; 60,-100], style(thickness=2));
        connect(Ec_LP.gasOut, GasOut) annotation (points=[88,72; 92,72; 92,1;
              101,1],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh_LP.gasOut, Ec_HP.gasIn) annotation (points=[24,32; 32,32; 32,
              50; -40,50; -40,72; -24,72],
                                       style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.gasOut, Ec_LP.gasIn) annotation (points=[56,72; 72,72],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.waterIn, Ev_LP_In) 
          annotation (points=[48,80; 48,100], style(thickness=2));
        connect(Ev_LP.waterOut, Ev_LP_Out) annotation (points=[48,64; 48,54; 32,
              54; 32,100], style(thickness=2));
        connect(Ev_LP.gasIn, Ec_HP.gasOut) annotation (points=[40,72; -8,72],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.gasOut, Sh_LP.gasIn) annotation (points=[-40,32; 8,32],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.waterIn, Ev_HP_In) 
          annotation (points=[-48,40; -48,100], style(thickness=2));
        connect(Ev_HP.waterOut, Ev_HP_Out) annotation (points=[-48,24; -48,14;
              -64,14; -64,100], style(thickness=2));
        connect(ShHPOut_T.outlet, Sh_HP_Out) 
          annotation (points=[-60,-84; -60,-100], style(thickness=2));
        connect(SensorsBus.T_Sh2HP_In, ShHP_RhIP.T_intermedA) annotation (
            points=[98,-40; -14,-40; -14,-34.97; -37.06,-34.97], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.T_Rh2IP_In, ShHP_RhIP.T_intermedB) annotation (
            points=[98,-40; -14,-40; -14,-38.37; -37.06,-38.37], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.T_Rh2IP_Out, RhIPOut_T.T) annotation (points=[98,-40;
              -14,-40; -14,-68; -26,-68], style(color=84, rgbcolor={255,170,213}));
        connect(ActuatorsBus.theta_attShHP, ShHP_RhIP.theta_valveA) annotation (
           points=[98,-72; 32,-72; 32,-52.14; -37.42,-52.14], style(color=52,
              rgbcolor={213,255,170}));
        connect(ActuatorsBus.theta_attRhIP, ShHP_RhIP.theta_valveB) annotation (
           points=[98,-72; 32,-72; 32,-55.71; -37.42,-55.71], style(color=52,
              rgbcolor={213,255,170}));
        connect(SensorsBus.T_Sh2HP_Out, ShHPOut_T.T) annotation (points=[98,-40;
              -14,-40; -14,-90; -70,-90; -70,-86], style(color=84, rgbcolor={
                255,170,213}));
        connect(RhIPOut_T.outlet, Rh_IP_Out) annotation (points=[-28,-78; 20,
              -78; 20,-100], style(
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(ShHP_RhIP.waterInB, Rh_IP_In) annotation (points=[-44.8,-31.4;
              -44.8,-10; -20,-10; -20,-100], style(thickness=2));
        connect(ShHP_RhIP.waterInA, Sh_HP_In) annotation (points=[-59.2,-31.4;
              -59.2,-6; -80,-6; -80,100], style(thickness=2));
        connect(ShHP_RhIP.LiquidWaterIn, LiquidWaterIn) annotation (points=[
              -66.4,-52.14; -88,-52.14; -88,60; -100,60], style(thickness=2));
        connect(ShHP_RhIP.waterOutA, ShHPOut_T.inlet) annotation (points=[-59.2,
              -58.6; -59.2,-61.3; -60,-61.3; -60,-72], style(thickness=2));
        connect(RhIPOut_T.inlet, ShHP_RhIP.waterOutB) annotation (points=[-40,
              -78; -44.8,-78; -44.8,-58.6], style(thickness=2));
        connect(ShHP_RhIP.gasOut, Ev_HP.gasIn) annotation (points=[-37.6,-45; 0,
              -45; 0,10; -76,10; -76,32; -56,32], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(ShHP_RhIP.gasIn, GasIn) annotation (points=[-66.4,-45; -84,-45;
              -84,1; -101,1], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
      end HEG_2LRh;
      
      model HEG_3LRh 
        "Heat Exchangers Group with three pressure level and reheat" 
        extends Interfaces.HEG_3LRh(Ec1_HP_Tstart_G_In = Ec_IP_Tstart_G_In,
                                    Ec1_HP_Tstart_G_Out = Ec_IP_Tstart_G_Out,
                                    Rh1_IP_Tstart_G_In = Sh1_HP_Tstart_G_In,
                                    Rh1_IP_Tstart_G_Out = Sh1_HP_Tstart_G_Out,
                                    Rh2_IP_Tstart_G_In = Sh2_HP_Tstart_G_In,
                                    Rh2_IP_Tstart_G_Out = Sh2_HP_Tstart_G_Out,
                                    Rh2_IP_N_G = Sh2_HP_N_G,
                                    Rh1_IP_N_G = Sh1_HP_N_G,
                                    Rh2_IP_gasVol = Sh2_HP_gasVol,
                                    Rh1_IP_gasVol = Sh1_HP_gasVol,
                                    Ec_IP_N_G = Ec1_HP_N_G,
                                    Ec_IP_gasVol = Ec1_HP_gasVol);
        
        parameter Real rhomcm 
          "Metal heat capacity per unit volume (density by specific heat capacity) [J/m^3.K]";
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal";
        constant Real pi=Modelica.Constants.pi;
        
        //Valves parameters
        parameter Real Cv_attShHP 
          "Cv (US) flow coefficient, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.Pressure pnom_attShHP 
          "Nominal inlet pressure, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.Pressure dpnom_attShHP 
          "Nominal pressure drop, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.MassFlowRate wnom_attShHP 
          "Nominal mass flowrate, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter SI.SpecificEnthalpy valShHP_hstart 
          "Specific enthalpy start value, valve for Sh_HP attemperation" annotation (dialog(group = "Attemperation Sh"));
        parameter Real Cv_attRhIP 
          "Cv (US) flow coefficient, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.Pressure pnom_attRhIP 
          "Nominal inlet pressure, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.Pressure dpnom_attRhIP 
          "Nominal pressure drop, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.MassFlowRate wnom_attRhIP 
          "Nominal mass flowrate, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        parameter SI.SpecificEnthalpy valRhIP_hstart 
          "Specific enthalpy start value, valve for Rh_IP attemperation" annotation (dialog(group = "Attemperation Rh"));
        
        replaceable Components.ParHE_att ShHP_RhIP(
          Cv_valA=Cv_attShHP,
          pnom_valA=pnom_attShHP,
          dpnom_valA=dpnom_attShHP,
          wnom_valA=wnom_attShHP,
          hstart_valA=valShHP_hstart,
          Cv_valB=Cv_attRhIP,
          pnom_valB=pnom_attRhIP,
          dpnom_valB=dpnom_attRhIP,
          wnom_valB=wnom_attRhIP,
          hstart_valB=valRhIP_hstart,
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          rhomcm_A_p1=rhomcm,
          rhomcm_B_p1=rhomcm,
          rhomcm_A_p2=rhomcm,
          rhomcm_B_p2=rhomcm,
          lambda=lambda,
          N_G_p1=Sh1_HP_N_G,
          N_F_A_p1=Sh1_HP_N_F,
          N_F_B_p1=Rh1_IP_N_F,
          exchSurface_G_A_p1=Sh1_HP_exchSurface_G,
          exchSurface_G_B_p1=Rh1_IP_exchSurface_G,
          exchSurface_F_A_p1=Sh1_HP_exchSurface_F,
          exchSurface_F_B_p1=Rh1_IP_exchSurface_F,
          extSurfaceTub_A_p1=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B_p1=Rh1_IP_extSurfaceTub,
          gasVol_p1=Sh1_HP_gasVol,
          fluidVol_A_p1=Sh1_HP_fluidVol,
          fluidVol_B_p1=Rh1_IP_fluidVol,
          metalVol_A_p1=Sh1_HP_metalVol,
          metalVol_B_p1=Rh1_IP_metalVol,
          N_G_p2=Sh2_HP_N_G,
          N_F_A_p2=Sh2_HP_N_F,
          N_F_B_p2=Rh2_IP_N_F,
          exchSurface_G_A_p2=Sh2_HP_exchSurface_G,
          exchSurface_G_B_p2=Rh2_IP_exchSurface_G,
          exchSurface_F_A_p2=Sh2_HP_exchSurface_F,
          exchSurface_F_B_p2=Rh2_IP_exchSurface_F,
          extSurfaceTub_A_p2=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B_p2=Rh2_IP_extSurfaceTub,
          gasVol_p2=Sh2_HP_gasVol,
          fluidVol_A_p2=Sh2_HP_fluidVol,
          fluidVol_B_p2=Rh2_IP_fluidVol,
          metalVol_A_p2=Sh2_HP_metalVol,
          metalVol_B_p2=Rh2_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In_p1=Sh1_HP_Tstart_G_In,
          Tstart_G_Out_p1=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In_p1=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out_p1=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In_p1=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out_p1=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In_p1=Sh1_HP_hstart_F_In,
          hstart_F_A_Out_p1=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In_p1=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out_p1=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In_p1=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out_p1=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In_p1=Rh1_IP_hstart_F_In,
          hstart_F_B_Out_p1=Rh1_IP_hstart_F_Out,
          Tstart_G_In_p2=Sh2_HP_Tstart_G_In,
          Tstart_G_Out_p2=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In_p2=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out_p2=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In_p2=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out_p2=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In_p2=Sh2_HP_hstart_F_In,
          hstart_F_A_Out_p2=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In_p2=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out_p2=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In_p2=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out_p2=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In_p2=Rh2_IP_hstart_F_In,
          hstart_F_B_Out_p2=Rh2_IP_hstart_F_Out,
          use_T=use_T_Sh) extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE_Att(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          rhomcm_A_p1=rhomcm,
          rhomcm_B_p1=rhomcm,
          rhomcm_A_p2=rhomcm,
          rhomcm_B_p2=rhomcm,
          lambda=lambda,
          N_G_p1=Sh1_HP_N_G,
          N_F_A_p1=Sh1_HP_N_F,
          N_F_B_p1=Rh1_IP_N_F,
          exchSurface_G_A_p1=Sh1_HP_exchSurface_G,
          exchSurface_G_B_p1=Rh1_IP_exchSurface_G,
          exchSurface_F_A_p1=Sh1_HP_exchSurface_F,
          exchSurface_F_B_p1=Rh1_IP_exchSurface_F,
          extSurfaceTub_A_p1=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B_p1=Rh1_IP_extSurfaceTub,
          gasVol_p1=Sh1_HP_gasVol,
          fluidVol_A_p1=Sh1_HP_fluidVol,
          fluidVol_B_p1=Rh1_IP_fluidVol,
          metalVol_A_p1=Sh1_HP_metalVol,
          metalVol_B_p1=Rh1_IP_metalVol,
          N_G_p2=Sh2_HP_N_G,
          N_F_A_p2=Sh2_HP_N_F,
          N_F_B_p2=Rh2_IP_N_F,
          exchSurface_G_A_p2=Sh2_HP_exchSurface_G,
          exchSurface_G_B_p2=Rh2_IP_exchSurface_G,
          exchSurface_F_A_p2=Sh2_HP_exchSurface_F,
          exchSurface_F_B_p2=Rh2_IP_exchSurface_F,
          extSurfaceTub_A_p2=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B_p2=Rh2_IP_extSurfaceTub,
          gasVol_p2=Sh2_HP_gasVol,
          fluidVol_A_p2=Sh2_HP_fluidVol,
          fluidVol_B_p2=Rh2_IP_fluidVol,
          metalVol_A_p2=Sh2_HP_metalVol,
          metalVol_B_p2=Rh2_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In_p1=Sh1_HP_Tstart_G_In,
          Tstart_G_Out_p1=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In_p1=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out_p1=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In_p1=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out_p1=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In_p1=Sh1_HP_hstart_F_In,
          hstart_F_A_Out_p1=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In_p1=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out_p1=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In_p1=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out_p1=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In_p1=Rh1_IP_hstart_F_In,
          hstart_F_B_Out_p1=Rh1_IP_hstart_F_Out,
          Tstart_G_In_p2=Sh2_HP_Tstart_G_In,
          Tstart_G_Out_p2=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In_p2=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out_p2=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In_p2=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out_p2=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In_p2=Sh2_HP_hstart_F_In,
          hstart_F_A_Out_p2=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In_p2=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out_p2=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In_p2=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out_p2=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In_p2=Rh2_IP_hstart_F_In,
          hstart_F_B_Out_p2=Rh2_IP_hstart_F_Out,
          use_T=use_T_Sh)         annotation (extent=[-88,-72; -48,-34]);
        replaceable Components.HE2ph Ev_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
          annotation (extent=[-30,-66; -10,-46]);
        replaceable Components.HE Ec2_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec2_HP_N_G,
          N_F=Ec2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec2_HP_exchSurface_G,
          exchSurface_F=Ec2_HP_exchSurface_F,
          extSurfaceTub=Ec2_HP_extSurfaceTub,
          gasVol=Ec2_HP_gasVol,
          fluidVol=Ec2_HP_fluidVol,
          metalVol=Ec2_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec2_HP_Tstart_G_In,
          Tstart_G_Out=Ec2_HP_Tstart_G_Out,
          Tstart_M_In=Ec2_HP_Tstart_M_In,
          Tstart_M_Out=Ec2_HP_Tstart_M_Out,
          Tstart_F_In=Ec2_HP_Tstart_F_In,
          Tstart_F_Out=Ec2_HP_Tstart_F_Out,
          hstart_F_In=Ec2_HP_hstart_F_In,
          hstart_F_Out=Ec2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec2_HP_N_G,
          N_F=Ec2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec2_HP_exchSurface_G,
          exchSurface_F=Ec2_HP_exchSurface_F,
          extSurfaceTub=Ec2_HP_extSurfaceTub,
          gasVol=Ec2_HP_gasVol,
          fluidVol=Ec2_HP_fluidVol,
          metalVol=Ec2_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec2_HP_Tstart_G_In,
          Tstart_G_Out=Ec2_HP_Tstart_G_Out,
          Tstart_M_In=Ec2_HP_Tstart_M_In,
          Tstart_M_Out=Ec2_HP_Tstart_M_Out,
          Tstart_F_In=Ec2_HP_Tstart_F_In,
          Tstart_F_Out=Ec2_HP_Tstart_F_Out,
          hstart_F_In=Ec2_HP_hstart_F_In,
          hstart_F_Out=Ec2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)          annotation (extent=[-34,-8; -14,12]);
        replaceable Components.ParHE Ec1HP_EcIP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec1_HP_N_G,
          N_F_A=Ec1_HP_N_F,
          N_F_B=Ec_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Ec,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Ec,
          fluidNomPressure_A=fluidHPNomPressure_Ec,
          fluidNomPressure_B=fluidIPNomPressure_Ec,
          exchSurface_G_A=Ec1_HP_exchSurface_G,
          exchSurface_G_B=Ec_IP_exchSurface_G,
          exchSurface_F_A=Ec1_HP_exchSurface_F,
          exchSurface_F_B=Ec_IP_exchSurface_F,
          extSurfaceTub_A=Ec1_HP_extSurfaceTub,
          extSurfaceTub_B=Ec_IP_extSurfaceTub,
          gasVol=Ec1_HP_gasVol,
          fluidVol_A=Ec1_HP_fluidVol,
          fluidVol_B=Ec_IP_fluidVol,
          metalVol_A=Ec1_HP_metalVol,
          metalVol_B=Ec_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec1_HP_Tstart_G_In,
          Tstart_G_Out=Ec1_HP_Tstart_G_Out,
          Tstart_M_A_In=Ec1_HP_Tstart_M_In,
          Tstart_M_A_Out=Ec1_HP_Tstart_M_Out,
          Tstart_F_A_In=Ec1_HP_Tstart_F_In,
          Tstart_F_A_Out=Ec1_HP_Tstart_F_Out,
          hstart_F_A_In=Ec1_HP_hstart_F_In,
          hstart_F_A_Out=Ec1_HP_hstart_F_Out,
          Tstart_M_B_In=Ec_IP_Tstart_M_In,
          Tstart_M_B_Out=Ec_IP_Tstart_M_Out,
          Tstart_F_B_In=Ec_IP_Tstart_F_In,
          Tstart_F_B_Out=Ec_IP_Tstart_F_Out,
          hstart_F_B_In=Ec_IP_hstart_F_In,
          hstart_F_B_Out=Ec_IP_hstart_F_Out,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec1_HP_N_G,
          N_F_A=Ec1_HP_N_F,
          N_F_B=Ec_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Ec,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Ec,
          fluidNomPressure_A=fluidHPNomPressure_Ec,
          fluidNomPressure_B=fluidIPNomPressure_Ec,
          exchSurface_G_A=Ec1_HP_exchSurface_G,
          exchSurface_G_B=Ec_IP_exchSurface_G,
          exchSurface_F_A=Ec1_HP_exchSurface_F,
          exchSurface_F_B=Ec_IP_exchSurface_F,
          extSurfaceTub_A=Ec1_HP_extSurfaceTub,
          extSurfaceTub_B=Ec_IP_extSurfaceTub,
          gasVol=Ec1_HP_gasVol,
          fluidVol_A=Ec1_HP_fluidVol,
          fluidVol_B=Ec_IP_fluidVol,
          metalVol_A=Ec1_HP_metalVol,
          metalVol_B=Ec_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec1_HP_Tstart_G_In,
          Tstart_G_Out=Ec1_HP_Tstart_G_Out,
          Tstart_M_A_In=Ec1_HP_Tstart_M_In,
          Tstart_M_A_Out=Ec1_HP_Tstart_M_Out,
          Tstart_F_A_In=Ec1_HP_Tstart_F_In,
          Tstart_F_A_Out=Ec1_HP_Tstart_F_Out,
          hstart_F_A_In=Ec1_HP_hstart_F_In,
          hstart_F_A_Out=Ec1_HP_hstart_F_Out,
          Tstart_M_B_In=Ec_IP_Tstart_M_In,
          Tstart_M_B_Out=Ec_IP_Tstart_M_Out,
          Tstart_F_B_In=Ec_IP_Tstart_F_In,
          Tstart_F_B_Out=Ec_IP_Tstart_F_Out,
          hstart_F_B_In=Ec_IP_hstart_F_In,
          hstart_F_B_Out=Ec_IP_hstart_F_Out,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         annotation (extent=[-30,40; -10,60]);
        replaceable Components.HE Sh_IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_IP_N_G,
          N_F=Sh_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidIPNomFlowRate_Sh,
          fluidNomPressure=fluidIPNomPressure_Sh,
          exchSurface_G=Sh_IP_exchSurface_G,
          exchSurface_F=Sh_IP_exchSurface_F,
          extSurfaceTub=Sh_IP_extSurfaceTub,
          gasVol=Sh_IP_gasVol,
          fluidVol=Sh_IP_fluidVol,
          metalVol=Sh_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_IP_Tstart_G_In,
          Tstart_G_Out=Sh_IP_Tstart_G_Out,
          Tstart_M_In=Sh_IP_Tstart_M_In,
          Tstart_M_Out=Sh_IP_Tstart_M_Out,
          Tstart_F_In=Sh_IP_Tstart_F_In,
          Tstart_F_Out=Sh_IP_Tstart_F_Out,
          hstart_F_In=Sh_IP_hstart_F_In,
          hstart_F_Out=Sh_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_IP_N_G,
          N_F=Sh_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidIPNomFlowRate_Sh,
          fluidNomPressure=fluidIPNomPressure_Sh,
          exchSurface_G=Sh_IP_exchSurface_G,
          exchSurface_F=Sh_IP_exchSurface_F,
          extSurfaceTub=Sh_IP_extSurfaceTub,
          gasVol=Sh_IP_gasVol,
          fluidVol=Sh_IP_fluidVol,
          metalVol=Sh_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_IP_Tstart_G_In,
          Tstart_G_Out=Sh_IP_Tstart_G_Out,
          Tstart_M_In=Sh_IP_Tstart_M_In,
          Tstart_M_Out=Sh_IP_Tstart_M_Out,
          Tstart_F_In=Sh_IP_Tstart_F_In,
          Tstart_F_Out=Sh_IP_Tstart_F_Out,
          hstart_F_In=Sh_IP_hstart_F_In,
          hstart_F_Out=Sh_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh)          annotation (extent=[-4,-66; 16,-46]);
        replaceable Components.HE2ph Ev_IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_IP_N_G,
          N_F=Ev_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidIPNomFlowRate_Ev,
          fluidNomPressure=fluidIPNomPressure_Ev,
          exchSurface_G=Ev_IP_exchSurface_G,
          exchSurface_F=Ev_IP_exchSurface_F,
          extSurfaceTub=Ev_IP_extSurfaceTub,
          gasVol=Ev_IP_gasVol,
          fluidVol=Ev_IP_fluidVol,
          metalVol=Ev_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_IP_Tstart_G_In,
          Tstart_G_Out=Ev_IP_Tstart_G_Out,
          Tstart_M_In=Ev_IP_Tstart_M_In,
          Tstart_M_Out=Ev_IP_Tstart_M_Out,
          Tstart_F_In=Ev_IP_Tstart_F_In,
          Tstart_F_Out=Ev_IP_Tstart_F_Out,
          hstart_F_In=Ev_IP_hstart_F_In,
          hstart_F_Out=Ev_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_IP_N_G,
          N_F=Ev_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidIPNomFlowRate_Ev,
          fluidNomPressure=fluidIPNomPressure_Ev,
          exchSurface_G=Ev_IP_exchSurface_G,
          exchSurface_F=Ev_IP_exchSurface_F,
          extSurfaceTub=Ev_IP_extSurfaceTub,
          gasVol=Ev_IP_gasVol,
          fluidVol=Ev_IP_fluidVol,
          metalVol=Ev_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_IP_Tstart_G_In,
          Tstart_G_Out=Ev_IP_Tstart_G_Out,
          Tstart_M_In=Ev_IP_Tstart_M_In,
          Tstart_M_Out=Ev_IP_Tstart_M_Out,
          Tstart_F_In=Ev_IP_Tstart_F_In,
          Tstart_F_Out=Ev_IP_Tstart_F_Out,
          hstart_F_In=Ev_IP_hstart_F_In,
          hstart_F_Out=Ev_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
          annotation (extent=[14,-8; 34,12]);
        replaceable Components.HE Sh_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          fluidNomPressure=fluidLPNomPressure_Sh,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Sh)          annotation (extent=[44,-8; 64,12]);
        replaceable Components.HE2ph Ev_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          fluidNomPressure=fluidLPNomPressure_Ev,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         annotation (extent=[28,60; 48,40]);
        replaceable Components.HE Ec_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidLPNomPressure_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)                annotation (extent=[58,60; 78,40]);
        annotation (Diagram, Icon);
        Water.SensT ShHPOut_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-68,-76; -84,-92], rotation=90);
        Water.SensT RhIPOut_T(redeclare package Medium = FluidMedium) 
          annotation (extent=[-60,-92; -44,-78]);
        
      equation 
        connect(GasOut, Ec_LP.gasOut) annotation (points=[101,1; 82,1; 82,50;
              76,50], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ec_LP.waterOut, Ec_LP_Out) annotation (points=[68,58; 68,66; 86,
              66; 86,38; 100,38], style(thickness=2));
        connect(Ec_LP_In, Ec_LP.waterIn) 
          annotation (points=[100,22; 68,22; 68,42], style(thickness=2));
        connect(Ev_LP.waterOut, Ev_LP_Out) 
          annotation (points=[38,58; 38,70; 100,70], style(thickness=2));
        connect(Ec_LP.gasIn, Ev_LP.gasOut) annotation (points=[60,50; 46,50],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.waterIn, Ev_LP_In) annotation (points=[38,42; 38,34; 90,
              34; 90,54; 100,54], style(thickness=2));
        connect(Ec1HP_EcIP.waterInA, Ec_HP_In) 
          annotation (points=[-24,58; -24,100], style(thickness=2));
        connect(Sh_LP.waterIn, Sh_LP_In) 
          annotation (points=[54,10; 54,86; 100,86], style(thickness=2));
        connect(Sh_LP.gasIn, Ev_IP.gasOut) annotation (points=[46,2; 32,2],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_IP.gasIn, Ec2_HP.gasOut) annotation (points=[16,2; -16,2],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_IP.waterIn, Ev_IP_In) annotation (points=[24,10; 24,74; 38,
              74; 38,100], style(thickness=2));
        connect(Ev_IP.waterOut, Ev_IP_Out) annotation (points=[24,-6; 24,-16;
              10,-16; 10,78; 22,78; 22,100], style(thickness=2));
        connect(Ec1HP_EcIP.waterInB, Ec_IP_In) 
                                             annotation (points=[-16,58; -16,92;
              70,92; 70,100], style(thickness=2));
        connect(Sh_IP.waterIn, Sh_IP_In) 
          annotation (points=[6,-48; 6,100], style(thickness=2));
        connect(Ec1HP_EcIP.waterOutB, Ec_IP_Out) 
                                               annotation (points=[-16,42; -16,
              32; -2,32; -2,88; 54,88; 54,100], style(thickness=2));
        connect(Ev_LP.gasIn, Ec1HP_EcIP.gasOut) 
                                              annotation (points=[30,50; -12,50],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ec2_HP.waterIn, Ec1HP_EcIP.waterOutA) 
          annotation (points=[-24,10; -24,42], style(thickness=2));
        connect(Ec2_HP.waterOut, Ec_HP_Out) annotation (points=[-24,-6; -24,-16;
              -40,-16; -40,100], style(thickness=2));
        connect(Ev_HP.waterIn, Ev_HP_In) annotation (points=[-20,-48; -20,-24;
              -56,-24; -56,100], style(thickness=2));
        connect(Sh_IP.waterOut, Sh_IP_Out) annotation (points=[6,-64; 6,-76; 40,
              -76; 40,-100], style(thickness=2));
        connect(Ev_HP.waterOut, Ev_HP_Out) annotation (points=[-20,-64; -20,-76;
              -36,-76; -36,-28; -72,-28; -72,100], style(thickness=2));
        connect(Sh_LP.gasOut, Ec1HP_EcIP.gasIn) 
                                              annotation (points=[62,2; 74,2;
              74,18; -36,18; -36,50; -28,50], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.gasOut, Sh_IP.gasIn) annotation (points=[-12,-56; -2,-56],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh_IP.gasOut, Ec2_HP.gasIn) annotation (points=[14,-56; 48,-56;
              48,-20; -50,-20; -50,2; -32,2], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh_LP_Out, Sh_LP.waterOut) annotation (points=[80,-100; 80,-26;
              54,-26; 54,-6], style(thickness=2));
        connect(Sh_HP_Out, ShHPOut_T.outlet) annotation (points=[-80,-100; -80,
              -88.8; -79.2,-88.8], style(thickness=2));
        connect(SensorsBus.T_Sh2HP_In, ShHP_RhIP.T_intermedA) annotation (
            points=[98,-40; -44,-40; -44,-41.79; -51.4,-41.79], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.T_Rh2IP_In, ShHP_RhIP.T_intermedB) annotation (
            points=[98,-40; -40,-40; -40,-45.59; -51.4,-45.59], style(
            color=84,
            rgbcolor={255,170,213},
            thickness=1));
        connect(SensorsBus.T_Sh2HP_Out, ShHPOut_T.T) annotation (points=[98,-40;
              30,-40; 30,-94; -71.2,-94; -71.2,-90.4], style(color=84, rgbcolor=
               {255,170,213}));
        connect(SensorsBus.T_Rh2IP_Out, RhIPOut_T.T) annotation (points=[98,-40;
              30,-40; 30,-80.8; -45.6,-80.8], style(color=84, rgbcolor={255,170,
                213}));
        connect(ActuatorsBus.theta_attShHP, ShHP_RhIP.theta_valveA) annotation (
           points=[98,-72; -40,-72; -40,-60.98; -51.8,-60.98], style(color=52,
              rgbcolor={213,255,170}));
        connect(ActuatorsBus.theta_attRhIP, ShHP_RhIP.theta_valveB) annotation (
           points=[98,-72; -44,-72; -44,-64.97; -51.8,-64.97], style(color=52,
              rgbcolor={213,255,170}));
        connect(Rh_IP_Out, RhIPOut_T.outlet) annotation (points=[0,-100; 0,
              -87.8; -47.2,-87.8], style(
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(Rh_IP_In, ShHP_RhIP.waterInB) annotation (points=[-40,-100; -40,
              -30; -60,-30; -60,-37.8], style(
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(ShHPOut_T.inlet, ShHP_RhIP.waterOutA) annotation (points=[-79.2,
              -79.2; -79.2,-74.6; -76,-74.6; -76,-68.2], style(thickness=2));
        connect(RhIPOut_T.inlet, ShHP_RhIP.waterOutB) annotation (points=[-56.8,
              -87.8; -56.8,-88; -60,-88; -60,-68.2], style(thickness=2));
        connect(ShHP_RhIP.waterInA, Sh_HP_In) annotation (points=[-76,-37.8;
              -76,80; -88,80; -88,100], style(thickness=2));
        connect(LiquidWaterIn, ShHP_RhIP.LiquidWaterIn) annotation (points=[-100,60;
              -88,60; -88,-20; -96,-20; -96,-60.98; -84,-60.98],          style(
              thickness=2));
        connect(ShHP_RhIP.gasIn, GasIn) annotation (points=[-84,-53; -92,-53;
              -92,1; -101,1], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.gasIn, ShHP_RhIP.gasOut) annotation (points=[-28,-56; -38,
              -56; -38,-53; -52,-53], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
      end HEG_3LRh;
      
      model HEG_3LRh_wa 
        "Heat Exchangers Group with three pressure level and reheat, without attemperation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.HEG_3LRh_wa(
                                    Ec1_HP_Tstart_G_In = Ec_IP_Tstart_G_In,
                                    Ec1_HP_Tstart_G_Out = Ec_IP_Tstart_G_Out,
                                    Rh1_IP_Tstart_G_In = Sh1_HP_Tstart_G_In,
                                    Rh1_IP_Tstart_G_Out = Sh1_HP_Tstart_G_Out,
                                    Rh2_IP_Tstart_G_In = Sh2_HP_Tstart_G_In,
                                    Rh2_IP_Tstart_G_Out = Sh2_HP_Tstart_G_Out,
                                    Rh2_IP_N_G = Sh2_HP_N_G,
                                    Rh1_IP_N_G = Sh1_HP_N_G,
                                    Rh2_IP_gasVol = Sh2_HP_gasVol,
                                    Rh1_IP_gasVol = Sh1_HP_gasVol,
                                    Ec_IP_N_G = Ec1_HP_N_G,
                                    Ec_IP_gasVol = Ec1_HP_gasVol);
        
        parameter Real rhomcm 
          "Metal heat capacity per unit volume (density by specific heat capacity) [J/m^3.K]";
        parameter SI.ThermalConductivity lambda 
          "Thermal conductivity of the metal";
        constant Real pi=Modelica.Constants.pi;
        
        replaceable Components.HE2ph Ev_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_HP_N_G,
          N_F=Ev_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ev,
          fluidNomPressure=fluidHPNomPressure_Ev,
          exchSurface_G=Ev_HP_exchSurface_G,
          exchSurface_F=Ev_HP_exchSurface_F,
          extSurfaceTub=Ev_HP_extSurfaceTub,
          gasVol=Ev_HP_gasVol,
          fluidVol=Ev_HP_fluidVol,
          metalVol=Ev_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_HP_Tstart_G_In,
          Tstart_G_Out=Ev_HP_Tstart_G_Out,
          Tstart_M_In=Ev_HP_Tstart_M_In,
          Tstart_M_Out=Ev_HP_Tstart_M_Out,
          Tstart_F_In=Ev_HP_Tstart_F_In,
          Tstart_F_Out=Ev_HP_Tstart_F_Out,
          hstart_F_In=Ev_HP_hstart_F_In,
          hstart_F_Out=Ev_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ev) 
          annotation (extent=[-8,-66; 12,-46]);
        replaceable Components.HE Ec2_HP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec2_HP_N_G,
          N_F=Ec2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec2_HP_exchSurface_G,
          exchSurface_F=Ec2_HP_exchSurface_F,
          extSurfaceTub=Ec2_HP_extSurfaceTub,
          gasVol=Ec2_HP_gasVol,
          fluidVol=Ec2_HP_fluidVol,
          metalVol=Ec2_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec2_HP_Tstart_G_In,
          Tstart_G_Out=Ec2_HP_Tstart_G_Out,
          Tstart_M_In=Ec2_HP_Tstart_M_In,
          Tstart_M_Out=Ec2_HP_Tstart_M_Out,
          Tstart_F_In=Ec2_HP_Tstart_F_In,
          Tstart_F_Out=Ec2_HP_Tstart_F_Out,
          hstart_F_In=Ec2_HP_hstart_F_In,
          hstart_F_Out=Ec2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec2_HP_N_G,
          N_F=Ec2_HP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          fluidNomFlowRate=fluidHPNomFlowRate_Ec,
          fluidNomPressure=fluidHPNomPressure_Ec,
          exchSurface_G=Ec2_HP_exchSurface_G,
          exchSurface_F=Ec2_HP_exchSurface_F,
          extSurfaceTub=Ec2_HP_extSurfaceTub,
          gasVol=Ec2_HP_gasVol,
          fluidVol=Ec2_HP_fluidVol,
          metalVol=Ec2_HP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec2_HP_Tstart_G_In,
          Tstart_G_Out=Ec2_HP_Tstart_G_Out,
          Tstart_M_In=Ec2_HP_Tstart_M_In,
          Tstart_M_Out=Ec2_HP_Tstart_M_Out,
          Tstart_F_In=Ec2_HP_Tstart_F_In,
          Tstart_F_Out=Ec2_HP_Tstart_F_Out,
          hstart_F_In=Ec2_HP_hstart_F_In,
          hstart_F_Out=Ec2_HP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          use_T=use_T_Ec)          annotation (extent=[-34,-2; -14,18]);
        replaceable Components.ParHE Ec1HP_EcIP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec1_HP_N_G,
          N_F_A=Ec1_HP_N_F,
          N_F_B=Ec_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G_A=Ec1_HP_exchSurface_G,
          exchSurface_G_B=Ec_IP_exchSurface_G,
          exchSurface_F_A=Ec1_HP_exchSurface_F,
          exchSurface_F_B=Ec_IP_exchSurface_F,
          gasVol=Ec1_HP_gasVol,
          fluidVol_A=Ec1_HP_fluidVol,
          fluidVol_B=Ec_IP_fluidVol,
          metalVol_A=Ec1_HP_metalVol,
          metalVol_B=Ec_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec1_HP_Tstart_G_In,
          Tstart_G_Out=Ec1_HP_Tstart_G_Out,
          Tstart_M_A_In=Ec1_HP_Tstart_M_In,
          Tstart_M_A_Out=Ec1_HP_Tstart_M_Out,
          Tstart_F_A_In=Ec1_HP_Tstart_F_In,
          Tstart_F_A_Out=Ec1_HP_Tstart_F_Out,
          hstart_F_A_In=Ec1_HP_hstart_F_In,
          hstart_F_A_Out=Ec1_HP_hstart_F_Out,
          Tstart_M_B_In=Ec_IP_Tstart_M_In,
          Tstart_M_B_Out=Ec_IP_Tstart_M_Out,
          Tstart_F_B_In=Ec_IP_Tstart_F_In,
          Tstart_F_B_Out=Ec_IP_Tstart_F_Out,
          hstart_F_B_In=Ec_IP_hstart_F_In,
          hstart_F_B_Out=Ec_IP_hstart_F_Out,
          lambda=lambda,
          extSurfaceTub_A=Ec1_HP_extSurfaceTub,
          extSurfaceTub_B=Ec_IP_extSurfaceTub,
          use_T=use_T_Ec,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Ec,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Ec,
          fluidNomPressure_A=fluidHPNomPressure_Ec,
          fluidNomPressure_B=fluidIPNomPressure_Ec,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec1_HP_N_G,
          N_F_A=Ec1_HP_N_F,
          N_F_B=Ec_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G_A=Ec1_HP_exchSurface_G,
          exchSurface_G_B=Ec_IP_exchSurface_G,
          exchSurface_F_A=Ec1_HP_exchSurface_F,
          exchSurface_F_B=Ec_IP_exchSurface_F,
          gasVol=Ec1_HP_gasVol,
          fluidVol_A=Ec1_HP_fluidVol,
          fluidVol_B=Ec_IP_fluidVol,
          metalVol_A=Ec1_HP_metalVol,
          metalVol_B=Ec_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec1_HP_Tstart_G_In,
          Tstart_G_Out=Ec1_HP_Tstart_G_Out,
          Tstart_M_A_In=Ec1_HP_Tstart_M_In,
          Tstart_M_A_Out=Ec1_HP_Tstart_M_Out,
          Tstart_F_A_In=Ec1_HP_Tstart_F_In,
          Tstart_F_A_Out=Ec1_HP_Tstart_F_Out,
          hstart_F_A_In=Ec1_HP_hstart_F_In,
          hstart_F_A_Out=Ec1_HP_hstart_F_Out,
          Tstart_M_B_In=Ec_IP_Tstart_M_In,
          Tstart_M_B_Out=Ec_IP_Tstart_M_Out,
          Tstart_F_B_In=Ec_IP_Tstart_F_In,
          Tstart_F_B_Out=Ec_IP_Tstart_F_Out,
          hstart_F_B_In=Ec_IP_hstart_F_In,
          hstart_F_B_Out=Ec_IP_hstart_F_Out,
          lambda=lambda,
          extSurfaceTub_A=Ec1_HP_extSurfaceTub,
          extSurfaceTub_B=Ec_IP_extSurfaceTub,
          use_T=use_T_Ec,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Ec,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Ec,
          fluidNomPressure_A=fluidHPNomPressure_Ec,
          fluidNomPressure_B=fluidIPNomPressure_Ec,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         annotation (extent=[-30,40; -10,60]);
        replaceable Components.HE2ph Ev_IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_IP_N_G,
          N_F=Ev_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ev_IP_exchSurface_G,
          exchSurface_F=Ev_IP_exchSurface_F,
          gasVol=Ev_IP_gasVol,
          fluidVol=Ev_IP_fluidVol,
          metalVol=Ev_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_IP_Tstart_G_In,
          Tstart_G_Out=Ev_IP_Tstart_G_Out,
          Tstart_M_In=Ev_IP_Tstart_M_In,
          Tstart_M_Out=Ev_IP_Tstart_M_Out,
          Tstart_F_In=Ev_IP_Tstart_F_In,
          Tstart_F_Out=Ev_IP_Tstart_F_Out,
          hstart_F_In=Ev_IP_hstart_F_In,
          hstart_F_Out=Ev_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ev_IP_extSurfaceTub,
          use_T=use_T_Ev,
          fluidNomFlowRate=fluidIPNomFlowRate_Ev,
          fluidNomPressure=fluidIPNomPressure_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_IP_N_G,
          N_F=Ev_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ev_IP_exchSurface_G,
          exchSurface_F=Ev_IP_exchSurface_F,
          gasVol=Ev_IP_gasVol,
          fluidVol=Ev_IP_fluidVol,
          metalVol=Ev_IP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_IP_Tstart_G_In,
          Tstart_G_Out=Ev_IP_Tstart_G_Out,
          Tstart_M_In=Ev_IP_Tstart_M_In,
          Tstart_M_Out=Ev_IP_Tstart_M_Out,
          Tstart_F_In=Ev_IP_Tstart_F_In,
          Tstart_F_Out=Ev_IP_Tstart_F_Out,
          hstart_F_In=Ev_IP_hstart_F_In,
          hstart_F_Out=Ev_IP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ev_IP_extSurfaceTub,
          use_T=use_T_Ev,
          fluidNomFlowRate=fluidIPNomFlowRate_Ev,
          fluidNomPressure=fluidIPNomPressure_Ev) 
          annotation (extent=[12,-2; 32,18]);
        replaceable Components.HE Sh_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          use_T=use_T_Sh,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          fluidNomPressure=fluidLPNomPressure_Sh) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_LP_N_G,
          N_F=Sh_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Sh_LP_exchSurface_G,
          exchSurface_F=Sh_LP_exchSurface_F,
          gasVol=Sh_LP_gasVol,
          fluidVol=Sh_LP_fluidVol,
          metalVol=Sh_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Sh_LP_Tstart_G_In,
          Tstart_G_Out=Sh_LP_Tstart_G_Out,
          Tstart_M_In=Sh_LP_Tstart_M_In,
          Tstart_M_Out=Sh_LP_Tstart_M_Out,
          Tstart_F_In=Sh_LP_Tstart_F_In,
          Tstart_F_Out=Sh_LP_Tstart_F_Out,
          hstart_F_In=Sh_LP_hstart_F_In,
          hstart_F_Out=Sh_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Sh_LP_extSurfaceTub,
          use_T=use_T_Sh,
          fluidNomFlowRate=fluidLPNomFlowRate_Sh,
          fluidNomPressure=fluidLPNomPressure_Sh) 
                                   annotation (extent=[48,-2; 68,18]);
        replaceable Components.HE2ph Ev_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          use_T=use_T_Ev,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          fluidNomPressure=fluidLPNomPressure_Ev) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ev_LP_N_G,
          N_F=Ev_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ev_LP_exchSurface_G,
          exchSurface_F=Ev_LP_exchSurface_F,
          gasVol=Ev_LP_gasVol,
          fluidVol=Ev_LP_fluidVol,
          metalVol=Ev_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ev_LP_Tstart_G_In,
          Tstart_G_Out=Ev_LP_Tstart_G_Out,
          Tstart_M_In=Ev_LP_Tstart_M_In,
          Tstart_M_Out=Ev_LP_Tstart_M_Out,
          Tstart_F_In=Ev_LP_Tstart_F_In,
          Tstart_F_Out=Ev_LP_Tstart_F_Out,
          hstart_F_In=Ev_LP_hstart_F_In,
          hstart_F_Out=Ev_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ev_LP_extSurfaceTub,
          use_T=use_T_Ev,
          fluidNomFlowRate=fluidLPNomFlowRate_Ev,
          fluidNomPressure=fluidLPNomPressure_Ev) 
                         annotation (extent=[26,60; 46,40]);
        replaceable Components.HE Ec_LP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          use_T=use_T_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          fluidNomPressure=fluidLPNomPressure_Ec) 
                         extends Interfaces.HeatExchanger(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Ec_LP_N_G,
          N_F=Ec_LP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Ec_LP_exchSurface_G,
          exchSurface_F=Ec_LP_exchSurface_F,
          gasVol=Ec_LP_gasVol,
          fluidVol=Ec_LP_fluidVol,
          metalVol=Ec_LP_metalVol,
          SSInit=SSInit,
          Tstart_G_In=Ec_LP_Tstart_G_In,
          Tstart_G_Out=Ec_LP_Tstart_G_Out,
          Tstart_M_In=Ec_LP_Tstart_M_In,
          Tstart_M_Out=Ec_LP_Tstart_M_Out,
          Tstart_F_In=Ec_LP_Tstart_F_In,
          Tstart_F_Out=Ec_LP_Tstart_F_Out,
          hstart_F_In=Ec_LP_hstart_F_In,
          hstart_F_Out=Ec_LP_hstart_F_Out,
          rhomcm=rhomcm,
          lambda=lambda,
          extSurfaceTub=Ec_LP_extSurfaceTub,
          use_T=use_T_Ec,
          fluidNomFlowRate=fluidLPNomFlowRate_Ec,
          fluidNomPressure=fluidLPNomPressure_Ec) 
                                         annotation (extent=[62,60; 82,40]);
        annotation (Diagram, Icon,
          DymolaStoredErrors);
        replaceable Components.ParHE Sh1HP_Rh1IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          SSInit=SSInit,
          lambda=lambda,
          N_G=Sh1_HP_N_G,
          N_F_A=Sh1_HP_N_F,
          N_F_B=Rh1_IP_N_F,
          exchSurface_G_A=Sh1_HP_exchSurface_G,
          exchSurface_G_B=Rh1_IP_exchSurface_G,
          exchSurface_F_A=Sh1_HP_exchSurface_F,
          exchSurface_F_B=Rh1_IP_exchSurface_F,
          extSurfaceTub_A=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B=Rh1_IP_extSurfaceTub,
          gasVol=Sh1_HP_gasVol,
          fluidVol_A=Sh1_HP_fluidVol,
          fluidVol_B=Rh1_IP_fluidVol,
          metalVol_A=Sh1_HP_metalVol,
          metalVol_B=Rh1_IP_metalVol,
          use_T=use_T_Sh,
          Tstart_G_In=Sh1_HP_Tstart_G_In,
          Tstart_G_Out=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In=Sh1_HP_hstart_F_In,
          hstart_F_A_Out=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In=Rh1_IP_hstart_F_In,
          hstart_F_B_Out=Rh1_IP_hstart_F_Out,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          SSInit=SSInit,
          lambda=lambda,
          N_G=Sh1_HP_N_G,
          N_F_A=Sh1_HP_N_F,
          N_F_B=Rh1_IP_N_F,
          exchSurface_G_A=Sh1_HP_exchSurface_G,
          exchSurface_G_B=Rh1_IP_exchSurface_G,
          exchSurface_F_A=Sh1_HP_exchSurface_F,
          exchSurface_F_B=Rh1_IP_exchSurface_F,
          extSurfaceTub_A=Sh1_HP_extSurfaceTub,
          extSurfaceTub_B=Rh1_IP_extSurfaceTub,
          gasVol=Sh1_HP_gasVol,
          fluidVol_A=Sh1_HP_fluidVol,
          fluidVol_B=Rh1_IP_fluidVol,
          metalVol_A=Sh1_HP_metalVol,
          metalVol_B=Rh1_IP_metalVol,
          use_T=use_T_Sh,
          Tstart_G_In=Sh1_HP_Tstart_G_In,
          Tstart_G_Out=Sh1_HP_Tstart_G_Out,
          Tstart_M_A_In=Sh1_HP_Tstart_M_In,
          Tstart_M_A_Out=Sh1_HP_Tstart_M_Out,
          Tstart_F_A_In=Sh1_HP_Tstart_F_In,
          Tstart_F_A_Out=Sh1_HP_Tstart_F_Out,
          hstart_F_A_In=Sh1_HP_hstart_F_In,
          hstart_F_A_Out=Sh1_HP_hstart_F_Out,
          Tstart_M_B_In=Rh1_IP_Tstart_M_In,
          Tstart_M_B_Out=Rh1_IP_Tstart_M_Out,
          Tstart_F_B_In=Rh1_IP_Tstart_F_In,
          Tstart_F_B_Out=Rh1_IP_Tstart_F_Out,
          hstart_F_B_In=Rh1_IP_hstart_F_In,
          hstart_F_B_Out=Rh1_IP_hstart_F_Out,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         annotation (extent=[-46,-66; -26,-46]);
        replaceable Components.ParHE Sh2HP_Rh2IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          SSInit=SSInit,
          lambda=lambda,
          use_T=use_T_Ec,
          N_G=Sh2_HP_N_G,
          N_F_A=Sh2_HP_N_F,
          N_F_B=Rh2_IP_N_F,
          exchSurface_G_A=Sh2_HP_exchSurface_G,
          exchSurface_G_B=Rh2_IP_exchSurface_G,
          exchSurface_F_A=Sh2_HP_exchSurface_F,
          exchSurface_F_B=Rh2_IP_exchSurface_F,
          extSurfaceTub_A=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B=Rh2_IP_extSurfaceTub,
          gasVol=Sh2_HP_gasVol,
          fluidVol_A=Sh2_HP_fluidVol,
          fluidVol_B=Rh2_IP_fluidVol,
          metalVol_A=Sh2_HP_metalVol,
          Tstart_G_In=Sh2_HP_Tstart_G_In,
          Tstart_G_Out=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In=Sh2_HP_hstart_F_In,
          hstart_F_A_Out=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In=Rh2_IP_hstart_F_In,
          hstart_F_B_Out=Rh2_IP_hstart_F_Out,
          metalVol_B=Rh2_IP_metalVol,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         extends 
          ThermoPower.PowerPlants.HRSG.Interfaces.ParallelHE(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          gasNomFlowRate=gasNomFlowRate,
          gasNomPressure=gasNomPressure,
          SSInit=SSInit,
          lambda=lambda,
          use_T=use_T_Ec,
          N_G=Sh2_HP_N_G,
          N_F_A=Sh2_HP_N_F,
          N_F_B=Rh2_IP_N_F,
          exchSurface_G_A=Sh2_HP_exchSurface_G,
          exchSurface_G_B=Rh2_IP_exchSurface_G,
          exchSurface_F_A=Sh2_HP_exchSurface_F,
          exchSurface_F_B=Rh2_IP_exchSurface_F,
          extSurfaceTub_A=Sh2_HP_extSurfaceTub,
          extSurfaceTub_B=Rh2_IP_extSurfaceTub,
          gasVol=Sh2_HP_gasVol,
          fluidVol_A=Sh2_HP_fluidVol,
          fluidVol_B=Rh2_IP_fluidVol,
          metalVol_A=Sh2_HP_metalVol,
          Tstart_G_In=Sh2_HP_Tstart_G_In,
          Tstart_G_Out=Sh2_HP_Tstart_G_Out,
          Tstart_M_A_In=Sh2_HP_Tstart_M_In,
          Tstart_M_A_Out=Sh2_HP_Tstart_M_Out,
          Tstart_F_A_In=Sh2_HP_Tstart_F_In,
          Tstart_F_A_Out=Sh2_HP_Tstart_F_Out,
          hstart_F_A_In=Sh2_HP_hstart_F_In,
          hstart_F_A_Out=Sh2_HP_hstart_F_Out,
          Tstart_M_B_In=Rh2_IP_Tstart_M_In,
          Tstart_M_B_Out=Rh2_IP_Tstart_M_Out,
          Tstart_F_B_In=Rh2_IP_Tstart_F_In,
          Tstart_F_B_Out=Rh2_IP_Tstart_F_Out,
          hstart_F_B_In=Rh2_IP_hstart_F_In,
          hstart_F_B_Out=Rh2_IP_hstart_F_Out,
          metalVol_B=Rh2_IP_metalVol,
          fluidNomFlowRate_A=fluidHPNomFlowRate_Sh,
          fluidNomFlowRate_B=fluidIPNomFlowRate_Rh,
          fluidNomPressure_A=fluidHPNomPressure_Sh,
          fluidNomPressure_B=fluidIPNomPressure_Rh,
          rhomcm_A=rhomcm,
          rhomcm_B=rhomcm) 
                         annotation (extent=[-86,-66; -66,-46]);
        replaceable Components.HE Sh_IP(
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          N_G=Sh_IP_N_G,
          N_F=Sh_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidIPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          exchSurface_G=Sh_IP_exchSurface_G,
          exchSurface_F=Sh_IP_exchSurface_F,
          extSurfaceTub=Sh_IP_extSurfaceTub,
          gasVol=Sh_IP_gasVol,
          fluidVol=Sh_IP_fluidVol,
          metalVol=Sh_IP_metalVol,
          rhomcm=rhomcm,
          use_T=use_T_Sh,
          SSInit=SSInit,
          Tstart_G_In=Sh_IP_Tstart_G_In,
          Tstart_G_Out=Sh_IP_Tstart_G_Out,
          Tstart_M_In=Sh_IP_Tstart_M_In,
          Tstart_M_Out=Sh_IP_Tstart_M_Out,
          Tstart_F_In=Sh_IP_Tstart_F_In,
          Tstart_F_Out=Sh_IP_Tstart_F_Out,
          hstart_F_In=Sh_IP_hstart_F_In,
          hstart_F_Out=Sh_IP_hstart_F_Out,
          fluidNomPressure=fluidIPNomPressure_Sh,
          lambda=lambda)                   extends Interfaces.HeatExchanger(    N_G=Sh_IP_N_G,
          N_F=Sh_IP_N_F,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate=fluidIPNomFlowRate_Sh,
          gasNomPressure=gasNomPressure,
          fluidNomPressure=fluidNomPressure_Sh,
          exchSurface_G=Sh_IP_exchSurface_G,
          exchSurface_F=Sh_IP_exchSurface_F,
          extSurfaceTub=Sh_IP_extSurfaceTub,
          gasVol=Sh_IP_gasVol,
          fluidVol=Sh_IP_fluidVol,
          metalVol=Sh_IP_metalVol,
          rhomcm=rhomcm,
          lambda=lamba,
          use_T=use_T_Sh,
          SSInit=SSInit,
          Tstart_G_In=Sh_IP_Tstart_G_In,
          Tstart_G_Out=Sh_IP_Tstart_G_Out,
          Tstart_M_In=Sh_IP_Tstart_M_In,
          Tstart_M_Out=Sh_IP_Tstart_M_Out,
          Tstart_F_In=Sh_IP_Tstart_F_In,
          Tstart_F_Out=Sh_IP_Tstart_F_Out,
          hstart_F_In=Sh_IP_hstart_F_In,
          hstart_F_Out=Sh_IP_hstart_F_Out) annotation (extent=[30,-66; 50,-46]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_ShLP_Ec1HP(                         redeclare package Medium
            = FlueGasMedium) annotation (extent=[-54,44; -42,56]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_EvIP_ShLP(                         redeclare package Medium 
            = FlueGasMedium) annotation (extent=[34,2; 46,14]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_Ec2HP_EvIP(                         redeclare package Medium
            = FlueGasMedium) annotation (extent=[-8,2; 4,14]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_ShIP_Ec2HP(                         redeclare package Medium
            = FlueGasMedium) annotation (extent=[-54,2; -42,14]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_Ec1HP_EvLP(                         redeclare package Medium
            = FlueGasMedium) annotation (extent=[10,44; 22,56]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_EvLP_EcLP(                         redeclare package Medium 
            = FlueGasMedium) annotation (extent=[48,44; 60,56]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_EvHP_ShIP(                         redeclare package Medium 
            = FlueGasMedium) annotation (extent=[14,-62; 26,-50]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_Sh1HP_EvHP(                         redeclare package Medium
            = FlueGasMedium) annotation (extent=[-24,-62; -12,-50]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas 
          stateGas_Sh2HP_Sh1HP(                         redeclare package 
            Medium = FlueGasMedium) annotation (extent=[-62,-62; -50,-50]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateEc1HP_out(                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-30,20; -18,32], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateRh1IP_out(                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-52,-86; -40,-74], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateSh1HP_out(                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-78,-42; -66,-30], rotation=180);
      equation 
        connect(Ec_LP.waterOut, Ec_LP_Out) annotation (points=[72,58; 72,66; 86,
              66; 86,38; 100,38], style(thickness=2));
        connect(Ec_LP_In, Ec_LP.waterIn) 
          annotation (points=[100,22; 72,22; 72,42], style(thickness=2));
        connect(Ev_LP.waterOut, Ev_LP_Out) 
          annotation (points=[36,58; 36,70; 100,70], style(thickness=2));
        connect(Ev_LP.waterIn, Ev_LP_In) annotation (points=[36,42; 36,34; 90,
              34; 90,54; 100,54], style(thickness=2));
        connect(Ec1HP_EcIP.waterInA, Ec_HP_In) 
          annotation (points=[-24,58; -24,100], style(thickness=2));
        connect(Sh_LP.waterIn, Sh_LP_In) 
          annotation (points=[58,16; 58,86; 100,86], style(thickness=2));
        connect(Ev_IP.waterIn, Ev_IP_In) annotation (points=[22,16; 22,74; 38,
              74; 38,100], style(thickness=2));
        connect(Ev_IP.waterOut, Ev_IP_Out) annotation (points=[22,0; 22,-8; 10,
              -8; 10,84; 22,84; 22,100],     style(thickness=2));
        connect(Ec1HP_EcIP.waterInB, Ec_IP_In) 
                                             annotation (points=[-16,58; -16,92;
              70,92; 70,100], style(thickness=2));
        connect(Ec1HP_EcIP.waterOutB, Ec_IP_Out) 
                                               annotation (points=[-16,42; -16,
              32; -2,32; -2,88; 54,88; 54,100], style(thickness=2));
        connect(Ec2_HP.waterOut, Ec_HP_Out) annotation (points=[-24,0; -24,-8;
              -40,-8; -40,100],  style(thickness=2));
        connect(Ev_HP.waterIn, Ev_HP_In) annotation (points=[2,-48; 2,-18; -56,
              -18; -56,100],     style(thickness=2));
        connect(Ev_HP.waterOut, Ev_HP_Out) annotation (points=[2,-64; 2,-78;
              -10,-78; -10,-24; -72,-24; -72,100], style(thickness=2));
        connect(Sh_LP_Out, Sh_LP.waterOut) annotation (points=[80,-100; 80,-8;
              58,-8; 58,0],   style(thickness=2));
        connect(Rh_IP_In, Sh1HP_Rh1IP.waterInB) annotation (points=[-40,-100;
              -40,-84; -24,-84; -24,-42; -32,-42; -32,-48],
                                                          style(thickness=2));
        connect(Sh1HP_Rh1IP.waterInA, Sh_HP_In) annotation (points=[-40,-48;
              -40,-29.7; -88,-29.7; -88,100],   style(thickness=2));
        connect(Sh2HP_Rh2IP.gasIn, GasIn) annotation (points=[-84,-56; -92,-56;
              -92,1; -101,1],      style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh2HP_Rh2IP.waterOutA, Sh_HP_Out) annotation (points=[-80,-64;
              -80,-100],                     style(thickness=2));
        connect(Rh_IP_Out, Sh2HP_Rh2IP.waterOutB) annotation (points=[0,-100; 0,
              -90; -72,-90; -72,-64],       style(thickness=2));
        connect(Sh_IP.waterIn, Sh_IP_In) 
          annotation (points=[40,-48; 40,-18; 6,-18; 6,100],
                                             style(thickness=2));
        connect(Sh_IP.waterOut, Sh_IP_Out) annotation (points=[40,-64; 40,-100],
                             style(thickness=2));
        connect(GasOut, Ec_LP.gasOut) annotation (points=[101,1; 84,1; 84,50;
              80,50], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_ShLP_Ec1HP.outlet, Ec1HP_EcIP.gasIn) annotation (
            points=[-44.4,50; -28,50],                     style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_ShLP_Ec1HP.inlet, Sh_LP.gasOut) annotation (points=[-51.6,50;
              -62,50; -62,26; 74,26; 74,8; 66,8],           style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_EvIP_ShLP.outlet, Sh_LP.gasIn) annotation (points=[43.6,8;
              50,8],                             style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_EvIP_ShLP.inlet, Ev_IP.gasOut) annotation (points=[36.4,8;
              30,8],                   style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ec_LP.gasIn,stateGas_EvLP_EcLP. outlet) annotation (points=[64,50;
              57.6,50],            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_LP.gasOut,stateGas_EvLP_EcLP. inlet) annotation (points=[44,50;
              50.4,50],            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Ec1HP_EvLP.outlet, Ev_LP.gasIn) annotation (points=[19.6,50;
              28,50],                            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Ec1HP_EvLP.inlet, Ec1HP_EcIP.gasOut) annotation (
            points=[12.4,50; -12,50],                  style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Ec2HP_EvIP.inlet, Ec2_HP.gasOut) annotation (points=[-5.6,8;
              -16,8],                           style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Ec2HP_EvIP.outlet, Ev_IP.gasIn) annotation (points=[1.6,8;
              14,8],                      style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ec2_HP.gasIn,stateGas_ShIP_Ec2HP. outlet) annotation (points=[-32,8;
              -44.4,8],                      style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_ShIP_Ec2HP.inlet, Sh_IP.gasOut) annotation (points=[-51.6,8;
              -62,8; -62,-12; 72,-12; 72,-56; 48,-56],          style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Sh_IP.gasIn,stateGas_EvHP_ShIP. outlet) annotation (points=[32,-56;
              23.6,-56],                style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ev_HP.gasOut,stateGas_EvHP_ShIP. inlet) annotation (points=[10,-56;
              16.4,-56],                         style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Sh1HP_EvHP.outlet, Ev_HP.gasIn) annotation (points=[-14.4,
              -56; -6,-56],                              style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Sh1HP_EvHP.inlet, Sh1HP_Rh1IP.gasOut) annotation (
            points=[-21.6,-56; -28,-56],              style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(Ec2_HP.waterIn, stateEc1HP_out.outlet) 
          annotation (points=[-24,16; -24,22.4], style(thickness=2));
        connect(stateEc1HP_out.inlet, Ec1HP_EcIP.waterOutA) 
          annotation (points=[-24,29.6; -24,42], style(thickness=2));
        connect(stateGas_Sh2HP_Sh1HP.outlet, Sh1HP_Rh1IP.gasIn) annotation (
            points=[-52.4,-56; -44,-56], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_Sh2HP_Sh1HP.inlet, Sh2HP_Rh2IP.gasOut) annotation (
            points=[-59.6,-56; -68,-56], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateRh1IP_out.inlet, Sh1HP_Rh1IP.waterOutB) annotation (points=
             [-42.4,-80; -32,-80; -32,-64], style(thickness=2));
        connect(stateRh1IP_out.outlet, Sh2HP_Rh2IP.waterInB) annotation (points=
             [-49.6,-80; -62,-80; -62,-40; -72,-40; -72,-48], style(thickness=2));
        connect(Sh2HP_Rh2IP.waterInA, stateSh1HP_out.outlet) annotation (points=
             [-80,-48; -80,-36; -75.6,-36], style(thickness=2));
        connect(stateSh1HP_out.inlet, Sh1HP_Rh1IP.waterOutA) annotation (points=
             [-68.4,-36; -50,-36; -50,-74; -40,-74; -40,-64], style(thickness=2));
      end HEG_3LRh_wa;
      
      model DG_2L_NC "Drums Group with two pressure level, natural circulation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_2L;
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-34,-20; -74,20]);
        annotation (Diagram);
        Components.DrumSensors LPd(
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                         annotation (extent=[58,0; 18,40]);
        Water.ThroughW feedPumpAtt(redeclare package Medium = FluidMedium) 
          "Feed pump for attemperation" 
                                annotation (extent=[-58,40; -78,60]);
        Water.ThroughW feedPumpLP(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[70,-12; 90,-36],
                                                                    rotation=90);
        Water.FlowSplit flowSplit(redeclare package Medium = FluidMedium) 
          annotation (extent=[32,-46; 52,-26], rotation=270);
        Water.FlowSplit flowSplit1(redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-60; 14,-40], rotation=180);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-6,-84; -26,-60], rotation=
              270);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-100,-8; -80,-28], rotation=90);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-6; 14,-26], rotation=90);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium) 
          annotation (extent=[-60,-40; -50,-30],
                                            rotation=270);
        Water.SinkW sinkW1(
                          redeclare package Medium = FluidMedium) 
          annotation (extent=[34,-22; 44,-12],
                                            rotation=270);
      equation 
        connect(HPd.downcomer, ToRiser_HP) 
          annotation (points=[-40,-14; -40,-72; -48,-72; -48,-100], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(HPd.feedwater, Feed_HP) 
          annotation (points=[-34.6,-3; -34.6,-80; -32,-80; -32,-100], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(LPd.riser, FromRiser_LP) 
          annotation (points=[22.4,8.6; 22.4,-68.7; 32,-68.7; 32,-100], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(LPd.feedwater, Feed_LP) 
          annotation (points=[57.4,17; 57.4,16; 64,16; 64,-100],   style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(HPd.riser, FromRiser_HP) 
          annotation (points=[-69.6,-11.4; -69.6,-65.7; -64,-65.7; -64,-100],
            style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(feedPumpAtt.outlet, LiquidWaterOut) 
          annotation (points=[-78,50; -100,50], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(feedPumpLP.inlet, WaterIn) 
          annotation (points=[80,-12; 80,50; 100,50], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(feedPumpLP.outlet, WaterForLP) 
          annotation (points=[80,-36; 80,-100], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(flowSplit.out1, ToRiser_LP) 
          annotation (points=[46.2,-42; 48,-42; 48,-100], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(flowSplit1.in1, flowSplit.out2) annotation (points=[10,-50; 38,
              -50; 38,-42], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(flowSplit1.out2, feedPumpAtt.inlet) 
                                                 annotation (points=[-2,-46;
              -16,-46; -16,50; -58,50], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit1.out1) 
                                                  annotation (points=[-16,-60;
              -16,-54.2; -2,-54.2], style(thickness=2));
        connect(feedPumpHP.outlet, WaterForHP) 
                                              annotation (points=[-16,-84; -16,
              -92; -16,-92; -16,-100],  style(thickness=2));
        connect(flowSplit.in1, LPd.downcomer)   annotation (points=[42,-30; 42,
              -16; 52,-16; 52,6], style(thickness=2));
        connect(steamHP_w.inlet, HPd.steam) 
          annotation (points=[-86,-12; -86,14; -65.6,14], style(thickness=2));
        connect(steamHP_w.outlet, Steam_HP_Out) annotation (points=[-86,-24;
              -86,-68; -80,-68; -80,-100], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) 
          annotation (points=[8,-10; 8,34; 26.4,34], style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) annotation (points=[8,-22; 8,
              -36; 16,-36; 16,-100], style(thickness=2));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              58,-40; 58,-60; 28,-60; 28,-40; -96,-40; -96,-26], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              58,-40; 58,-60; 28,-60; 28,-40; -2,-40; -2,-24], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 58,
              -40; 58,-60; 28,-60; 28,-40; -26,-40; -26,14.8; -46.8,14.8], style(
              color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,34.8; 45.2,34.8], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 58,
              -40; 58,-60; 28,-60; 28,-40; -26,-40; -26,8; -40.4,8],   style(
              color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,28; 51.6,28], style(color=84, rgbcolor={255,170,213}));
        connect(sinkW.flange, HPd.blowdown) annotation (points=[-55,-30; -54,
              -30; -54,-19.6], style(thickness=2));
        connect(sinkW1.flange, LPd.blowdown) 
          annotation (points=[39,-12; 38,-12; 38,0.4], style(thickness=2));
        connect(ActuatorsBus.flowRate_attemp, feedPumpAtt.in_w0) annotation (
            points=[98,-72; -8,-72; -8,66; -64,66; -64,56], style(color=52,
              rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; -8,-72; -8,-50; -28,-50; -28,-67.2; -22,-67.2],
            style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedLP, feedPumpLP.in_w0) annotation (
            points=[98,-72; 60,-72; 60,-19.2; 74,-19.2],
                                                     style(color=52, rgbcolor={
                213,255,170}));
      end DG_2L_NC;
      
      model DG_3L_CC 
        "Drums Group with three pressure level, controlled circulation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_3L;
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-44,-36; -74,-6]);
        Components.DrumSensors IPd(
          redeclare package Medium = FluidMedium,
          rint=IPd_rint,
          rext=IPd_rext,
          L=IPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=IPd_pstart,
          hlstart=IPd_hlstart,
          hvstart=IPd_hvstart,
          Tmstart=IPd_Tmstart,
          Cm=IPd_Cm) "IP drum" 
                        annotation (extent=[50,-56; 20,-26]);
        Components.DrumSensors LPd(
          redeclare package Medium = FluidMedium,
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                        annotation (extent=[32,54; 2,84]);
        annotation (Diagram);
        Water.ThroughW feedPumpAtt(redeclare package Medium = FluidMedium) 
          "Feed pump for attemperation" 
                                annotation (extent=[-64,42; -80,58]);
        Water.FlowSplit flowSplit(redeclare package Medium = FluidMedium) 
          annotation (extent=[20,30; 36,46],   rotation=270);
        Water.FlowSplit flowSplit1(redeclare package Medium = FluidMedium) 
          annotation (extent=[-42,18; -26,34], rotation=180);
        Water.FlowSplit flowSplit2(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,-6; -22,10], rotation=270);
        Water.ThroughW feedPumpIP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[86,-66; 70,-50], rotation=
              270);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-16,-74; -32,-58], rotation=
             270);
        Water.ThroughW feedPumpLP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[82,56; 68,72], rotation=270);
        Water.ThroughW circulationPumpIP(redeclare package Medium = FluidMedium)
                                annotation (extent=[56,-80; 40,-64], rotation=
              270);
        Water.ThroughW circulationPumpHP(redeclare package Medium = FluidMedium)
                                annotation (extent=[-40,-76; -56,-60], rotation=
             270);
        Water.ThroughW circulationPumpLP(redeclare package Medium = FluidMedium)
                                annotation (extent=[56,32; 40,16], rotation=180);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-102,-46; -82,-66], rotation=90);
        Water.SensW steamIP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-44; 12,-64], rotation=90);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,60; -6,40], rotation=90);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium) 
          annotation (extent=[-64,-54; -54,-44],
                                            rotation=270);
        Water.SinkW sinkW1(
                          redeclare package Medium = FluidMedium) 
          annotation (extent=[10,30; 20,40],rotation=270);
        Water.SinkW sinkW2(
                          redeclare package Medium = FluidMedium) 
          annotation (extent=[30,-80; 40,-70],
                                            rotation=270);
      equation 
        connect(HPd.feedwater, Feed_HP)  annotation (points=[-44.45,-23.25;
              -44.45,-22.5; -40,-22.5; -40,-100], style(thickness=2));
        connect(IPd.feedwater, Feed_IP)   annotation (points=[49.55,-43.25;
              49.55,-44.5; 54,-44.5; 54,-100], style(thickness=2));
        connect(FromRiser_LP, LPd.riser) 
          annotation (points=[100,8; 5.3,8; 5.3,60.45], style(thickness=2));
        connect(flowSplit.in1, LPd.downcomer)   annotation (points=[28,42.8; 28,
              58.5; 27.5,58.5], style(thickness=2));
        connect(flowSplit1.out2, feedPumpAtt.inlet) 
                                                 annotation (points=[-38.8,29.2;
              -48,29.2; -48,50; -64,50], style(thickness=2));
        connect(feedPumpAtt.outlet, LiquidWaterOut) 
          annotation (points=[-80,50; -100,50], style(thickness=2));
        connect(flowSplit2.in1, flowSplit1.out1) annotation (points=[-30,6.8;
              -48,6.8; -48,22.64; -38.8,22.64], style(thickness=2));
        connect(WaterForHP, feedPumpHP.outlet) 
          annotation (points=[-24,-100; -24,-74], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit2.out2) 
                                                  annotation (points=[-24,-58;
              -24,-20; -33.2,-20; -33.2,-2.8], style(thickness=2));
        connect(feedPumpIP.outlet, WaterForIP) 
                                              annotation (points=[78,-66; 78,
              -100; 70,-100],         style(thickness=2));
        connect(feedPumpIP.inlet, flowSplit2.out1) 
                                                  annotation (points=[78,-50;
              78,-16; -26.64,-16; -26.64,-2.8], style(thickness=2));
        connect(circulationPumpIP.inlet, IPd.downcomer) 
                                                  annotation (points=[48,-64;
              48,-51.5; 45.5,-51.5], style(thickness=2));
        connect(circulationPumpHP.inlet, HPd.downcomer) 
                                                 annotation (points=[-48,-60;
              -48,-31.5; -48.5,-31.5], style(thickness=2));
        connect(circulationPumpLP.outlet, ToRiser_LP) 
          annotation (points=[56,24; 100,24], style(thickness=2));
        connect(feedPumpLP.inlet, WaterIn) 
          annotation (points=[75,72; 100,72], style(thickness=2));
        connect(feedPumpLP.outlet, WaterForLP) 
          annotation (points=[75,56; 100,56], style(thickness=2));
        connect(FromRiser_IP, IPd.riser)   annotation (points=[22,-100; 22,-76;
              23.3,-76; 23.3,-49.55], style(thickness=2));
        connect(FromRiser_HP, HPd.riser)  annotation (points=[-72,-100; -72,
              -29.55; -70.7,-29.55], style(thickness=2));
        connect(circulationPumpLP.inlet, flowSplit.out1) 
                                                 annotation (points=[40,24;
              31.36,24; 31.36,33.2], style(thickness=2));
        connect(flowSplit.out2, flowSplit1.in1) annotation (points=[24.8,33.2;
              24.8,26; -29.2,26], style(thickness=2));
        connect(ToRiser_IP, circulationPumpIP.outlet) 
                                              annotation (points=[38,-100; 38,
              -86; 48,-86; 48,-80], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ToRiser_HP, circulationPumpHP.outlet) 
                                              annotation (points=[-56,-100; -56,
              -86; -48,-86; -48,-76], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(steamHP_w.outlet, Steam_HP_Out) 
          annotation (points=[-88,-62; -88,-100], style(thickness=2));
        connect(steamHP_w.inlet, HPd.steam) annotation (points=[-88,-50; -88,
              -10.5; -67.7,-10.5], style(thickness=2));
        connect(steamIP_w.outlet, Steam_IP_Out) 
          annotation (points=[6,-60; 6,-100], style(thickness=2));
        connect(steamIP_w.inlet, IPd.steam) 
          annotation (points=[6,-48; 6,-30.5; 26.3,-30.5], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) annotation (points=[-12,56; -12,
              79.5; 8.3,79.5],  style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) 
          annotation (points=[-12,44; -12,-8; 100,-8], style(thickness=2));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-54; -66,-54; -66,-74; -98,-74; -98,
              -64], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamIP, steamIP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-74; -4,-74; -4,-62], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -22,-18; -22,42], style(color=84, rgbcolor={255,
                170,213}));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-9.9; -53.6,-9.9], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumIP, IPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-29.9; 40.4,-29.9], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,36; 48,36; 48,80.1; 22.4,80.1], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-15; -48.8,-15], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumIP, IPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-35; 45.2,-35], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,36; 48,36; 48,75; 27.2,75], style(color=84, rgbcolor={255,
                170,213}));
        connect(sinkW.flange, HPd.blowdown) annotation (points=[-59,-44; -60,
              -40; -60,-35.7; -59,-35.7],
                               style(thickness=2));
        connect(sinkW1.flange, LPd.blowdown) annotation (points=[15,40; 16,40;
              16,54.3; 17,54.3], style(thickness=2));
        connect(sinkW2.flange, IPd.blowdown) annotation (points=[35,-70; 36,-70;
              36,-55.7; 35,-55.7], style(thickness=2));
        connect(ActuatorsBus.flowRate_attemp, feedPumpAtt.in_w0) annotation (
            points=[98,-72; 60,-72; 60,-90; -16,-90; -16,36; -40,36; -40,68;
              -68.8,68; -68.8,54.8], style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-90; -36,-90; -36,-62.8; -28.8,-62.8],
            style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedIP, feedPumpIP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-54; 73.2,-54; 73.2,-54.8],
                                                                 style(color=52,
              rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedLP, feedPumpLP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,67.2; 70.8,67.2], style(color=52,
              rgbcolor={213,255,170}));
        connect(Feed_LP, LPd.feedwater) annotation (points=[100,40; 56,40; 56,
              66.75; 31.55,66.75], style(thickness=2));
      end DG_3L_CC;
      
      model DG_3L_CC_wa 
        "Drums Group with three pressure level, controlled circulation and without attemperation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_3L_wa;
        parameter SI.MassFlowRate RiserHPFlowRate=0 
          "Nominal mass flowrate through the riser of HP";
        parameter SI.MassFlowRate RiserIPFlowRate=0 
          "Nominal mass flowrate through the riser of IP";
        parameter SI.MassFlowRate RiserLPFlowRate=0 
          "Nominal mass flowrate through the riser of LP";
        
        //Total Feed Pump Parameter
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0_TFP 
          "Nominal rpm"                                                              annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure outletTFPNomPressure = fluidLPNomPressure 
          "Nominal live steam pressure"                                          annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure inletTFPNomPressure 
          "Nominal condensation pressure"                                         annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.MassFlowRate TFPNomFlowRate "Nominal steam mass flow rate"
                                                                                annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.SpecificEnthalpy hstart_TFP 
          "Fluid Specific Enthalpy Start Value" annotation (Dialog(group = "Total Feed Pump (TFP)"));
        
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-44,-36; -74,-6]);
        Components.DrumSensors IPd(
          redeclare package Medium = FluidMedium,
          rint=IPd_rint,
          rext=IPd_rext,
          L=IPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=IPd_pstart,
          hlstart=IPd_hlstart,
          hvstart=IPd_hvstart,
          Tmstart=IPd_Tmstart,
          Cm=IPd_Cm) "IP drum" 
                        annotation (extent=[50,-56; 20,-26]);
        Components.DrumSensors LPd(
          redeclare package Medium = FluidMedium,
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                        annotation (extent=[32,54; 2,84]);
        annotation (Diagram);
        Water.FlowSplit flowSplit(redeclare package Medium = FluidMedium) 
          annotation (extent=[20,30; 36,46],   rotation=270);
        Water.FlowSplit flowSplit2(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,-6; -22,10], rotation=270);
        Water.ThroughW feedPumpIP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[86,-66; 70,-50], rotation=
              270);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-16,-76; -32,-60], rotation=
             270);
        Water.ThroughW circulationPumpIP(redeclare package Medium = FluidMedium,
            w0=RiserIPFlowRate) annotation (extent=[56,-80; 40,-64], rotation=
              270);
        Water.ThroughW circulationPumpHP(redeclare package Medium = FluidMedium,
            w0=RiserHPFlowRate) annotation (extent=[-40,-76; -56,-60], rotation=
             270);
        Water.ThroughW circulationPumpLP(redeclare package Medium = FluidMedium,
            w0=RiserLPFlowRate) annotation (extent=[56,32; 40,16], rotation=180);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-102,-46; -82,-66], rotation=90);
        Water.SensW steamIP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-44; 12,-64], rotation=90);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,60; -6,40], rotation=90);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[-64,-54; -54,-44],
                                            rotation=270);
        Water.SinkW sinkW1(
                          redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[10,30; 20,40],rotation=270);
        Water.SinkW sinkW2(
                          redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[30,-80; 40,-70],
                                            rotation=270);
        Components.PrescribedSpeedPump prescribedSpeedPump(
          redeclare package WaterMedium = FluidMedium,
          rho_nom=1000,
          n0=n0_TFP,
          nominalSteamPressure=outletTFPNomPressure,
          nominalCondensationPressure=inletTFPNomPressure,
          nominalSteamFlow=TFPNomFlowRate,
          hstart=hstart_TFP,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0}) annotation (extent=[68,66; 88,46]);
      equation 
        connect(HPd.feedwater, Feed_HP)  annotation (points=[-44.45,-23.25;
              -44.45,-22.5; -40,-22.5; -40,-100], style(thickness=2));
        connect(IPd.feedwater, Feed_IP)   annotation (points=[49.55,-43.25;
              49.55,-44.5; 54,-44.5; 54,-100], style(thickness=2));
        connect(FromRiser_LP, LPd.riser) 
          annotation (points=[100,8; 5.3,8; 5.3,60.45], style(thickness=2));
        connect(flowSplit.in1, LPd.downcomer)   annotation (points=[28,42.8; 28,
              58.5; 27.5,58.5], style(thickness=2));
        connect(WaterForHP, feedPumpHP.outlet) 
          annotation (points=[-24,-100; -24,-76], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit2.out2) 
                                                  annotation (points=[-24,-60;
              -24,-20; -33.2,-20; -33.2,-2.8], style(thickness=2));
        connect(feedPumpIP.outlet, WaterForIP) 
                                              annotation (points=[78,-66; 78,
              -100; 70,-100],         style(thickness=2));
        connect(feedPumpIP.inlet, flowSplit2.out1) 
                                                  annotation (points=[78,-50;
              78,-16; -26.64,-16; -26.64,-2.8], style(thickness=2));
        connect(circulationPumpIP.inlet, IPd.downcomer) 
                                                  annotation (points=[48,-64;
              48,-51.5; 45.5,-51.5], style(thickness=2));
        connect(circulationPumpHP.inlet, HPd.downcomer) 
                                                 annotation (points=[-48,-60;
              -48,-31.5; -48.5,-31.5], style(thickness=2));
        connect(circulationPumpLP.outlet, ToRiser_LP) 
          annotation (points=[56,24; 100,24], style(thickness=2));
        connect(FromRiser_IP, IPd.riser)   annotation (points=[22,-100; 22,-76;
              23.3,-76; 23.3,-49.55], style(thickness=2));
        connect(FromRiser_HP, HPd.riser)  annotation (points=[-72,-100; -72,
              -29.55; -70.7,-29.55], style(thickness=2));
        connect(circulationPumpLP.inlet, flowSplit.out1) 
                                                 annotation (points=[40,24;
              31.36,24; 31.36,33.2], style(thickness=2));
        connect(ToRiser_IP, circulationPumpIP.outlet) 
                                              annotation (points=[38,-100; 38,
              -86; 48,-86; 48,-80], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ToRiser_HP, circulationPumpHP.outlet) 
                                              annotation (points=[-56,-100; -56,
              -86; -48,-86; -48,-76], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(steamHP_w.outlet, Steam_HP_Out) 
          annotation (points=[-88,-62; -88,-100], style(thickness=2));
        connect(steamHP_w.inlet, HPd.steam) annotation (points=[-88,-50; -88,
              -10.5; -67.7,-10.5], style(thickness=2));
        connect(steamIP_w.outlet, Steam_IP_Out) 
          annotation (points=[6,-60; 6,-100], style(thickness=2));
        connect(steamIP_w.inlet, IPd.steam) 
          annotation (points=[6,-48; 6,-30.5; 26.3,-30.5], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) annotation (points=[-12,56; -12,
              79.5; 8.3,79.5],  style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) 
          annotation (points=[-12,44; -12,-8; 100,-8], style(thickness=2));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-56; -66,-56; -66,-74; -98,-74; -98,
              -64], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamIP, steamIP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-74; -4,-74; -4,-62], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -22,-18; -22,42], style(color=84, rgbcolor={255,
                170,213}));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-9.9; -53.6,-9.9], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumIP, IPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-29.9; 40.4,-29.9], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,38; 48,38; 48,80.1; 22.4,80.1], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-15; -48.8,-15], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumIP, IPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-35; 45.2,-35], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,38; 48,38; 48,75; 27.2,75], style(color=84, rgbcolor={255,
                170,213}));
        connect(sinkW1.flange, LPd.blowdown) annotation (points=[15,40; 16,40;
              16,54.3; 17,54.3], style(thickness=2));
        connect(sinkW2.flange, IPd.blowdown) annotation (points=[35,-70; 36,-70;
              36,-55.7; 35,-55.7], style(thickness=2));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-90; -36,-90; -36,-64.8; -28.8,-64.8],
            style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedIP, feedPumpIP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-54; 73.2,-54; 73.2,-54.8],
                                                                 style(color=52,
              rgbcolor={213,255,170}));
        connect(flowSplit2.in1, flowSplit.out2) annotation (points=[-30,6.8;
              -30,24; 24.8,24; 24.8,33.2], style(thickness=2));
        connect(Feed_LP, LPd.feedwater) annotation (points=[100,40; 54,40; 54,
              66.75; 31.55,66.75], style(thickness=2));
        connect(sinkW.flange, HPd.blowdown) annotation (points=[-59,-44; -59,
              -44; -59,-35.7], style(thickness=2));
        connect(prescribedSpeedPump.outlet, WaterForLP) annotation (points=[88,56;
              100,56],                   style(thickness=2));
        connect(prescribedSpeedPump.inlet, WaterIn) annotation (points=[68,56;
              58,56; 58,72; 100,72], style(thickness=2));
        connect(ActuatorsBus.nPump_feedLP, prescribedSpeedPump.pumpSpeed_rpm) 
          annotation (points=[98,-72; 66,-72; 66,44; 58,44; 58,50; 67.2,50],
            style(color=52, rgbcolor={213,255,170}));
      end DG_3L_CC_wa;
      
      model DG_3L_CC_wafp "Drums Group with three pressure level, controlled circulation, without
   attemperation and without feed pump" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_3L_wa;
        parameter SI.MassFlowRate RiserHPFlowRate=0 
          "Nominal mass flowrate through the riser of HP";
        parameter SI.MassFlowRate RiserIPFlowRate=0 
          "Nominal mass flowrate through the riser of IP";
        parameter SI.MassFlowRate RiserLPFlowRate=0 
          "Nominal mass flowrate through the riser of LP";
        
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-44,-36; -74,-6]);
        Components.DrumSensors IPd(
          redeclare package Medium = FluidMedium,
          rint=IPd_rint,
          rext=IPd_rext,
          L=IPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=IPd_pstart,
          hlstart=IPd_hlstart,
          hvstart=IPd_hvstart,
          Tmstart=IPd_Tmstart,
          Cm=IPd_Cm) "IP drum" 
                        annotation (extent=[50,-56; 20,-26]);
        Components.DrumSensors LPd(
          redeclare package Medium = FluidMedium,
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                        annotation (extent=[32,54; 2,84]);
        annotation (Diagram);
        Water.FlowSplit flowSplit(redeclare package Medium = FluidMedium) 
          annotation (extent=[20,30; 36,46],   rotation=270);
        Water.FlowSplit flowSplit2(redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,-6; -22,10], rotation=270);
        Water.ThroughW feedPumpIP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[86,-66; 70,-50], rotation=
              270);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-16,-76; -32,-60], rotation=
             270);
        Water.ThroughW circulationPumpIP(redeclare package Medium = FluidMedium,
            w0=RiserIPFlowRate) annotation (extent=[56,-80; 40,-64], rotation=
              270);
        Water.ThroughW circulationPumpHP(redeclare package Medium = FluidMedium,
            w0=RiserHPFlowRate) annotation (extent=[-40,-76; -56,-60], rotation=
             270);
        Water.ThroughW circulationPumpLP(redeclare package Medium = FluidMedium,
            w0=RiserLPFlowRate) annotation (extent=[56,32; 40,16], rotation=180);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-102,-46; -82,-66], rotation=90);
        Water.SensW steamIP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-44; 12,-64], rotation=90);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,60; -6,40], rotation=90);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[-64,-54; -54,-44],
                                            rotation=270);
        Water.SinkW sinkW1(
                          redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[10,30; 20,40],rotation=270);
        Water.SinkW sinkW2(
                          redeclare package Medium = FluidMedium, w0=0) 
          annotation (extent=[30,-80; 40,-70],
                                            rotation=270);
        
      equation 
        connect(HPd.feedwater, Feed_HP)  annotation (points=[-44.45,-23.25;
              -44.45,-22.5; -40,-22.5; -40,-100], style(thickness=2));
        connect(IPd.feedwater, Feed_IP)   annotation (points=[49.55,-43.25;
              49.55,-44.5; 54,-44.5; 54,-100], style(thickness=2));
        connect(FromRiser_LP, LPd.riser) 
          annotation (points=[100,8; 5.3,8; 5.3,60.45], style(thickness=2));
        connect(flowSplit.in1, LPd.downcomer)   annotation (points=[28,42.8; 28,
              58.5; 27.5,58.5], style(thickness=2));
        connect(WaterForHP, feedPumpHP.outlet) 
          annotation (points=[-24,-100; -24,-76], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit2.out2) 
                                                  annotation (points=[-24,-60;
              -24,-20; -33.2,-20; -33.2,-2.8], style(thickness=2));
        connect(feedPumpIP.outlet, WaterForIP) 
                                              annotation (points=[78,-66; 78,
              -100; 70,-100],         style(thickness=2));
        connect(feedPumpIP.inlet, flowSplit2.out1) 
                                                  annotation (points=[78,-50;
              78,-16; -26.64,-16; -26.64,-2.8], style(thickness=2));
        connect(circulationPumpIP.inlet, IPd.downcomer) 
                                                  annotation (points=[48,-64;
              48,-51.5; 45.5,-51.5], style(thickness=2));
        connect(circulationPumpHP.inlet, HPd.downcomer) 
                                                 annotation (points=[-48,-60;
              -48,-31.5; -48.5,-31.5], style(thickness=2));
        connect(circulationPumpLP.outlet, ToRiser_LP) 
          annotation (points=[56,24; 100,24], style(thickness=2));
        connect(FromRiser_IP, IPd.riser)   annotation (points=[22,-100; 22,-76;
              23.3,-76; 23.3,-49.55], style(thickness=2));
        connect(FromRiser_HP, HPd.riser)  annotation (points=[-72,-100; -72,
              -29.55; -70.7,-29.55], style(thickness=2));
        connect(circulationPumpLP.inlet, flowSplit.out1) 
                                                 annotation (points=[40,24;
              31.36,24; 31.36,33.2], style(thickness=2));
        connect(ToRiser_IP, circulationPumpIP.outlet) 
                                              annotation (points=[38,-100; 38,
              -86; 48,-86; 48,-80], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ToRiser_HP, circulationPumpHP.outlet) 
                                              annotation (points=[-56,-100; -56,
              -86; -48,-86; -48,-76], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(steamHP_w.outlet, Steam_HP_Out) 
          annotation (points=[-88,-62; -88,-100], style(thickness=2));
        connect(steamHP_w.inlet, HPd.steam) annotation (points=[-88,-50; -88,
              -10.5; -67.7,-10.5], style(thickness=2));
        connect(steamIP_w.outlet, Steam_IP_Out) 
          annotation (points=[6,-60; 6,-100], style(thickness=2));
        connect(steamIP_w.inlet, IPd.steam) 
          annotation (points=[6,-48; 6,-30.5; 26.3,-30.5], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) annotation (points=[-12,56; -12,
              79.5; 8.3,79.5],  style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) 
          annotation (points=[-12,44; -12,-8; 100,-8], style(thickness=2));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-56; -66,-56; -66,-74; -98,-74; -98,
              -64], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamIP, steamIP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -12,-18; -12,-74; -4,-74; -4,-62], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              70,-40; 70,-18; -22,-18; -22,42], style(color=84, rgbcolor={255,
                170,213}));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-9.9; -53.6,-9.9], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumIP, IPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,-29.9; 40.4,-29.9], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 70,
              -40; 70,36; 48,36; 48,80.1; 22.4,80.1], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-18; -36,-18; -36,-15; -48.8,-15], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumIP, IPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,-35; 45.2,-35], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 70,
              -40; 70,36; 48,36; 48,75; 27.2,75], style(color=84, rgbcolor={255,
                170,213}));
        connect(sinkW1.flange, LPd.blowdown) annotation (points=[15,40; 16,40;
              16,54.3; 17,54.3], style(thickness=2));
        connect(sinkW2.flange, IPd.blowdown) annotation (points=[35,-70; 36,-70;
              36,-55.7; 35,-55.7], style(thickness=2));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-90; -36,-90; -36,-64.8; -28.8,-64.8],
            style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedIP, feedPumpIP.in_w0) annotation (
            points=[98,-72; 66,-72; 66,-54; 73.2,-54; 73.2,-54.8],
                                                                 style(color=52,
              rgbcolor={213,255,170}));
        connect(flowSplit2.in1, flowSplit.out2) annotation (points=[-30,6.8;
              -30,24; 24.8,24; 24.8,33.2], style(thickness=2));
        connect(Feed_LP, LPd.feedwater) annotation (points=[100,40; 54,40; 54,
              66.75; 31.55,66.75], style(thickness=2));
        connect(sinkW.flange, HPd.blowdown) annotation (points=[-59,-44; -59,
              -44; -59,-35.7], style(thickness=2));
        connect(WaterIn, WaterForLP) annotation (points=[100,72; 80,72; 80,56;
              100,56], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end DG_3L_CC_wafp;
      
      model DG_3L_tap_CC "Drums Group with three pressure level and
   tappings of saturated water for external heater, controlled circulation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_3L_tap;
        //Flow Rate of evaporators circulation
        parameter SI.MassFlowRate RiserHPFlowRate=0 
          "Nominal mass flowrate through the riser of HP";
        parameter SI.MassFlowRate RiserIPFlowRate=0 
          "Nominal mass flowrate through the riser of IP";
        parameter SI.MassFlowRate RiserLPFlowRate=0 
          "Nominal mass flowrate through the riser of LP";
        
        //Total Feed Pump Parameter
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0_TFP 
          "Nominal rpm"                                                              annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure outletTFPNomPressure = fluidLPNomPressure 
          "Nominal live steam pressure"                                          annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure inletTFPNomPressure 
          "Nominal condensation pressure"                                         annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.MassFlowRate TFPNomFlowRate "Nominal steam mass flow rate"
                                                                                annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.SpecificEnthalpy hstart_TFP 
          "Fluid Specific Enthalpy Start Value" annotation (Dialog(group = "Total Feed Pump (TFP)"));
        
        //mixer for external tappings 
        parameter SI.Volume mixHP_V "Internal volume of the HP steam mixer";
        parameter SI.Volume mixIP_V "Internal volume of the IP steam mixer";
        
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-48,-48; -78,-18]);
        Components.DrumSensors IPd(
          redeclare package Medium = FluidMedium,
          rint=IPd_rint,
          rext=IPd_rext,
          L=IPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=IPd_pstart,
          hlstart=IPd_hlstart,
          hvstart=IPd_hvstart,
          Tmstart=IPd_Tmstart,
          Cm=IPd_Cm) "IP drum" 
                        annotation (extent=[52,-62; 22,-32]);
        Components.DrumSensors LPd(
          redeclare package Medium = FluidMedium,
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                        annotation (extent=[26,42; -4,72]);
        Water.ThroughW feedPumpAtt(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-40,10; -56,26]);
        Water.ThroughW feedPumpIP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[88,-64; 72,-48], rotation=
              270);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-16,-60; -32,-44], rotation=
             270);
        Water.ThroughW circulationPumpIP(redeclare package Medium = FluidMedium)
                                annotation (extent=[56,-86; 40,-70], rotation=
              270);
        Water.ThroughW circulationPumpHP(redeclare package Medium = FluidMedium)
                                annotation (extent=[-40,-78; -56,-62], rotation=
             270);
        Water.ThroughW circulationPumpLP(redeclare package Medium = FluidMedium)
                                annotation (extent=[74,32; 58,16], rotation=180);
        Water.FlowSplit flowSplit2(redeclare package Medium = FluidMedium) 
          annotation (extent=[-28,-30; -14,-16],
                                               rotation=270);
        Water.FlowSplit flowSplit1(redeclare package Medium = FluidMedium) 
          annotation (extent=[34,80; 48,94],   rotation=180);
        Water.FlowSplit flowSplit3(redeclare package Medium = FluidMedium) 
          annotation (extent=[-44,-68; -30,-54],
                                               rotation=90);
        Water.FlowSplit flowSplit4(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,26; 32,42],   rotation=270);
        Water.FlowSplit flowSplit5(redeclare package Medium = FluidMedium) 
          annotation (extent=[6,8; 20,22],     rotation=180);
        Water.FlowSplit flowSplit6(redeclare package Medium = FluidMedium) 
          annotation (extent=[56,-76; 70,-62], rotation=90);
        Water.Mixer mixHP(redeclare package Medium = FluidMedium,
          pstart=HPd_pstart,
          hstart=HPd_hvstart,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixHP_V)      annotation (extent=[-96,-62; -80,-46], rotation=270);
        Water.Mixer mixIP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixIP_V,
          pstart=IPd_pstart,
          hstart=IPd_hvstart) 
                           annotation (extent=[-2,-62; 14,-46], rotation=270);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium) 
          annotation (extent=[6,24; 16,34], rotation=270);
        Water.SinkW sinkW1(redeclare package Medium = FluidMedium) 
          annotation (extent=[-68,-70; -58,-60], rotation=270);
        Water.SinkW sinkW2(redeclare package Medium = FluidMedium) 
          annotation (extent=[36,-80; 26,-70], rotation=270);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,50; -6,30], rotation=90);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-102,-68; -82,-88], rotation=90);
        Water.SensW steamIP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-68; 12,-88], rotation=90);
        annotation (Diagram);
        Components.PrescribedSpeedPump prescribedSpeedPump(
          redeclare package WaterMedium = FluidMedium,
          rho_nom=1000,
          n0=n0_TFP,
          nominalSteamPressure=outletTFPNomPressure,
          nominalCondensationPressure=inletTFPNomPressure,
          nominalSteamFlow=TFPNomFlowRate,
          hstart=hstart_TFP,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0}) annotation (extent=[78,96; 58,76]);
      equation 
        connect(feedPumpAtt.outlet, LiquidWaterOut) 
          annotation (points=[-56,18; -100,18], style(thickness=2));
        connect(feedPumpIP.outlet, WaterForIP) 
          annotation (points=[80,-64; 80,-100; 70,-100], style(thickness=2));
        connect(circulationPumpIP.inlet, IPd.downcomer) 
                                                  annotation (points=[48,-70;
              48,-57.5; 47.5,-57.5], style(thickness=2));
        connect(circulationPumpHP.outlet, ToRiser_HP) 
                                              annotation (points=[-48,-78; -48,
              -90; -56,-90; -56,-100], style(thickness=2));
        connect(FromRiser_IP, IPd.riser)   annotation (points=[22,-100; 22,-82;
              25.3,-82; 25.3,-55.55], style(thickness=2));
        connect(flowSplit1.out1, WaterForLP) annotation (points=[36.8,84.06; 26,
              84.06; 26,70; 80,70; 80,56; 100,56], style(thickness=2));
        connect(flowSplit3.in1, Feed_HP) annotation (points=[-37,-65.2; -37,
              -81.6; -40,-81.6; -40,-100], style(thickness=2));
        connect(flowSplit3.out1, HPd.feedwater)  annotation (points=[-39.94,
              -56.8; -40,-48; -40,-38; -48.45,-38; -48.45,-35.25], style(
              thickness=2));
        connect(circulationPumpHP.inlet, HPd.downcomer) 
                                                 annotation (points=[-48,-62;
              -48,-43.5; -52.5,-43.5], style(thickness=2));
        connect(WaterForHP, feedPumpHP.outlet) 
                                              annotation (points=[-24,-100; -24,
              -60],                   style(thickness=2));
        connect(circulationPumpLP.outlet, ToRiser_LP) 
          annotation (points=[74,24; 100,24], style(thickness=2));
        connect(flowSplit4.in1, LPd.downcomer)   annotation (points=[24,38.8;
              24,46.5; 21.5,46.5], style(thickness=2));
        connect(flowSplit5.out2, feedPumpAtt.inlet) 
                                                 annotation (points=[8.8,17.8;
              -39.6,17.8; -39.6,18; -40,18], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit2.out2) 
                                                  annotation (points=[-24,-44;
              -24,-27.2; -23.8,-27.2], style(thickness=2));
        connect(feedPumpIP.inlet, flowSplit2.out1) 
                                                  annotation (points=[80,-48;
              80,-28; -18.06,-28; -18.06,-27.2], style(thickness=2));
        connect(FromRiser_HP, HPd.riser)  annotation (points=[-72,-100; -72,-80;
              -74.7,-80; -74.7,-41.55], style(thickness=2));
        connect(flowSplit6.in1, Feed_IP) annotation (points=[63,-73.2; 63,-84.6;
              54,-84.6; 54,-100], style(thickness=2));
        connect(flowSplit6.out1, IPd.feedwater)   annotation (points=[60.06,
              -64.8; 60.06,-49.25; 51.55,-49.25], style(thickness=2));
        connect(LPd.riser, FromRiser_LP) 
          annotation (points=[-0.7,48.45; -0.7,8; 100,8],
                                                        style(thickness=2));
        connect(HPd.steam,mixHP. in1)  annotation (points=[-71.7,-22.5; -83.2,
              -22.5; -83.2,-47.6], style(thickness=2));
        connect(mixIP.in1, IPd.steam)    annotation (points=[10.8,-47.6; 10.8,
              -36.5; 28.3,-36.5], style(thickness=2));
        connect(flowSplit5.in1, flowSplit4.out2) annotation (points=[17.2,15;
              17.2,14.5; 20.8,14.5; 20.8,29.2], style(thickness=2));
        connect(flowSplit2.in1, flowSplit5.out1) annotation (points=[-21,-18.8;
              -21,12.06; 8.8,12.06], style(thickness=2));
        connect(flowSplit4.out1, circulationPumpLP.inlet) 
                                                  annotation (points=[27.36,
              29.2; 27.36,24; 58,24], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ToRiser_IP, circulationPumpIP.outlet) 
                                              annotation (points=[38,-100; 38,
              -90; 48,-90; 48,-86], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(sinkW.flange, LPd.blowdown) annotation (points=[11,34; 11,38.15;
              11,38.15; 11,42.3],
                               style(thickness=2));
        connect(sinkW1.flange, HPd.blowdown) 
          annotation (points=[-63,-60; -64,-54; -64,-47.7; -63,-47.7],
                                                   style(thickness=2));
        connect(sinkW2.flange, IPd.blowdown) annotation (points=[31,-70; 34,-70;
              34,-61.7; 37,-61.7], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) 
          annotation (points=[-12,46; -12,67.5; 2.3,67.5], style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) annotation (points=[-12,34; -12,
              0; 82,0; 82,-8; 100,-8], style(thickness=2));
        connect(steamHP_w.outlet, Steam_HP_Out) 
          annotation (points=[-88,-84; -88,-100], style(thickness=2));
        connect(steamHP_w.inlet, mixHP.out) 
          annotation (points=[-88,-72; -88,-62], style(thickness=2));
        connect(steamIP_w.outlet, Steam_IP_Out) 
          annotation (points=[6,-84; 6,-100], style(thickness=2));
        connect(steamIP_w.inlet, mixIP.out) 
          annotation (points=[6,-72; 6,-67; 6,-62; 6,-62], style(thickness=2));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-12; -40,-12; -40,-21.9; -57.6,-21.9], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumIP, IPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-35.9; 42.4,-35.9], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-12; 46,-12; 46,68.1; 16.4,68.1], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              74,-40; 74,-12; -80,-12; -80,-92; -98,-92; -98,-86], style(color=
                84, rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamIP, steamIP_w.w) annotation (points=[98,-40;
              74,-40; 74,-12; -14,-12; -14,-92; -4,-92; -4,-86], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              76,-40; 76,-12; -22,-12; -22,32], style(color=84, rgbcolor={255,
                170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 74,
              -40; 74,-12; -40,-12; -40,-27; -52.8,-27], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumIP, IPd.y_out) annotation (points=[98,-40; 72,
              -40; 72,-41; 47.2,-41], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 74,
              -40; 74,-12; 46,-12; 46,63; 21.2,63], style(color=84, rgbcolor={
                255,170,213}));
        connect(ActuatorsBus.flowRate_attemp, feedPumpAtt.in_w0) annotation (
            points=[98,-72; 68,-72; 68,4; -60,4; -60,28; -44.8,28; -44.8,22.8],
            style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; 68,-72; 68,4; -36,4; -36,-48.8; -28.8,-48.8], style(
              color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedIP, feedPumpIP.in_w0) annotation (
            points=[98,-72; 68,-72; 68,-52.8; 75.2,-52.8], style(color=52,
              rgbcolor={213,255,170}));
        connect(HPsteamFromExUse, mixHP.in2) annotation (points=[-84,100; -84,
              -10; -92.8,-10; -92.8,-47.68], style(thickness=2));
        connect(mixIP.in2, IPsteamFromExUse) annotation (points=[1.2,-47.68;
              1.2,-4; -64,-4; -64,100], style(thickness=2));
        connect(flowSplit3.out2, tapHPwater) annotation (points=[-34.2,-56.8;
              -34.2,86; -34,86; -34,100], style(thickness=2));
        connect(flowSplit6.out2, tapIPwater) annotation (points=[65.8,-64.8;
              65.8,-8; -26,-8; -26,80; -14,80; -14,100], style(thickness=2));
        connect(tapLPwater, flowSplit1.out2) 
          annotation (points=[6,100; 6,89.8; 36.8,89.8], style(thickness=2));
        connect(Fedd_LP, LPd.feedwater) annotation (points=[100,40; 40,40; 40,
              54.75; 25.55,54.75],
                            style(thickness=2));
        connect(ActuatorsBus.nPump_feedLP, prescribedSpeedPump.pumpSpeed_rpm) 
          annotation (points=[98,-72; 68,-72; 68,12; 84,12; 84,80; 78.8,80],
            style(color=52, rgbcolor={213,255,170}));
        connect(prescribedSpeedPump.outlet, flowSplit1.in1) annotation (points=
              [58,86; 51.6,86; 51.6,87; 45.2,87], style(thickness=2));
        connect(prescribedSpeedPump.inlet, WaterIn) annotation (points=[78,86;
              88,86; 88,72; 100,72], style(thickness=2));
      end DG_3L_tap_CC;
      
      model DG_3L_tap_CC_wa "Drums Group with three pressure level and tappings of saturated water
   for external heater, controlled circulation and without attemperation" 
        extends ThermoPower.PowerPlants.HRSG.Interfaces.DG_3L_tap_wa;
        //Flow Rate of evaporators circulation
        parameter SI.MassFlowRate RiserHPFlowRate=0 
          "Nominal mass flowrate through the riser of HP";
        parameter SI.MassFlowRate RiserIPFlowRate=0 
          "Nominal mass flowrate through the riser of IP";
        parameter SI.MassFlowRate RiserLPFlowRate=0 
          "Nominal mass flowrate through the riser of LP";
        
        //Total Feed Pump Parameter
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0_TFP 
          "Nominal rpm"                                                              annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure outletTFPNomPressure = fluidLPNomPressure 
          "Nominal live steam pressure"                                          annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.Pressure inletTFPNomPressure 
          "Nominal condensation pressure"                                         annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.MassFlowRate TFPNomFlowRate "Nominal steam mass flow rate"
                                                                                annotation (Dialog(group = "Total Feed Pump (TFP)"));
        parameter SI.SpecificEnthalpy hstart_TFP 
          "Fluid Specific Enthalpy Start Value" annotation (Dialog(group = "Total Feed Pump (TFP)"));
        
        //mixer for external tappings 
        parameter SI.Volume mixHP_V "Internal volume of the HP steam mixer";
        parameter SI.Volume mixIP_V "Internal volume of the IP steam mixer";
        
        Components.DrumSensors HPd(
          redeclare package Medium = FluidMedium,
          rint=HPd_rint,
          rext=HPd_rext,
          L=HPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=HPd_pstart,
          hlstart=HPd_hlstart,
          hvstart=HPd_hvstart,
          Tmstart=HPd_Tmstart,
          Cm=HPd_Cm) "HP drum" 
                        annotation (extent=[-48,-48; -78,-18]);
        Components.DrumSensors IPd(
          redeclare package Medium = FluidMedium,
          rint=IPd_rint,
          rext=IPd_rext,
          L=IPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=IPd_pstart,
          hlstart=IPd_hlstart,
          hvstart=IPd_hvstart,
          Tmstart=IPd_Tmstart,
          Cm=IPd_Cm) "IP drum" 
                        annotation (extent=[52,-62; 22,-32]);
        Components.DrumSensors LPd(
          redeclare package Medium = FluidMedium,
          rint=LPd_rint,
          rext=LPd_rext,
          L=LPd_L,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          pstart=LPd_pstart,
          hlstart=LPd_hlstart,
          hvstart=LPd_hvstart,
          Tmstart=LPd_Tmstart,
          Cm=LPd_Cm) "LP drum" 
                        annotation (extent=[26,42; -4,72]);
        Water.ThroughW feedPumpIP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[88,-64; 72,-48], rotation=
              270);
        Water.ThroughW feedPumpHP(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-16,-60; -32,-44], rotation=
             270);
        Water.ThroughW circulationPumpIP(redeclare package Medium = FluidMedium)
                                annotation (extent=[56,-86; 40,-70], rotation=
              270);
        Water.ThroughW circulationPumpHP(redeclare package Medium = FluidMedium)
                                annotation (extent=[-40,-78; -56,-62], rotation=
             270);
        Water.ThroughW circulationPumpLP(redeclare package Medium = FluidMedium)
                                annotation (extent=[74,32; 58,16], rotation=180);
        Water.FlowSplit flowSplit2(redeclare package Medium = FluidMedium) 
          annotation (extent=[-28,-30; -14,-16],
                                               rotation=270);
        Water.FlowSplit flowSplit1(redeclare package Medium = FluidMedium) 
          annotation (extent=[34,80; 48,94],   rotation=180);
        Water.FlowSplit flowSplit3(redeclare package Medium = FluidMedium) 
          annotation (extent=[-44,-68; -30,-54],
                                               rotation=90);
        Water.FlowSplit flowSplit4(redeclare package Medium = FluidMedium) 
          annotation (extent=[16,26; 32,42],   rotation=270);
        Water.FlowSplit flowSplit6(redeclare package Medium = FluidMedium) 
          annotation (extent=[56,-76; 70,-62], rotation=90);
        Water.Mixer mixHP(redeclare package Medium = FluidMedium,
          pstart=HPd_pstart,
          hstart=HPd_hvstart,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixHP_V)      annotation (extent=[-96,-62; -80,-46], rotation=270);
        Water.Mixer mixIP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixIP_V,
          pstart=IPd_pstart,
          hstart=IPd_hvstart) 
                           annotation (extent=[-2,-62; 14,-46], rotation=270);
        Water.SinkW sinkW(redeclare package Medium = FluidMedium) 
          annotation (extent=[6,24; 16,34], rotation=270);
        Water.SinkW sinkW1(redeclare package Medium = FluidMedium) 
          annotation (extent=[-68,-70; -58,-60], rotation=270);
        Water.SinkW sinkW2(redeclare package Medium = FluidMedium) 
          annotation (extent=[36,-80; 26,-70], rotation=270);
        Water.SensW steamLP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-26,50; -6,30], rotation=90);
        Water.SensW steamHP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-102,-68; -82,-88], rotation=90);
        Water.SensW steamIP_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-68; 12,-88], rotation=90);
        annotation (Diagram);
        Components.PrescribedSpeedPump prescribedSpeedPump(
          redeclare package WaterMedium = FluidMedium,
          rho_nom=1000,
          n0=n0_TFP,
          nominalSteamPressure=outletTFPNomPressure,
          nominalCondensationPressure=inletTFPNomPressure,
          nominalSteamFlow=TFPNomFlowRate,
          hstart=hstart_TFP,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0}) annotation (extent=[78,96; 58,76]);
      equation 
        connect(feedPumpIP.outlet, WaterForIP) 
          annotation (points=[80,-64; 80,-100; 70,-100], style(thickness=2));
        connect(circulationPumpIP.inlet, IPd.downcomer) 
                                                  annotation (points=[48,-70;
              48,-57.5; 47.5,-57.5], style(thickness=2));
        connect(circulationPumpHP.outlet, ToRiser_HP) 
                                              annotation (points=[-48,-78; -48,
              -90; -56,-90; -56,-100], style(thickness=2));
        connect(FromRiser_IP, IPd.riser)   annotation (points=[22,-100; 22,-82;
              25.3,-82; 25.3,-55.55], style(thickness=2));
        connect(flowSplit1.out1, WaterForLP) annotation (points=[36.8,84.06; 26,
              84.06; 26,70; 80,70; 80,56; 100,56], style(thickness=2));
        connect(flowSplit3.in1, Feed_HP) annotation (points=[-37,-65.2; -37,
              -81.6; -40,-81.6; -40,-100], style(thickness=2));
        connect(flowSplit3.out1, HPd.feedwater)  annotation (points=[-39.94,
              -56.8; -40,-48; -40,-38; -48.45,-38; -48.45,-35.25], style(
              thickness=2));
        connect(circulationPumpHP.inlet, HPd.downcomer) 
                                                 annotation (points=[-48,-62;
              -48,-43.5; -52.5,-43.5], style(thickness=2));
        connect(WaterForHP, feedPumpHP.outlet) 
                                              annotation (points=[-24,-100; -24,
              -60],                   style(thickness=2));
        connect(circulationPumpLP.outlet, ToRiser_LP) 
          annotation (points=[74,24; 100,24], style(thickness=2));
        connect(flowSplit4.in1, LPd.downcomer)   annotation (points=[24,38.8;
              24,46.5; 21.5,46.5], style(thickness=2));
        connect(feedPumpHP.inlet, flowSplit2.out2) 
                                                  annotation (points=[-24,-44;
              -24,-27.2; -23.8,-27.2], style(thickness=2));
        connect(feedPumpIP.inlet, flowSplit2.out1) 
                                                  annotation (points=[80,-48;
              80,-28; -18.06,-28; -18.06,-27.2], style(thickness=2));
        connect(FromRiser_HP, HPd.riser)  annotation (points=[-72,-100; -72,-80;
              -74.7,-80; -74.7,-41.55], style(thickness=2));
        connect(flowSplit6.in1, Feed_IP) annotation (points=[63,-73.2; 63,-84.6;
              54,-84.6; 54,-100], style(thickness=2));
        connect(flowSplit6.out1, IPd.feedwater)   annotation (points=[60.06,
              -64.8; 60.06,-49.25; 51.55,-49.25], style(thickness=2));
        connect(LPd.riser, FromRiser_LP) 
          annotation (points=[-0.7,48.45; -0.7,8; 100,8],
                                                        style(thickness=2));
        connect(HPd.steam,mixHP. in1)  annotation (points=[-71.7,-22.5; -83.2,
              -22.5; -83.2,-47.6], style(thickness=2));
        connect(mixIP.in1, IPd.steam)    annotation (points=[10.8,-47.6; 10.8,
              -36.5; 28.3,-36.5], style(thickness=2));
        connect(flowSplit4.out1, circulationPumpLP.inlet) 
                                                  annotation (points=[27.36,
              29.2; 27.36,24; 58,24], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(ToRiser_IP, circulationPumpIP.outlet) 
                                              annotation (points=[38,-100; 38,
              -90; 48,-90; 48,-86], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(sinkW.flange, LPd.blowdown) annotation (points=[11,34; 11,38.15;
              11,38.15; 11,42.3],
                               style(thickness=2));
        connect(sinkW1.flange, HPd.blowdown) 
          annotation (points=[-63,-60; -64,-54; -64,-47.7; -63,-47.7],
                                                   style(thickness=2));
        connect(sinkW2.flange, IPd.blowdown) annotation (points=[31,-70; 34,-70;
              34,-61.7; 37,-61.7], style(thickness=2));
        connect(steamLP_w.inlet, LPd.steam) 
          annotation (points=[-12,46; -12,67.5; 2.3,67.5], style(thickness=2));
        connect(steamLP_w.outlet, Steam_LP_Out) annotation (points=[-12,34; -12,
              0; 82,0; 82,-8; 100,-8], style(thickness=2));
        connect(steamHP_w.outlet, Steam_HP_Out) 
          annotation (points=[-88,-84; -88,-100], style(thickness=2));
        connect(steamHP_w.inlet, mixHP.out) 
          annotation (points=[-88,-72; -88,-62], style(thickness=2));
        connect(steamIP_w.outlet, Steam_IP_Out) 
          annotation (points=[6,-84; 6,-100], style(thickness=2));
        connect(steamIP_w.inlet, mixIP.out) 
          annotation (points=[6,-72; 6,-67; 6,-62; 6,-62], style(thickness=2));
        connect(SensorsBus.p_drumHP, HPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-12; -40,-12; -40,-21.9; -57.6,-21.9], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumIP, IPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-35.9; 42.4,-35.9], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.p_drumLP, LPd.p_out) annotation (points=[98,-40; 74,
              -40; 74,-12; 46,-12; 46,68.1; 16.4,68.1], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamHP, steamHP_w.w) annotation (points=[98,-40;
              74,-40; 74,-12; -80,-12; -80,-92; -98,-92; -98,-86], style(color=
                84, rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamIP, steamIP_w.w) annotation (points=[98,-40;
              74,-40; 74,-12; -14,-12; -14,-92; -4,-92; -4,-86], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.w_steamLP, steamLP_w.w) annotation (points=[98,-40;
              76,-40; 76,-12; -22,-12; -22,32], style(color=84, rgbcolor={255,
                170,213}));
        connect(SensorsBus.y_drumHP, HPd.y_out) annotation (points=[98,-40; 74,
              -40; 74,-12; -40,-12; -40,-27; -52.8,-27], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumIP, IPd.y_out) annotation (points=[98,-40; 72,
              -40; 72,-41; 47.2,-41], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.y_drumLP, LPd.y_out) annotation (points=[98,-40; 74,
              -40; 74,-12; 46,-12; 46,63; 21.2,63], style(color=84, rgbcolor={
                255,170,213}));
        connect(ActuatorsBus.flowRate_feedHP, feedPumpHP.in_w0) annotation (
            points=[98,-72; 68,-72; 68,4; -36,4; -36,-48.8; -28.8,-48.8], style(
              color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.flowRate_feedIP, feedPumpIP.in_w0) annotation (
            points=[98,-72; 68,-72; 68,-52.8; 75.2,-52.8], style(color=52,
              rgbcolor={213,255,170}));
        connect(HPsteamFromExUse, mixHP.in2) annotation (points=[-84,100; -84,
              -10; -92.8,-10; -92.8,-47.68], style(thickness=2));
        connect(mixIP.in2, IPsteamFromExUse) annotation (points=[1.2,-47.68;
              1.2,-4; -64,-4; -64,100], style(thickness=2));
        connect(flowSplit3.out2, tapHPwater) annotation (points=[-34.2,-56.8;
              -34.2,86; -34,86; -34,100], style(thickness=2));
        connect(flowSplit6.out2, tapIPwater) annotation (points=[65.8,-64.8;
              65.8,-8; -26,-8; -26,80; -14,80; -14,100], style(thickness=2));
        connect(tapLPwater, flowSplit1.out2) 
          annotation (points=[6,100; 6,89.8; 36.8,89.8], style(thickness=2));
        connect(Fedd_LP, LPd.feedwater) annotation (points=[100,40; 40,40; 40,
              54.75; 25.55,54.75],
                            style(thickness=2));
        connect(flowSplit2.in1, flowSplit4.out2) annotation (points=[-21,-18.8;
              -21,20; 20.8,20; 20.8,29.2], style(thickness=2));
        connect(ActuatorsBus.nPump_feedLP, prescribedSpeedPump.pumpSpeed_rpm) 
          annotation (points=[98,-72; 68,-72; 68,12; 84,12; 84,80; 78.8,80],
            style(color=52, rgbcolor={213,255,170}));
        connect(prescribedSpeedPump.outlet, flowSplit1.in1) annotation (points=
              [58,86; 51.6,86; 51.6,87; 45.2,87], style(thickness=2));
        connect(prescribedSpeedPump.inlet, WaterIn) annotation (points=[78,86;
              90,86; 90,72; 100,72], style(thickness=2));
      end DG_3L_tap_CC_wa;
      
      model HRSG_3LRh_wa 
        "Heat Recovery Steam Generator with three pressure level and reheat, without attemperation" 
        extends Interfaces.HRSG_3LRh;
        
        annotation (Diagram);
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wa cylindersBodies(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          n0_TFP=1500,
          inletTFPNomPressure=5398.2,
          TFPNomFlowRate=89.8,
          hstart_TFP=1.43495e5,
          IPd_hlstart=1.0265e6) annotation (extent=[-58,24; 18,100]);
        ThermoPower.PowerPlants.HRSG.Examples.HEG_3LRh_wa HeatExchangersGroup(
          gasNomFlowRate=585.5,
          fluidHPNomFlowRate_Sh=70.59,
          fluidHPNomPressure_Sh=134.3e5,
          fluidHPNomFlowRate_Ev=175.5,
          fluidHPNomPressure_Ev=137.1e5,
          fluidHPNomFlowRate_Ec=70.10,
          fluidHPNomPressure_Ec=138.9e5,
          fluidIPNomFlowRate_Rh=81.10,
          fluidIPNomPressure_Rh=28.4e5,
          fluidIPNomFlowRate_Sh=13.5,
          fluidIPNomPressure_Sh=29.5e5,
          fluidIPNomFlowRate_Ev=67.5,
          fluidIPNomPressure_Ev=37.16e5,
          fluidIPNomFlowRate_Ec=21.8,
          fluidIPNomPressure_Ec=48.6e5,
          fluidLPNomFlowRate_Sh=6.91,
          fluidLPNomPressure_Sh=6.6e5,
          fluidLPNomFlowRate_Ev=41.49,
          fluidLPNomPressure_Ev=15.34e5,
          fluidLPNomFlowRate_Ec=122.4,
          fluidLPNomPressure_Ec=19.8e5,
          Sh2_HP_N_G=3,
          Sh2_HP_N_F=5,
          Sh2_HP_exchSurface_G=3636,
          Sh2_HP_exchSurface_F=421.844,
          Sh2_HP_extSurfaceTub=540.913,
          Sh2_HP_gasVol=10,
          Sh2_HP_fluidVol=2.615,
          Sh2_HP_metalVol=1.685,
          Sh1_HP_N_G=3,
          Sh1_HP_N_F=7,
          Sh1_HP_exchSurface_G=8137.2,
          Sh1_HP_exchSurface_F=612.387,
          Sh1_HP_extSurfaceTub=721.256,
          Sh1_HP_gasVol=10,
          Sh1_HP_fluidVol=4.134,
          Sh1_HP_metalVol=1.600,
          Ev_HP_N_G=4,
          Ev_HP_N_F=4,
          Ev_HP_exchSurface_G=30501.9,
          Ev_HP_exchSurface_F=2296.328,
          Ev_HP_extSurfaceTub=2704.564,
          Ev_HP_gasVol=10,
          Ev_HP_fluidVol=15.500,
          Ev_HP_metalVol=6.001,
          Ec2_HP_N_G=3,
          Ec2_HP_N_F=6,
          Ec2_HP_exchSurface_G=20335,
          Ec2_HP_exchSurface_F=1451.506,
          Ec2_HP_extSurfaceTub=1803.043,
          Ec2_HP_gasVol=10,
          Ec2_HP_fluidVol=9.290,
          Ec2_HP_metalVol=5.045,
          Ec1_HP_N_G=3,
          Ec1_HP_N_F=5,
          Ec1_HP_exchSurface_G=12201.2,
          Ec1_HP_exchSurface_F=870.904,
          Ec1_HP_extSurfaceTub=1081.826,
          Ec1_HP_gasVol=10,
          Ec1_HP_fluidVol=5.574,
          Ec1_HP_metalVol=3.027,
          Rh2_IP_N_F=7,
          Rh2_IP_exchSurface_G=4630.2,
          Rh2_IP_exchSurface_F=873.079,
          Rh2_IP_extSurfaceTub=1009.143,
          Rh2_IP_fluidVol=8.403,
          Rh2_IP_metalVol=2.823,
          Rh1_IP_N_F=5,
          Rh1_IP_exchSurface_G=4630,
          Rh1_IP_exchSurface_F=900.387,
          Rh1_IP_extSurfaceTub=1009.250,
          Rh1_IP_fluidVol=8.936,
          Rh1_IP_metalVol=2.292,
          Sh_IP_N_G=3,
          Sh_IP_N_F=7,
          Sh_IP_exchSurface_G=2314.8,
          Sh_IP_exchSurface_F=450.218,
          Sh_IP_extSurfaceTub=504.652,
          Sh_IP_gasVol=10,
          Sh_IP_fluidVol=4.468,
          Sh_IP_metalVol=1.146,
          Ev_IP_N_G=4,
          Ev_IP_N_F=4,
          Ev_IP_exchSurface_G=24402,
          Ev_IP_exchSurface_F=1837.063,
          Ev_IP_extSurfaceTub=2163.652,
          Ev_IP_gasVol=10,
          Ev_IP_fluidVol=12.400,
          Ev_IP_metalVol=4.801,
          Ec_IP_N_G=3,
          Ec_IP_N_F=5,
          Ec_IP_exchSurface_G=4067.2,
          Ec_IP_exchSurface_F=306.177,
          Ec_IP_extSurfaceTub=360.609,
          Ec_IP_gasVol=10,
          Ec_IP_fluidVol=2.067,
          Ec_IP_metalVol=0.800,
          Sh_LP_N_G=3,
          Sh_LP_N_F=7,
          Sh_LP_exchSurface_G=1708.2,
          Sh_LP_exchSurface_F=225.073,
          Sh_LP_extSurfaceTub=252.286,
          Sh_LP_gasVol=10,
          Sh_LP_fluidVol=2.234,
          Sh_LP_metalVol=0.573,
          Ev_LP_N_G=4,
          Ev_LP_N_F=4,
          Ev_LP_exchSurface_G=24402,
          Ev_LP_exchSurface_F=2292.926,
          Ev_LP_extSurfaceTub=2592.300,
          Ev_LP_gasVol=10,
          Ev_LP_fluidVol=19.318,
          Ev_LP_metalVol=5.374,
          Ec_LP_N_G=3,
          Ec_LP_N_F=6,
          Ec_LP_exchSurface_G=40095.9,
          Ec_LP_exchSurface_F=3439.389,
          Ec_LP_extSurfaceTub=3888.449,
          Ec_LP_gasVol=10,
          Ec_LP_fluidVol=28.977,
          Ec_LP_metalVol=8.061,
          use_T_Ev=false,
          Sh2_HP_Tstart_G_In=884.65,
          Sh2_HP_Tstart_G_Out=837.31,
          Sh2_HP_Tstart_M_In=742.65,
          Sh2_HP_Tstart_M_Out=823.28,
          Sh2_HP_Tstart_F_In=742.65,
          Sh2_HP_Tstart_F_Out=823.28,
          Sh1_HP_Tstart_G_In=837.15,
          Sh1_HP_Tstart_G_Out=748.60,
          Sh1_HP_Tstart_M_In=606.59,
          Sh1_HP_Tstart_M_Out=743.18,
          Sh1_HP_Tstart_F_In=606.59,
          Sh1_HP_Tstart_F_Out=743.18,
          Ev_HP_Tstart_G_In=747.15,
          Ev_HP_Tstart_G_Out=620.30,
          Ev_HP_hstart_F_In=1.514e6,
          Ev_HP_hstart_F_Out=2.002e6,
          Ec2_HP_Tstart_G_In=614.15,
          Ec2_HP_Tstart_G_Out=558.98,
          Ec2_HP_Tstart_M_In=494.67,
          Ec2_HP_Tstart_M_Out=594.14,
          Ec2_HP_Tstart_F_In=494.67,
          Ec2_HP_Tstart_F_Out=594.14,
          Ec1_HP_Tstart_M_In=431.77,
          Ec1_HP_Tstart_M_Out=494.67,
          Ec1_HP_Tstart_F_In=431.77,
          Ec1_HP_Tstart_F_Out=494.67,
          Rh2_IP_Tstart_M_In=717.31,
          Rh2_IP_Tstart_M_Out=813.09,
          Rh2_IP_Tstart_F_In=717.31,
          Rh2_IP_Tstart_F_Out=813.09,
          Rh1_IP_Tstart_M_In=618.31,
          Rh1_IP_Tstart_M_Out=717.34,
          Rh1_IP_Tstart_F_In=618.31,
          Rh1_IP_Tstart_F_Out=717.34,
          Sh_IP_Tstart_G_In=620.15,
          Sh_IP_Tstart_G_Out=614.50,
          Sh_IP_Tstart_M_In=506.08,
          Sh_IP_Tstart_M_Out=605.11,
          Sh_IP_Tstart_F_In=506.08,
          Sh_IP_Tstart_F_Out=605.11,
          Ev_IP_Tstart_G_In=558.15,
          Ev_IP_Tstart_G_Out=518.51,
          Ev_IP_hstart_F_In=9.92e5,
          Ev_IP_hstart_F_Out=1.37e6,
          Ec_IP_Tstart_G_In=517.15,
          Ec_IP_Tstart_G_Out=480.11,
          Ec_IP_Tstart_M_In=430.24,
          Ec_IP_Tstart_M_Out=493.16,
          Ec_IP_Tstart_F_In=430.24,
          Ec_IP_Tstart_F_Out=493.16,
          Sh_LP_Tstart_G_In=519.15,
          Sh_LP_Tstart_G_Out=517.44,
          Sh_LP_Tstart_M_In=435.75,
          Sh_LP_Tstart_M_Out=505.04,
          Sh_LP_Tstart_F_In=435.75,
          Sh_LP_Tstart_F_Out=505.75,
          Ev_LP_Tstart_G_In=480.00,
          Ev_LP_Tstart_G_Out=453.47,
          Ev_LP_hstart_F_In=6.625e5,
          Ev_LP_hstart_F_Out=1.065e6,
          Ec_LP_Tstart_G_In=453.47,
          Ec_LP_Tstart_G_Out=372.35,
          Ec_LP_Tstart_M_In=331.05,
          Ec_LP_Tstart_M_Out=428.09,
          Ec_LP_Tstart_F_In=331.05,
          Ec_LP_Tstart_F_Out=428.09,
          rhomcm=7900*578.05,
          lambda=20,
          Ec_LP(gamma_G=46.8, gamma_F=4000),
          Ev_LP(gamma_G=127, gamma_F=20000),
          Ec1HP_EcIP(
            gamma_G_A=42,
            gamma_G_B=45,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh_LP(gamma_G=16.6, gamma_F=4000),
          Ev_IP(gamma_G=58.5, gamma_F=20000),
          Ec2_HP(gamma_G=56, gamma_F=4000),
          Sh_IP(gamma_G=33, gamma_F=4000),
          Ev_HP(gamma_G=46.5, gamma_F=20000),
          gasNomPressure=1e5,
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_G_A=83.97,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          Ev_HP_Tstart_M_In=FluidMedium.temperature_ph(137.1e5, 1.514e6),
          Ev_HP_Tstart_M_Out=FluidMedium.temperature_ph(137.1e5, 2.002e6),
          Ev_IP_Tstart_M_In=FluidMedium.temperature_ph(37.16e5, 9.92e5),
          Ev_IP_Tstart_M_Out=FluidMedium.temperature_ph(37.16e5, 1.37e6),
          Ev_LP_Tstart_M_In=FluidMedium.temperature_ph(15.34e5, 6.625e5),
          Ev_LP_Tstart_M_Out=FluidMedium.temperature_ph(15.34e5, 1.065e6)) 
                             annotation (extent=[-58,-74; 18,2]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-34,18; -24,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-52,8; -42,18],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-46,18; -36,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-40,8; -30,18],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-58,18; -48,8],    rotation=90);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_in(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[2,18; 12,8],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-16,8; -6,18],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-10,18; 0,8],      rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-4,8; 6,18],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-22,18; -12,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[38,30; 28,20], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[22,26; 32,36], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,18; 40,8],  rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[34,14; 44,24], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[46,-2; 56,8],  rotation=270);
      equation 
        connect(stateEcLP_in.outlet,HeatExchangersGroup. Ec_LP_In) annotation (
            points=[51,0; 51,-27.64; 18,-27.64],    style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.inlet,HeatExchangersGroup. Ec_LP_Out) annotation (
           points=[45,10; 45,-21.56; 18,-21.56],  style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.outlet,HeatExchangersGroup. Ev_LP_In) annotation (
            points=[39,16; 39,-15.48; 18,-15.48], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.outlet,HeatExchangersGroup. Sh_LP_In) annotation (
            points=[27,28; 27,-3.32; 18,-3.32], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.inlet,cylindersBodies. Steam_LP_Out) annotation (
            points=[27,34; 27,58.96; 18,58.96],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_out.outlet,cylindersBodies. FromRiser_LP) annotation (
           points=[33,28; 33,65.04; 18,65.04],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.inlet,cylindersBodies. ToRiser_LP) annotation (
            points=[39,22; 39,71.12; 18,71.12],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.outlet,cylindersBodies. Feed_LP) annotation (
            points=[45,16; 45,77.2; 18,77.2],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_in.inlet,cylindersBodies. WaterForLP) annotation (
            points=[51,6; 51,83.28; 18,83.28],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Sh_HP_Out, Sh_HP_Out) annotation (points=[-50.4,
              -74; -50,-78; -50,-80; -80,-80; -80,-100],style(thickness=2));
        connect(Rh_IP_In, HeatExchangersGroup.Rh_IP_In) annotation (points=[-50,-100;
              -50,-84; -34,-84; -34,-80; -35.2,-74],style(thickness=2));
        connect(Rh_IP_Out, HeatExchangersGroup.Rh_IP_Out) 
          annotation (points=[-20,-100; -20,-74],          style(thickness=2));
        connect(Sh_IP_Out, HeatExchangersGroup.Sh_IP_Out) annotation (points=[10,-100;
              10,-84; -4,-84; -4,-74; -4.8,-74],          style(thickness=2));
        connect(Sh_LP_Out, HeatExchangersGroup.Sh_LP_Out) annotation (points=[40,-100;
              40,-80; 10,-80; 10,-74; 10.4,-74],          style(thickness=2));
        connect(GasOut, HeatExchangersGroup.GasOut) annotation (points=[100,-10;
              62,-10; 62,-35.62; 18.38,-35.62],style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(HeatExchangersGroup.GasIn, GasIn) annotation (points=[-58.38,
              -35.62; -78,-35.62; -78,-10; -100,-10],
                                                    style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(ActuatorsBus, cylindersBodies.ActuatorsBus) annotation (points=[98,36;
              58,36; 58,34.64; 17.24,34.64],        style(color=52, rgbcolor={
                213,255,170}));
        connect(cylindersBodies.SensorsBus, SensorsBus) annotation (points=[17.24,
              46.8; 53.65,46.8; 53.65,68; 98,68],      style(color=84, rgbcolor=
               {255,170,213}));
        connect(stateEvLP_out.inlet, HeatExchangersGroup.Ev_LP_Out) 
          annotation (points=[33,22; 33,-9.4; 18,-9.4], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_In, stateEcIP_in.outlet) 
          annotation (points=[6.6,2; 7,2; 7,10], style(thickness=2));
        connect(stateEcIP_in.inlet, cylindersBodies.WaterForIP) annotation (
            points=[7,16; 7,20.5; 6.6,20.5; 6.6,24], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_Out, stateEcIP_out.inlet) 
          annotation (points=[0.52,2; 1,2; 1,10], style(thickness=2));
        connect(stateEcIP_out.outlet, cylindersBodies.Feed_IP) annotation (
            points=[1,16; 1,20.5; 0.52,20.5; 0.52,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_In, stateEvIP_in.outlet) 
          annotation (points=[-5.56,2; -5,2; -5,10], style(thickness=2));
        connect(stateEvIP_in.inlet, cylindersBodies.ToRiser_IP) annotation (
            points=[-5,16; -5,20.5; -5.56,20.5; -5.56,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_Out, stateEvIP_out.inlet) 
          annotation (points=[-11.64,2; -11,2; -11,10], style(thickness=2));
        connect(stateEvIP_out.outlet, cylindersBodies.FromRiser_IP) annotation (
           points=[-11,16; -11,20.5; -11.64,20.5; -11.64,24], style(thickness=2));
        connect(HeatExchangersGroup.Sh_IP_In, stateShIP_in.outlet) 
          annotation (points=[-17.72,2; -17,2; -17,10], style(thickness=2));
        connect(stateShIP_in.inlet, cylindersBodies.Steam_IP_Out) annotation (
            points=[-17,16; -17,20.5; -17.72,20.5; -17.72,24], style(thickness=
                2));
        connect(HeatExchangersGroup.Ec_HP_In, stateEcHP_in.outlet) 
          annotation (points=[-29.12,2; -29,2; -29,10], style(thickness=2));
        connect(stateEcHP_in.inlet, cylindersBodies.WaterForHP) annotation (
            points=[-29,16; -29,19.5; -29.12,19.5; -29.12,24], style(thickness=
                2));
        connect(HeatExchangersGroup.Ec_HP_Out, stateEcHP_out.inlet) annotation (
           points=[-35.2,2; -35.2,5; -35,5; -35,10], style(thickness=2));
        connect(stateEcHP_out.outlet, cylindersBodies.Feed_HP) annotation (
            points=[-35,16; -35,20.5; -35.2,20.5; -35.2,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_In, stateEvHP_in.outlet) annotation (
            points=[-41.28,2; -41.28,6; -41,6; -41,10], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_Out, stateEvHP_out.inlet) annotation (
           points=[-47.36,2; -47.36,5; -47,5; -47,10], style(thickness=2));
        connect(HeatExchangersGroup.Sh_HP_In, stateShHP_in.outlet) 
          annotation (points=[-53.44,2; -53,2; -53,10], style(thickness=2));
        connect(stateShHP_in.inlet, cylindersBodies.Steam_HP_Out) annotation (
            points=[-53,16; -53,20.5; -53.44,20.5; -53.44,24], style(thickness=
                2));
        connect(stateEvHP_out.outlet, cylindersBodies.FromRiser_HP) annotation (
           points=[-47,16; -47,19.5; -47.36,19.5; -47.36,24], style(thickness=2));
        connect(stateEvHP_in.inlet, cylindersBodies.ToRiser_HP) annotation (
            points=[-41,16; -41,20.5; -41.28,20.5; -41.28,24], style(thickness=
                2));
        connect(WaterIn, cylindersBodies.WaterIn) annotation (points=[80,-100;
              80,89.36; 18,89.36], style(thickness=2));
      end HRSG_3LRh_wa;
      
      model HRSG_3LRh_wafp "Heat Recovery Steam Generator with three pressure level and reheat, without attemperation and
   without feed pump" 
        extends Interfaces.HRSG_3LRh;
        
        annotation (Diagram);
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wafp cylindersBodies(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          IPd_hlstart=1.0265e6) annotation (extent=[-58,24; 18,100]);
        ThermoPower.PowerPlants.HRSG.Examples.HEG_3LRh_wa HeatExchangersGroup(
          gasNomFlowRate=585.5,
          fluidHPNomFlowRate_Sh=70.59,
          fluidHPNomPressure_Sh=134.3e5,
          fluidHPNomFlowRate_Ev=175.5,
          fluidHPNomPressure_Ev=137.1e5,
          fluidHPNomFlowRate_Ec=70.10,
          fluidHPNomPressure_Ec=138.9e5,
          fluidIPNomFlowRate_Rh=81.10,
          fluidIPNomPressure_Rh=28.4e5,
          fluidIPNomFlowRate_Sh=13.5,
          fluidIPNomPressure_Sh=29.5e5,
          fluidIPNomFlowRate_Ev=67.5,
          fluidIPNomPressure_Ev=37.16e5,
          fluidIPNomFlowRate_Ec=21.8,
          fluidIPNomPressure_Ec=48.6e5,
          fluidLPNomFlowRate_Sh=6.91,
          fluidLPNomPressure_Sh=6.6e5,
          fluidLPNomFlowRate_Ev=41.49,
          fluidLPNomPressure_Ev=15.34e5,
          fluidLPNomFlowRate_Ec=122.4,
          fluidLPNomPressure_Ec=19.8e5,
          Sh2_HP_N_G=3,
          Sh2_HP_N_F=5,
          Sh2_HP_exchSurface_G=3636,
          Sh2_HP_exchSurface_F=421.844,
          Sh2_HP_extSurfaceTub=540.913,
          Sh2_HP_gasVol=10,
          Sh2_HP_fluidVol=2.615,
          Sh2_HP_metalVol=1.685,
          Sh1_HP_N_G=3,
          Sh1_HP_N_F=7,
          Sh1_HP_exchSurface_G=8137.2,
          Sh1_HP_exchSurface_F=612.387,
          Sh1_HP_extSurfaceTub=721.256,
          Sh1_HP_gasVol=10,
          Sh1_HP_fluidVol=4.134,
          Sh1_HP_metalVol=1.600,
          Ev_HP_N_G=4,
          Ev_HP_N_F=4,
          Ev_HP_exchSurface_G=30501.9,
          Ev_HP_exchSurface_F=2296.328,
          Ev_HP_extSurfaceTub=2704.564,
          Ev_HP_gasVol=10,
          Ev_HP_fluidVol=15.500,
          Ev_HP_metalVol=6.001,
          Ec2_HP_N_G=3,
          Ec2_HP_N_F=6,
          Ec2_HP_exchSurface_G=20335,
          Ec2_HP_exchSurface_F=1451.506,
          Ec2_HP_extSurfaceTub=1803.043,
          Ec2_HP_gasVol=10,
          Ec2_HP_fluidVol=9.290,
          Ec2_HP_metalVol=5.045,
          Ec1_HP_N_G=3,
          Ec1_HP_N_F=5,
          Ec1_HP_exchSurface_G=12201.2,
          Ec1_HP_exchSurface_F=870.904,
          Ec1_HP_extSurfaceTub=1081.826,
          Ec1_HP_gasVol=10,
          Ec1_HP_fluidVol=5.574,
          Ec1_HP_metalVol=3.027,
          Rh2_IP_N_F=7,
          Rh2_IP_exchSurface_G=4630.2,
          Rh2_IP_exchSurface_F=873.079,
          Rh2_IP_extSurfaceTub=1009.143,
          Rh2_IP_fluidVol=8.403,
          Rh2_IP_metalVol=2.823,
          Rh1_IP_N_F=5,
          Rh1_IP_exchSurface_G=4630,
          Rh1_IP_exchSurface_F=900.387,
          Rh1_IP_extSurfaceTub=1009.250,
          Rh1_IP_fluidVol=8.936,
          Rh1_IP_metalVol=2.292,
          Sh_IP_N_G=3,
          Sh_IP_N_F=7,
          Sh_IP_exchSurface_G=2314.8,
          Sh_IP_exchSurface_F=450.218,
          Sh_IP_extSurfaceTub=504.652,
          Sh_IP_gasVol=10,
          Sh_IP_fluidVol=4.468,
          Sh_IP_metalVol=1.146,
          Ev_IP_N_G=4,
          Ev_IP_N_F=4,
          Ev_IP_exchSurface_G=24402,
          Ev_IP_exchSurface_F=1837.063,
          Ev_IP_extSurfaceTub=2163.652,
          Ev_IP_gasVol=10,
          Ev_IP_fluidVol=12.400,
          Ev_IP_metalVol=4.801,
          Ec_IP_N_G=3,
          Ec_IP_N_F=5,
          Ec_IP_exchSurface_G=4067.2,
          Ec_IP_exchSurface_F=306.177,
          Ec_IP_extSurfaceTub=360.609,
          Ec_IP_gasVol=10,
          Ec_IP_fluidVol=2.067,
          Ec_IP_metalVol=0.800,
          Sh_LP_N_G=3,
          Sh_LP_N_F=7,
          Sh_LP_exchSurface_G=1708.2,
          Sh_LP_exchSurface_F=225.073,
          Sh_LP_extSurfaceTub=252.286,
          Sh_LP_gasVol=10,
          Sh_LP_fluidVol=2.234,
          Sh_LP_metalVol=0.573,
          Ev_LP_N_G=4,
          Ev_LP_N_F=4,
          Ev_LP_exchSurface_G=24402,
          Ev_LP_exchSurface_F=2292.926,
          Ev_LP_extSurfaceTub=2592.300,
          Ev_LP_gasVol=10,
          Ev_LP_fluidVol=19.318,
          Ev_LP_metalVol=5.374,
          Ec_LP_N_G=3,
          Ec_LP_N_F=6,
          Ec_LP_exchSurface_G=40095.9,
          Ec_LP_exchSurface_F=3439.389,
          Ec_LP_extSurfaceTub=3888.449,
          Ec_LP_gasVol=10,
          Ec_LP_fluidVol=28.977,
          Ec_LP_metalVol=8.061,
          use_T_Ev=false,
          Sh2_HP_Tstart_G_In=884.65,
          Sh2_HP_Tstart_G_Out=837.31,
          Sh2_HP_Tstart_M_In=742.65,
          Sh2_HP_Tstart_M_Out=823.28,
          Sh2_HP_Tstart_F_In=742.65,
          Sh2_HP_Tstart_F_Out=823.28,
          Sh1_HP_Tstart_G_In=837.15,
          Sh1_HP_Tstart_G_Out=748.60,
          Sh1_HP_Tstart_M_In=606.59,
          Sh1_HP_Tstart_M_Out=743.18,
          Sh1_HP_Tstart_F_In=606.59,
          Sh1_HP_Tstart_F_Out=743.18,
          Ev_HP_Tstart_G_In=747.15,
          Ev_HP_Tstart_G_Out=620.30,
          Ev_HP_hstart_F_In=1.514e6,
          Ev_HP_hstart_F_Out=2.002e6,
          Ec2_HP_Tstart_G_In=614.15,
          Ec2_HP_Tstart_G_Out=558.98,
          Ec2_HP_Tstart_M_In=494.67,
          Ec2_HP_Tstart_M_Out=594.14,
          Ec2_HP_Tstart_F_In=494.67,
          Ec2_HP_Tstart_F_Out=594.14,
          Ec1_HP_Tstart_M_In=431.77,
          Ec1_HP_Tstart_M_Out=494.67,
          Ec1_HP_Tstart_F_In=431.77,
          Ec1_HP_Tstart_F_Out=494.67,
          Rh2_IP_Tstart_M_In=717.31,
          Rh2_IP_Tstart_M_Out=813.09,
          Rh2_IP_Tstart_F_In=717.31,
          Rh2_IP_Tstart_F_Out=813.09,
          Rh1_IP_Tstart_M_In=618.31,
          Rh1_IP_Tstart_M_Out=717.34,
          Rh1_IP_Tstart_F_In=618.31,
          Rh1_IP_Tstart_F_Out=717.34,
          Sh_IP_Tstart_G_In=620.15,
          Sh_IP_Tstart_G_Out=614.50,
          Sh_IP_Tstart_M_In=506.08,
          Sh_IP_Tstart_M_Out=605.11,
          Sh_IP_Tstart_F_In=506.08,
          Sh_IP_Tstart_F_Out=605.11,
          Ev_IP_Tstart_G_In=558.15,
          Ev_IP_Tstart_G_Out=518.51,
          Ev_IP_hstart_F_In=9.92e5,
          Ev_IP_hstart_F_Out=1.37e6,
          Ec_IP_Tstart_G_In=517.15,
          Ec_IP_Tstart_G_Out=480.11,
          Ec_IP_Tstart_M_In=430.24,
          Ec_IP_Tstart_M_Out=493.16,
          Ec_IP_Tstart_F_In=430.24,
          Ec_IP_Tstart_F_Out=493.16,
          Sh_LP_Tstart_G_In=519.15,
          Sh_LP_Tstart_G_Out=517.44,
          Sh_LP_Tstart_M_In=435.75,
          Sh_LP_Tstart_M_Out=505.04,
          Sh_LP_Tstart_F_In=435.75,
          Sh_LP_Tstart_F_Out=505.75,
          Ev_LP_Tstart_G_In=480.00,
          Ev_LP_Tstart_G_Out=453.47,
          Ev_LP_hstart_F_In=6.625e5,
          Ev_LP_hstart_F_Out=1.065e6,
          Ec_LP_Tstart_G_In=453.47,
          Ec_LP_Tstart_G_Out=372.35,
          Ec_LP_Tstart_M_In=331.05,
          Ec_LP_Tstart_M_Out=428.09,
          Ec_LP_Tstart_F_In=331.05,
          Ec_LP_Tstart_F_Out=428.09,
          rhomcm=7900*578.05,
          lambda=20,
          Ec_LP(gamma_G=46.8, gamma_F=4000),
          Ev_LP(gamma_G=127, gamma_F=20000),
          Ec1HP_EcIP(
            gamma_G_A=42,
            gamma_G_B=45,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh_LP(gamma_G=16.6, gamma_F=4000),
          Ev_IP(gamma_G=58.5, gamma_F=20000),
          Ec2_HP(gamma_G=56, gamma_F=4000),
          Sh_IP(gamma_G=33, gamma_F=4000),
          Ev_HP(gamma_G=46.5, gamma_F=20000),
          gasNomPressure=1e5,
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_G_A=83.97,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          Ev_HP_Tstart_M_In=FluidMedium.temperature_ph(137.1e5, 1.514e6),
          Ev_HP_Tstart_M_Out=FluidMedium.temperature_ph(137.1e5, 2.002e6),
          Ev_IP_Tstart_M_In=FluidMedium.temperature_ph(37.16e5, 9.92e5),
          Ev_IP_Tstart_M_Out=FluidMedium.temperature_ph(37.16e5, 1.37e6),
          Ev_LP_Tstart_M_In=FluidMedium.temperature_ph(15.34e5, 6.625e5),
          Ev_LP_Tstart_M_Out=FluidMedium.temperature_ph(15.34e5, 1.065e6)) 
                             annotation (extent=[-58,-74; 18,2]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-34,18; -24,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-52,8; -42,18],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-46,18; -36,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-40,8; -30,18],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-58,18; -48,8],    rotation=90);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_in(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[2,18; 12,8],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-16,8; -6,18],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-10,18; 0,8],      rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-4,8; 6,18],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-22,18; -12,8],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[38,30; 28,20], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[22,26; 32,36], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,18; 40,8],  rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[34,14; 44,24], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[46,-2; 56,8],  rotation=270);
      equation 
        connect(stateEcLP_in.outlet,HeatExchangersGroup. Ec_LP_In) annotation (
            points=[51,0; 51,-27.64; 18,-27.64],    style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.inlet,HeatExchangersGroup. Ec_LP_Out) annotation (
           points=[45,10; 45,-21.56; 18,-21.56],  style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.outlet,HeatExchangersGroup. Ev_LP_In) annotation (
            points=[39,16; 39,-15.48; 18,-15.48], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.outlet,HeatExchangersGroup. Sh_LP_In) annotation (
            points=[27,28; 27,-3.32; 18,-3.32], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.inlet,cylindersBodies. Steam_LP_Out) annotation (
            points=[27,34; 27,58.96; 18,58.96],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_out.outlet,cylindersBodies. FromRiser_LP) annotation (
           points=[33,28; 33,65.04; 18,65.04],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.inlet,cylindersBodies. ToRiser_LP) annotation (
            points=[39,22; 39,71.12; 18,71.12],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.outlet,cylindersBodies. Feed_LP) annotation (
            points=[45,16; 45,77.2; 18,77.2],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_in.inlet,cylindersBodies. WaterForLP) annotation (
            points=[51,6; 51,83.28; 18,83.28],   style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Sh_HP_Out, Sh_HP_Out) annotation (points=[-50.4,
              -74; -50.4,-84; -80,-84; -80,-100],       style(thickness=2));
        connect(Rh_IP_In, HeatExchangersGroup.Rh_IP_In) annotation (points=[-50,-100;
              -50,-90; -35.2,-90; -35.2,-74],       style(thickness=2));
        connect(Rh_IP_Out, HeatExchangersGroup.Rh_IP_Out) 
          annotation (points=[-20,-100; -20,-74],          style(thickness=2));
        connect(Sh_IP_Out, HeatExchangersGroup.Sh_IP_Out) annotation (points=[10,-100;
              10,-90; -4,-90; -4,-74; -4.8,-74],          style(thickness=2));
        connect(Sh_LP_Out, HeatExchangersGroup.Sh_LP_Out) annotation (points=[40,-100;
              40,-86; 10,-86; 10,-74; 10.4,-74],          style(thickness=2));
        connect(GasOut, HeatExchangersGroup.GasOut) annotation (points=[100,-10;
              62,-10; 62,-35.62; 18.38,-35.62],style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(HeatExchangersGroup.GasIn, GasIn) annotation (points=[-58.38,
              -35.62; -78,-35.62; -78,-10; -100,-10],
                                                    style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(ActuatorsBus, cylindersBodies.ActuatorsBus) annotation (points=[98,36;
              58,36; 58,34.64; 17.24,34.64],        style(color=52, rgbcolor={
                213,255,170}));
        connect(cylindersBodies.SensorsBus, SensorsBus) annotation (points=[17.24,
              46.8; 53.65,46.8; 53.65,68; 98,68],      style(color=84, rgbcolor=
               {255,170,213}));
        connect(stateEvLP_out.inlet, HeatExchangersGroup.Ev_LP_Out) 
          annotation (points=[33,22; 33,-9.4; 18,-9.4], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_In, stateEcIP_in.outlet) 
          annotation (points=[6.6,2; 7,2; 7,10], style(thickness=2));
        connect(stateEcIP_in.inlet, cylindersBodies.WaterForIP) annotation (
            points=[7,16; 7,20.5; 6.6,20.5; 6.6,24], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_Out, stateEcIP_out.inlet) 
          annotation (points=[0.52,2; 1,2; 1,10], style(thickness=2));
        connect(stateEcIP_out.outlet, cylindersBodies.Feed_IP) annotation (
            points=[1,16; 1,20.5; 0.52,20.5; 0.52,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_In, stateEvIP_in.outlet) 
          annotation (points=[-5.56,2; -5,2; -5,10], style(thickness=2));
        connect(stateEvIP_in.inlet, cylindersBodies.ToRiser_IP) annotation (
            points=[-5,16; -5,20.5; -5.56,20.5; -5.56,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_Out, stateEvIP_out.inlet) 
          annotation (points=[-11.64,2; -11,2; -11,10], style(thickness=2));
        connect(stateEvIP_out.outlet, cylindersBodies.FromRiser_IP) annotation (
           points=[-11,16; -11,20.5; -11.64,20.5; -11.64,24], style(thickness=2));
        connect(HeatExchangersGroup.Sh_IP_In, stateShIP_in.outlet) 
          annotation (points=[-17.72,2; -17,2; -17,10], style(thickness=2));
        connect(stateShIP_in.inlet, cylindersBodies.Steam_IP_Out) annotation (
            points=[-17,16; -17,20.5; -17.72,20.5; -17.72,24], style(thickness=
                2));
        connect(HeatExchangersGroup.Ec_HP_In, stateEcHP_in.outlet) 
          annotation (points=[-29.12,2; -29,2; -29,10], style(thickness=2));
        connect(stateEcHP_in.inlet, cylindersBodies.WaterForHP) annotation (
            points=[-29,16; -29,19.5; -29.12,19.5; -29.12,24], style(thickness=
                2));
        connect(HeatExchangersGroup.Ec_HP_Out, stateEcHP_out.inlet) annotation (
           points=[-35.2,2; -35.2,5; -35,5; -35,10], style(thickness=2));
        connect(stateEcHP_out.outlet, cylindersBodies.Feed_HP) annotation (
            points=[-35,16; -35,20.5; -35.2,20.5; -35.2,24], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_In, stateEvHP_in.outlet) annotation (
            points=[-41.28,2; -41.28,6; -41,6; -41,10], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_Out, stateEvHP_out.inlet) annotation (
           points=[-47.36,2; -47.36,5; -47,5; -47,10], style(thickness=2));
        connect(HeatExchangersGroup.Sh_HP_In, stateShHP_in.outlet) 
          annotation (points=[-53.44,2; -53,2; -53,10], style(thickness=2));
        connect(stateShHP_in.inlet, cylindersBodies.Steam_HP_Out) annotation (
            points=[-53,16; -53,20.5; -53.44,20.5; -53.44,24], style(thickness=
                2));
        connect(stateEvHP_out.outlet, cylindersBodies.FromRiser_HP) annotation (
           points=[-47,16; -47,19.5; -47.36,19.5; -47.36,24], style(thickness=2));
        connect(stateEvHP_in.inlet, cylindersBodies.ToRiser_HP) annotation (
            points=[-41,16; -41,20.5; -41.28,20.5; -41.28,24], style(thickness=
                2));
        connect(WaterIn, cylindersBodies.WaterIn) annotation (points=[80,-100;
              80,89.36; 18,89.36], style(thickness=2));
      end HRSG_3LRh_wafp;
      
      model HRSG_tap_wa "Heat Recovery Steam Generator with three pressure level,
  reheat and tappings of saturated water for external heater, without attemperation" 
        extends Interfaces.HRSG_3LRh_tap;
        
        annotation (Diagram);
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_tap_CC_wa cylindersBodies(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          n0_TFP=1500,
          inletTFPNomPressure=5398.2,
          TFPNomFlowRate=89.8,
          hstart_TFP=1.43495e5,
          mixHP_V=5,
          mixIP_V=5,
          IPd_hlstart=1.0265e6) annotation (extent=[-40,8; 20,68]);
        ThermoPower.PowerPlants.HRSG.Examples.HEG_3LRh_wa HeatExchangersGroup(
          gasNomFlowRate=585.5,
          fluidHPNomFlowRate_Sh=70.59,
          fluidHPNomPressure_Sh=134.3e5,
          fluidHPNomFlowRate_Ev=175.5,
          fluidHPNomPressure_Ev=137.1e5,
          fluidHPNomFlowRate_Ec=70.10,
          fluidHPNomPressure_Ec=138.9e5,
          fluidIPNomFlowRate_Rh=81.10,
          fluidIPNomPressure_Rh=28.4e5,
          fluidIPNomFlowRate_Sh=13.5,
          fluidIPNomPressure_Sh=29.5e5,
          fluidIPNomFlowRate_Ev=67.5,
          fluidIPNomPressure_Ev=37.16e5,
          fluidIPNomFlowRate_Ec=21.8,
          fluidIPNomPressure_Ec=48.6e5,
          fluidLPNomFlowRate_Sh=6.91,
          fluidLPNomPressure_Sh=6.6e5,
          fluidLPNomFlowRate_Ev=41.49,
          fluidLPNomPressure_Ev=15.34e5,
          fluidLPNomFlowRate_Ec=122.4,
          fluidLPNomPressure_Ec=19.8e5,
          Sh2_HP_N_G=3,
          Sh2_HP_N_F=5,
          Sh2_HP_exchSurface_G=3636,
          Sh2_HP_exchSurface_F=421.844,
          Sh2_HP_extSurfaceTub=540.913,
          Sh2_HP_gasVol=10,
          Sh2_HP_fluidVol=2.615,
          Sh2_HP_metalVol=1.685,
          Sh1_HP_N_G=3,
          Sh1_HP_N_F=7,
          Sh1_HP_exchSurface_G=8137.2,
          Sh1_HP_exchSurface_F=612.387,
          Sh1_HP_extSurfaceTub=721.256,
          Sh1_HP_gasVol=10,
          Sh1_HP_fluidVol=4.134,
          Sh1_HP_metalVol=1.600,
          Ev_HP_N_G=4,
          Ev_HP_N_F=4,
          Ev_HP_exchSurface_G=30501.9,
          Ev_HP_exchSurface_F=2296.328,
          Ev_HP_extSurfaceTub=2704.564,
          Ev_HP_gasVol=10,
          Ev_HP_fluidVol=15.500,
          Ev_HP_metalVol=6.001,
          Ec2_HP_N_G=3,
          Ec2_HP_N_F=6,
          Ec2_HP_exchSurface_G=20335,
          Ec2_HP_exchSurface_F=1451.506,
          Ec2_HP_extSurfaceTub=1803.043,
          Ec2_HP_gasVol=10,
          Ec2_HP_fluidVol=9.290,
          Ec2_HP_metalVol=5.045,
          Ec1_HP_N_G=3,
          Ec1_HP_N_F=5,
          Ec1_HP_exchSurface_G=12201.2,
          Ec1_HP_exchSurface_F=870.904,
          Ec1_HP_extSurfaceTub=1081.826,
          Ec1_HP_gasVol=10,
          Ec1_HP_fluidVol=5.574,
          Ec1_HP_metalVol=3.027,
          Rh2_IP_N_F=7,
          Rh2_IP_exchSurface_G=4630.2,
          Rh2_IP_exchSurface_F=873.079,
          Rh2_IP_extSurfaceTub=1009.143,
          Rh2_IP_fluidVol=8.403,
          Rh2_IP_metalVol=2.823,
          Rh1_IP_N_F=5,
          Rh1_IP_exchSurface_G=4630,
          Rh1_IP_exchSurface_F=900.387,
          Rh1_IP_extSurfaceTub=1009.250,
          Rh1_IP_fluidVol=8.936,
          Rh1_IP_metalVol=2.292,
          Sh_IP_N_G=3,
          Sh_IP_N_F=7,
          Sh_IP_exchSurface_G=2314.8,
          Sh_IP_exchSurface_F=450.218,
          Sh_IP_extSurfaceTub=504.652,
          Sh_IP_gasVol=10,
          Sh_IP_fluidVol=4.468,
          Sh_IP_metalVol=1.146,
          Ev_IP_N_G=4,
          Ev_IP_N_F=4,
          Ev_IP_exchSurface_G=24402,
          Ev_IP_exchSurface_F=1837.063,
          Ev_IP_extSurfaceTub=2163.652,
          Ev_IP_gasVol=10,
          Ev_IP_fluidVol=12.400,
          Ev_IP_metalVol=4.801,
          Ec_IP_N_G=3,
          Ec_IP_N_F=5,
          Ec_IP_exchSurface_G=4067.2,
          Ec_IP_exchSurface_F=306.177,
          Ec_IP_extSurfaceTub=360.609,
          Ec_IP_gasVol=10,
          Ec_IP_fluidVol=2.067,
          Ec_IP_metalVol=0.800,
          Sh_LP_N_G=3,
          Sh_LP_N_F=7,
          Sh_LP_exchSurface_G=1708.2,
          Sh_LP_exchSurface_F=225.073,
          Sh_LP_extSurfaceTub=252.286,
          Sh_LP_gasVol=10,
          Sh_LP_fluidVol=2.234,
          Sh_LP_metalVol=0.573,
          Ev_LP_N_G=4,
          Ev_LP_N_F=4,
          Ev_LP_exchSurface_G=24402,
          Ev_LP_exchSurface_F=2292.926,
          Ev_LP_extSurfaceTub=2592.300,
          Ev_LP_gasVol=10,
          Ev_LP_fluidVol=19.318,
          Ev_LP_metalVol=5.374,
          Ec_LP_N_G=3,
          Ec_LP_N_F=6,
          Ec_LP_exchSurface_G=40095.9,
          Ec_LP_exchSurface_F=3439.389,
          Ec_LP_extSurfaceTub=3888.449,
          Ec_LP_gasVol=10,
          Ec_LP_fluidVol=28.977,
          Ec_LP_metalVol=8.061,
          use_T_Ev=false,
          Sh2_HP_Tstart_G_In=884.65,
          Sh2_HP_Tstart_G_Out=837.31,
          Sh2_HP_Tstart_M_In=742.65,
          Sh2_HP_Tstart_M_Out=823.28,
          Sh2_HP_Tstart_F_In=742.65,
          Sh2_HP_Tstart_F_Out=823.28,
          Sh1_HP_Tstart_G_In=837.15,
          Sh1_HP_Tstart_G_Out=748.60,
          Sh1_HP_Tstart_M_In=606.59,
          Sh1_HP_Tstart_M_Out=743.18,
          Sh1_HP_Tstart_F_In=606.59,
          Sh1_HP_Tstart_F_Out=743.18,
          Ev_HP_Tstart_G_In=747.15,
          Ev_HP_Tstart_G_Out=620.30,
          Ev_HP_hstart_F_In=1.514e6,
          Ev_HP_hstart_F_Out=2.002e6,
          Ec2_HP_Tstart_G_In=614.15,
          Ec2_HP_Tstart_G_Out=558.98,
          Ec2_HP_Tstart_M_In=494.67,
          Ec2_HP_Tstart_M_Out=594.14,
          Ec2_HP_Tstart_F_In=494.67,
          Ec2_HP_Tstart_F_Out=594.14,
          Ec1_HP_Tstart_M_In=431.77,
          Ec1_HP_Tstart_M_Out=494.67,
          Ec1_HP_Tstart_F_In=431.77,
          Ec1_HP_Tstart_F_Out=494.67,
          Rh2_IP_Tstart_M_In=717.31,
          Rh2_IP_Tstart_M_Out=813.09,
          Rh2_IP_Tstart_F_In=717.31,
          Rh2_IP_Tstart_F_Out=813.09,
          Rh1_IP_Tstart_M_In=618.31,
          Rh1_IP_Tstart_M_Out=717.34,
          Rh1_IP_Tstart_F_In=618.31,
          Rh1_IP_Tstart_F_Out=717.34,
          Sh_IP_Tstart_G_In=620.15,
          Sh_IP_Tstart_G_Out=614.50,
          Sh_IP_Tstart_M_In=506.08,
          Sh_IP_Tstart_M_Out=605.11,
          Sh_IP_Tstart_F_In=506.08,
          Sh_IP_Tstart_F_Out=605.11,
          Ev_IP_Tstart_G_In=558.15,
          Ev_IP_Tstart_G_Out=518.51,
          Ev_IP_hstart_F_In=9.92e5,
          Ev_IP_hstart_F_Out=1.37e6,
          Ec_IP_Tstart_G_In=517.15,
          Ec_IP_Tstart_G_Out=480.11,
          Ec_IP_Tstart_M_In=430.24,
          Ec_IP_Tstart_M_Out=493.16,
          Ec_IP_Tstart_F_In=430.24,
          Ec_IP_Tstart_F_Out=493.16,
          Sh_LP_Tstart_G_In=519.15,
          Sh_LP_Tstart_G_Out=517.44,
          Sh_LP_Tstart_M_In=435.75,
          Sh_LP_Tstart_M_Out=505.04,
          Sh_LP_Tstart_F_In=435.75,
          Sh_LP_Tstart_F_Out=505.75,
          Ev_LP_Tstart_G_In=480.00,
          Ev_LP_Tstart_G_Out=453.47,
          Ev_LP_hstart_F_In=6.625e5,
          Ev_LP_hstart_F_Out=1.065e6,
          Ec_LP_Tstart_G_In=453.47,
          Ec_LP_Tstart_G_Out=372.35,
          Ec_LP_Tstart_M_In=331.05,
          Ec_LP_Tstart_M_Out=428.09,
          Ec_LP_Tstart_F_In=331.05,
          Ec_LP_Tstart_F_Out=428.09,
          rhomcm=7900*578.05,
          lambda=20,
          Ec_LP(gamma_G=46.8, gamma_F=4000),
          Ev_LP(gamma_G=127, gamma_F=20000),
          Ec1HP_EcIP(
            gamma_G_A=42,
            gamma_G_B=45,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh_LP(gamma_G=16.6, gamma_F=4000),
          Ev_IP(gamma_G=58.5, gamma_F=20000),
          Ec2_HP(gamma_G=56, gamma_F=4000),
          Sh_IP(gamma_G=33, gamma_F=4000),
          Ev_HP(gamma_G=46.5, gamma_F=20000),
          gasNomPressure=1e5,
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_G_A=83.97,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          redeclare package FlueGasMedium = FlueGasMedium,
          redeclare package FluidMedium = FluidMedium,
          Ev_HP_Tstart_M_In=FluidMedium.temperature_ph(137.1e5, 1.514e6),
          Ev_HP_Tstart_M_Out=FluidMedium.temperature_ph(137.1e5, 2.002e6),
          Ev_IP_Tstart_M_In=FluidMedium.temperature_ph(37.16e5, 9.92e5),
          Ev_IP_Tstart_M_Out=FluidMedium.temperature_ph(37.16e5, 1.37e6),
          Ev_LP_Tstart_M_In=FluidMedium.temperature_ph(15.34e5, 6.625e5),
          Ev_LP_Tstart_M_Out=FluidMedium.temperature_ph(15.34e5, 1.065e6)) 
                             annotation (extent=[-40,-70; 20,-10]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-20,2; -12,-6],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-36,-6; -28,2],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-32,2; -24,-6],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-26,-6; -18,2],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-40,2; -32,-6],    rotation=90);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_in(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[6,2; 14,-6],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-8,-6; 0,2],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-2,2; 6,-6],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[2,-6; 10,2],       rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-12,2; -4,-6],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[38,26; 28,16], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[22,22; 32,32], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,14; 40,4],  rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[34,10; 44,20], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[46,-6; 56,4],  rotation=270);
      equation 
        connect(HeatExchangersGroup.GasIn, GasIn) annotation (points=[-40.3,
              -39.7; -78,-39.7; -78,-10; -100,-10], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(ActuatorsBus, cylindersBodies.ActuatorsBus) annotation (points=[98,36;
              58,36; 58,16.4; 19.4,16.4],           style(color=52, rgbcolor={
                213,255,170}));
        connect(cylindersBodies.SensorsBus, SensorsBus) annotation (points=[19.4,26;
              53.65,26; 53.65,68; 98,68],              style(color=84, rgbcolor=
               {255,170,213}));
        connect(cylindersBodies.tapLPwater, LPwater_Out) annotation (points=[
              -8.2,68; -8,68; -8,76; 80,76; 80,100], style(thickness=2));
        connect(cylindersBodies.tapIPwater, IPwater_Out) annotation (points=[
              -14.2,68; -14.2,82; 40,82; 40,100], style(thickness=2));
        connect(cylindersBodies.tapHPwater, HPwater_Out) annotation (points=[
              -20.2,68; -20.2,84; -40,84; -40,100], style(thickness=2));
        connect(cylindersBodies.IPsteamFromExUse, IPsteam_In) annotation (
            points=[-29.2,68; -29.2,88; 0,88; 0,100], style(thickness=2));
        connect(cylindersBodies.HPsteamFromExUse, HPsteam_In) annotation (
            points=[-35.2,68; -35.2,80; -80,80; -80,100], style(thickness=2));
        connect(Rh_IP_In, HeatExchangersGroup.Rh_IP_In) annotation (points=[-50,
              -100; -50,-80; -22,-80; -22,-70], style(thickness=2));
        connect(Sh_HP_Out, HeatExchangersGroup.Sh_HP_Out) annotation (points=[
              -80,-100; -80,-76; -34,-76; -34,-70], style(thickness=2));
        connect(Rh_IP_Out, HeatExchangersGroup.Rh_IP_Out) annotation (points=[
              -20,-100; -20,-82; -10,-82; -10,-70], style(thickness=2));
        connect(Sh_IP_Out, HeatExchangersGroup.Sh_IP_Out) annotation (points=[
              10,-100; 10,-82; 2,-82; 2,-70], style(thickness=2));
        connect(Sh_LP_Out, HeatExchangersGroup.Sh_LP_Out) annotation (points=[
              40,-100; 40,-80; 14,-80; 14,-70], style(thickness=2));
        connect(HeatExchangersGroup.Sh_HP_In, stateShHP_in.outlet) annotation (
            points=[-36.4,-10; -36.4,-7; -36,-7; -36,-4.4], style(thickness=2));
        connect(stateShHP_in.inlet, cylindersBodies.Steam_HP_Out) 
          annotation (points=[-36,0.4; -36,8; -36.4,8], style(thickness=2));
        connect(stateEvHP_out.outlet, cylindersBodies.FromRiser_HP) 
          annotation (points=[-32,0.4; -32,8; -31.6,8], style(thickness=2));
        connect(stateEvHP_in.inlet, cylindersBodies.ToRiser_HP) 
          annotation (points=[-28,0.4; -28,8; -26.8,8], style(thickness=2));
        connect(stateEcHP_out.outlet, cylindersBodies.Feed_HP) 
          annotation (points=[-22,0.4; -22,8], style(thickness=2));
        connect(stateEcHP_in.inlet, cylindersBodies.WaterForHP) 
          annotation (points=[-16,0.4; -16,8; -17.2,8], style(thickness=2));
        connect(HeatExchangersGroup.Ec_HP_In, stateEcHP_in.outlet) annotation (
            points=[-17.2,-10; -16,-10; -16,-4.4], style(thickness=2));
        connect(HeatExchangersGroup.Ec_HP_Out, stateEcHP_out.inlet) 
          annotation (points=[-22,-10; -22,-4.4], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_In, stateEvHP_in.outlet) annotation (
            points=[-26.8,-10; -28,-10; -28,-4.4], style(thickness=2));
        connect(HeatExchangersGroup.Ev_HP_Out, stateEvHP_out.inlet) annotation (
           points=[-31.6,-10; -32,-10; -32,-4.4], style(thickness=2));
        connect(HeatExchangersGroup.Sh_IP_In, stateShIP_in.outlet) 
          annotation (points=[-8.2,-10; -8,-10; -8,-4.4], style(thickness=2));
        connect(stateShIP_in.inlet, cylindersBodies.Steam_IP_Out) 
          annotation (points=[-8,0.4; -8,8; -8.2,8], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_Out, stateEvIP_out.inlet) 
          annotation (points=[-3.4,-10; -4,-10; -4,-4.4], style(thickness=2));
        connect(stateEvIP_out.outlet, cylindersBodies.FromRiser_IP) annotation (
           points=[-4,0.4; -4,3.8; -3.4,3.8; -3.4,8], style(thickness=2));
        connect(HeatExchangersGroup.Ev_IP_In, stateEvIP_in.outlet) 
          annotation (points=[1.4,-10; 2,-10; 2,-4.4], style(thickness=2));
        connect(stateEvIP_in.inlet, cylindersBodies.ToRiser_IP) annotation (
            points=[2,0.4; 2,3.8; 1.4,3.8; 1.4,8], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_Out, stateEcIP_out.inlet) annotation (
           points=[6.2,-10; 6.2,-7; 6,-7; 6,-4.4], style(thickness=2));
        connect(stateEcIP_out.outlet, cylindersBodies.Feed_IP) 
          annotation (points=[6,0.4; 6,8; 6.2,8], style(thickness=2));
        connect(HeatExchangersGroup.Ec_IP_In, stateEcIP_in.outlet) 
          annotation (points=[11,-10; 10,-10; 10,-4.4], style(thickness=2));
        connect(stateEcIP_in.inlet, cylindersBodies.WaterForIP) 
          annotation (points=[10,0.4; 11,0.4; 11,8], style(thickness=2));
        connect(stateShLP_in.inlet, cylindersBodies.Steam_LP_Out) annotation (
            points=[27,30; 28,30; 28,35.6; 20,35.6], style(thickness=2));
        connect(stateShLP_in.outlet, HeatExchangersGroup.Sh_LP_In) annotation (
            points=[27,24; 28,24; 28,-14.2; 20,-14.2], style(thickness=2));
        connect(stateEvLP_out.outlet, cylindersBodies.FromRiser_LP) annotation (
           points=[33,24; 32,24; 32,40.4; 20,40.4], style(thickness=2));
        connect(stateEvLP_out.inlet, HeatExchangersGroup.Ev_LP_Out) annotation (
           points=[33,18; 32,18; 32,-19; 20,-19], style(thickness=2));
        connect(HeatExchangersGroup.Ev_LP_In, stateEvLP_in.outlet) 
          annotation (points=[20,-23.8; 39,-23.8; 39,12], style(thickness=2));
        connect(stateEcLP_out.inlet, HeatExchangersGroup.Ec_LP_Out) annotation (
           points=[45,6; 44,6; 44,-28.6; 20,-28.6], style(thickness=2));
        connect(HeatExchangersGroup.Ec_LP_In, stateEcLP_in.outlet) 
          annotation (points=[20,-33.4; 51,-33.4; 51,-4], style(thickness=2));
        connect(stateEvLP_in.inlet, cylindersBodies.ToRiser_LP) annotation (
            points=[39,18; 38,18; 38,45.2; 20,45.2], style(thickness=2));
        connect(stateEcLP_out.outlet, cylindersBodies.Fedd_LP) 
          annotation (points=[45,12; 44,12; 44,50; 20,50], style(thickness=2));
        connect(stateEcLP_in.inlet, cylindersBodies.WaterForLP) annotation (
            points=[51,2; 50,2; 50,54.8; 20,54.8], style(thickness=2));
        connect(GasOut, HeatExchangersGroup.GasOut) annotation (points=[100,-10;
              58,-10; 58,-39.7; 20.3,-39.7], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(WaterIn, cylindersBodies.WaterIn) 
          annotation (points=[80,-100; 80,59.6; 20,59.6], style(thickness=2));
      end HRSG_tap_wa;
      
    end Examples;
    
    package Tests 
      model computation_states 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        parameter SI.SpecificEnthalpy h=2.39102e6 "value of specific enthalpy";
        parameter SI.Pressure p=5389.2 "value of pressure";
        parameter SI.Temperature T=288 "value of temperature";
        
        SI.Temperature Tf "Temperature (p,h)";
        SI.SpecificEnthalpy hf "Specific enthalpy (p,T)";
        SI.Temperature Ts "Saturation temperature (p)";
        SI.SpecificEnthalpy hv "Dew specific enthalpy (p)";
        SI.SpecificEnthalpy hl "Bubble specific enthalpy (p)";
        SI.Density rhov "Dew density (p)";
        SI.Density rhol "Bubble density (p)";
        FluidMedium.SaturationProperties sat "Saturation properties";
        
      equation 
        sat.psat = p;
        sat.Tsat = FluidMedium.saturationTemperature(p);
        
        Ts = sat.Tsat;
        hl=FluidMedium.bubbleEnthalpy(sat);
        hv=FluidMedium.dewEnthalpy(sat);
        Tf=FluidMedium.temperature_ph(p,h);
        hf=FluidMedium.specificEnthalpy_pT(p,T);
        rhov=FluidMedium.density_ph(p,h);
        rhol=FluidMedium.bubbleDensity(sat);
      end computation_states;
      
      model TestHE_simp 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
              w0=70.59,
          p0=129.6e5,
          h=3.251e6)          annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=129.6e5,
          h=3.328e6)      annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=862) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          w0=585.5,
          redeclare package Medium = FlueGasMedium,
          T=884.65)          annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE_simp hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          N_F=5,
          exchSurface_G=540.913,
          exchSurface_F=421.844,
          gasVol=10,
          fluidVol=2.615,
          metalVol=1.685,
          rhomcm=7780*688,
          lambda=20,
          gasNomFlowRate=585.5,
          gamma_G=83.97,
          gamma_F=4000,
          Tstart_G_In=884.65,
          Tstart_F_In=742.65,
          fluidNomFlowRate=70.59,
          fluidNomPressure=129.6e5,
          gasNomPressure=0,
          Tstart_M_In=743,
          Tstart_M_Out=824.28,
          Tstart_F_Out=769.84,
          SSInit=false,
          Tstart_G_Out=876.35) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestHE_simp;
      
      model TestEcLP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=453.47 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=372.35 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=89.82 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=6e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=35 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=307.05 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=428.09 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=307.05 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=428.09 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_Out) 
          "Nominal specific enthalpy";
        parameter Boolean SSInit = false "Steady-state initialization";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-10,50; 10,70], rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-10,-70; 10,-50], rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-10; 70,10]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-70,-10; -50,10]);
        annotation (Diagram);
        Components.HE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          N_F=6,
          exchSurface_G=40095.9,
          exchSurface_F=3439.389,
          extSurfaceTub=3888.449,
          gasVol=10,
          fluidVol=28.977,
          metalVol=8.061,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=SSInit,
          gasNomPressure=5e5) 
          annotation (extent=[-30,-30; 30,30]);
      equation 
        connect(hE.waterIn, sourseW_water.flange) annotation (points=[0,24; 0,
              50; -1.83691e-015,50], style(thickness=2));
        connect(hE.waterOut, sinkP_water.flange) annotation (points=[0,-24; 0,
              -50; 1.83691e-015,-50], style(thickness=2));
        connect(hE.gasIn, sourceW_gas.flange) annotation (points=[-24,0; -50,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(hE.gasOut, sinkP_gas.flange) annotation (points=[24,0; 50,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
      end TestEcLP;
      
      model TestEvLP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=480 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=453.47 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=41.49 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=15.34e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_In) 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_Out) 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=6.626e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=1.065e6 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE2ph hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=4,
          N_F=4,
          exchSurface_G=24402,
          exchSurface_F=2292.926,
          extSurfaceTub=2592.300,
          gasVol=10,
          fluidVol=19.318,
          metalVol=5.374,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestEvLP;
      
      model TestShLP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=519.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=517.44 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=6.91 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=6.6e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=50 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=435.75 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=505.04 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_Out) 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          N_F=7,
          exchSurface_G=1708.2,
          exchSurface_F=225.073,
          extSurfaceTub=252.286,
          gasVol=10,
          fluidVol=2.234,
          metalVol=0.573,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestShLP;
      
      model TestEc1HP_EcIP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 
          "Nominal flow rate through the gas side";
        parameter SI.Temperature Tstart_G_In=517.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=480.11 
          "Outlet gas temperature start value";
        
        //fluid A
        parameter SI.MassFlowRate fluidNomFlowRate_A=70.1 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_A=138.9e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_A=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_A=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_A_In=Tstart_F_A_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_A_Out=Tstart_F_A_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_A_In=431.77 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_A_Out=494.67 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_A_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_A_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_Out) 
          "Nominal specific enthalpy";
        
        //fluid B
        parameter SI.MassFlowRate fluidNomFlowRate_B=21.8 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_B=48.6e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_B=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_B=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_B_In=Tstart_F_B_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_B_Out=Tstart_F_B_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_B_In=430.24 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_B_Out=493.16 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_B_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_B_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_Out) 
          "Nominal specific enthalpy";
        Water.SourceW sourseW_water_A(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_A,
          p0=fluidNomPressure_A,
          h=hstart_F_A_In)    annotation (extent=[-38,64; -18,84],rotation=270);
        Water.SinkP sinkP_water_A(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_A,
          h=hstart_F_A_Out) 
                          annotation (extent=[-38,-96; -18,-76],rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[60,-10; 80,10]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          T=Tstart_G_In,
          w0=gasNomFlowRate) annotation (extent=[-94,-10; -74,10]);
        annotation (Diagram);
        Components.ParHE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          gasVol=10,
          lambda=20,
          N_F_A=5,
          exchSurface_G_A=12201.200,
          exchSurface_F_A=870.904,
          extSurfaceTub_A=1081.826,
          fluidVol_A=5.574,
          metalVol_A=3.027,
          rhomcm_A=7900*578.05,
          N_F_B=5,
          exchSurface_G_B=4067.200,
          exchSurface_F_B=306.177,
          extSurfaceTub_B=360.609,
          fluidVol_B=2.067,
          metalVol_B=0.800,
          rhomcm_B=7900*578.05,
          SSInit=true,
          counterCurrent_A=true,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate_A=fluidNomFlowRate_A,
          fluidNomFlowRate_B=fluidNomFlowRate_B,
          fluidNomPressure_A=fluidNomPressure_A,
          fluidNomPressure_B=fluidNomPressure_B,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_A_In=Tstart_M_A_In,
          Tstart_M_A_Out=Tstart_M_A_Out,
          Tstart_F_A_In=Tstart_F_A_In,
          Tstart_F_A_Out=Tstart_F_A_Out,
          Tstart_M_B_In=Tstart_M_B_In,
          Tstart_M_B_Out=Tstart_M_B_Out,
          Tstart_F_B_In=Tstart_F_B_In,
          Tstart_F_B_Out=Tstart_F_B_Out,
          gamma_G_A=gamma_G_A,
          gamma_G_B=gamma_G_B,
          gamma_F_A=gamma_F_A,
          gamma_F_B=gamma_F_B,
          counterCurrent_B=true,
          gasNomPressure=1e5) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SinkP sinkP_water_B(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_B,
          h=hstart_F_B_Out) 
                          annotation (extent=[-2,-96; 18,-76],  rotation=270);
        Water.SourceW sourseW_water_B(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_B,
          p0=fluidNomPressure_B,
          h=hstart_F_B_In)    annotation (extent=[-4,64; 16,84],  rotation=270);
        Water.SensT T_waterIn_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,28; -14,48],
                                             rotation=270);
        Water.SensT T_waterOut_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,-52; -14,-32],
                                               rotation=270);
        Water.SensT T_waterOut_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[2,-52; 22,-32],  rotation=270);
        Water.SensT T_waterIn_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,28; 20,48],  rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
        
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 60,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -74,0],                                     style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_waterOut_A.outlet, sinkP_water_A.flange) annotation (points=[-28,-48;
              -28,-62; -28,-76; -28,-76],          style(thickness=2));
        connect(sinkP_water_B.flange, T_waterOut_B.outlet) annotation (points=[8,-76; 8,
              -69; 8,-69; 8,-62; 8,-48; 8,-48],              style(thickness=2));
        connect(T_waterOut_B.inlet, hE.waterOutB) annotation (points=[8,-36; 8,
              -26; -2,-26; -2,-16], style(thickness=2));
        connect(T_waterOut_A.inlet, hE.waterOutA) annotation (points=[-28,-36;
              -28,-28; -18,-28; -18,-16], style(thickness=2));
        connect(hE.waterInA, T_waterIn_A.outlet) annotation (points=[-18,16;
              -18,24; -28,24; -28,32], style(thickness=2));
        connect(hE.waterInB, T_waterIn_B.outlet) 
          annotation (points=[-2,16; -2,24; 6,24; 6,32], style(thickness=2));
        connect(T_waterIn_B.inlet, sourseW_water_B.flange) 
          annotation (points=[6,44; 6,49; 6,49; 6,54; 6,64; 6,64],
                                                       style(thickness=2));
        connect(T_waterIn_A.inlet, sourseW_water_A.flange) annotation (points=[-28,44;
              -28,54; -28,64; -28,64],         style(thickness=2));
      end TestEc1HP_EcIP;
      
      model TestEvIP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=558.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=518.51 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=67.5 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=37.16e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_In) 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_Out) 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=9.920e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=1.370e6 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE2ph hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=4,
          N_F=4,
          exchSurface_G=24402,
          exchSurface_F=1837.063,
          extSurfaceTub=2163.652,
          gasVol=10,
          fluidVol=12.400,
          metalVol=4.801,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestEvIP;
      
      model TestShIP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=620.14 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=614.5 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=13.5 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=29.5e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=33 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=506.08 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=605.11 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_Out) 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          N_F=7,
          exchSurface_G=2314.8,
          exchSurface_F=450.218,
          extSurfaceTub=504.652,
          gasVol=10,
          fluidVol=4.468,
          metalVol=1.146,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
        Water.SinkP OutIP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[-42,-88; -54,-76],
                                                                rotation=0);
        Water.ValveLin valveLinIP(redeclare package Medium = FluidMedium, Kv=
              fluidNomFlowRate/fluidNomPressure) 
                                 annotation (extent=[-20,-88; -32,-76]);
        Modelica.Blocks.Sources.Constant const 
          annotation (extent=[-86,-50; -76,-40]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
        connect(valveLinIP.outlet,OutIP. flange) 
          annotation (points=[-32,-82; -42,-82],
                                               style(thickness=2));
        connect(valveLinIP.inlet, T_waterOut.outlet) 
          annotation (points=[-20,-82; -10,-82; -10,-58], style(thickness=2));
        connect(const.y, valveLinIP.cmd) annotation (points=[-75.5,-45; -26,-45;
              -26,-77.2], style(color=74, rgbcolor={0,0,127}));
      end TestShIP;
      
      model TestEc2HP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=614.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=558.98 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=70.1 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=138.6e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=60 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=484.77 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=594.14 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure,Tstart_F_Out) 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          N_F=6,
          exchSurface_G=20335,
          exchSurface_F=1451.506,
          extSurfaceTub=1803.043,
          gasVol=10,
          fluidVol=9.290,
          metalVol=5.045,
          rhomcm=7900*578.05,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestEc2HP;
      
      model TestEvHP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 "Nominal mass flowrate";
        parameter SI.Temperature Tstart_G_In=747.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=620.3 
          "Outlet gas temperature start value";
        
        //fluid
        parameter SI.MassFlowRate fluidNomFlowRate=175.5 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure=137.1e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_In=Tstart_F_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_Out=Tstart_F_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_In=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_In) 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_Out=FluidMedium.temperature_ph(fluidNomPressure,hstart_F_Out) 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_In=1.514e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_Out=2.002e6 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water(redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate,
          p0=fluidNomPressure,
          h=hstart_F_In)      annotation (extent=[-20,60; 0,80],  rotation=270);
        Water.SinkP sinkP_water(redeclare package Medium = FluidMedium,
          p0=fluidNomPressure,
          h=hstart_F_Out) annotation (extent=[-20,-98; 0,-78],  rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          w0=gasNomFlowRate,
          T=Tstart_G_In)     annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.HE2ph hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=4,
          N_F=4,
          exchSurface_G=30501.9,
          exchSurface_F=2296.328,
          extSurfaceTub=2704.564,
          gasVol=10,
          fluidVol=15.500,
          metalVol=6.001,
          rhomcm=7900*612.58,
          lambda=20,
          gasNomFlowRate=585.5,
          gasNomPressure=0,
          fluidNomFlowRate=fluidNomFlowRate,
          fluidNomPressure=fluidNomPressure,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_In=Tstart_M_In,
          Tstart_M_Out=Tstart_M_Out,
          Tstart_F_In=Tstart_F_In,
          Tstart_F_Out=Tstart_F_Out,
          gamma_G=gamma_G,
          gamma_F=gamma_F,
          SSInit=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SensT T_waterIn(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,32; 4,52], rotation=270);
        Water.SensT T_waterOut(redeclare package Medium = FluidMedium) 
          annotation (extent=[-16,-62; 4,-42], rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(sinkP_water.flange, T_waterOut.outlet) annotation (points=[-10,-78;
              -10,-68; -10,-68; -10,-58],      style(thickness=2));
        connect(T_waterOut.inlet, hE.waterOut) 
          annotation (points=[-10,-46; -10,-16], style(thickness=2));
        connect(T_waterIn.inlet, sourseW_water.flange) annotation (points=[-10,48;
              -10,54; -10,60; -10,60],     style(thickness=2));
        connect(T_waterIn.outlet, hE.waterIn) 
          annotation (points=[-10,36; -10,16], style(thickness=2));
      end TestEvHP;
      
      model TestSh1HP_Rh1IP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 
          "Nominal flow rate through the gas side";
        parameter SI.Temperature Tstart_G_In=837.15 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=748.6 
          "Outlet gas temperature start value";
        
        //fluid A
        parameter SI.MassFlowRate fluidNomFlowRate_A=70.59 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_A=134.3e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_A=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_A=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_A_In=Tstart_F_A_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_A_Out=Tstart_F_A_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_A_In=606.59 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_A_Out=743.18 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_A_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_A_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_Out) 
          "Nominal specific enthalpy";
        
        //fluid B
        parameter SI.MassFlowRate fluidNomFlowRate_B=81.1 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_B=28.4e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_B=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_B=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_B_In=Tstart_F_B_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_B_Out=Tstart_F_B_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_B_In=618.31 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_B_Out=717.34 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_B_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_B_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_Out) 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water_A(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_A,
          p0=fluidNomPressure_A,
          h=hstart_F_A_In)    annotation (extent=[-38,64; -18,84],rotation=270);
        Water.SinkP sinkP_water_A(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_A,
          h=hstart_F_A_Out) 
                          annotation (extent=[-38,-96; -18,-76],rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          T=Tstart_G_In,
          w0=gasNomFlowRate) annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.ParHE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          gasVol=10,
          lambda=20,
          gasNomPressure=0,
          N_F_A=7,
          exchSurface_G_A=8137.2,
          exchSurface_F_A=612.387,
          extSurfaceTub_A=721.256,
          fluidVol_A=4.134,
          metalVol_A=1.600,
          rhomcm_A=7800*575.22,
          N_F_B=5,
          exchSurface_F_B=4630,
          exchSurface_G_B=900.387,
          extSurfaceTub_B=1009.250,
          fluidVol_B=8.936,
          metalVol_B=2.292,
          rhomcm_B=7850*575.64,
          SSInit=true,
          counterCurrent_A=true,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate_A=fluidNomFlowRate_A,
          fluidNomFlowRate_B=fluidNomFlowRate_B,
          fluidNomPressure_A=fluidNomPressure_A,
          fluidNomPressure_B=fluidNomPressure_B,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_A_In=Tstart_M_A_In,
          Tstart_M_A_Out=Tstart_M_A_Out,
          Tstart_F_A_In=Tstart_F_A_In,
          Tstart_F_A_Out=Tstart_F_A_Out,
          Tstart_M_B_In=Tstart_M_B_In,
          Tstart_M_B_Out=Tstart_M_B_Out,
          Tstart_F_B_In=Tstart_F_B_In,
          Tstart_F_B_Out=Tstart_F_B_Out,
          gamma_G_A=gamma_G_A,
          gamma_G_B=gamma_G_B,
          gamma_F_A=gamma_F_A,
          gamma_F_B=gamma_F_B,
          counterCurrent_B=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SinkP sinkP_water_B(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_B,
          h=hstart_F_B_Out) 
                          annotation (extent=[-2,-96; 18,-76],  rotation=270);
        Water.SourceW sourseW_water_B(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_B,
          p0=fluidNomPressure_B,
          h=hstart_F_B_In)    annotation (extent=[-4,64; 16,84],  rotation=270);
        Water.SensT T_waterIn_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,28; -14,48],
                                             rotation=270);
        Water.SensT T_waterOut_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,-52; -14,-32],
                                               rotation=270);
        Water.SensT T_waterOut_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[2,-52; 22,-32],  rotation=270);
        Water.SensT T_waterIn_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,28; 20,48],  rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_waterOut_A.outlet, sinkP_water_A.flange) annotation (points=[-28,-48;
              -28,-62; -28,-76; -28,-76],          style(thickness=2));
        connect(sinkP_water_B.flange, T_waterOut_B.outlet) annotation (points=[8,-76; 8,
              -69; 8,-69; 8,-62; 8,-48; 8,-48],              style(thickness=2));
        connect(T_waterOut_B.inlet, hE.waterOutB) annotation (points=[8,-36; 8,
              -26; -2,-26; -2,-16], style(thickness=2));
        connect(T_waterOut_A.inlet, hE.waterOutA) annotation (points=[-28,-36;
              -28,-28; -18,-28; -18,-16], style(thickness=2));
        connect(hE.waterInA, T_waterIn_A.outlet) annotation (points=[-18,16;
              -18,24; -28,24; -28,32], style(thickness=2));
        connect(hE.waterInB, T_waterIn_B.outlet) 
          annotation (points=[-2,16; -2,24; 6,24; 6,32], style(thickness=2));
        connect(T_waterIn_B.inlet, sourseW_water_B.flange) 
          annotation (points=[6,44; 6,49; 6,49; 6,54; 6,64; 6,64],
                                                       style(thickness=2));
        connect(T_waterIn_A.inlet, sourseW_water_A.flange) annotation (points=[-28,44;
              -28,54; -28,64; -28,64],         style(thickness=2));
      end TestSh1HP_Rh1IP;
      
      model TestSh2HP_Rh2IP 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //gas
        parameter SI.MassFlowRate gasNomFlowRate=585.5 
          "Nominal flow rate through the gas side";
        parameter SI.Temperature Tstart_G_In=884.65 
          "Inlet gas temperature start value";
        parameter SI.Temperature Tstart_G_Out=823.15 
          "Outlet gas temperature start value";
        
        //fluid A
        parameter SI.MassFlowRate fluidNomFlowRate_A=70.59 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_A=130.5e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_A=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_A=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_A_In=Tstart_F_A_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_A_Out=Tstart_F_A_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_A_In=769.486 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_A_Out=823.28 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_A_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_A_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_A,Tstart_F_A_Out) 
          "Nominal specific enthalpy";
        
        //fluid B
        parameter SI.MassFlowRate fluidNomFlowRate_B=81.1 
          "Nominal flow rate through the fluid side";
        parameter SI.Pressure fluidNomPressure_B=28.2e5 
          "Nominal pressure in the fluid side inlet";
        parameter SI.CoefficientOfHeatTransfer gamma_G_B=40 
          "Constant heat transfer coefficient in the gas side";
        parameter SI.CoefficientOfHeatTransfer gamma_F_B=4000 
          "Constant heat transfer coefficient in the fluid side";
        parameter SI.Temperature Tstart_M_B_In=Tstart_F_B_In 
          "Inlet metal wall temperature start value";
        parameter SI.Temperature Tstart_M_B_Out=Tstart_F_B_Out 
          "Outlet metal wall temperature start value";
        parameter SI.Temperature Tstart_F_B_In=757.896 
          "Inlet fluid temperature start value";
        parameter SI.Temperature Tstart_F_B_Out=813.09 
          "Outlet fluid temperature start value";
        parameter SI.SpecificEnthalpy hstart_F_B_In=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_In) 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy hstart_F_B_Out=FluidMedium.specificEnthalpy_pT(fluidNomPressure_B,Tstart_F_B_Out) 
          "Nominal specific enthalpy";
        
        Water.SourceW sourseW_water_A(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_A,
          p0=fluidNomPressure_A,
          h=hstart_F_A_In)    annotation (extent=[-38,64; -18,84],rotation=270);
        Water.SinkP sinkP_water_A(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_A,
          h=hstart_F_A_Out) 
                          annotation (extent=[-38,-96; -18,-76],rotation=270);
        Gas.SinkP sinkP_gas(redeclare package Medium = FlueGasMedium, T=Tstart_G_Out) 
                         annotation (extent=[50,-12; 76,12]);
        Gas.SourceW sourceW_gas(
          redeclare package Medium = FlueGasMedium,
          T=Tstart_G_In,
          w0=gasNomFlowRate) annotation (extent=[-90,-14; -68,14]);
        annotation (Diagram);
        Components.ParHE hE(redeclare package FluidMedium = FluidMedium,
          redeclare package FlueGasMedium = FlueGasMedium,
          N_G=3,
          gasVol=10,
          lambda=20,
          gasNomPressure=0,
          N_F_A=5,
          exchSurface_G_A=3636,
          exchSurface_F_A=421.844,
          extSurfaceTub_A=540.913,
          fluidVol_A=2.615,
          metalVol_A=1.685,
          rhomcm_A=7780*688.31,
          N_F_B=7,
          exchSurface_F_B=4630.2,
          exchSurface_G_B=873.079,
          extSurfaceTub_B=1009.143,
          fluidVol_B=8.403,
          metalVol_B=2.823,
          rhomcm_B=7800*574.93,
          SSInit=true,
          counterCurrent_A=true,
          gasNomFlowRate=gasNomFlowRate,
          fluidNomFlowRate_A=fluidNomFlowRate_A,
          fluidNomFlowRate_B=fluidNomFlowRate_B,
          fluidNomPressure_A=fluidNomPressure_A,
          fluidNomPressure_B=fluidNomPressure_B,
          Tstart_G_In=Tstart_G_In,
          Tstart_G_Out=Tstart_G_Out,
          Tstart_M_A_In=Tstart_M_A_In,
          Tstart_M_A_Out=Tstart_M_A_Out,
          Tstart_F_A_In=Tstart_F_A_In,
          Tstart_F_A_Out=Tstart_F_A_Out,
          Tstart_M_B_In=Tstart_M_B_In,
          Tstart_M_B_Out=Tstart_M_B_Out,
          Tstart_F_B_In=Tstart_F_B_In,
          Tstart_F_B_Out=Tstart_F_B_Out,
          gamma_G_A=gamma_G_A,
          gamma_G_B=gamma_G_B,
          gamma_F_A=gamma_F_A,
          gamma_F_B=gamma_F_B,
          counterCurrent_B=true) 
          annotation (extent=[-30,-20; 10,20]);
        Water.SinkP sinkP_water_B(
          redeclare package Medium = FluidMedium,
          p0=fluidNomPressure_B,
          h=hstart_F_B_Out) 
                          annotation (extent=[-2,-96; 18,-76],  rotation=270);
        Water.SourceW sourseW_water_B(
          redeclare package Medium = FluidMedium,
          w0=fluidNomFlowRate_B,
          p0=fluidNomPressure_B,
          h=hstart_F_B_In)    annotation (extent=[-4,64; 16,84],  rotation=270);
        Water.SensT T_waterIn_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,28; -14,48],
                                             rotation=270);
        Water.SensT T_waterOut_A(redeclare package Medium = FluidMedium) 
          annotation (extent=[-34,-52; -14,-32],
                                               rotation=270);
        Water.SensT T_waterOut_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[2,-52; 22,-32],  rotation=270);
        Water.SensT T_waterIn_B(redeclare package Medium = FluidMedium) 
          annotation (extent=[0,28; 20,48],  rotation=270);
        Gas.SensT T_gasIn(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[-58,-6; -38,14]);
        Gas.SensT T_gasOut(redeclare package Medium = FlueGasMedium) 
          annotation (extent=[20,-6; 40,14]);
        
      equation 
        connect(T_gasOut.inlet, hE.gasOut) annotation (points=[24,0; 6,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasOut.outlet, sinkP_gas.flange) annotation (points=[36,0; 50,
              0], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.outlet, hE.gasIn) annotation (points=[-42,0; -26,0],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_gasIn.inlet, sourceW_gas.flange) annotation (points=[-54,0;
              -61,0; -61,1.77636e-015; -68,1.77636e-015], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(T_waterOut_A.outlet, sinkP_water_A.flange) annotation (points=[-28,-48;
              -28,-62; -28,-76; -28,-76],          style(thickness=2));
        connect(sinkP_water_B.flange, T_waterOut_B.outlet) annotation (points=[8,-76; 8,
              -69; 8,-69; 8,-62; 8,-48; 8,-48],              style(thickness=2));
        connect(T_waterOut_B.inlet, hE.waterOutB) annotation (points=[8,-36; 8,
              -26; -2,-26; -2,-16], style(thickness=2));
        connect(T_waterOut_A.inlet, hE.waterOutA) annotation (points=[-28,-36;
              -28,-28; -18,-28; -18,-16], style(thickness=2));
        connect(hE.waterInA, T_waterIn_A.outlet) annotation (points=[-18,16;
              -18,24; -28,24; -28,32], style(thickness=2));
        connect(hE.waterInB, T_waterIn_B.outlet) 
          annotation (points=[-2,16; -2,24; 6,24; 6,32], style(thickness=2));
        connect(T_waterIn_B.inlet, sourseW_water_B.flange) 
          annotation (points=[6,44; 6,49; 6,49; 6,54; 6,64; 6,64],
                                                       style(thickness=2));
        connect(T_waterIn_A.inlet, sourseW_water_A.flange) annotation (points=[-28,44;
              -28,54; -28,64; -28,64],         style(thickness=2));
      end TestSh2HP_Rh2IP;
      
      model TestHEG_3LRh_wa 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        //HP
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh=67.6 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Sh=138.9e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev=175.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Ev=138.9e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec=67.6 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Ec=138.9e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In= 2.657e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In= 1.514e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out= 1.9423e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_In= 6.775e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_Out= 1.45077e6 
          "Nominal specific enthalpy";
        
        //IP
        parameter SI.MassFlowRate fluidIPNomFlowRate_Rh=81.10 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Rh=33.8e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Sh=13.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Sh=33.8e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ev=67.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Ev=33.8e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ec=13.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Ec=33.8e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_In= 3.22e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_Out=3.64853e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_In=2.802e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_In= 9.92e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_Out= 1.36395e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_In=6.654e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_Out=9.70768e5 
          "Nominal specific enthalpy";
        
        //LP
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh=8.72 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Sh=7.19e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev=41.49 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Ev=7.19e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec=89.82 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Ec=7.19e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In= 2.760e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In= 6.626e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=1.0227e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=2.44e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=6.39929e5 
          "Nominal specific enthalpy";
        
        Water.SinkP OutHP(redeclare package Medium = FluidMedium, p0=0) 
                          annotation (extent=[-82,-90; -94,-78],
                                                              rotation=0);
        Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=375.386) 
                         annotation (extent=[68,-30; 80,-18]);
        Gas.SourceW sourceGas(
          redeclare package Medium = FlueGasMedium,
          w0=585.5,
          T=884.65)          annotation (extent=[-98,-32; -84,-18]);
        Water.SinkP sinkEvHP(
          redeclare package Medium = FluidMedium,
          p0=fluidHPNomPressure_Ev,
          h=Ev_HP_hstart_F_Out) 
                           annotation (extent=[-52,88; -40,100],rotation=90);
        Water.ValveLin valveLinHP(redeclare package Medium = FluidMedium, Kv=
              fluidHPNomFlowRate_Sh/fluidHPNomPressure_Sh) 
                                annotation (extent=[-62,-78; -74,-90]);
        Water.SinkP OutIP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[-14,-90; -26,-78],
                                                                rotation=0);
        Water.ValveLin valveLinIP(redeclare package Medium = FluidMedium, Kv=
              fluidIPNomFlowRate_Sh/fluidIPNomPressure_Sh) 
                                 annotation (extent=[4,-78; -8,-90]);
        Water.SinkP OutLP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[56,-90; 68,-78], rotation=0);
        Water.ValveLin valveLinLP(redeclare package Medium = FluidMedium, Kv=
              fluidLPNomFlowRate_Sh/fluidLPNomPressure_Sh) 
                                 annotation (extent=[36,-78; 48,-90]);
        annotation (Diagram, Icon);
        Water.SourceW sourceEvHP(
          redeclare package Medium = FluidMedium,
          w0=fluidHPNomFlowRate_Ev,
          p0=fluidHPNomPressure_Ev,
          h=Ev_HP_hstart_F_In) 
                              annotation (extent=[-44,76; -32,88], rotation=270);
        Water.SourceW sourceRhIP(
          redeclare package Medium = FluidMedium,
          w0=fluidIPNomFlowRate_Rh,
          p0=fluidIPNomPressure_Rh,
          h=Rh1_IP_hstart_F_In) 
                              annotation (extent=[-36,-72; -24,-60],
                                                                   rotation=90);
        Water.SinkP sinkRhIP(
          redeclare package Medium = FluidMedium,
          p0=fluidIPNomPressure_Rh,
          h=Rh2_IP_hstart_F_Out) 
                           annotation (extent=[-16,-60; -4,-72],rotation=90);
        Modelica.Blocks.Sources.Constant commandValve 
          annotation (extent=[-44,-90; -34,-80], rotation=270);
        Water.SinkP sinkEcHP(
          redeclare package Medium = FluidMedium,
          p0=fluidHPNomPressure_Ec,
          h=Ec2_HP_hstart_F_Out) 
                           annotation (extent=[-36,88; -24,100],rotation=90);
        Water.SourceW sourceEcHP(
          redeclare package Medium = FluidMedium,
          w0=fluidHPNomFlowRate_Ec,
          p0=fluidHPNomPressure_Ec,
          h=Ec1_HP_hstart_F_In) 
                              annotation (extent=[-28,76; -16,88], rotation=270);
        Water.SinkP sinkEvIP(
          redeclare package Medium = FluidMedium,
          p0=fluidIPNomPressure_Ev,
          h=Ev_IP_hstart_F_Out) 
                           annotation (extent=[-4,88; 8,100],   rotation=90);
        Water.SourceW sourceEvIP(
          redeclare package Medium = FluidMedium,
          w0=fluidIPNomFlowRate_Ev,
          p0=fluidIPNomPressure_Ev,
          h=Ev_IP_hstart_F_In) 
                              annotation (extent=[4,76; 16,88],    rotation=270);
        Water.SinkP sinkEcIP(
          redeclare package Medium = FluidMedium,
          p0=fluidIPNomPressure_Ec,
          h=Ec_IP_hstart_F_Out) 
                           annotation (extent=[12,88; 24,100],  rotation=90);
        Water.SourceW sourceEcIP(
          redeclare package Medium = FluidMedium,
          w0=fluidIPNomFlowRate_Ec,
          p0=fluidIPNomPressure_Ec,
          h=Ec_IP_hstart_F_In) 
                              annotation (extent=[20,76; 32,88],   rotation=270);
        Water.SinkP sinkEvLP(
          redeclare package Medium = FluidMedium,
          p0=fluidLPNomPressure_Ev,
          h=Ev_LP_hstart_F_Out) 
                           annotation (extent=[84,32; 96,44],   rotation=0);
        Water.SourceW sourceEvLP(
          redeclare package Medium = FluidMedium,
          w0=fluidLPNomFlowRate_Ev,
          p0=fluidLPNomPressure_Ev,
          h=Ev_LP_hstart_F_In) 
                              annotation (extent=[70,36; 82,24],   rotation=180);
        Water.SinkP sinkEcLP(
          redeclare package Medium = FluidMedium,
          p0=fluidLPNomPressure_Ec,
          h=Ec_LP_hstart_F_Out) 
                           annotation (extent=[84,16; 96,28],   rotation=0);
        Water.SourceW sourceEcLP(
          redeclare package Medium = FluidMedium,
          w0=fluidLPNomFlowRate_Ec,
          p0=fluidLPNomPressure_Ec,
          h=Ec_LP_hstart_F_In) 
                              annotation (extent=[70,20; 82,8],    rotation=180);
        Water.SourceP sourceShHP(p0=fluidHPNomPressure_Sh, h=Sh1_HP_hstart_F_In) 
          annotation (extent=[-48,76; -60,88], rotation=270);
        Water.SourceP sourceShIP(p0=fluidIPNomPressure_Sh, h=Sh_IP_hstart_F_In) 
          annotation (extent=[0,76; -12,88], rotation=270);
        Water.SourceP sourceShLP(p0=fluidLPNomPressure_Sh, h=Sh_LP_hstart_F_In) 
          annotation (extent=[70,52; 82,40], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[62,44; 50,32], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,40; 62,52], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[62,28; 50,16], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,24; 62,36], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[50,8; 62,20],  rotation=180);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-28,72; -16,60],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-52,60; -40,72],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-44,72; -32,60],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-36,60; -24,72],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-60,72; -48,60],   rotation=90);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_in(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[20,72; 32,60],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-4,60; 8,72],      rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[4,72; 16,60],      rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[12,60; 24,72],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-12,72; 0,60],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-58,-56; -42,-72], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[2,-56; 18,-72],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[22,-56; 38,-72],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                               redeclare package Medium = 
              FlueGasMedium) annotation (extent=[-86,-18; -66,2], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                redeclare package Medium = 
              FlueGasMedium) annotation (extent=[50,-18; 70,2], rotation=270);
        ThermoPower.PowerPlants.HRSG.Examples.HEG_3LRh_wa hEG_3LRh_simp(
          gasNomFlowRate=585.5,
          fluidHPNomFlowRate_Sh=70.59,
          fluidHPNomPressure_Sh=134.3e5,
          fluidHPNomFlowRate_Ev=175.5,
          fluidHPNomPressure_Ev=137.1e5,
          fluidHPNomFlowRate_Ec=70.10,
          fluidHPNomPressure_Ec=138.9e5,
          fluidIPNomFlowRate_Rh=81.10,
          fluidIPNomPressure_Rh=28.4e5,
          fluidIPNomFlowRate_Sh=13.5,
          fluidIPNomPressure_Sh=29.5e5,
          fluidIPNomFlowRate_Ev=67.5,
          fluidIPNomPressure_Ev=37.16e5,
          fluidIPNomFlowRate_Ec=21.8,
          fluidIPNomPressure_Ec=48.6e5,
          fluidLPNomFlowRate_Sh=6.91,
          fluidLPNomPressure_Sh=6.6e5,
          fluidLPNomFlowRate_Ev=41.49,
          fluidLPNomPressure_Ev=15.34e5,
          fluidLPNomFlowRate_Ec=122.4,
          fluidLPNomPressure_Ec=19.8e5,
          Sh2_HP_N_G=3,
          Sh2_HP_N_F=5,
          Sh2_HP_exchSurface_G=3636,
          Sh2_HP_exchSurface_F=421.844,
          Sh2_HP_extSurfaceTub=540.913,
          Sh2_HP_gasVol=10,
          Sh2_HP_fluidVol=2.615,
          Sh2_HP_metalVol=1.685,
          Sh1_HP_N_G=3,
          Sh1_HP_N_F=7,
          Sh1_HP_exchSurface_G=8137.2,
          Sh1_HP_exchSurface_F=612.387,
          Sh1_HP_extSurfaceTub=721.256,
          Sh1_HP_gasVol=10,
          Sh1_HP_fluidVol=4.134,
          Sh1_HP_metalVol=1.600,
          Ev_HP_N_G=4,
          Ev_HP_N_F=4,
          Ev_HP_exchSurface_G=30501.9,
          Ev_HP_exchSurface_F=2296.328,
          Ev_HP_extSurfaceTub=2704.564,
          Ev_HP_gasVol=10,
          Ev_HP_fluidVol=15.500,
          Ev_HP_metalVol=6.001,
          Ec2_HP_N_G=3,
          Ec2_HP_N_F=6,
          Ec2_HP_exchSurface_G=20335,
          Ec2_HP_exchSurface_F=1451.506,
          Ec2_HP_extSurfaceTub=1803.043,
          Ec2_HP_gasVol=10,
          Ec2_HP_fluidVol=9.290,
          Ec2_HP_metalVol=5.045,
          Ec1_HP_N_G=3,
          Ec1_HP_N_F=5,
          Ec1_HP_exchSurface_G=12201.2,
          Ec1_HP_exchSurface_F=870.904,
          Ec1_HP_extSurfaceTub=1081.826,
          Ec1_HP_gasVol=10,
          Ec1_HP_fluidVol=5.574,
          Ec1_HP_metalVol=3.027,
          Rh2_IP_N_F=7,
          Rh2_IP_exchSurface_G=4630.2,
          Rh2_IP_exchSurface_F=873.079,
          Rh2_IP_extSurfaceTub=1009.143,
          Rh2_IP_fluidVol=8.403,
          Rh2_IP_metalVol=2.823,
          Rh1_IP_N_F=5,
          Rh1_IP_exchSurface_G=4630,
          Rh1_IP_exchSurface_F=900.387,
          Rh1_IP_extSurfaceTub=1009.250,
          Rh1_IP_fluidVol=8.936,
          Rh1_IP_metalVol=2.292,
          Sh_IP_N_G=3,
          Sh_IP_N_F=7,
          Sh_IP_exchSurface_G=2314.8,
          Sh_IP_exchSurface_F=450.218,
          Sh_IP_extSurfaceTub=504.652,
          Sh_IP_gasVol=10,
          Sh_IP_fluidVol=4.468,
          Sh_IP_metalVol=1.146,
          Ev_IP_N_G=4,
          Ev_IP_N_F=4,
          Ev_IP_exchSurface_G=24402,
          Ev_IP_exchSurface_F=1837.063,
          Ev_IP_extSurfaceTub=2163.652,
          Ev_IP_gasVol=10,
          Ev_IP_fluidVol=12.400,
          Ev_IP_metalVol=4.801,
          Ec_IP_N_G=3,
          Ec_IP_N_F=5,
          Ec_IP_exchSurface_G=4067.2,
          Ec_IP_exchSurface_F=306.177,
          Ec_IP_extSurfaceTub=360.609,
          Ec_IP_gasVol=10,
          Ec_IP_fluidVol=2.067,
          Ec_IP_metalVol=0.800,
          Sh_LP_N_G=3,
          Sh_LP_N_F=7,
          Sh_LP_exchSurface_G=1708.2,
          Sh_LP_exchSurface_F=225.073,
          Sh_LP_extSurfaceTub=252.286,
          Sh_LP_gasVol=10,
          Sh_LP_fluidVol=2.234,
          Sh_LP_metalVol=0.573,
          Ev_LP_N_G=4,
          Ev_LP_N_F=4,
          Ev_LP_exchSurface_G=24402,
          Ev_LP_exchSurface_F=2292.926,
          Ev_LP_extSurfaceTub=2592.300,
          Ev_LP_gasVol=10,
          Ev_LP_fluidVol=19.318,
          Ev_LP_metalVol=5.374,
          Ec_LP_N_G=3,
          Ec_LP_N_F=6,
          Ec_LP_exchSurface_G=40095.9,
          Ec_LP_exchSurface_F=3439.389,
          Ec_LP_extSurfaceTub=3888.449,
          Ec_LP_gasVol=10,
          Ec_LP_fluidVol=28.977,
          Ec_LP_metalVol=8.061,
          use_T_Ev=false,
          Sh2_HP_Tstart_G_In=884.65,
          Sh2_HP_Tstart_G_Out=837.31,
          Sh2_HP_Tstart_M_In=742.65,
          Sh2_HP_Tstart_M_Out=823.28,
          Sh2_HP_Tstart_F_In=742.65,
          Sh2_HP_Tstart_F_Out=823.28,
          Sh1_HP_Tstart_G_In=837.15,
          Sh1_HP_Tstart_G_Out=748.60,
          Sh1_HP_Tstart_M_In=606.59,
          Sh1_HP_Tstart_M_Out=743.18,
          Sh1_HP_Tstart_F_In=606.59,
          Sh1_HP_Tstart_F_Out=743.18,
          Ev_HP_Tstart_G_In=747.15,
          Ev_HP_Tstart_G_Out=620.30,
          Ev_HP_Tstart_M_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev, 1.514e6),
          Ev_HP_Tstart_M_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,
              2.002e6),
          Ev_HP_hstart_F_In=1.514e6,
          Ev_HP_hstart_F_Out=2.002e6,
          Ec2_HP_Tstart_G_In=614.15,
          Ec2_HP_Tstart_G_Out=558.98,
          Ec2_HP_Tstart_M_In=494.67,
          Ec2_HP_Tstart_M_Out=594.14,
          Ec2_HP_Tstart_F_In=494.67,
          Ec2_HP_Tstart_F_Out=594.14,
          Ec1_HP_Tstart_M_In=431.77,
          Ec1_HP_Tstart_M_Out=494.67,
          Ec1_HP_Tstart_F_In=431.77,
          Ec1_HP_Tstart_F_Out=494.67,
          Rh2_IP_Tstart_M_In=717.31,
          Rh2_IP_Tstart_M_Out=813.09,
          Rh2_IP_Tstart_F_In=717.31,
          Rh2_IP_Tstart_F_Out=813.09,
          Rh1_IP_Tstart_M_In=618.31,
          Rh1_IP_Tstart_M_Out=717.34,
          Rh1_IP_Tstart_F_In=618.31,
          Rh1_IP_Tstart_F_Out=717.34,
          Sh_IP_Tstart_G_In=620.15,
          Sh_IP_Tstart_G_Out=614.50,
          Sh_IP_Tstart_M_In=506.08,
          Sh_IP_Tstart_M_Out=605.11,
          Sh_IP_Tstart_F_In=506.08,
          Sh_IP_Tstart_F_Out=605.11,
          Ev_IP_Tstart_G_In=558.15,
          Ev_IP_Tstart_G_Out=518.51,
          Ev_IP_Tstart_M_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ev, 9.92e5),
          Ev_IP_Tstart_M_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ev, 1.37e6),
          Ev_IP_hstart_F_In=9.92e5,
          Ev_IP_hstart_F_Out=1.37e6,
          Ec_IP_Tstart_G_In=517.15,
          Ec_IP_Tstart_G_Out=480.11,
          Ec_IP_Tstart_M_In=430.24,
          Ec_IP_Tstart_M_Out=493.16,
          Ec_IP_Tstart_F_In=430.24,
          Ec_IP_Tstart_F_Out=493.16,
          Sh_LP_Tstart_G_In=519.15,
          Sh_LP_Tstart_G_Out=517.44,
          Sh_LP_Tstart_M_In=435.75,
          Sh_LP_Tstart_M_Out=505.04,
          Sh_LP_Tstart_F_In=435.75,
          Sh_LP_Tstart_F_Out=505.75,
          Ev_LP_Tstart_G_In=480.00,
          Ev_LP_Tstart_G_Out=453.47,
          Ev_LP_Tstart_M_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev, 6.625e5),
          Ev_LP_Tstart_M_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,
              1.065e6),
          Ev_LP_hstart_F_In=6.625e5,
          Ev_LP_hstart_F_Out=1.065e6,
          Ec_LP_Tstart_G_In=453.47,
          Ec_LP_Tstart_G_Out=372.35,
          Ec_LP_Tstart_M_In=331.05,
          Ec_LP_Tstart_M_Out=428.09,
          Ec_LP_Tstart_F_In=331.05,
          Ec_LP_Tstart_F_Out=428.09,
          rhomcm=7900*578.05,
          lambda=20,
          Ec_LP(gamma_G=46.8, gamma_F=4000),
          Ev_LP(gamma_G=127, gamma_F=20000),
          Ec1HP_EcIP(
            gamma_G_A=42,
            gamma_G_B=45,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh_LP(gamma_G=16.6, gamma_F=4000),
          Ev_IP(gamma_G=58.5, gamma_F=20000),
          Ec2_HP(gamma_G=56, gamma_F=4000),
          Sh_IP(gamma_G=33, gamma_F=4000),
          Ev_HP(gamma_G=46.5, gamma_F=20000),
          gasNomPressure=1e5,
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_G_A=83.97,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          SSInit=false)      annotation (extent=[-60,-48; 40,52]);
      equation 
        connect(OutHP.flange, valveLinHP.outlet) 
          annotation (points=[-82,-84; -74,-84],style(thickness=2));
        connect(valveLinLP.outlet, OutLP.flange) 
          annotation (points=[48,-84; 56,-84], style(thickness=2));
        connect(valveLinIP.outlet, OutIP.flange) 
          annotation (points=[-8,-84; -14,-84], style(thickness=2));
        connect(commandValve.y, valveLinHP.cmd) annotation (points=[-39,-90.5;
              -39,-98; -68,-98; -68,-88.8], style(color=74, rgbcolor={0,0,127}));
        connect(commandValve.y, valveLinIP.cmd) annotation (points=[-39,-90.5;
              -39,-98; -2,-98; -2,-88.8], style(color=74, rgbcolor={0,0,127}));
        connect(commandValve.y, valveLinLP.cmd) annotation (points=[-39,-90.5;
              -39,-98; 42,-98; 42,-88.8], style(color=74, rgbcolor={0,0,127}));
        connect(sourceShLP.flange, stateShLP_in.inlet) 
          annotation (points=[70,46; 59.6,46], style(thickness=2));
        connect(sinkEvLP.flange, stateEvLP_out.outlet) 
          annotation (points=[84,38; 59.6,38], style(thickness=2));
        connect(sourceEvLP.flange, stateEvLP_in.inlet) 
          annotation (points=[70,30; 59.6,30], style(thickness=2));
        connect(sinkEcLP.flange, stateEcLP_out.outlet) 
          annotation (points=[84,22; 59.6,22], style(thickness=2));
        connect(sourceEcLP.flange, stateEcLP_in.inlet) 
          annotation (points=[70,14; 59.6,14], style(thickness=2));
        connect(stateShHP_in.inlet, sourceShHP.flange) 
          annotation (points=[-54,69.6; -54,76], style(thickness=2));
        connect(stateEvHP_out.outlet, sinkEvHP.flange) 
          annotation (points=[-46,69.6; -46,88], style(thickness=2));
        connect(stateEcHP_in.inlet, sourceEcHP.flange) 
          annotation (points=[-22,69.6; -22,76], style(thickness=2));
        connect(stateEcHP_out.outlet, sinkEcHP.flange) 
          annotation (points=[-30,69.6; -30,88], style(thickness=2));
        connect(stateEvHP_in.inlet, sourceEvHP.flange) 
          annotation (points=[-38,69.6; -38,76], style(thickness=2));
        connect(stateEcIP_in.inlet, sourceEcIP.flange) 
          annotation (points=[26,69.6; 26,76], style(thickness=2));
        connect(stateEcIP_out.outlet, sinkEcIP.flange) 
          annotation (points=[18,69.6; 18,88], style(thickness=2));
        connect(stateEvIP_in.inlet, sourceEvIP.flange) annotation (points=[10,69.6;
              10,72.8; 10,76; 10,76],       style(thickness=2));
        connect(stateEvIP_out.outlet, sinkEvIP.flange) 
          annotation (points=[2,69.6; 2,78.8; 2,88; 2,88], style(thickness=2));
        connect(stateShIP.inlet, sourceShIP.flange) annotation (points=[-6,69.6;
              -6,72.8; -6,76; -6,76], style(thickness=2));
        connect(stateShHP_out.outlet, valveLinHP.inlet) annotation (points=[-50,
              -68.8; -50,-84; -62,-84], style(thickness=2));
        connect(valveLinLP.inlet, stateShLP_out.outlet) 
          annotation (points=[36,-84; 30,-84; 30,-68.8], style(thickness=2));
        connect(valveLinIP.inlet, stateShIP_out.outlet) 
          annotation (points=[4,-84; 10,-84; 10,-68.8], style(thickness=2));
        connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-76,-14;
              -76,-25; -84,-25],      style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[68,-24;
              60,-24; 60,-14], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_out.inlet, hEG_3LRh_simp.GasOut) annotation (points=[60,-2;
              60,2.5; 40.5,2.5],        style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_in.outlet, hEG_3LRh_simp.GasIn) annotation (points=[-76,-2;
              -76,2.5; -60.5,2.5],         style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(hEG_3LRh_simp.Sh_HP_In, stateShHP_in.outlet) 
          annotation (points=[-54,52; -54,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ev_HP_Out, stateEvHP_out.inlet) 
          annotation (points=[-46,52; -46,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ev_HP_In, stateEvHP_in.outlet) 
          annotation (points=[-38,52; -38,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ec_HP_Out, stateEcHP_out.inlet) 
          annotation (points=[-30,52; -30,62.4; -30,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ec_HP_In, stateEcHP_in.outlet) 
          annotation (points=[-22,52; -22,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Sh_IP_In, stateShIP.outlet) 
          annotation (points=[-7,52; -6,52; -6,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ev_IP_Out, stateEvIP_out.inlet) 
          annotation (points=[1,52; 1,57; 2,57; 2,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ev_IP_In, stateEvIP_in.outlet) 
          annotation (points=[9,52; 10,52; 10,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ec_IP_Out, stateEcIP_out.inlet) annotation (
            points=[17,52; 17,57; 18,57; 18,62.4], style(thickness=2));
        connect(hEG_3LRh_simp.Ec_IP_In, stateEcIP_in.outlet) 
          annotation (points=[25,52; 26,52; 26,62.4], style(thickness=2));
        connect(stateShLP_in.outlet, hEG_3LRh_simp.Sh_LP_In) annotation (points=
             [52.4,46; 46.2,46; 46.2,45; 40,45], style(thickness=2));
        connect(stateEvLP_out.inlet, hEG_3LRh_simp.Ev_LP_Out) annotation (
            points=[52.4,38; 46.2,38; 46.2,37; 40,37], style(thickness=2));
        connect(stateEvLP_in.outlet, hEG_3LRh_simp.Ev_LP_In) annotation (points=
             [52.4,30; 46.2,30; 46.2,29; 40,29], style(thickness=2));
        connect(stateEcLP_out.inlet, hEG_3LRh_simp.Ec_LP_Out) annotation (
            points=[52.4,22; 45.2,22; 45.2,21; 40,21], style(thickness=2));
        connect(stateEcLP_in.outlet, hEG_3LRh_simp.Ec_LP_In) annotation (points=
             [52.4,14; 48,14; 48,13; 40,13], style(thickness=2));
        connect(stateShHP_out.inlet, hEG_3LRh_simp.Sh_HP_Out) 
          annotation (points=[-50,-59.2; -50,-48], style(thickness=2));
        connect(sourceRhIP.flange, hEG_3LRh_simp.Rh_IP_In) 
          annotation (points=[-30,-60; -30,-48], style(thickness=2));
        connect(sinkRhIP.flange, hEG_3LRh_simp.Rh_IP_Out) 
          annotation (points=[-10,-60; -10,-48; -10,-48], style(thickness=2));
        connect(stateShIP_out.inlet, hEG_3LRh_simp.Sh_IP_Out) 
          annotation (points=[10,-59.2; 10,-59.2; 10,-48], style(thickness=2));
        connect(stateShLP_out.inlet, hEG_3LRh_simp.Sh_LP_Out) 
          annotation (points=[30,-59.2; 30,-48], style(thickness=2));
      end TestHEG_3LRh_wa;
      
      model TestDG_3LCC_wafp 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wafp Drums(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          IPd_hlstart=1.0265e5) annotation (extent=[-94,-20; 6,80]);
        Water.SinkP sinkToEcLP_p(           h=2.440e5, p0=7.19e5) 
          annotation (extent=[74,52; 86,64]);
        annotation (Diagram);
        Water.SourceW sourceFromEcLP_w(
          h=6.544e5,
          w0=89.8,
          p0=7.19048e5) 
                     annotation (extent=[70,44; 58,56]);
        Water.SinkP sinkToRiserLP_p(p0=1.534e6, h=1.6325e6) 
          annotation (extent=[74,36; 86,48]);
        Water.SourceW sourceFromRiserLP_w(
          w0=41.49,
          h=1.065e6,
          p0=7.19046e5) 
                     annotation (extent=[70,28; 58,40]);
        Water.SinkP sinkToShLP_p(          h=2.760e6,
          redeclare package Medium = FluidMedium,
          p0=5.398e3) 
          annotation (extent=[74,20; 86,32]);
        Water.SinkP sinkToEcHP_p(p0=1.389e7, h=6.775e5) 
          annotation (extent=[-62,-70; -50,-58], rotation=270);
        Water.SourceW sourceFromEcHP_w(
          w0=69.5,
          h=1.463e6,
          p0=1.626e7) 
                     annotation (extent=[-58,-56; -70,-44], rotation=90);
        Water.SinkP sinkToRiserHP_p(p0=1.371e7, h=1.6325e6) 
          annotation (extent=[-78,-70; -66,-58], rotation=270);
        Water.SourceW sourceFromRiserHP_w(
          w0=175.5,
          h=2.002e6,
          p0=1.626e7) 
                     annotation (extent=[-74,-56; -86,-44], rotation=90);
        Water.SinkP sinkToShHP_p(            h=2.657e6,
          redeclare package Medium = FluidMedium,
          p0=2.98e6) 
          annotation (extent=[-58,-86; -46,-74], rotation=0);
        Water.SinkP sinkToEcIP_p(p0=4.86e6, h=6.654e5) 
          annotation (extent=[-14,-70; -2,-58], rotation=270);
        Water.SourceW sourceFromEcIP_w(
          h=9.444e5,
          w0=12.7,
          p0=3.3816e6) 
                     annotation (extent=[-10,-56; -22,-44], rotation=90);
        Water.SinkP sinkToRiserIP_p(p0=3.716e6, h=1.0223e6) 
          annotation (extent=[-30,-70; -18,-58], rotation=270);
        Water.SourceW sourceFromRiserIP_w(
          w0=67.5,
          h=1.370e6,
          p0=3.3816e6) 
                     annotation (extent=[-26,-56; -38,-44], rotation=90);
        Water.SinkP sinkToShIP_p(           h=2.802e6,
          p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-86; 6,-74],    rotation=0);
        Water.ValveLin valveLP(redeclare package Medium = FluidMedium, Kv=6.9/6.738e5) 
          annotation (extent=[40,34; 56,18]);
        Water.ValveLin valveIP(redeclare package Medium = FluidMedium, Kv=13.5/
              2.959e6) annotation (extent=[-32,-72; -16,-88]);
        Water.ValveLin valveHP(redeclare package Medium = FluidMedium, Kv=70/1.344e7) 
          annotation (extent=[-84,-72; -68,-88]);
      public 
        Modelica.Blocks.Sources.Constant com_valve(k=1) 
          annotation (extent=[36,-98; 24,-86]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcHP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-62,-28; -50,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-70,-40; -58,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-78,-28; -66,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-86,-40; -74,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShHP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-94,-28; -82,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcIP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-14,-28; -2,-40],rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-22,-40; -10,-28],rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-30,-28; -18,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-38,-40; -26,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShIP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-46,-28; -34,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcLP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[34,64; 22,52], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[22,44; 34,56], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[34,48; 22,36], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[22,28; 34,40], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShLP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[34,32; 22,20], rotation=180);
      public 
        Water.SourceW sourceWater(
          p0=1.98e6,
          h=2.440e5,
          w0=89.82)  annotation (extent=[60,60; 48,72]);
      public 
        Modelica.Blocks.Sources.Ramp IPpump_com(
          duration=10,
          offset=12.7,
          height=0) 
          annotation (extent=[84,-66; 72,-54]);
        Modelica.Blocks.Sources.Ramp HPpump_com(
          duration=10,
          startTime=0,
          offset=69.5,
          height=0) 
          annotation (extent=[84,-46; 72,-34]);
      public 
        Modelica.Blocks.Sources.Constant LPpump_com(k=89.8) 
          annotation (extent=[84,-86; 72,-74]);
      protected 
        Buses.Actuators actuators annotation (extent=[70,-12; 58,0]);
      equation 
        connect(valveLP.outlet, sinkToShLP_p.flange) 
          annotation (points=[56,26; 74,26], style(thickness=2));
        connect(valveHP.outlet, sinkToShHP_p.flange) 
          annotation (points=[-68,-80; -58,-80], style(thickness=2));
        connect(valveIP.outlet, sinkToShIP_p.flange) 
          annotation (points=[-16,-80; -6,-80], style(thickness=2));
        connect(valveHP.cmd, com_valve.y) annotation (points=[-76,-86.4; -76,
              -92; 23.4,-92],                 style(color=74, rgbcolor={0,0,127}));
        connect(valveIP.cmd, com_valve.y) annotation (points=[-24,-86.4; -24,
              -92; 23.4,-92],                 style(color=74, rgbcolor={0,0,127}));
        connect(valveLP.cmd, com_valve.y) annotation (points=[48,19.6; 48,14;
              18,14; 18,-92; 23.4,-92],
                                    style(color=74, rgbcolor={0,0,127}));
        connect(sinkToEcIP_p.flange, stateToEcIP.outlet) annotation (points=[-8,-58;
              -8,-47.8; -8,-47.8; -8,-37.6],      style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcIP.inlet, Drums.WaterForIP)           annotation (
            points=[-8,-30.4; -8,-20; -9,-20],   style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserIP_p.flange, stateToRiserIP.outlet) annotation (
            points=[-24,-58; -24,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserIP.inlet, Drums.ToRiser_IP)           annotation (
            points=[-24,-30.4; -24,-20; -25,-20],    style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserIP_w.flange, stateReturnRiserIP.inlet) 
          annotation (points=[-32,-44; -32,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserIP.outlet, Drums.FromRiser_IP) 
          annotation (points=[-32,-30.4; -32,-20; -33,-20],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcIP.outlet, Drums.Feed_IP)           annotation (
            points=[-16,-30.4; -16,-20; -17,-20],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcIP_w.flange, stateReturnEcIP.inlet) annotation (
            points=[-16,-44; -16,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShIP.inlet, Drums.Steam_IP_Out)           annotation (
            points=[-40,-30.4; -40,-20; -41,-20],    style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShIP.outlet, valveIP.inlet) annotation (points=[-40,
              -37.6; -40,-80; -32,-80], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToEcHP_p.flange, stateToEcHP.outlet) annotation (points=[
              -56,-58; -56,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcHP.inlet, Drums.WaterForHP)           annotation (
            points=[-56,-30.4; -56,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcHP.outlet, Drums.Feed_HP)           annotation (
            points=[-64,-30.4; -64,-20],            style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcHP_w.flange, stateReturnEcHP.inlet) annotation (
            points=[-64,-44; -64,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserHP_p.flange, stateToRiserHP.outlet) annotation (
            points=[-72,-58; -72,-37.6],            style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserHP.inlet, Drums.ToRiser_HP)           annotation (
            points=[-72,-30.4; -72,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserHP_w.flange, stateReturnRiserHP.inlet) 
          annotation (points=[-80,-44; -80,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserHP.outlet, Drums.FromRiser_HP) 
          annotation (points=[-80,-30.4; -80,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(valveHP.inlet, stateToShHP.outlet) annotation (points=[-84,-80;
              -88,-80; -88,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShHP.inlet, Drums.Steam_HP_Out)           annotation (
            points=[-88,-30.4; -88,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserLP_w.flange, stateReturnRiserLP.inlet) 
          annotation (points=[58,34; 31.6,34], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserLP_p.flange, stateToRiserLP.outlet) annotation (
            points=[74,42; 31.6,42], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserLP.outlet, Drums.FromRiser_LP) 
          annotation (points=[24.4,34; 6,34],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShLP.inlet, Drums.Steam_LP_Out)           annotation (
            points=[24.4,26; 6,26],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserLP.inlet, Drums.ToRiser_LP)           annotation (
            points=[24.4,42; 6,42],                      style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcLP_w.flange, stateReturnEcLP.inlet) annotation (
            points=[58,50; 31.6,50], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcLP.outlet, Drums.Feed_LP)           annotation (
            points=[24.4,50; 6,50],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToEcLP_p.flange, stateToEcLP.outlet) annotation (points=[74,58;
              31.6,58],     style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcLP.inlet, Drums.WaterForLP)           annotation (
            points=[24.4,58; 6,58],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(valveLP.inlet, stateToShLP.outlet) annotation (points=[40,26;
              31.6,26],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceWater.flange, Drums.WaterIn)           annotation (points=[48,66; 6,
              66],          style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(IPpump_com.y, actuators.flowRate_feedIP) 
                                                     annotation (points=[71.4,-60;
              64,-60; 64,-6], style(color=74, rgbcolor={0,0,127}));
        connect(HPpump_com.y, actuators.flowRate_feedHP) 
                                                     annotation (points=[71.4,-40;
              64,-40; 64,-6],        style(color=74, rgbcolor={0,0,127}));
        connect(actuators, Drums.ActuatorsBus)           annotation (points=[64,-6; 5,
              -6],       style(color=52, rgbcolor={213,255,170}));
        connect(LPpump_com.y, actuators.flowRate_feedLP) annotation (points=[
              71.4,-80; 64,-80; 64,-6], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(HPpump_com.y, sourceFromEcHP_w.in_w0) annotation (points=[71.4,
              -40; 64,-40; 64,-72; -46,-72; -46,-52; -60.4,-52; -60.4,-52.4],
            style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(IPpump_com.y, sourceFromEcIP_w.in_w0) annotation (points=[71.4,
              -60; 64,-60; 64,-72; 8,-72; 8,-52.4; -12.4,-52.4], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(LPpump_com.y, sourceFromEcLP_w.in_w0) annotation (points=[71.4,
              -80; 64,-80; 64,-26; 92,-26; 92,70; 66.4,70; 66.4,53.6], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
      end TestDG_3LCC_wafp;
      
      model TestDG_3LCC_wa 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wa Drums(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          IPd_hlstart=1.0265e5,
          n0_TFP=1500,
          inletTFPNomPressure=5398.2,
          TFPNomFlowRate=89.8,
          hstart_TFP=1.43495e5,
          totalFeedPump(totalFeedPump(feedWaterPump(redeclare function 
                  efficiencyCharacteristic = 
                    Functions.PumpCharacteristics.constantEfficiency (eta_nom=
                        0.0071))))) 
                                annotation (extent=[-94,-20; 6,80]);
        Water.SinkP sinkToEcLP_p(           h=2.440e5, p0=7.19e5) 
          annotation (extent=[74,52; 86,64]);
        annotation (Diagram);
        Water.SourceW sourceFromEcLP_w(
          h=6.544e5,
          w0=89.8,
          p0=7.19048e5) 
                     annotation (extent=[70,44; 58,56]);
        Water.SinkP sinkToRiserLP_p(p0=1.534e6, h=1.6325e6) 
          annotation (extent=[74,36; 86,48]);
        Water.SourceW sourceFromRiserLP_w(
          w0=41.49,
          h=1.065e6,
          p0=7.19046e5) 
                     annotation (extent=[70,28; 58,40]);
        Water.SinkP sinkToShLP_p(          h=2.760e6,
          redeclare package Medium = FluidMedium,
          p0=5.398e3) 
          annotation (extent=[74,20; 86,32]);
        Water.SinkP sinkToEcHP_p(p0=1.389e7, h=6.775e5) 
          annotation (extent=[-62,-70; -50,-58], rotation=270);
        Water.SourceW sourceFromEcHP_w(
          w0=69.5,
          h=1.463e6,
          p0=1.626e7) 
                     annotation (extent=[-58,-56; -70,-44], rotation=90);
        Water.SinkP sinkToRiserHP_p(p0=1.371e7, h=1.6325e6) 
          annotation (extent=[-78,-70; -66,-58], rotation=270);
        Water.SourceW sourceFromRiserHP_w(
          w0=175.5,
          h=2.002e6,
          p0=1.626e7) 
                     annotation (extent=[-74,-56; -86,-44], rotation=90);
        Water.SinkP sinkToShHP_p(            h=2.657e6,
          redeclare package Medium = FluidMedium,
          p0=2.98e6) 
          annotation (extent=[-58,-86; -46,-74], rotation=0);
        Water.SinkP sinkToEcIP_p(p0=4.86e6, h=6.654e5) 
          annotation (extent=[-14,-70; -2,-58], rotation=270);
        Water.SourceW sourceFromEcIP_w(
          h=9.444e5,
          w0=12.7,
          p0=3.3816e6) 
                     annotation (extent=[-10,-56; -22,-44], rotation=90);
        Water.SinkP sinkToRiserIP_p(p0=3.716e6, h=1.0223e6) 
          annotation (extent=[-30,-70; -18,-58], rotation=270);
        Water.SourceW sourceFromRiserIP_w(
          w0=67.5,
          h=1.370e6,
          p0=3.3816e6) 
                     annotation (extent=[-26,-56; -38,-44], rotation=90);
        Water.SinkP sinkToShIP_p(           h=2.802e6,
          p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-6,-86; 6,-74],    rotation=0);
        Water.ValveLin valveLP(redeclare package Medium = FluidMedium, Kv=6.9/6.738e5) 
          annotation (extent=[40,34; 56,18]);
        Water.ValveLin valveIP(redeclare package Medium = FluidMedium, Kv=13.5/
              2.959e6) annotation (extent=[-32,-72; -16,-88]);
        Water.ValveLin valveHP(redeclare package Medium = FluidMedium, Kv=70/1.344e7) 
          annotation (extent=[-84,-72; -68,-88]);
      public 
        Modelica.Blocks.Sources.Constant com_valve(k=1) 
          annotation (extent=[46,-96; 34,-84]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcHP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-62,-28; -50,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-70,-40; -58,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-78,-28; -66,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserHP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-86,-40; -74,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShHP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-94,-28; -82,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcIP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-14,-28; -2,-40],rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-22,-40; -10,-28],rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-30,-28; -18,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserIP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[-38,-40; -26,-28], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShIP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-46,-28; -34,-40], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcLP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[34,64; 22,52], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnEcLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[22,44; 34,56], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateToRiserLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[34,48; 22,36], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateReturnRiserLP(                     redeclare package Medium = 
              FluidMedium) annotation (extent=[22,28; 34,40], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShLP(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[34,32; 22,20], rotation=180);
        Water.SourceP sourceShLP(
          redeclare package Medium = FluidMedium,
          p0=5398.2,
          h=1.43495e5) 
          annotation (extent=[52,72; 64,60], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateFromCondenser(                           redeclare package 
            Medium = 
              FluidMedium) annotation (extent=[34,72; 22,60], rotation=0);
      public 
        Modelica.Blocks.Sources.Constant IPpump_com(k=12.7) 
          annotation (extent=[84,-56; 72,-44]);
        Modelica.Blocks.Sources.Constant HPpump_com(k=69.5) 
          annotation (extent=[84,-36; 72,-24]);
      public 
        Modelica.Blocks.Sources.Constant LPpump_com(k=89.8) 
          annotation (extent=[84,-78; 72,-66]);
      protected 
        Buses.Actuators actuators annotation (extent=[70,-12; 58,0]);
      equation 
        connect(valveLP.outlet, sinkToShLP_p.flange) 
          annotation (points=[56,26; 74,26], style(thickness=2));
        connect(valveHP.outlet, sinkToShHP_p.flange) 
          annotation (points=[-68,-80; -58,-80], style(thickness=2));
        connect(valveIP.outlet, sinkToShIP_p.flange) 
          annotation (points=[-16,-80; -6,-80], style(thickness=2));
        connect(valveHP.cmd, com_valve.y) annotation (points=[-76,-86.4; -76,
              -96; 18,-96; 18,-90; 33.4,-90], style(color=74, rgbcolor={0,0,127}));
        connect(valveIP.cmd, com_valve.y) annotation (points=[-24,-86.4; -24,
              -96; 18,-96; 18,-90; 33.4,-90], style(color=74, rgbcolor={0,0,127}));
        connect(valveLP.cmd, com_valve.y) annotation (points=[48,19.6; 48,4; 18,
              4; 18,-90; 33.4,-90], style(color=74, rgbcolor={0,0,127}));
        connect(sinkToEcIP_p.flange, stateToEcIP.outlet) annotation (points=[-8,-58;
              -8,-47.8; -8,-47.8; -8,-37.6],      style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcIP.inlet, Drums.WaterForIP)           annotation (
            points=[-8,-30.4; -8,-20; -9,-20],   style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserIP_p.flange, stateToRiserIP.outlet) annotation (
            points=[-24,-58; -24,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserIP.inlet, Drums.ToRiser_IP)           annotation (
            points=[-24,-30.4; -24,-20; -25,-20],    style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserIP_w.flange, stateReturnRiserIP.inlet) 
          annotation (points=[-32,-44; -32,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserIP.outlet, Drums.FromRiser_IP) 
          annotation (points=[-32,-30.4; -32,-20; -33,-20],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcIP.outlet, Drums.Feed_IP)           annotation (
            points=[-16,-30.4; -16,-20; -17,-20],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcIP_w.flange, stateReturnEcIP.inlet) annotation (
            points=[-16,-44; -16,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShIP.inlet, Drums.Steam_IP_Out)           annotation (
            points=[-40,-30.4; -40,-20; -41,-20],    style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShIP.outlet, valveIP.inlet) annotation (points=[-40,
              -37.6; -40,-80; -32,-80], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToEcHP_p.flange, stateToEcHP.outlet) annotation (points=[
              -56,-58; -56,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcHP.inlet, Drums.WaterForHP)           annotation (
            points=[-56,-30.4; -56,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcHP.outlet, Drums.Feed_HP)           annotation (
            points=[-64,-30.4; -64,-20],            style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcHP_w.flange, stateReturnEcHP.inlet) annotation (
            points=[-64,-44; -64,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserHP_p.flange, stateToRiserHP.outlet) annotation (
            points=[-72,-58; -72,-37.6],            style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserHP.inlet, Drums.ToRiser_HP)           annotation (
            points=[-72,-30.4; -72,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserHP_w.flange, stateReturnRiserHP.inlet) 
          annotation (points=[-80,-44; -80,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserHP.outlet, Drums.FromRiser_HP) 
          annotation (points=[-80,-30.4; -80,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(valveHP.inlet, stateToShHP.outlet) annotation (points=[-84,-80;
              -88,-80; -88,-37.6], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShHP.inlet, Drums.Steam_HP_Out)           annotation (
            points=[-88,-30.4; -88,-20],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromRiserLP_w.flange, stateReturnRiserLP.inlet) 
          annotation (points=[58,34; 31.6,34], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToRiserLP_p.flange, stateToRiserLP.outlet) annotation (
            points=[74,42; 31.6,42], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnRiserLP.outlet, Drums.FromRiser_LP) 
          annotation (points=[24.4,34; 6,34],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToShLP.inlet, Drums.Steam_LP_Out)           annotation (
            points=[24.4,26; 6,26],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToRiserLP.inlet, Drums.ToRiser_LP)           annotation (
            points=[24.4,42; 6,42],                      style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sourceFromEcLP_w.flange, stateReturnEcLP.inlet) annotation (
            points=[58,50; 31.6,50], style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateReturnEcLP.outlet, Drums.Feed_LP)           annotation (
            points=[24.4,50; 6,50],                        style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(sinkToEcLP_p.flange, stateToEcLP.outlet) annotation (points=[74,58;
              31.6,58],     style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateToEcLP.inlet, Drums.WaterForLP)           annotation (
            points=[24.4,58; 6,58],                          style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(valveLP.inlet, stateToShLP.outlet) annotation (points=[40,26;
              31.6,26],               style(
            thickness=2,
            fillColor=3,
            rgbfillColor={0,0,255},
            fillPattern=1));
        connect(stateFromCondenser.outlet, Drums.WaterIn)           annotation (
           points=[24.4,66; 6,66], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(stateFromCondenser.inlet, sourceShLP.flange) annotation (points=
             [31.6,66; 52,66], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(IPpump_com.y, actuators.flowRate_feedIP) 
                                                     annotation (points=[71.4,-50;
              64,-50; 64,-6], style(color=74, rgbcolor={0,0,127}));
        connect(HPpump_com.y, actuators.flowRate_feedHP) 
                                                     annotation (points=[71.4,-30;
              64,-30; 64,-6],        style(color=74, rgbcolor={0,0,127}));
        connect(actuators, Drums.ActuatorsBus)           annotation (points=[64,-6; 5,
              -6],       style(color=52, rgbcolor={213,255,170}));
        connect(LPpump_com.y, actuators.flowRate_feedLP) annotation (points=[71.4,-72;
              64,-72; 64,-6],           style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(HPpump_com.y, sourceFromEcHP_w.in_w0) annotation (points=[71.4,-30;
              64,-30; 64,-72; -46,-72; -46,-52; -60.4,-52; -60.4,-52.4],
            style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(IPpump_com.y, sourceFromEcIP_w.in_w0) annotation (points=[71.4,-50;
              64,-50; 64,-72; 8,-72; 8,-52.4; -12.4,-52.4],      style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
        connect(LPpump_com.y, sourceFromEcLP_w.in_w0) annotation (points=[71.4,-72;
              64,-72; 64,-18; 92,-18; 92,70; 66.4,70; 66.4,53.6],      style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=74,
            rgbfillColor={0,0,127},
            fillPattern=1));
      end TestDG_3LCC_wa;
      
      model TestHEG_DG_nntoccare 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //HP
        parameter SI.MassFlowRate fluidHPNomFlowRate_Sh=69.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Sh=134.3e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ev=175.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Ev=137.1e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidHPNomFlowRate_Ec=69.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidHPNomPressure_Ec=138.9e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Sh1_HP_hstart_F_In= 2.657e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_In= 1.514e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_HP_hstart_F_Out= 2.002e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec1_HP_hstart_F_In= 6.775e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec2_HP_hstart_F_Out= 1.46e6 
          "Nominal specific enthalpy";
        
        //IP
        parameter SI.MassFlowRate fluidIPNomFlowRate_Rh=81.10 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Rh=28.4e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Sh=12.7 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Sh=29.6e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ev=67.5 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Ev=37.2e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidIPNomFlowRate_Ec=12.7 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidIPNomPressure_Ec=48.6e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Rh1_IP_hstart_F_In= 3.22e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Rh2_IP_hstart_F_Out=3.548e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Sh_IP_hstart_F_In=2.802e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_In= 9.92e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_IP_hstart_F_Out= 1.37e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_In=6.654e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_IP_hstart_F_Out=9.44e5 
          "Nominal specific enthalpy";
        
        //LP
        parameter SI.MassFlowRate fluidLPNomFlowRate_Sh=6.91 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Sh=6.6e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ev=41.49 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Ev=15.3e5 "Nominal pressure";
        parameter SI.MassFlowRate fluidLPNomFlowRate_Ec=89.8 
          "Nominal mass flowrate";
        parameter SI.Pressure fluidLPNomPressure_Ec=19.8e5 "Nominal pressure";
        parameter SI.SpecificEnthalpy Sh_LP_hstart_F_In= 2.760e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_In= 6.626e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ev_LP_hstart_F_Out=1.065e6 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_In=2.44e5 
          "Nominal specific enthalpy";
        parameter SI.SpecificEnthalpy Ec_LP_hstart_F_Out=6.54e5 
          "Nominal specific enthalpy";
        
        ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wafp Drums(
          HPd_rint=1.067,
          HPd_rext=1.167,
          HPd_L=11.920,
          HPd_Cm=0,
          IPd_rint=0.915,
          IPd_rext=1.015,
          IPd_L=7,
          IPd_Cm=0,
          LPd_rint=1.143,
          LPd_rext=1.243,
          LPd_L=11.503,
          LPd_Cm=0,
          RiserHPFlowRate=175.5,
          RiserIPFlowRate=67.5,
          RiserLPFlowRate=41.5,
          redeclare package FluidMedium = FluidMedium,
          SSInit=false,
          fluidLPNomPressure=7.19048e5,
          LPd_hvstart=2.76051e6,
          LPd_hlstart=6.68356e5,
          fluidHPNomPressure=1.626e7,
          fluidIPNomPressure=3.3816e6,
          HPd_hvstart=2.53239e6,
          HPd_hlstart=1.5879e6,
          IPd_hvstart=2.794e6,
          IPd_hlstart=1.0265e5) annotation (extent=[-60,30; 10,98]);
      protected 
        Buses.Actuators actuators annotation (extent=[84,36; 76,44]);
      public 
        Water.SourceW sourceWater(
          p0=1.98e6,
          h=2.440e5,
          w0=89.82)  annotation (extent=[44,84; 32,96]);
        annotation (Diagram);
        Water.SinkP outHP(redeclare package Medium = FluidMedium, p0=0) 
                          annotation (extent=[-88,-88; -100,-76],
                                                              rotation=0);
        Water.SinkP outIP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[-18,-94; -30,-82],
                                                                rotation=0);
        Water.SinkP outLP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[54,-88; 66,-76], rotation=0);
        Water.SourceW sourceRhIP(
          redeclare package Medium = FluidMedium,
          w0=fluidIPNomFlowRate_Rh,
          p0=fluidIPNomPressure_Rh,
          h=Rh1_IP_hstart_F_In) 
                              annotation (extent=[-40,-80; -32,-72],
                                                                   rotation=180);
        Water.SinkP sinkRhIP(
          redeclare package Medium = FluidMedium,
          p0=fluidIPNomPressure_Rh,
          h=Rh2_IP_hstart_F_Out) 
                           annotation (extent=[-20,-70; -12,-78],
                                                                rotation=0);
        Gas.SourceW sourceGas(
          redeclare package Medium = FlueGasMedium,
          w0=585.5,
          T=884.65)          annotation (extent=[-100,-30; -88,-18]);
        Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                         annotation (extent=[80,-30; 92,-18]);
        Water.ValveLin valveLinHP(redeclare package Medium = FluidMedium, Kv=
              fluidHPNomFlowRate_Sh/fluidHPNomPressure_Sh) 
                                annotation (extent=[-68,-76; -80,-88]);
        Water.ValveLin valveLinIP(redeclare package Medium = FluidMedium, Kv=
              fluidIPNomFlowRate_Sh/fluidIPNomPressure_Sh) 
                                 annotation (extent=[2,-82; -10,-94]);
        Water.ValveLin valveLinLP(redeclare package Medium = FluidMedium, Kv=
              fluidLPNomFlowRate_Sh/fluidLPNomPressure_Sh) 
                                 annotation (extent=[34,-76; 46,-88]);
        Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
          annotation (extent=[100,16; 86,30]);
        Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
          annotation (extent=[60,16; 74,30]);
        Modelica.Blocks.Sources.Constant commandValve 
          annotation (extent=[-46,-92; -36,-82], rotation=270);
        
        ThermoPower.PowerPlants.HRSG.Examples.HEG_3LRh_wa HeatExchangersGroup(
          gasNomFlowRate=585.5,
          fluidHPNomFlowRate_Sh=70.59,
          fluidHPNomPressure_Sh=134.3e5,
          fluidHPNomFlowRate_Ev=175.5,
          fluidHPNomPressure_Ev=137.1e5,
          fluidHPNomFlowRate_Ec=70.10,
          fluidHPNomPressure_Ec=138.9e5,
          fluidIPNomFlowRate_Rh=81.10,
          fluidIPNomPressure_Rh=28.4e5,
          fluidIPNomFlowRate_Sh=13.5,
          fluidIPNomPressure_Sh=29.5e5,
          fluidIPNomFlowRate_Ev=67.5,
          fluidIPNomPressure_Ev=37.16e5,
          fluidIPNomFlowRate_Ec=21.8,
          fluidIPNomPressure_Ec=48.6e5,
          fluidLPNomFlowRate_Sh=6.91,
          fluidLPNomPressure_Sh=6.6e5,
          fluidLPNomFlowRate_Ev=41.49,
          fluidLPNomPressure_Ev=15.34e5,
          fluidLPNomFlowRate_Ec=122.4,
          fluidLPNomPressure_Ec=19.8e5,
          Sh2_HP_N_G=3,
          Sh2_HP_N_F=5,
          Sh2_HP_exchSurface_G=3636,
          Sh2_HP_exchSurface_F=421.844,
          Sh2_HP_extSurfaceTub=540.913,
          Sh2_HP_gasVol=10,
          Sh2_HP_fluidVol=2.615,
          Sh2_HP_metalVol=1.685,
          Sh1_HP_N_G=3,
          Sh1_HP_N_F=7,
          Sh1_HP_exchSurface_G=8137.2,
          Sh1_HP_exchSurface_F=612.387,
          Sh1_HP_extSurfaceTub=721.256,
          Sh1_HP_gasVol=10,
          Sh1_HP_fluidVol=4.134,
          Sh1_HP_metalVol=1.600,
          Ev_HP_N_G=4,
          Ev_HP_N_F=4,
          Ev_HP_exchSurface_G=30501.9,
          Ev_HP_exchSurface_F=2296.328,
          Ev_HP_extSurfaceTub=2704.564,
          Ev_HP_gasVol=10,
          Ev_HP_fluidVol=15.500,
          Ev_HP_metalVol=6.001,
          Ec2_HP_N_G=3,
          Ec2_HP_N_F=6,
          Ec2_HP_exchSurface_G=20335,
          Ec2_HP_exchSurface_F=1451.506,
          Ec2_HP_extSurfaceTub=1803.043,
          Ec2_HP_gasVol=10,
          Ec2_HP_fluidVol=9.290,
          Ec2_HP_metalVol=5.045,
          Ec1_HP_N_G=3,
          Ec1_HP_N_F=5,
          Ec1_HP_exchSurface_G=12201.2,
          Ec1_HP_exchSurface_F=870.904,
          Ec1_HP_extSurfaceTub=1081.826,
          Ec1_HP_gasVol=10,
          Ec1_HP_fluidVol=5.574,
          Ec1_HP_metalVol=3.027,
          Rh2_IP_N_F=7,
          Rh2_IP_exchSurface_G=4630.2,
          Rh2_IP_exchSurface_F=873.079,
          Rh2_IP_extSurfaceTub=1009.143,
          Rh2_IP_fluidVol=8.403,
          Rh2_IP_metalVol=2.823,
          Rh1_IP_N_F=5,
          Rh1_IP_exchSurface_G=4630,
          Rh1_IP_exchSurface_F=900.387,
          Rh1_IP_extSurfaceTub=1009.250,
          Rh1_IP_fluidVol=8.936,
          Rh1_IP_metalVol=2.292,
          Sh_IP_N_G=3,
          Sh_IP_N_F=7,
          Sh_IP_exchSurface_G=2314.8,
          Sh_IP_exchSurface_F=450.218,
          Sh_IP_extSurfaceTub=504.652,
          Sh_IP_gasVol=10,
          Sh_IP_fluidVol=4.468,
          Sh_IP_metalVol=1.146,
          Ev_IP_N_G=4,
          Ev_IP_N_F=4,
          Ev_IP_exchSurface_G=24402,
          Ev_IP_exchSurface_F=1837.063,
          Ev_IP_extSurfaceTub=2163.652,
          Ev_IP_gasVol=10,
          Ev_IP_fluidVol=12.400,
          Ev_IP_metalVol=4.801,
          Ec_IP_N_G=3,
          Ec_IP_N_F=5,
          Ec_IP_exchSurface_G=4067.2,
          Ec_IP_exchSurface_F=306.177,
          Ec_IP_extSurfaceTub=360.609,
          Ec_IP_gasVol=10,
          Ec_IP_fluidVol=2.067,
          Ec_IP_metalVol=0.800,
          Sh_LP_N_G=3,
          Sh_LP_N_F=7,
          Sh_LP_exchSurface_G=1708.2,
          Sh_LP_exchSurface_F=225.073,
          Sh_LP_extSurfaceTub=252.286,
          Sh_LP_gasVol=10,
          Sh_LP_fluidVol=2.234,
          Sh_LP_metalVol=0.573,
          Ev_LP_N_G=4,
          Ev_LP_N_F=4,
          Ev_LP_exchSurface_G=24402,
          Ev_LP_exchSurface_F=2292.926,
          Ev_LP_extSurfaceTub=2592.300,
          Ev_LP_gasVol=10,
          Ev_LP_fluidVol=19.318,
          Ev_LP_metalVol=5.374,
          Ec_LP_N_G=3,
          Ec_LP_N_F=6,
          Ec_LP_exchSurface_G=40095.9,
          Ec_LP_exchSurface_F=3439.389,
          Ec_LP_extSurfaceTub=3888.449,
          Ec_LP_gasVol=10,
          Ec_LP_fluidVol=28.977,
          Ec_LP_metalVol=8.061,
          use_T_Ev=false,
          Sh2_HP_Tstart_G_In=884.65,
          Sh2_HP_Tstart_G_Out=837.31,
          Sh2_HP_Tstart_M_In=742.65,
          Sh2_HP_Tstart_M_Out=823.28,
          Sh2_HP_Tstart_F_In=742.65,
          Sh2_HP_Tstart_F_Out=823.28,
          Sh1_HP_Tstart_G_In=837.15,
          Sh1_HP_Tstart_G_Out=748.60,
          Sh1_HP_Tstart_M_In=606.59,
          Sh1_HP_Tstart_M_Out=743.18,
          Sh1_HP_Tstart_F_In=606.59,
          Sh1_HP_Tstart_F_Out=743.18,
          Ev_HP_Tstart_G_In=747.15,
          Ev_HP_Tstart_G_Out=620.30,
          Ev_HP_Tstart_M_In=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,
              1.514e6),
          Ev_HP_Tstart_M_Out=FluidMedium.temperature_ph(fluidHPNomPressure_Ev,
              2.002e6),
          Ev_HP_hstart_F_In=1.514e6,
          Ev_HP_hstart_F_Out=2.002e6,
          Ec2_HP_Tstart_G_In=614.15,
          Ec2_HP_Tstart_G_Out=558.98,
          Ec2_HP_Tstart_M_In=494.67,
          Ec2_HP_Tstart_M_Out=594.14,
          Ec2_HP_Tstart_F_In=494.67,
          Ec2_HP_Tstart_F_Out=594.14,
          Ec1_HP_Tstart_M_In=431.77,
          Ec1_HP_Tstart_M_Out=494.67,
          Ec1_HP_Tstart_F_In=431.77,
          Ec1_HP_Tstart_F_Out=494.67,
          Rh2_IP_Tstart_M_In=717.31,
          Rh2_IP_Tstart_M_Out=813.09,
          Rh2_IP_Tstart_F_In=717.31,
          Rh2_IP_Tstart_F_Out=813.09,
          Rh1_IP_Tstart_M_In=618.31,
          Rh1_IP_Tstart_M_Out=717.34,
          Rh1_IP_Tstart_F_In=618.31,
          Rh1_IP_Tstart_F_Out=717.34,
          Sh_IP_Tstart_G_In=620.15,
          Sh_IP_Tstart_G_Out=614.50,
          Sh_IP_Tstart_M_In=506.08,
          Sh_IP_Tstart_M_Out=605.11,
          Sh_IP_Tstart_F_In=506.08,
          Sh_IP_Tstart_F_Out=605.11,
          Ev_IP_Tstart_G_In=558.15,
          Ev_IP_Tstart_G_Out=518.51,
          Ev_IP_Tstart_M_In=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,
              9.92e5),
          Ev_IP_Tstart_M_Out=FluidMedium.temperature_ph(fluidIPNomPressure_Ev,
              1.37e6),
          Ev_IP_hstart_F_In=9.92e5,
          Ev_IP_hstart_F_Out=1.37e6,
          Ec_IP_Tstart_G_In=517.15,
          Ec_IP_Tstart_G_Out=480.11,
          Ec_IP_Tstart_M_In=430.24,
          Ec_IP_Tstart_M_Out=493.16,
          Ec_IP_Tstart_F_In=430.24,
          Ec_IP_Tstart_F_Out=493.16,
          Sh_LP_Tstart_G_In=519.15,
          Sh_LP_Tstart_G_Out=517.44,
          Sh_LP_Tstart_M_In=435.75,
          Sh_LP_Tstart_M_Out=505.04,
          Sh_LP_Tstart_F_In=435.75,
          Sh_LP_Tstart_F_Out=505.75,
          Ev_LP_Tstart_G_In=480.00,
          Ev_LP_Tstart_G_Out=453.47,
          Ev_LP_Tstart_M_In=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,
              6.625e5),
          Ev_LP_Tstart_M_Out=FluidMedium.temperature_ph(fluidLPNomPressure_Ev,
              1.065e6),
          Ev_LP_hstart_F_In=6.625e5,
          Ev_LP_hstart_F_Out=1.065e6,
          Ec_LP_Tstart_G_In=453.47,
          Ec_LP_Tstart_G_Out=372.35,
          Ec_LP_Tstart_M_In=331.05,
          Ec_LP_Tstart_M_Out=428.09,
          Ec_LP_Tstart_F_In=331.05,
          Ec_LP_Tstart_F_Out=428.09,
          rhomcm=7900*578.05,
          lambda=20,
          Ec_LP(gamma_G=46.8, gamma_F=4000),
          Ev_LP(gamma_G=127, gamma_F=20000),
          Ec1HP_EcIP(
            gamma_G_A=42,
            gamma_G_B=45,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh_LP(gamma_G=16.6, gamma_F=4000),
          Ev_IP(gamma_G=58.5, gamma_F=20000),
          Ec2_HP(gamma_G=56, gamma_F=4000),
          Sh_IP(gamma_G=33, gamma_F=4000),
          Ev_HP(gamma_G=46.5, gamma_F=20000),
          gasNomPressure=1e5,
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_G_A=83.97,
            gamma_G_B=80,
            gamma_F_A=4000,
            gamma_F_B=4000)) annotation (extent=[-60,-60; 10,12]);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-38,26; -28,16],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-56,16; -46,26],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-50,26; -40,16],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-44,16; -34,26],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-62,26; -52,16],   rotation=90);
      public 
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_in(
                                           redeclare package Medium = 
              FluidMedium) annotation (extent=[-4,26; 6,16],      rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-22,16; -12,26],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvIP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-16,26; -6,16],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-10,16; 0,26],     rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-28,26; -18,16],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                               redeclare package Medium = 
              FlueGasMedium) annotation (extent=[-84,-32; -68,-16], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                redeclare package Medium = 
              FlueGasMedium) annotation (extent=[46,-34; 66,-14], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[32,30; 20,18], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[14,24; 26,36], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[44,18; 32,6],  rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEvLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[26,12; 38,24], rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateEcLP_in(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[38,-4; 50,8],  rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-60,-66; -48,-78], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-16,-66; -4,-78],  rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[14,-68; 26,-80],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                   redeclare package Medium = 
              FluidMedium) annotation (extent=[-30,-64; -22,-72], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-48,-66; -40,-74], rotation=270);
      equation 
        connect(com_pumpFeedIP.y, actuators.flowRate_feedIP) 
                                                     annotation (points=[74.7,23;
              80,23; 80,40], style(color=74, rgbcolor={0,0,127}));
        connect(com_pumpFeedHP.y, actuators.flowRate_feedHP) 
                                                     annotation (points=[85.3,23;
              80,23; 80,40],        style(color=74, rgbcolor={0,0,127}));
        connect(actuators, Drums.ActuatorsBus)           annotation (points=[80,40;
              20,40; 20,39.52; 9.3,39.52],     style(color=52, rgbcolor={213,
                255,170}));
        connect(outHP.flange,valveLinHP. outlet) 
          annotation (points=[-88,-82; -80,-82],style(thickness=2));
        connect(valveLinLP.outlet,outLP. flange) 
          annotation (points=[46,-82; 54,-82], style(thickness=2));
        connect(valveLinIP.outlet,outIP. flange) 
          annotation (points=[-10,-88; -18,-88], style(thickness=2));
        connect(commandValve.y, valveLinHP.cmd) annotation (points=[-41,-92.5;
              -41,-96; -74,-96; -74,-86.8], style(color=74, rgbcolor={0,0,127}));
        connect(commandValve.y, valveLinIP.cmd) annotation (points=[-41,-92.5;
              -41,-96; -4,-96; -4,-92.8], style(color=74, rgbcolor={0,0,127}));
        connect(commandValve.y, valveLinLP.cmd) annotation (points=[-41,-92.5;
              -41,-96; 40,-96; 40,-86.8], style(color=74, rgbcolor={0,0,127}));
        connect(Drums.Steam_HP_Out, stateShHP_in.inlet)           annotation (points=
              [-55.8,30; -56,30; -56,24; -57,24], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Sh_HP_In, stateShHP_in.outlet) annotation (
            points=[-55.8,12; -56,12; -56,18; -57,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ev_HP_Out, stateEvHP_out.inlet) annotation (
           points=[-50.2,12; -51,12; -51,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvHP_out.outlet, Drums.FromRiser_HP)           annotation (
           points=[-51,24; -50.2,24; -50.2,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ev_HP_In, stateEvHP_in.outlet) annotation (
            points=[-44.6,12; -45,12; -45,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvHP_in.inlet, Drums.ToRiser_HP)           annotation (
            points=[-45,24; -44.6,24; -44.6,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ec_HP_Out, stateEcHP_out.inlet) annotation (
           points=[-39,12; -39,18],         style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcHP_out.outlet, Drums.Feed_HP)           annotation (
            points=[-39,24; -39,30],         style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ec_HP_In, stateEcHP_in.outlet) annotation (
            points=[-33.4,12; -33,12; -33,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcHP_in.inlet, Drums.WaterForHP)           annotation (
            points=[-33,24; -33,27; -33.4,27; -33.4,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Sh_IP_In, stateShIP.outlet) annotation (
            points=[-22.9,12; -23,12; -23,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShIP.inlet, Drums.Steam_IP_Out)           annotation (
            points=[-23,24; -22.9,24; -22.9,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ev_IP_Out, stateEvIP_out.inlet) annotation (
           points=[-17.3,12; -17.3,15; -17,15; -17,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvIP_out.outlet, Drums.FromRiser_IP)           annotation (
           points=[-17,24; -17.3,24; -17.3,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ev_IP_In, stateEvIP_in.outlet) annotation (
            points=[-11.7,12; -11.7,15; -11,15; -11,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvIP_in.inlet, Drums.ToRiser_IP)           annotation (
            points=[-11,24; -11,27; -11.7,27; -11.7,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ec_IP_Out, stateEcIP_out.inlet) annotation (
           points=[-6.1,12; -5,12; -5,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcIP_out.outlet, Drums.Feed_IP)           annotation (
            points=[-5,24; -6.1,24; -6.1,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(HeatExchangersGroup.Ec_IP_In, stateEcIP_in.outlet) annotation (
            points=[-0.5,12; 0,12; 0,18; 1,18], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcIP_in.inlet, Drums.WaterForIP)           annotation (
            points=[1,24; -0.5,24; -0.5,30], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_in.outlet, HeatExchangersGroup.GasIn) annotation (
            points=[-71.2,-24; -65.775,-24; -65.775,-23.64; -60.35,-23.64],
            style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-80.8,
              -24; -88,-24], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_out.inlet, HeatExchangersGroup.GasOut) annotation (
            points=[50,-24; 30.175,-24; 30.175,-23.64; 10.35,-23.64], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[80,-24;
              62,-24], style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_in.outlet, HeatExchangersGroup.Ec_LP_In) annotation (
            points=[44,-1.6; 44,-16.08; 10,-16.08], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.inlet, HeatExchangersGroup.Ec_LP_Out) annotation (
           points=[38,8.4; 38,-10.32; 10,-10.32], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.outlet, HeatExchangersGroup.Ev_LP_In) annotation (
            points=[32,14.4; 32,-4.56; 10,-4.56], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_out.inlet, HeatExchangersGroup.Ev_LP_Out) annotation (
           points=[26,20.4; 26,0; 10,0; 10,1.2], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.outlet, HeatExchangersGroup.Sh_LP_In) annotation (
            points=[20,26.4; 20,6.96; 10,6.96], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_in.inlet, Drums.Steam_LP_Out)           annotation (
            points=[20,33.6; 20,61.28; 10,61.28], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_out.outlet, Drums.FromRiser_LP)           annotation (
           points=[26,27.6; 26,66.72; 10,66.72], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEvLP_in.inlet, Drums.ToRiser_LP)           annotation (
            points=[32,21.6; 32,72.16; 10,72.16], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_out.outlet, Drums.Feed_LP)           annotation (
            points=[38,15.6; 38,77.6; 10,77.6], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateEcLP_in.inlet, Drums.WaterForLP)           annotation (
            points=[44,5.6; 44,83.04; 10,83.04], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sourceWater.flange, Drums.WaterIn)           annotation (points=
             [32,90; 32,88.48; 10,88.48], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShHP_out.outlet, valveLinHP.inlet) annotation (points=[-54,
              -75.6; -54,-82; -68,-82], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShHP_out.inlet, HeatExchangersGroup.Sh_HP_Out) annotation (
           points=[-54,-68.4; -54,-60; -53,-60],            style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(valveLinLP.inlet, stateShLP_out.outlet) annotation (points=[34,
              -82; 20,-82; 20,-77.6], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShLP_out.inlet, HeatExchangersGroup.Sh_LP_Out) annotation (
           points=[20,-70.4; 20,-66; 3,-66; 3,-60], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShIP_out.inlet, HeatExchangersGroup.Sh_IP_Out) annotation (
           points=[-10,-68.4; -10,-60; -11,-60], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateShIP_out.outlet, valveLinIP.inlet) annotation (points=[-10,
              -75.6; -2,-75.6; -2,-76; 10,-76; 10,-88; 2,-88], style(
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sinkRhIP.flange, stateRhIP_out.outlet) annotation (points=[-20,
              -74; -26,-74; -26,-70.4], style(thickness=2));
        connect(stateRhIP_out.inlet, HeatExchangersGroup.Rh_IP_Out) annotation (
           points=[-26,-65.6; -26,-60; -25,-60], style(thickness=2));
        connect(stateRhIP_in.outlet, HeatExchangersGroup.Rh_IP_In) annotation (
            points=[-44,-67.6; -44,-66; -39,-66; -39,-60], style(thickness=2));
        connect(stateRhIP_in.inlet, sourceRhIP.flange) annotation (points=[-44,
              -72.4; -44,-76; -40,-76], style(thickness=2));
      end TestHEG_DG_nntoccare;
      
      model TestHRSG_wa 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
      protected 
        Buses.Actuators actuators annotation (extent=[84,44; 72,54]);
        annotation (Diagram);
      public 
        Water.SinkP outHP(redeclare package Medium = FluidMedium, p0=0) 
                          annotation (extent=[-78,-46; -92,-32],
                                                              rotation=0);
        Water.SinkP outIP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[-40,-86; -54,-72],
                                                                rotation=0);
        Water.SinkP outLP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[40,-86; 54,-72], rotation=0);
        Water.SourceW sourceRhIP(
          redeclare package Medium = FluidMedium,
          h=3.22e6,
          w0=81.10,
          p0=28.4e5)          annotation (extent=[-34,-64; -22,-52],
                                                                   rotation=90);
        Water.SinkP sinkRhIP(
          redeclare package Medium = FluidMedium,
          h=3.548e6,
          p0=28.4e5)       annotation (extent=[-22,-38; -10,-50],
                                                                rotation=90);
        Gas.SourceW sourceGas(
          redeclare package Medium = FlueGasMedium,
          w0=585.5,
          T=884.65)          annotation (extent=[-100,22; -84,38]);
        Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                         annotation (extent=[72,22; 88,38]);
        Water.ValveLin valveLinHP(redeclare package Medium = FluidMedium, Kv=
              69.5/134.3e5)     annotation (extent=[-54,-32; -68,-46]);
        Water.ValveLin valveLinIP(redeclare package Medium = FluidMedium, Kv=
              12.7/29.6e5)       annotation (extent=[-10,-72; -24,-86],
            rotation=0);
        Water.ValveLin valveLinLP(redeclare package Medium = FluidMedium, Kv=
              6.91/6.6e5)        annotation (extent=[30,-86; 16,-72], rotation=
              180);
        Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
          annotation (extent=[98,64; 86,76]);
        Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
          annotation (extent=[58,64; 70,76]);
        Modelica.Blocks.Sources.Constant commandValve 
          annotation (extent=[-92,-96; -82,-86], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                               redeclare package Medium = 
              FlueGasMedium) annotation (extent=[-76,20; -56,40],   rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                redeclare package Medium = 
              FlueGasMedium) annotation (extent=[42,20; 62,40],   rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-48,-16; -32,-32], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-12,-16; 4,-32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[0,-16; 16,-32],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                   redeclare package Medium = 
              FluidMedium) annotation (extent=[-24,-16; -8,-32],  rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-36,-16; -20,-32], rotation=270);
        ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                redeclare package FlueGasMedium = FlueGasMedium, redeclare 
            package FluidMedium = FluidMedium) 
          annotation (extent=[-48,-6; 32,74]);
        Water.SourceP sourceShLP(
          redeclare package Medium = FluidMedium,
          p0=5398.2,
          h=1.43495e5) 
          annotation (extent=[18,-38; 30,-50],
                                             rotation=270);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
          stateFromCondenser(                           redeclare package 
            Medium = 
              FluidMedium) annotation (extent=[32,-16; 16,-32],
                                                              rotation=270);
      public 
        Modelica.Blocks.Sources.Constant n_pump(k=89.8) 
          annotation (extent=[98,84; 86,96]);
      equation 
        connect(com_pumpFeedIP.y, actuators.flowRate_feedIP) 
                                                     annotation (points=[70.6,70;
              78,70; 78,49], style(color=74, rgbcolor={0,0,127}));
        connect(com_pumpFeedHP.y, actuators.flowRate_feedHP) 
                                                     annotation (points=[85.4,70;
              78,70; 78,49],        style(color=74, rgbcolor={0,0,127}));
        connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-72,30;
              -84,30],       style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[72,30;
              58,30],  style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-60,30; -48,
              30],         style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[46,30; 32,
              30],        style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
          annotation (points=[8,-19.2; 8,-6], style(thickness=2));
        connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) 
          annotation (points=[-4,-19.2; -4,-6], style(thickness=2));
        connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
          annotation (points=[-16,-19.2; -16,-6], style(thickness=2));
        connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) 
          annotation (points=[-28,-19.2; -28,-6], style(thickness=2));
        connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
          annotation (points=[-40,-19.2; -40,-6], style(thickness=2));
        connect(sinkRhIP.flange, stateRhIP_out.outlet) 
          annotation (points=[-16,-38; -16,-28.8], style(thickness=2));
        connect(sourceRhIP.flange, stateRhIP_in.inlet) 
          annotation (points=[-28,-52; -28,-28.8], style(thickness=2));
        connect(valveLinLP.inlet, stateShLP_out.outlet) 
          annotation (points=[16,-79; 8,-79; 8,-28.8], style(thickness=2));
        connect(valveLinIP.inlet, stateShIP_out.outlet) 
          annotation (points=[-10,-79; -4,-79; -4,-28.8], style(thickness=2));
        connect(valveLinHP.inlet, stateShHP_out.outlet) annotation (points=[-54,
              -39; -40,-39; -40,-28.8], style(thickness=2));
        connect(outLP.flange, valveLinLP.outlet) 
          annotation (points=[40,-79; 30,-79], style(thickness=2));
        connect(commandValve.y, valveLinHP.cmd) annotation (points=[-81.5,-91;
              -61,-91; -61,-44.6], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinIP.cmd, commandValve.y) annotation (points=[-17,-84.6;
              -17,-91; -81.5,-91], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinLP.cmd, commandValve.y) annotation (points=[23,-84.6;
              23,-91; -81.5,-91], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinHP.outlet, outHP.flange) 
          annotation (points=[-68,-39; -78,-39], style(thickness=2));
        connect(actuators, hRSG.ActuatorsBus) annotation (points=[78,49; 54.6,
              49; 54.6,48.4; 31.2,48.4], style(color=52, rgbcolor={213,255,170}));
        connect(sourceShLP.flange, stateFromCondenser.inlet) annotation (points=
             [24,-38; 24,-28.8], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(stateFromCondenser.outlet, hRSG.WaterIn) annotation (points=[24,
              -19.2; 24,-6], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(n_pump.y, actuators.flowRate_feedLP) annotation (points=[85.4,
              90; 78,90; 78,49], style(
            color=74,
            rgbcolor={0,0,127},
            fillPattern=1));
        connect(outIP.flange, valveLinIP.outlet) annotation (points=[-40,-79;
              -32,-79; -32,-79; -24,-79], style(thickness=2));
      end TestHRSG_wa;
      
      model TestHRSG_wafp 
        replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
          Modelica.Media.Interfaces.PartialMedium;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
      protected 
        Buses.Actuators actuators annotation (extent=[84,44; 72,54]);
        annotation (Diagram);
      public 
        Water.SinkP outHP(redeclare package Medium = FluidMedium, p0=0) 
                          annotation (extent=[-78,-46; -92,-32],
                                                              rotation=0);
        Water.SinkP outIP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[-36,-86; -50,-72],
                                                                rotation=0);
        Water.SinkP outLP(redeclare package Medium = FluidMedium, p0=0) 
                           annotation (extent=[40,-86; 54,-72], rotation=0);
        Water.SourceW sourceRhIP(
          redeclare package Medium = FluidMedium,
          h=3.22e6,
          w0=81.10,
          p0=28.4e5)          annotation (extent=[-34,-64; -22,-52],
                                                                   rotation=90);
        Water.SinkP sinkRhIP(
          redeclare package Medium = FluidMedium,
          h=3.548e6,
          p0=28.4e5)       annotation (extent=[-22,-38; -10,-50],
                                                                rotation=90);
        Gas.SourceW sourceGas(
          redeclare package Medium = FlueGasMedium,
          w0=585.5,
          T=884.65)          annotation (extent=[-100,22; -84,38]);
        Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                         annotation (extent=[72,22; 88,38]);
        Water.ValveLin valveLinHP(redeclare package Medium = FluidMedium, Kv=
              69.5/134.3e5)     annotation (extent=[-54,-32; -68,-46]);
        Water.ValveLin valveLinIP(redeclare package Medium = FluidMedium, Kv=
              12.7/29.6e5)       annotation (extent=[-10,-72; -24,-86],
            rotation=0);
        Water.ValveLin valveLinLP(redeclare package Medium = FluidMedium, Kv=
              6.91/6.6e5)        annotation (extent=[30,-86; 16,-72], rotation=
              180);
        Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
          annotation (extent=[98,64; 86,76]);
        Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
          annotation (extent=[58,64; 70,76]);
        Modelica.Blocks.Sources.Constant commandValve 
          annotation (extent=[-92,-96; -82,-86], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                               redeclare package Medium = 
              FlueGasMedium) annotation (extent=[-76,20; -56,40],   rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                redeclare package Medium = 
              FlueGasMedium) annotation (extent=[42,20; 62,40],   rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-48,-16; -32,-32], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[-12,-16; 4,-32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
            redeclare package Medium = FluidMedium) 
                           annotation (extent=[0,-16; 16,-32],    rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                   redeclare package Medium = 
              FluidMedium) annotation (extent=[-24,-16; -8,-32],  rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-36,-16; -20,-32], rotation=270);
        ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wafp hRSG(
                           redeclare package FlueGasMedium = FlueGasMedium, redeclare 
            package FluidMedium = FluidMedium) 
          annotation (extent=[-48,-6; 32,74]);
      public 
        Water.SourceW sourceWater(
          p0=1.98e6,
          h=2.440e5,
          w0=89.82)  annotation (extent=[30,-50; 18,-38], rotation=90);
      equation 
        connect(com_pumpFeedIP.y, actuators.flowRate_feedIP) 
                                                     annotation (points=[70.6,70;
              78,70; 78,49], style(color=74, rgbcolor={0,0,127}));
        connect(com_pumpFeedHP.y, actuators.flowRate_feedHP) 
                                                     annotation (points=[85.4,70;
              78,70; 78,49],        style(color=74, rgbcolor={0,0,127}));
        connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-72,30;
              -84,30],       style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[72,30;
              58,30],  style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2,
            fillColor=76,
            rgbfillColor={170,170,255},
            fillPattern=1));
        connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-60,30; -48,
              30],         style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[46,30; 32,
              30],        style(
            color=76,
            rgbcolor={159,159,223},
            thickness=2));
        connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
          annotation (points=[8,-19.2; 8,-6], style(thickness=2));
        connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) 
          annotation (points=[-4,-19.2; -4,-6], style(thickness=2));
        connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
          annotation (points=[-16,-19.2; -16,-6], style(thickness=2));
        connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) 
          annotation (points=[-28,-19.2; -28,-6], style(thickness=2));
        connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
          annotation (points=[-40,-19.2; -40,-6], style(thickness=2));
        connect(sinkRhIP.flange, stateRhIP_out.outlet) 
          annotation (points=[-16,-38; -16,-28.8], style(thickness=2));
        connect(sourceRhIP.flange, stateRhIP_in.inlet) 
          annotation (points=[-28,-52; -28,-28.8], style(thickness=2));
        connect(valveLinLP.inlet, stateShLP_out.outlet) 
          annotation (points=[16,-79; 8,-79; 8,-28.8], style(thickness=2));
        connect(valveLinIP.inlet, stateShIP_out.outlet) 
          annotation (points=[-10,-79; -4,-79; -4,-28.8], style(thickness=2));
        connect(valveLinIP.outlet, outIP.flange) 
          annotation (points=[-24,-79; -36,-79], style(thickness=2));
        connect(valveLinHP.inlet, stateShHP_out.outlet) annotation (points=[-54,
              -39; -40,-39; -40,-28.8], style(thickness=2));
        connect(outLP.flange, valveLinLP.outlet) 
          annotation (points=[40,-79; 30,-79], style(thickness=2));
        connect(commandValve.y, valveLinHP.cmd) annotation (points=[-81.5,-91;
              -61,-91; -61,-44.6], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinIP.cmd, commandValve.y) annotation (points=[-17,-84.6;
              -17,-91; -81.5,-91], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinLP.cmd, commandValve.y) annotation (points=[23,-84.6;
              23,-91; -81.5,-91], style(color=74, rgbcolor={0,0,127}));
        connect(valveLinHP.outlet, outHP.flange) 
          annotation (points=[-68,-39; -78,-39], style(thickness=2));
        connect(actuators, hRSG.ActuatorsBus) annotation (points=[78,49; 54.6,
              49; 54.6,48.4; 31.2,48.4], style(color=52, rgbcolor={213,255,170}));
        connect(sourceWater.flange, hRSG.WaterIn) annotation (points=[24,-38; 24,-6],
            style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end TestHRSG_wafp;
      
      package AddControl 
        model TestPumpControl 
          import ThermoPower;
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          Water.SinkP sinkToEcLP_p(           h=2.440e5, p0=7.19e5) 
            annotation (extent=[60,-20; 80,0]);
          Water.SourceP sourceShLP(
            redeclare package Medium = FluidMedium,
            p0=5398.2,
            h=1.43495e5) 
            annotation (extent=[-60,0; -80,-20],
                                               rotation=180);
        public 
          Modelica.Blocks.Sources.Ramp n_pump(
            duration=100,
            offset=89.9,
            startTime=500,
            height=0) 
            annotation (extent=[64,34; 52,46]);
          ThermoPower.PowerPlants.Control.PID pIDController(
            CSmin=500,
            PVmin=-1,
            PVmax=1,
            CSmax=2500,
            Ti=200,
            Kp=4) annotation (extent=[12,46; 32,26],  rotation=180);
        public 
          ThermoPower.PowerPlants.HRSG.Components.PrescribedSpeedPump pump(
            rho_nom=1000,
            redeclare package WaterMedium = FluidMedium,
            q_nom={0.0898,0,0.1},
            head_nom={72.74,130,0},
            nominalSteamPressure=7.19048e5,
            nominalCondensationPressure=5398.2,
            nominalSteamFlow=89.8,
            hstart=1.43495e5,
            n0=1500,
            feedWaterPump(redeclare function efficiencyCharacteristic = 
                  Functions.PumpCharacteristics.constantEfficiency (eta_nom=0.6))) 
                                  annotation (extent=[0,0; -20,-20],   rotation=180);
          ThermoPower.Water.SensW feed_w(redeclare package Medium = FluidMedium)
            annotation (extent=[36,4; 16,-16],      rotation=180);
          annotation (Diagram);
          Modelica.Blocks.Continuous.FirstOrder firstOrder(y_start=1512, T=1) 
            annotation (extent=[-4,26; -24,46], rotation=0);
        equation 
          connect(n_pump.y, pIDController.SP) annotation (points=[51.4,40; 32,
                40], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(feed_w.inlet, pump.outlet)          annotation (points=[20,-10;
                10,-10; 10,-10; 0,-10],      style(
              thickness=2,
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(sourceShLP.flange, pump.inlet)          annotation (points=[-60,-10;
                -50,-10; -50,-10; -40,-10; -40,-10; -20,-10],          style(
              thickness=2,
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(feed_w.outlet, sinkToEcLP_p.flange) annotation (points=[32,
                -10; 60,-10], style(
              thickness=2,
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(pIDController.PV, feed_w.w) annotation (points=[32,32; 40,32;
                40,-8.88178e-016; 34,-8.88178e-016],       style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(pIDController.CS, firstOrder.u) annotation (points=[11.4,36;
                -2,36], style(color=74, rgbcolor={0,0,127}));
          connect(firstOrder.y, pump.pumpSpeed_rpm)          annotation (points=[-25,36;
                -40,36; -40,-4; -20.8,-4],         style(color=74, rgbcolor={0,
                  0,127}));
        end TestPumpControl;
        
        model TestDG_3LCC_wafp 
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wafp Drums(
            HPd_rint=1.067,
            HPd_rext=1.167,
            HPd_L=11.920,
            HPd_Cm=0,
            IPd_rint=0.915,
            IPd_rext=1.015,
            IPd_L=7,
            IPd_Cm=0,
            LPd_rint=1.143,
            LPd_rext=1.243,
            LPd_L=11.503,
            LPd_Cm=0,
            RiserHPFlowRate=175.5,
            RiserIPFlowRate=67.5,
            RiserLPFlowRate=41.5,
            redeclare package FluidMedium = FluidMedium,
            SSInit=false,
            fluidLPNomPressure=7.19048e5,
            LPd_hvstart=2.76051e6,
            LPd_hlstart=6.68356e5,
            fluidHPNomPressure=1.626e7,
            fluidIPNomPressure=3.3816e6,
            HPd_hvstart=2.53239e6,
            HPd_hlstart=1.5879e6,
            IPd_hvstart=2.794e6,
            IPd_hlstart=1.0265e5) annotation (extent=[-94,-20; 6,80]);
          Water.SinkP sinkToEcLP_p(           h=2.440e5, p0=7.19e5) 
            annotation (extent=[74,52; 86,64]);
          annotation (Diagram);
          Water.SourceW sourceFromEcLP_w(
            h=6.544e5,
            w0=89.8,
            p0=7.19048e5) 
                       annotation (extent=[70,44; 58,56]);
          Water.SinkP sinkToRiserLP_p(p0=1.534e6, h=1.6325e6) 
            annotation (extent=[74,36; 86,48]);
          Water.SourceW sourceFromRiserLP_w(
            w0=41.49,
            h=1.065e6,
            p0=7.19046e5) 
                       annotation (extent=[70,28; 58,40]);
          Water.SinkP sinkToShLP_p(          h=2.760e6,
            redeclare package Medium = FluidMedium,
            p0=5.398e3) 
            annotation (extent=[74,20; 86,32]);
          Water.SinkP sinkToEcHP_p(p0=1.389e7, h=6.775e5) 
            annotation (extent=[-62,-70; -50,-58], rotation=270);
          Water.SourceW sourceFromEcHP_w(
            w0=69.5,
            h=1.463e6,
            p0=1.626e7) 
                       annotation (extent=[-58,-56; -70,-44], rotation=90);
          Water.SinkP sinkToRiserHP_p(p0=1.371e7, h=1.6325e6) 
            annotation (extent=[-78,-70; -66,-58], rotation=270);
          Water.SourceW sourceFromRiserHP_w(
            w0=175.5,
            h=2.002e6,
            p0=1.626e7) 
                       annotation (extent=[-74,-56; -86,-44], rotation=90);
          Water.SinkP sinkToShHP_p(            h=2.657e6,
            redeclare package Medium = FluidMedium,
            p0=2.98e6) 
            annotation (extent=[-58,-86; -46,-74], rotation=0);
          Water.SinkP sinkToEcIP_p(p0=4.86e6, h=6.654e5) 
            annotation (extent=[-14,-70; -2,-58], rotation=270);
          Water.SourceW sourceFromEcIP_w(
            h=9.444e5,
            w0=12.7,
            p0=3.3816e6) 
                       annotation (extent=[-10,-56; -22,-44], rotation=90);
          Water.SinkP sinkToRiserIP_p(p0=3.716e6, h=1.0223e6) 
            annotation (extent=[-30,-70; -18,-58], rotation=270);
          Water.SourceW sourceFromRiserIP_w(
            w0=67.5,
            h=1.370e6,
            p0=3.3816e6) 
                       annotation (extent=[-26,-56; -38,-44], rotation=90);
          Water.SinkP sinkToShIP_p(           h=2.802e6,
            p0=6e5,
            redeclare package Medium = FluidMedium) 
            annotation (extent=[-6,-86; 6,-74],    rotation=0);
          Water.ValveLin valveLP(redeclare package Medium = FluidMedium, Kv=6.9/6.738e5) 
            annotation (extent=[40,34; 56,18]);
          Water.ValveLin valveIP(redeclare package Medium = FluidMedium, Kv=13.5/
                2.959e6) annotation (extent=[-32,-72; -16,-88]);
          Water.ValveLin valveHP(redeclare package Medium = FluidMedium, Kv=70/1.344e7) 
            annotation (extent=[-84,-72; -68,-88]);
        public 
          Modelica.Blocks.Sources.Constant com_valve(k=1) 
            annotation (extent=[36,-98; 24,-86]);
        public 
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcHP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-62,-28; -50,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-70,-40; -58,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-78,-28; -66,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-86,-40; -74,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShHP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-94,-28; -82,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcIP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-14,-28; -2,-40],rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-22,-40; -10,-28],rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-30,-28; -18,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-38,-40; -26,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShIP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-46,-28; -34,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcLP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[34,64; 22,52], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[22,44; 34,56], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[34,48; 22,36], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[22,28; 34,40], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShLP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[34,32; 22,20], rotation=180);
        public 
          Water.SourceW sourceWater(
            p0=1.98e6,
            h=2.440e5,
            w0=89.82)  annotation (extent=[60,60; 48,72]);
        protected 
          Buses.Actuators actuators 
            annotation (extent=[34,-58; 46,-46], rotation=0);
        public 
          Control.levelsControl levelsControl 
            annotation (extent=[44,-30; 64,-10], rotation=180);
        equation 
          connect(valveLP.outlet, sinkToShLP_p.flange) 
            annotation (points=[56,26; 74,26], style(thickness=2));
          connect(valveHP.outlet, sinkToShHP_p.flange) 
            annotation (points=[-68,-80; -58,-80], style(thickness=2));
          connect(valveIP.outlet, sinkToShIP_p.flange) 
            annotation (points=[-16,-80; -6,-80], style(thickness=2));
          connect(valveHP.cmd, com_valve.y) annotation (points=[-76,-86.4; -76,
                -92; 23.4,-92],                 style(color=74, rgbcolor={0,0,127}));
          connect(valveIP.cmd, com_valve.y) annotation (points=[-24,-86.4; -24,
                -92; 23.4,-92],                 style(color=74, rgbcolor={0,0,127}));
          connect(valveLP.cmd, com_valve.y) annotation (points=[48,19.6; 48,14;
                18,14; 18,-92; 23.4,-92],
                                      style(color=74, rgbcolor={0,0,127}));
          connect(sinkToEcIP_p.flange, stateToEcIP.outlet) annotation (points=[-8,-58;
                -8,-47.8; -8,-47.8; -8,-37.6],      style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcIP.inlet, Drums.WaterForIP)           annotation (
              points=[-8,-30.4; -8,-20; -9,-20],   style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserIP_p.flange, stateToRiserIP.outlet) annotation (
              points=[-24,-58; -24,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserIP.inlet, Drums.ToRiser_IP)           annotation (
              points=[-24,-30.4; -24,-20; -25,-20],    style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserIP_w.flange, stateReturnRiserIP.inlet) 
            annotation (points=[-32,-44; -32,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserIP.outlet, Drums.FromRiser_IP) 
            annotation (points=[-32,-30.4; -32,-20; -33,-20],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcIP.outlet, Drums.Feed_IP)           annotation (
              points=[-16,-30.4; -16,-20; -17,-20],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcIP_w.flange, stateReturnEcIP.inlet) annotation (
              points=[-16,-44; -16,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShIP.inlet, Drums.Steam_IP_Out)           annotation (
              points=[-40,-30.4; -40,-20; -41,-20],    style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShIP.outlet, valveIP.inlet) annotation (points=[-40,
                -37.6; -40,-80; -32,-80], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToEcHP_p.flange, stateToEcHP.outlet) annotation (points=[
                -56,-58; -56,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcHP.inlet, Drums.WaterForHP)           annotation (
              points=[-56,-30.4; -56,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcHP.outlet, Drums.Feed_HP)           annotation (
              points=[-64,-30.4; -64,-20],            style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcHP_w.flange, stateReturnEcHP.inlet) annotation (
              points=[-64,-44; -64,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserHP_p.flange, stateToRiserHP.outlet) annotation (
              points=[-72,-58; -72,-37.6],            style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserHP.inlet, Drums.ToRiser_HP)           annotation (
              points=[-72,-30.4; -72,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserHP_w.flange, stateReturnRiserHP.inlet) 
            annotation (points=[-80,-44; -80,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserHP.outlet, Drums.FromRiser_HP) 
            annotation (points=[-80,-30.4; -80,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(valveHP.inlet, stateToShHP.outlet) annotation (points=[-84,-80;
                -88,-80; -88,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShHP.inlet, Drums.Steam_HP_Out)           annotation (
              points=[-88,-30.4; -88,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserLP_w.flange, stateReturnRiserLP.inlet) 
            annotation (points=[58,34; 31.6,34], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserLP_p.flange, stateToRiserLP.outlet) annotation (
              points=[74,42; 31.6,42], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserLP.outlet, Drums.FromRiser_LP) 
            annotation (points=[24.4,34; 6,34],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShLP.inlet, Drums.Steam_LP_Out)           annotation (
              points=[24.4,26; 6,26],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserLP.inlet, Drums.ToRiser_LP)           annotation (
              points=[24.4,42; 6,42],                      style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcLP_w.flange, stateReturnEcLP.inlet) annotation (
              points=[58,50; 31.6,50], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcLP.outlet, Drums.Feed_LP)           annotation (
              points=[24.4,50; 6,50],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToEcLP_p.flange, stateToEcLP.outlet) annotation (points=[74,58;
                31.6,58],     style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcLP.inlet, Drums.WaterForLP)           annotation (
              points=[24.4,58; 6,58],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(valveLP.inlet, stateToShLP.outlet) annotation (points=[40,26;
                31.6,26],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceWater.flange, Drums.WaterIn)           annotation (points=
               [48,66; 6,66], style(
              thickness=2,
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(sourceFromEcLP_w.in_w0, actuators.flowRate_feedLP) 
            annotation (points=[66.4,53.6; 66.4,72; 98,72; 98,-52; 40,-52],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(sourceFromEcIP_w.in_w0, actuators.flowRate_feedIP) 
            annotation (points=[-12.4,-52.4; 12,-52.4; 12,-70; 98,-70; 98,-52;
                40,-52], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(sourceFromEcHP_w.in_w0, actuators.flowRate_feedHP) 
            annotation (points=[-60.4,-52.4; -44,-52.4; -44,-70; 98,-70; 98,-52;
                40,-52], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(levelsControl.ActuatorsBus, Drums.ActuatorsBus) 
            annotation (points=[44,-20; 28,-20; 28,-6; 5,-6], style(color=52,
                rgbcolor={213,255,170}));
          connect(levelsControl.ActuatorsBus, actuators) annotation (points=[44,
                -20; 28,-20; 28,-52; 40,-52], style(color=52, rgbcolor={213,255,
                  170}));
          connect(levelsControl.SensorsBus, Drums.SensorsBus) 
            annotation (points=[63.8,-20; 80,-20; 80,10; 5,10], style(color=84,
                rgbcolor={255,170,213}));
        end TestDG_3LCC_wafp;
        
        model TestDG_3LCC_wa 
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          ThermoPower.PowerPlants.HRSG.Examples.DG_3L_CC_wa Drums(
            HPd_rint=1.067,
            HPd_rext=1.167,
            HPd_L=11.920,
            HPd_Cm=0,
            IPd_rint=0.915,
            IPd_rext=1.015,
            IPd_L=7,
            IPd_Cm=0,
            LPd_rint=1.143,
            LPd_rext=1.243,
            LPd_L=11.503,
            LPd_Cm=0,
            RiserHPFlowRate=175.5,
            RiserIPFlowRate=67.5,
            RiserLPFlowRate=41.5,
            redeclare package FluidMedium = FluidMedium,
            SSInit=false,
            fluidLPNomPressure=7.19048e5,
            LPd_hvstart=2.76051e6,
            LPd_hlstart=6.68356e5,
            fluidHPNomPressure=1.626e7,
            fluidIPNomPressure=3.3816e6,
            HPd_hvstart=2.53239e6,
            HPd_hlstart=1.5879e6,
            IPd_hvstart=2.794e6,
            IPd_hlstart=1.0265e5,
            n0_TFP=1500,
            inletTFPNomPressure=5398.2,
            TFPNomFlowRate=89.8,
            hstart_TFP=1.43495e5) annotation (extent=[-94,-20; 6,80]);
          Water.SinkP sinkToEcLP_p(           h=2.440e5, p0=7.19e5) 
            annotation (extent=[74,52; 86,64]);
          annotation (Diagram);
          Water.SourceW sourceFromEcLP_w(
            h=6.544e5,
            w0=89.8,
            p0=7.19048e5) 
                       annotation (extent=[70,44; 58,56]);
          Water.SinkP sinkToRiserLP_p(p0=1.534e6, h=1.6325e6) 
            annotation (extent=[74,36; 86,48]);
          Water.SourceW sourceFromRiserLP_w(
            w0=41.49,
            h=1.065e6,
            p0=7.19046e5) 
                       annotation (extent=[70,28; 58,40]);
          Water.SinkP sinkToShLP_p(          h=2.760e6,
            redeclare package Medium = FluidMedium,
            p0=5.398e3) 
            annotation (extent=[74,20; 86,32]);
          Water.SinkP sinkToEcHP_p(p0=1.389e7, h=6.775e5) 
            annotation (extent=[-62,-70; -50,-58], rotation=270);
          Water.SourceW sourceFromEcHP_w(
            w0=69.5,
            h=1.463e6,
            p0=1.626e7) 
                       annotation (extent=[-58,-56; -70,-44], rotation=90);
          Water.SinkP sinkToRiserHP_p(p0=1.371e7, h=1.6325e6) 
            annotation (extent=[-78,-70; -66,-58], rotation=270);
          Water.SourceW sourceFromRiserHP_w(
            w0=175.5,
            h=2.002e6,
            p0=1.626e7) 
                       annotation (extent=[-74,-56; -86,-44], rotation=90);
          Water.SinkP sinkToShHP_p(            h=2.657e6,
            redeclare package Medium = FluidMedium,
            p0=2.98e6) 
            annotation (extent=[-58,-86; -46,-74], rotation=0);
          Water.SinkP sinkToEcIP_p(p0=4.86e6, h=6.654e5) 
            annotation (extent=[-14,-70; -2,-58], rotation=270);
          Water.SourceW sourceFromEcIP_w(
            h=9.444e5,
            w0=12.7,
            p0=3.3816e6) 
                       annotation (extent=[-10,-56; -22,-44], rotation=90);
          Water.SinkP sinkToRiserIP_p(p0=3.716e6, h=1.0223e6) 
            annotation (extent=[-30,-70; -18,-58], rotation=270);
          Water.SourceW sourceFromRiserIP_w(
            w0=67.5,
            h=1.370e6,
            p0=3.3816e6) 
                       annotation (extent=[-26,-56; -38,-44], rotation=90);
          Water.SinkP sinkToShIP_p(           h=2.802e6,
            p0=6e5,
            redeclare package Medium = FluidMedium) 
            annotation (extent=[-6,-86; 6,-74],    rotation=0);
          Water.ValveLin valveLP(redeclare package Medium = FluidMedium, Kv=6.9/6.738e5) 
            annotation (extent=[40,34; 56,18]);
          Water.ValveLin valveIP(redeclare package Medium = FluidMedium, Kv=13.5/
                2.959e6) annotation (extent=[-32,-72; -16,-88]);
          Water.ValveLin valveHP(redeclare package Medium = FluidMedium, Kv=70/1.344e7) 
            annotation (extent=[-84,-72; -68,-88]);
        public 
          Modelica.Blocks.Sources.Constant com_valve(k=1) 
            annotation (extent=[46,-90; 34,-78]);
        public 
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcHP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-62,-28; -50,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-70,-40; -58,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-78,-28; -66,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserHP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-86,-40; -74,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShHP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-94,-28; -82,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcIP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-14,-28; -2,-40],rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-22,-40; -10,-28],rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-30,-28; -18,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserIP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[-38,-40; -26,-28], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShIP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[-46,-28; -34,-40], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToEcLP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[34,64; 22,52], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnEcLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[22,44; 34,56], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateToRiserLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[34,48; 22,36], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateReturnRiserLP(                     redeclare package Medium = 
                FluidMedium) annotation (extent=[22,28; 34,40], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToShLP(
                                             redeclare package Medium = 
                FluidMedium) annotation (extent=[34,32; 22,20], rotation=180);
          Water.SourceP sourceShLP(
            redeclare package Medium = FluidMedium,
            p0=5398.2,
            h=1.43495e5) 
            annotation (extent=[54,72; 66,60], rotation=180);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateFromCondenser(                           redeclare package 
              Medium = 
                FluidMedium) annotation (extent=[34,72; 22,60], rotation=0);
        protected 
          Buses.Actuators actuators 
            annotation (extent=[36,-60; 48,-48], rotation=0);
        public 
          ThermoPower.PowerPlants.HRSG.Control.levelsControl 
            levelsControlSimplified 
            annotation (extent=[40,-30; 60,-10], rotation=180);
          Water.SensW sensW annotation (extent=[50,62; 36,76]);
        equation 
          connect(valveLP.outlet, sinkToShLP_p.flange) 
            annotation (points=[56,26; 74,26], style(thickness=2));
          connect(valveHP.outlet, sinkToShHP_p.flange) 
            annotation (points=[-68,-80; -58,-80], style(thickness=2));
          connect(valveIP.outlet, sinkToShIP_p.flange) 
            annotation (points=[-16,-80; -6,-80], style(thickness=2));
          connect(valveHP.cmd, com_valve.y) annotation (points=[-76,-86.4; -76,
                -96; 18,-96; 18,-84; 33.4,-84], style(color=74, rgbcolor={0,0,127}));
          connect(valveIP.cmd, com_valve.y) annotation (points=[-24,-86.4; -24,
                -96; 18,-96; 18,-84; 33.4,-84], style(color=74, rgbcolor={0,0,127}));
          connect(valveLP.cmd, com_valve.y) annotation (points=[48,19.6; 48,14;
                18,14; 18,-84; 33.4,-84],
                                      style(color=74, rgbcolor={0,0,127}));
          connect(sinkToEcIP_p.flange, stateToEcIP.outlet) annotation (points=[-8,-58;
                -8,-47.8; -8,-47.8; -8,-37.6],      style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcIP.inlet, Drums.WaterForIP)           annotation (
              points=[-8,-30.4; -8,-20; -9,-20],   style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserIP_p.flange, stateToRiserIP.outlet) annotation (
              points=[-24,-58; -24,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserIP.inlet, Drums.ToRiser_IP)           annotation (
              points=[-24,-30.4; -24,-20; -25,-20],    style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserIP_w.flange, stateReturnRiserIP.inlet) 
            annotation (points=[-32,-44; -32,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserIP.outlet, Drums.FromRiser_IP) 
            annotation (points=[-32,-30.4; -32,-20; -33,-20],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcIP.outlet, Drums.Feed_IP)           annotation (
              points=[-16,-30.4; -16,-20; -17,-20],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcIP_w.flange, stateReturnEcIP.inlet) annotation (
              points=[-16,-44; -16,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShIP.inlet, Drums.Steam_IP_Out)           annotation (
              points=[-40,-30.4; -40,-20; -41,-20],    style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShIP.outlet, valveIP.inlet) annotation (points=[-40,
                -37.6; -40,-80; -32,-80], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToEcHP_p.flange, stateToEcHP.outlet) annotation (points=[
                -56,-58; -56,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcHP.inlet, Drums.WaterForHP)           annotation (
              points=[-56,-30.4; -56,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcHP.outlet, Drums.Feed_HP)           annotation (
              points=[-64,-30.4; -64,-20],            style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcHP_w.flange, stateReturnEcHP.inlet) annotation (
              points=[-64,-44; -64,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserHP_p.flange, stateToRiserHP.outlet) annotation (
              points=[-72,-58; -72,-37.6],            style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserHP.inlet, Drums.ToRiser_HP)           annotation (
              points=[-72,-30.4; -72,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserHP_w.flange, stateReturnRiserHP.inlet) 
            annotation (points=[-80,-44; -80,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserHP.outlet, Drums.FromRiser_HP) 
            annotation (points=[-80,-30.4; -80,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(valveHP.inlet, stateToShHP.outlet) annotation (points=[-84,-80;
                -88,-80; -88,-37.6], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShHP.inlet, Drums.Steam_HP_Out)           annotation (
              points=[-88,-30.4; -88,-20],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromRiserLP_w.flange, stateReturnRiserLP.inlet) 
            annotation (points=[58,34; 31.6,34], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sinkToRiserLP_p.flange, stateToRiserLP.outlet) annotation (
              points=[74,42; 31.6,42], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnRiserLP.outlet, Drums.FromRiser_LP) 
            annotation (points=[24.4,34; 6,34],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToShLP.inlet, Drums.Steam_LP_Out)           annotation (
              points=[24.4,26; 6,26],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToRiserLP.inlet, Drums.ToRiser_LP)           annotation (
              points=[24.4,42; 6,42],                      style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(sourceFromEcLP_w.flange, stateReturnEcLP.inlet) annotation (
              points=[58,50; 31.6,50], style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateReturnEcLP.outlet, Drums.Feed_LP)           annotation (
              points=[24.4,50; 6,50],                        style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateToEcLP.inlet, Drums.WaterForLP)           annotation (
              points=[24.4,58; 6,58],                          style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(valveLP.inlet, stateToShLP.outlet) annotation (points=[40,26;
                31.6,26],               style(
              thickness=2,
              fillColor=3,
              rgbfillColor={0,0,255},
              fillPattern=1));
          connect(stateFromCondenser.outlet, Drums.WaterIn)           annotation (
             points=[24.4,66; 6,66], style(
              thickness=2,
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(sourceFromEcIP_w.in_w0, actuators.flowRate_feedIP) 
            annotation (points=[-12.4,-52.4; 8,-52.4; 8,-72; 94,-72; 94,-54; 42,
                -54], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(sourceFromEcHP_w.in_w0, actuators.flowRate_feedHP) 
            annotation (points=[-60.4,-52.4; -48,-52.4; -48,-72; 94,-72; 94,-54;
                42,-54], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1));
          connect(levelsControlSimplified.SensorsBus, Drums.SensorsBus) 
            annotation (points=[59.8,-20; 78,-20; 78,10; 5,10], style(color=84,
                rgbcolor={255,170,213}));
          connect(levelsControlSimplified.ActuatorsBus, Drums.ActuatorsBus) 
            annotation (points=[40,-20; 24,-20; 24,-6; 5,-6], style(color=52,
                rgbcolor={213,255,170}));
          connect(levelsControlSimplified.ActuatorsBus, actuators) annotation (
              points=[40,-20; 24,-20; 24,-54; 42,-54], style(color=52, rgbcolor=
                 {213,255,170}));
          connect(sensW.w, sourceFromEcLP_w.in_w0) annotation (points=[37.4,
                73.2; 26,73.2; 26,82; 66.4,82; 66.4,53.6], style(color=74,
                rgbcolor={0,0,127}));
          connect(sensW.outlet, stateFromCondenser.inlet) annotation (points=[
                38.8,66.2; 35.4,66.2; 35.4,66; 31.6,66], style(thickness=2));
          connect(sourceShLP.flange, sensW.inlet) annotation (points=[54,66;
                51.6,66; 51.6,66.2; 47.2,66.2], style(thickness=2));
          connect(sinkToEcLP_p.flange, stateToEcLP.outlet) 
            annotation (points=[74,58; 31.6,58], style(thickness=2));
        end TestDG_3LCC_wa;
        
        model TestHRSG_wa 
          replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
            Modelica.Media.Interfaces.PartialMedium;
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          annotation (Diagram);
          Gas.SourceW sourceGas(
            redeclare package Medium = FlueGasMedium,
            w0=585.5,
            T=884.65)          annotation (extent=[-100,22; -84,38]);
          Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                           annotation (extent=[74,22; 90,38]);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                                 redeclare package Medium = 
                FlueGasMedium) annotation (extent=[-76,20; -56,40],   rotation=0);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                  redeclare package Medium = 
                FlueGasMedium) annotation (extent=[44,20; 64,40],   rotation=0);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShHP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[-48,-16; -32,-32], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShIP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[-12,-16; 4,-32],   rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShLP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[0,-16; 16,-32],    rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateRhIP_out(                           redeclare package Medium 
              = FluidMedium) annotation (extent=[-24,-16; -8,-32],  rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateRhIP_in(                           redeclare package Medium = 
                FluidMedium) annotation (extent=[-36,-16; -20,-32], rotation=270);
          ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                  redeclare package FlueGasMedium = 
                FlueGasMedium,                                                     redeclare 
              package FluidMedium = FluidMedium) 
            annotation (extent=[-48,-6; 32,74]);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateFromCondenser(                           redeclare package 
              Medium = 
                FluidMedium) annotation (extent=[32,-16; 16,-32],
                                                                rotation=270);
          Water.SinkP OutLP(redeclare package Medium = FluidMedium,
            p0=5389.2,
            h=2.3854e6)      annotation (extent=[64,-80; 76,-68], rotation=0);
          Water.SteamTurbineStodola turbineHP(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-50,-92; -30,-72]);
          Water.SteamTurbineStodola turbineIP(
            pstart_in=2.68e6,
            pstart_out=6e5,
            wstart=81.10,
            hstartin=3.554e6,
            hstartout=3.1281e6,
            wnom=81.10,
            eta_iso_nom=0.903,
            Kt=0.018883)     annotation (extent=[-10,-92; 10,-72]);
          Water.SteamTurbineStodola turbineLP(
            pstart_in=6e5,
            pstart_out=5.3982e3,
            wstart=89.82,
            hstartin=3.109e6,
            hstartout=2.3854e6,
            wnom=89.82,
            eta_iso_nom=0.903,
            Kt=0.078004)     annotation (extent=[34,-92; 54,-72]);
          Water.Mixer mixLP(
            redeclare package Medium = FluidMedium,
            V=10,
            pstart=7.19e5,
            hstart=2.89295e6,
            initOpt=ThermoPower.Choices.Init.Options.noInit) 
                            annotation (extent=[16,-76; 26,-66],
                                                              rotation=0);
          Water.Mixer mixIP(
            redeclare package Medium = FluidMedium,
            V=10,
            pstart=3.38e6,
            initOpt=ThermoPower.Choices.Init.Options.noInit,
            hstart=3.1076e6) annotation (extent=[-34,-50; -22,-38],
                                                                  rotation=90);
          Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
                314.16/2) 
                        annotation (extent=[94,-88; 84,-78]);
          Water.SourceP sourceShLP(
            redeclare package Medium = FluidMedium,
            p0=5398.2,
            h=1.43495e5) 
            annotation (extent=[34,-40; 46,-52],
                                               rotation=180);
          Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
            annotation (extent=[90,62; 78,74]);
          Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
            annotation (extent=[50,62; 62,74]);
        public 
          Modelica.Blocks.Sources.Constant n_pump(k=89.8) 
            annotation (extent=[90,82; 78,94]);
        protected 
          Buses.Actuators actuators annotation (extent=[76,42; 64,52]);
        equation 
          connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-72,30;
                -84,30],       style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2,
              fillColor=76,
              rgbfillColor={170,170,255},
              fillPattern=1));
          connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[74,30;
                60,30],  style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2,
              fillColor=76,
              rgbfillColor={170,170,255},
              fillPattern=1));
          connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-60,30; -48,
                30],         style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2));
          connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[48,30;
                32,30],     style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2));
          connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
            annotation (points=[8,-19.2; 8,-6], style(thickness=2));
          connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) 
            annotation (points=[-4,-19.2; -4,-6], style(thickness=2));
          connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
            annotation (points=[-16,-19.2; -16,-6], style(thickness=2));
          connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) 
            annotation (points=[-28,-19.2; -28,-6], style(thickness=2));
          connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
            annotation (points=[-40,-19.2; -40,-6], style(thickness=2));
          connect(stateFromCondenser.outlet, hRSG.WaterIn) annotation (points=[24,
                -19.2; 24,-6], style(
              thickness=2,
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(OutLP.flange, turbineLP.outlet) annotation (points=[64,-74;
                51.7,-74],                 style(thickness=2));
          connect(turbineHP.shaft_b, turbineIP.shaft_a) annotation (points=[-33.6,
                -82; -6.6,-82],       style(color=0, rgbcolor={0,0,0}));
          connect(turbineIP.shaft_b, turbineLP.shaft_a) annotation (points=[6.4,-82;
                37.4,-82],           style(color=0, rgbcolor={0,0,0}));
          connect(mixLP.in2, turbineIP.outlet) 
            annotation (points=[17.05,-74; 7.7,-74],  style(thickness=2));
          connect(constantSpeed.flange, turbineLP.shaft_b) annotation (points=[84,-83;
                84,-82; 50.4,-82],         style(color=0, rgbcolor={0,0,0}));
          connect(turbineLP.inlet, mixLP.out) annotation (points=[36.5,-74.1;
                36.5,-71; 26,-71], style(thickness=2));
          connect(sourceShLP.flange, stateFromCondenser.inlet) 
            annotation (points=[34,-46; 24,-46; 24,-28.8], style(thickness=2));
          connect(com_pumpFeedIP.y,actuators. flowRate_feedIP) 
                                                       annotation (points=[62.6,68;
                70,68; 70,47], style(color=74, rgbcolor={0,0,127}));
          connect(com_pumpFeedHP.y,actuators. flowRate_feedHP) 
                                                       annotation (points=[77.4,68;
                70,68; 70,47],        style(color=74, rgbcolor={0,0,127}));
          connect(actuators, hRSG.ActuatorsBus) annotation (points=[70,47; 46.6,
                47; 46.6,48.4; 31.2,48.4], style(color=52, rgbcolor={213,255,170}));
          connect(n_pump.y,actuators. flowRate_feedLP) annotation (points=[77.4,88;
                70,88; 70,47],     style(
              color=74,
              rgbcolor={0,0,127},
              fillPattern=1));
          connect(mixLP.in1, stateShLP_out.outlet) 
            annotation (points=[17,-68; 8,-68; 8,-28.8], style(thickness=2));
          connect(turbineHP.inlet, stateShHP_out.outlet) annotation (points=[-47.5,
                -74.1; -47.5,-52.05; -40,-52.05; -40,-28.8],       style(
                thickness=2));
          connect(turbineHP.outlet, mixIP.in1) annotation (points=[-32.3,-74;
                -31.6,-74; -31.6,-48.8], style(thickness=2));
          connect(mixIP.out, stateRhIP_in.inlet) 
            annotation (points=[-28,-38; -28,-28.8], style(thickness=2));
          connect(turbineIP.inlet, stateRhIP_out.outlet) annotation (points=[-7.5,
                -74.1; -16,-74.1; -16,-28.8],      style(thickness=2));
          connect(stateShIP_out.outlet, mixIP.in2) annotation (points=[-4,-28.8;
                -4,-60; -24.4,-60; -24.4,-48.74], style(thickness=2));
        end TestHRSG_wa;
        
        model TestHRSG_wac 
          replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
            Modelica.Media.Interfaces.PartialMedium;
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          annotation (Diagram);
          Gas.SourceW sourceGas(
            redeclare package Medium = FlueGasMedium,
            w0=585.5,
            T=884.65)          annotation (extent=[-100,22; -84,38]);
          Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                           annotation (extent=[74,22; 90,38]);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                                 redeclare package Medium = 
                FlueGasMedium) annotation (extent=[-76,20; -56,40],   rotation=0);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                                  redeclare package Medium = 
                FlueGasMedium) annotation (extent=[42,20; 62,40],   rotation=0);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShHP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[-48,-16; -32,-32], rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShIP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[-12,-16; 4,-32],   rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateShLP_out(
              redeclare package Medium = FluidMedium) 
                             annotation (extent=[0,-16; 16,-32],    rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateRhIP_out(                           redeclare package Medium 
              = FluidMedium) annotation (extent=[-24,-16; -8,-32],  rotation=90);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateRhIP_in(                           redeclare package Medium = 
                FluidMedium) annotation (extent=[-36,-16; -20,-32], rotation=270);
          ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                  redeclare package FlueGasMedium = 
                FlueGasMedium,                                                     redeclare 
              package FluidMedium = FluidMedium) 
            annotation (extent=[-48,-6; 32,74]);
          ThermoPower.PowerPlants.HRSG.Components.StateReader_water 
            stateFromCondenser(                           redeclare package 
              Medium = 
                FluidMedium) annotation (extent=[32,-16; 16,-32],
                                                                rotation=270);
          Water.SinkP OutLP(redeclare package Medium = FluidMedium,
            p0=5389.2,
            h=2.3854e6)      annotation (extent=[64,-76; 76,-64], rotation=0);
          Water.SteamTurbineStodola turbineHP(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-50,-92; -30,-72]);
          Water.SteamTurbineStodola turbineIP(
            pstart_in=2.68e6,
            pstart_out=6e5,
            wstart=81.10,
            hstartin=3.554e6,
            hstartout=3.1281e6,
            wnom=81.10,
            eta_iso_nom=0.903,
            Kt=0.018883)     annotation (extent=[-10,-92; 10,-72]);
          Water.SteamTurbineStodola turbineLP(
            pstart_in=6e5,
            pstart_out=5.3982e3,
            wstart=89.82,
            hstartin=3.109e6,
            hstartout=2.3854e6,
            wnom=89.82,
            eta_iso_nom=0.903,
            Kt=0.078004)     annotation (extent=[34,-92; 54,-72]);
          Water.Mixer mixLP(
            redeclare package Medium = FluidMedium,
            V=10,
            pstart=7.19e5,
            hstart=2.89295e6,
            initOpt=ThermoPower.Choices.Init.Options.noInit) 
                            annotation (extent=[18,-76; 28,-66],
                                                              rotation=0);
          Water.Mixer mixIP(
            redeclare package Medium = FluidMedium,
            V=10,
            pstart=3.38e6,
            initOpt=ThermoPower.Choices.Init.Options.noInit,
            hstart=3.1076e6) annotation (extent=[-34,-50; -22,-38],
                                                                  rotation=90);
          Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
                314.16/2) 
                        annotation (extent=[98,-88; 88,-78]);
          Water.SourceP sourceShLP(
            redeclare package Medium = FluidMedium,
            p0=5398.2,
            h=1.43495e5) 
            annotation (extent=[40,-34; 52,-46],
                                               rotation=180);
          ThermoPower.PowerPlants.HRSG.Control.levelsControl 
            levelsControlSimplified 
            annotation (extent=[60,64; 80,84]);
        equation 
          connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-72,30;
                -84,30],       style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2,
              fillColor=76,
              rgbfillColor={170,170,255},
              fillPattern=1));
          connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[74,30;
                58,30],  style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2,
              fillColor=76,
              rgbfillColor={170,170,255},
              fillPattern=1));
          connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-60,30; -48,
                30],         style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2));
          connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[46,30;
                32,30],     style(
              color=76,
              rgbcolor={159,159,223},
              thickness=2));
          connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
            annotation (points=[8,-19.2; 8,-6], style(thickness=2));
          connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) 
            annotation (points=[-4,-19.2; -4,-6], style(thickness=2));
          connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
            annotation (points=[-16,-19.2; -16,-6], style(thickness=2));
          connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) 
            annotation (points=[-28,-19.2; -28,-6], style(thickness=2));
          connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
            annotation (points=[-40,-19.2; -40,-6], style(thickness=2));
          connect(stateFromCondenser.outlet, hRSG.WaterIn) annotation (points=[24,
                -19.2; 24,-6], style(
              thickness=2,
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(OutLP.flange, turbineLP.outlet) annotation (points=[64,-70;
                58,-70; 58,-74; 51.7,-74], style(thickness=2));
          connect(turbineHP.shaft_b, turbineIP.shaft_a) annotation (points=[-33.6,
                -82; -6.6,-82],       style(color=0, rgbcolor={0,0,0}));
          connect(turbineIP.shaft_b, turbineLP.shaft_a) annotation (points=[6.4,-82;
                37.4,-82],           style(color=0, rgbcolor={0,0,0}));
          connect(mixLP.in2, turbineIP.outlet) 
            annotation (points=[19.05,-74; 7.7,-74],  style(thickness=2));
          connect(constantSpeed.flange, turbineLP.shaft_b) annotation (points=[88,-83;
                88,-82; 50.4,-82],         style(color=0, rgbcolor={0,0,0}));
          connect(turbineLP.inlet, mixLP.out) annotation (points=[36.5,-74.1;
                36.5,-71; 28,-71], style(thickness=2));
          connect(sourceShLP.flange, stateFromCondenser.inlet) 
            annotation (points=[40,-40; 24,-40; 24,-28.8], style(thickness=2));
          connect(mixLP.in1, stateShLP_out.outlet) 
            annotation (points=[19,-68; 8,-68; 8,-28.8], style(thickness=2));
          connect(turbineHP.inlet, stateShHP_out.outlet) annotation (points=[-47.5,
                -74.1; -47.5,-52.05; -40,-52.05; -40,-28.8],       style(
                thickness=2));
          connect(turbineHP.outlet, mixIP.in1) annotation (points=[-32.3,-74;
                -31.6,-74; -31.6,-48.8], style(thickness=2));
          connect(mixIP.out, stateRhIP_in.inlet) 
            annotation (points=[-28,-38; -28,-28.8], style(thickness=2));
          connect(turbineIP.inlet, stateRhIP_out.outlet) annotation (points=[-7.5,
                -74.1; -16,-74.1; -16,-28.8],      style(thickness=2));
          connect(stateShIP_out.outlet, mixIP.in2) annotation (points=[-4,-28.8;
                -4,-60; -24.4,-60; -24.4,-48.74], style(thickness=2));
          connect(levelsControlSimplified.SensorsBus, hRSG.SensorsBus) 
            annotation (points=[60.2,74; 46,74; 46,61.2; 31.2,61.2], style(
                color=84, rgbcolor={255,170,213}));
          connect(levelsControlSimplified.ActuatorsBus, hRSG.ActuatorsBus) 
            annotation (points=[80,74; 92,74; 92,48.4; 31.2,48.4], style(color=
                  52, rgbcolor={213,255,170}));
        end TestHRSG_wac;
        
      end AddControl;
    end Tests;
    
  end HRSG;
  
  package SteamTurbineGroup 
    package Interfaces 
      partial model ST_2L 
        "Base class for Steam Turbine with two pressure levels" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter  
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        parameter Boolean SSInit=false "Steady-state initialization" 
                                       annotation (Dialog(tab = "Initialization"));
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate + steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[10,90; 30,110]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[40,-110; 60,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100, 8; 100, -8], style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-50,20; -50,-20; -20,-50; -20,50; -50,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[20,20; 20,-20; 50,-50; 50,50; 20,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,-50; 50,-92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-50,96; -50,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[20,70; 20,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-20,50; -20,70; 20,70; 20,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[18,72; 22,68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
                                Diagram);
        
      end ST_2L;
      
      partial model ST_2LRh 
        "Base class for Steam Turbine with two pressure levels and reheat" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamIPNomPressure 
          "Nominal IP steam pressure (pressure in the reheat)";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area IPT_Kt "Flow coefficient"           annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "IP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        parameter Boolean SSInit=false "Steady-state initialization" 
                                       annotation (Dialog(tab = "Initialization"));
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamIPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //IPT
        parameter SI.Pressure IPT_pstart_in = steamIPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.Pressure IPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.MassFlowRate IPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate + steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-70,90; -50,110]);
        ThermoPower.Water.FlangeB HPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-40,90; -20,110]);
        ThermoPower.Water.FlangeA IPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[0,90; 20,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[30,90; 50,110]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[60,-110; 80,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100, 8; 100, -8], style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-60,20; -60,-20; -30,-50; -30,50; -60,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[10,20; 10,-20; 70,-52; 70,50; 10,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[70,-52; 70,-94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-60,96; -60,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-30,92; -30,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[10,20; 10,96; 10,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[40,94; 40,34], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
                                Diagram);
        
      end ST_2LRh;
      
      partial model ST_3LRh 
        "Base class for Steam Turbine with three pressure levels and reheat" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamIPNomFlowRate 
          "Nominal IP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamIPNomPressure "Nominal IP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area IPT_Kt "Flow coefficient"           annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "IP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        parameter Boolean SSInit=false "Steady-state initialization" 
                                       annotation (Dialog(tab = "Initialization"));
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamIPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //IPT
        parameter SI.Pressure IPT_pstart_in = steamIPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.Pressure IPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.MassFlowRate IPT_wstart = steamIPNomFlowRate + steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //Other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-80,90; -60,110]);
        ThermoPower.Water.FlangeB HPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-50,90; -30,110]);
        ThermoPower.Water.FlangeA IPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-20,90; 0,110]);
        ThermoPower.Water.FlangeA SteamToMix(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[10,90; 30,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[70,-110; 90,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8],   style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-70,20; -70,-20; -40,-50; -40,50; -70,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-10,20; -10,-20; 20,-50; 20,50; -10,20],   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[50,20; 50,-20; 80,-50; 80,50; 50,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-70,96; -70,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-40,92; -40,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-10,20; -10,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,20; 50,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[20,96; 20,68; -40,68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[80,-50; 80,-94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[20,50; 20,60; 50,60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[48,62; 52,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-42,70; -38,66], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
                                Diagram);
        
      end ST_3LRh;
      
      partial model ST_2LHU 
        "Base class for Steam Turbine with two pressure levels and with coupling Heat Usage" 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter  
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        parameter Boolean SSInit=false "Steady-state initialization" 
                                       annotation (Dialog(tab = "Initialization"));
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeB SteamForHU(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-60,-110; -40,-90]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[40,-110; 60,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100, 8; 100, -8], style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-50,20; -50,-20; -20,-50; -20,50; -50,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[20,20; 20,-20; 50,-50; 50,50; 20,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,-50; 50,-92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-50,96; -50,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[48,78; 52,74], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-50,-92; -50,-70; 70,-70; 70,76; 50,76], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-20,50; -20,76; 50,76], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,76; 50,96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-12,52; -12,68; 12,52; 12,68; -12,52], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-12,60; -20,60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[12,60; 20,60; 20,20; 20,22], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
                                Diagram);
        
      end ST_2LHU;
      
      partial model ST_2LRhHU 
        "Base class for Steam Turbine with two pressure levels, reheat and with coupling Heat Usage" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area IPT_Kt "Flow coefficient"           annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "IP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        parameter Boolean SSInit=false "Steady-state initialization" 
                                       annotation (Dialog(tab = "Initialization"));
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamIPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-70,90; -50,110]);
        ThermoPower.Water.FlangeB HPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-40,90; -20,110]);
        ThermoPower.Water.FlangeA IPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[10,90; 30,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeB SteamForHU(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-60,-110; -40,-90]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[40,-110; 60,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100, 8; 100, -8], style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-60,20; -60,-20; -30,-50; -30,50; -60,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[20,20; 20,-20; 50,-50; 50,50; 20,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[48,72; 52,68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[12,62; 28,62; 12,40; 28,40; 12,62],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-30,70; 70,70; 70,-70; -50,-70; -50,-92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[50,70; 50,94; 50,96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-60,20; -60,50; -60,50; -60,96], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[50,-50; 50,-94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[20,20; 20,40], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[20,62; 20,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-30,50; -30,92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2))), Diagram);
        
      end ST_2LRhHU;
      
      partial model ST_2LRh_3t 
        "Base class for Steam Turbine with two pressure levels, reheat and three tappings" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamIPNomFlowRate 
          "Nominal IP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamIPNomPressure "Nominal IP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area IPT_Kt "Flow coefficient"           annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "IP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamIPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //IPT
        parameter SI.Pressure IPT_pstart_in = steamIPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.Pressure IPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.MassFlowRate IPT_wstart = steamIPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        annotation (Diagram, Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8],   style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-60,20; -60,-20; -30,-50; -30,50; -60,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[10,20; 10,-20; 60,-50; 60,50; 10,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[60,-50; 60,-92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-60,96; -60,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-30,92; -30,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[10,20; 10,96; 10,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[40,94; 40,38], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-46,-34; -46,-70; -60,-70; -60,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[24,-28; 24,-74; -40,-74; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[40,-38; 40,-80; -20,-80; -20,-98], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1))));
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-70,90; -50,110]);
        ThermoPower.Water.FlangeB HPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-40,90; -20,110]);
        ThermoPower.Water.FlangeA IPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[0,90; 20,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[30,90; 50,110]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[50,-110; 70,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        ThermoPower.Water.FlangeB Tap1(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-66,-106; -54,-94]);
        ThermoPower.Water.FlangeB Tap2(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-46,-106; -34,-94]);
        ThermoPower.Water.FlangeB Tap3(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-26,-106; -14,-94]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end ST_2LRh_3t;
      
      partial model ST_3LRh_7t 
        "Base class for Steam Turbine with two pressure levels, reheat and seven tappings" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameter
        parameter SI.MassFlowRate steamHPNomFlowRate 
          "Nominal HP steam flow rate";
        parameter SI.MassFlowRate steamIPNomFlowRate 
          "Nominal IP steam flow rate";
        parameter SI.MassFlowRate steamLPNomFlowRate 
          "Nominal LP steam flowr rate";
        parameter SI.Pressure steamHPNomPressure "Nominal HP steam pressure";
        parameter SI.Pressure steamIPNomPressure "Nominal IP steam pressure";
        parameter SI.Pressure steamLPNomPressure "Nominal LP steam pressure";
        parameter SI.Area HPT_Kt "Flow coefficient"           annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "HP Turbine"));
        parameter Real HPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "HP Turbine"));
        parameter SI.Area IPT_Kt "Flow coefficient"           annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "IP Turbine"));
        parameter Real IPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "IP Turbine"));
        parameter SI.Area LPT_Kt "Flow coefficient"           annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_mech=0.98 "Mechanical efficiency"            annotation (Dialog(group = "LP Turbine"));
        parameter Real LPT_eta_iso_nom=0.92 "Nominal isentropic efficiency" 
                                                     annotation (Dialog(group = "LP Turbine"));
        
        //Start value
        //HPT
        parameter SI.Pressure HPT_pstart_in = steamHPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.Pressure HPT_pstart_out = steamIPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.MassFlowRate HPT_wstart = steamHPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        parameter SI.SpecificEnthalpy HPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "HP Turbine"));
        //IPT
        parameter SI.Pressure IPT_pstart_in = steamIPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.Pressure IPT_pstart_out = steamLPNomPressure 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.MassFlowRate IPT_wstart = steamIPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        parameter SI.SpecificEnthalpy IPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "IP Turbine"));
        //LPT
        parameter SI.Pressure LPT_pstart_in = steamLPNomPressure 
          "Inlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.Pressure LPT_pstart_out = pcond 
          "Outlet pressure start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.MassFlowRate LPT_wstart = steamLPNomFlowRate 
          "Mass flow rate start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_in 
          "Inlet specific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        parameter SI.SpecificEnthalpy LPT_hstart_out 
          "Outletspecific enthalpy start value" 
           annotation (Dialog(tab = "Initialization",
                              group = "LP Turbine"));
        
        //other parameter
        parameter SI.Pressure pcond "Condenser pressure";
        
        annotation (Diagram, Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8],   style(
                color=76,
                gradient=2,
                fillColor=9)),
            Polygon(points=[-70,20; -70,-20; -40,-50; -40,50; -70,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-10,20; -10,-20; 20,-50; 20,50; -10,20],   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[50,20; 50,-20; 80,-50; 80,50; 50,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-70,96; -70,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-40,92; -40,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-10,20; -10,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,20; 50,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[20,96; 20,68; -40,68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[80,-50; 80,-94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[20,50; 20,60; 50,60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[48,62; 52,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-42,70; -38,66], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-64,-26; -64,-50; -80,-50; -80,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[-50,-40; -50,-60; -60,-60; -60,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[-4,-26; -4,-60; -40,-60; -40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[10,-40; 10,-66; -20,-66; -20,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[56,-26; 56,-74; 0,-74; 0,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[64,-34; 64,-80; 20,-80; 20,-100; 20,-98], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1)),
            Line(points=[72,-42; 72,-86; 40,-86; 40,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillPattern=1))));
        ThermoPower.Water.FlangeA HPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-80,90; -60,110]);
        ThermoPower.Water.FlangeB HPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-50,90; -30,110]);
        ThermoPower.Water.FlangeA IPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[-20,90; 0,110]);
        ThermoPower.Water.FlangeA SteamToMix(redeclare package Medium = 
              FluidMedium)               annotation (extent=[10,90; 30,110]);
        ThermoPower.Water.FlangeA LPT_In(redeclare package Medium = FluidMedium)
                                         annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeB LPT_Out(redeclare package Medium = 
              FluidMedium)                annotation (extent=[70,-110; 90,-90]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        ThermoPower.Water.FlangeB Tap1(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-86,-106; -74,-94]);
        ThermoPower.Water.FlangeB Tap2(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-66,-106; -54,-94]);
        ThermoPower.Water.FlangeB Tap3(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-46,-106; -34,-94]);
        ThermoPower.Water.FlangeB Tap4(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-26,-106; -14,-94]);
        ThermoPower.Water.FlangeB Tap5(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[-6,-106; 6,-94]);
        ThermoPower.Water.FlangeB Tap6(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[14,-106; 26,-94]);
        ThermoPower.Water.FlangeB Tap7(redeclare package Medium = FluidMedium) 
                                          annotation (extent=[34,-106; 46,-94]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end ST_3LRh_7t;
      
      partial model Condenser "Base class for condenser" 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Nominal parameter
        parameter SI.MassFlowRate condNomFlowRate 
          "Nominal flow rate through the condensing fluid side";
        parameter SI.MassFlowRate coolNomFlowRate 
          "Nominal flow rate through the cooling fluid side";
        parameter SI.Pressure condNomPressure 
          "Nominal pressure in the condensing fluid side inlet";
        parameter SI.Pressure coolNomPressure 
          "Nominal pressure in the cooling fluid side inlet";
        
        //Physical Parameter
        parameter Integer N_cool=2 "Number of node of the cooling fluid side";
        parameter SI.Area condExchSurface 
          "Exchange surface between condensing fluid - metal";
        parameter SI.Area coolExchSurface 
          "Exchange surface between metal - cooling fluid";
        parameter SI.Volume condVol "Condensing fluid volume";
        parameter SI.Volume coolVol "Cooling fluid volume";
        parameter SI.Volume metalVol "Volume of the metal part in the tubes";
        parameter SI.SpecificHeatCapacity cm "Specific heat capacity of metal";
        parameter SI.Density rhoMetal "Density of metal";
        
        //Initialization conditions
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the cooling fluid side"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        //Start value
        parameter SI.Pressure pstart_cond = condNomPressure 
          "Condensing fluid pressure start value"                annotation(Dialog(tab = "Initialization"));
        parameter SI.Volume Vlstart_cond = condVol*0.15 
          "Start value of the liquid water volume, condensation side"             annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_in 
          "Inlet metal wall temperature start value"       annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_out 
          "Outlet metal wall temperature start value"      annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M[N_cool]=linspace(Tstart_M_in,Tstart_M_out,N_cool) 
          "Start value of metal wall temperature vector (initialized by default)"
                                                                                  annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_in=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_in) 
          "Inlet cooling fluid temperature start value"     annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_out=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_out) 
          "Outlet cooling fluid temperature start value"    annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_cool[N_cool]=linspace(Tstart_cool_in,Tstart_cool_out,N_cool) 
          "Start value of cooling fluid temperature vector (initialized by default)"
                                                                          annotation(Dialog(tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_in=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_in) 
          "Inlet cooling fluid specific enthalpy start value"           annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_out=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_out) 
          "Outlet cooling fluid specific enthalpy start value"          annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool[N_cool]=linspace(hstart_cool_in,hstart_cool_out,N_cool) 
          "Start value of cooling fluid enthalpy vector (initialized by default)"
                                                                          annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstartin_cool = coolNomPressure 
          "Inlet cooling fluid pressure start value"        annotation(Dialog(tab = "Initialization"));
        parameter SI.Pressure pstartout_cool = coolNomPressure 
          "Outlet cooling fluid pressure start value"        annotation(Dialog(tab = "Initialization"));
        
        ThermoPower.Water.FlangeB waterOut(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-40,-100; 0,-60]);
        ThermoPower.Water.FlangeA coolingIn(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[60,-48; 100,-8]);
        ThermoPower.Water.FlangeB coolingOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[60,30; 100,70]);
        annotation (Diagram, Icon(
            Rectangle(extent=[-90,80; 50,-50],  style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-80,-50; 40,-80], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Line(points=[68,-30; -58,-30; 10,10; -58,50; 70,50],   style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Text(
              extent=[-100,-113; 100,-143],
              string="%name",
              style(color=71, rgbcolor={85,170,255}))));
        ThermoPower.Water.FlangeA steamIn(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-40,60; 0,100]);
        
      end Condenser;
      
      partial model CondPlant_base 
        "Base class for Condensation Plant, simplified version" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        parameter SI.Pressure p "Pressure of condesation";
        parameter SI.Volume Vtot "Total volume condensing fluid side";
        parameter SI.Volume Vlstart "Start value of the liquid volume";
        
        ThermoPower.Water.FlangeA SteamIn(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-20,80; 20,120]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-20,-120; 20,-80]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[40,30; -40,30; 38,0; -40,-30; 40,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,60; 0,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,-60; 0,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
        
      end CondPlant_base;
      
      partial model CondPlantHU_base 
        "Base class for Condensation Plant with coupling Heat Usage (type simplified)" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        parameter SI.Pressure p "Pressure of condesation";
        parameter SI.Volume Vtot "Total volume condensing fluid side";
        parameter SI.Volume Vlstart "Start value of the liquid volume";
        
        ThermoPower.Water.FlangeA SteamToHU(redeclare package Medium = 
              FluidMedium)                  annotation (extent=[-68,80; -28,120]);
        ThermoPower.Water.FlangeA SteamIn(redeclare package Medium = 
              FluidMedium)                annotation (extent=[30,80; 70,120]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-20,-120; 20,-80]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[40,30; -40,30; 38,0; -40,-30; 40,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,-60; 0,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-60,0; -80,0; -80,70; -50,70; -50,102], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,60; 0,70; 50,70; 50,88], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
        
      end CondPlantHU_base;
      
      partial model CondPlant "Base class for Condensation Plant" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Nominal parameter
        parameter SI.MassFlowRate condNomFlowRate 
          "Nominal flow rate through the condensing fluid side";
        parameter SI.MassFlowRate coolNomFlowRate 
          "Nominal flow rate through the cooling fluid side";
        parameter SI.Pressure condNomPressure 
          "Nominal pressure in the condensing fluid side inlet";
        parameter SI.Pressure coolNomPressure 
          "Nominal pressure in the cooling fluid side inlet";
        
        //Physical Parameter
        parameter Integer N_cool=2 "Number of node of the cooling fluid side";
        parameter SI.Area condExchSurface 
          "Exchange surface between condensing fluid - metal";
        parameter SI.Area coolExchSurface 
          "Exchange surface between metal - cooling fluid";
        parameter SI.Volume condVol "Condensing fluid volume";
        parameter SI.Volume coolVol "Cooling fluid volume";
        parameter SI.Volume metalVol "Volume of the metal part in the tubes";
        parameter SI.SpecificHeatCapacity cm "Specific heat capacity of metal";
        parameter SI.Density rhoMetal "Density of metal";
        
        //Initialization conditions
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the cooling fluid side"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        //Start value
        parameter SI.Pressure pstart_cond = condNomPressure 
          "Condensing fluid pressure start value"                annotation(Dialog(tab = "Initialization"));
        parameter SI.Volume Vlstart_cond = condVol*0.15 
          "Start value of the liquid water volume, condensation side"             annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_in 
          "Inlet metal wall temperature start value"       annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_out 
          "Outlet metal wall temperature start value"      annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_in=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_in) 
          "Inlet cooling fluid temperature start value"     annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_out=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_out) 
          "Outlet cooling fluid temperature start value"    annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_in=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_in) 
          "Inlet cooling fluid specific enthalpy start value"           annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_out=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_out) 
          "Outlet cooling fluid specific enthalpy start value"          annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        
        ThermoPower.Water.FlangeA SteamIn(redeclare package Medium = 
              FluidMedium)                annotation (extent=[-10,90; 10,110]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-10,-110; 10,-90]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[40,30; -40,30; 38,0; -40,-30; 40,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,60; 0,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,-60; 0,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
        
      end CondPlant;
      
      partial model CondPlantHU 
        "Base class for Condensation Plant with coupling Heat Usage" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Nominal parameter
        parameter SI.MassFlowRate condNomFlowRate 
          "Nominal flow rate through the condensing fluid side";
        parameter SI.MassFlowRate coolNomFlowRate 
          "Nominal flow rate through the cooling fluid side";
        parameter SI.Pressure condNomPressure 
          "Nominal pressure in the condensing fluid side inlet";
        parameter SI.Pressure coolNomPressure 
          "Nominal pressure in the cooling fluid side inlet";
        
        //Physical Parameter
        parameter Integer N_cool=2 "Number of node of the cooling fluid side";
        parameter SI.Area condExchSurface 
          "Exchange surface between condensing fluid - metal";
        parameter SI.Area coolExchSurface 
          "Exchange surface between metal - cooling fluid";
        parameter SI.Volume condVol "Condensing fluid volume";
        parameter SI.Volume coolVol "Cooling fluid volume";
        parameter SI.Volume metalVol "Volume of the metal part in the tubes";
        parameter SI.SpecificHeatCapacity cm "Specific heat capacity of metal";
        parameter SI.Density rhoMetal "Density of metal";
        
        //Initialization conditions
        parameter Boolean use_T = true 
          "Select: -true- to insert the initial temperature or -false- to insert the initial specifc enthalpy of the cooling fluid side"
           annotation(Dialog(tab = "Initialization Conditions"));
        parameter Boolean SSInit = false "Steady-state initialization" annotation(Dialog(tab = "Initialization Conditions"));
        //Start value
        parameter SI.Pressure pstart_cond = condNomPressure 
          "Condensing fluid pressure start value"                annotation(Dialog(tab = "Initialization"));
        parameter SI.Volume Vlstart_cond = condVol*0.15 
          "Start value of the liquid water volume, condensation side"             annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_in 
          "Inlet metal wall temperature start value"       annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_M_out 
          "Outlet metal wall temperature start value"      annotation(Dialog(tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_in=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_in) 
          "Inlet cooling fluid temperature start value"     annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.Temperature Tstart_cool_out=FluidMedium.temperature_ph(coolNomPressure,hstart_cool_out) 
          "Outlet cooling fluid temperature start value"    annotation(Dialog(enable = use_T,
                                                                              tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_in=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_in) 
          "Inlet cooling fluid specific enthalpy start value"           annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        parameter SI.SpecificEnthalpy hstart_cool_out=FluidMedium.specificEnthalpy_pT(coolNomPressure,Tstart_cool_out) 
          "Outlet cooling fluid specific enthalpy start value"          annotation(Dialog(enable = not use_T,
                                                                                          tab = "Initialization"));
        
        ThermoPower.Water.FlangeA SteamToHU(redeclare package Medium = 
              FluidMedium)                  annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA SteamIn(redeclare package Medium = 
              FluidMedium)                annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-10,-110; 10,-90]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[40,30; -40,30; 38,0; -40,-30; 40,-30], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,-60; 0,-98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-60,0; -80,0; -80,80; -50,80; -50,102], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[0,60; 0,80; 50,80; 50,98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
        
      end CondPlantHU;
      
      partial model STGroup2L 
        "Base class for Steam Turbine Group (two pressure levels)" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[50,-92; 10,-52], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[40,-62; 20,-62; 38,-72; 20,-82; 40,-82], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-20,-60; -20,-72; 10,-72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[50,-72; 80,-72; 80,66; 50,66; 50,96; 50,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-60,20; -60,72; -50,72; -50,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-42,38; -42,66; 0,66; 0,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-62,58; -58,58; -60,52; -62,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-44,58; -40,58; -42,52; -44,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[78,36; 82,36; 80,42; 78,36], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Rectangle(extent=[-100,8; 100,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-60,20; -60,-20; -20,-60; -20,60; -60,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Text(
              extent=[-120,6; 40,-8],
              style(
                color=7,
                rgbcolor={255,255,255},
                thickness=2,
                fillPattern=1),
              string="2L")));
        ThermoPower.Water.FlangeA From_SH_HP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA From_SH_LP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-10,90; 10,110]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[40,90; 60,110]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end STGroup2L;
      
      partial model STGroup2LRh 
        "Base class for Steam Turbine Group (two pressure levels and reheat)" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-60,20; -60,-20; -20,-60; -20,60; -60,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[50,-92; 10,-52], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[40,-62; 20,-62; 38,-72; 20,-82; 40,-82], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-120,6; 40,-8],
              style(
                color=7,
                rgbcolor={255,255,255},
                thickness=2,
                fillPattern=1),
              string="2LR"),
            Line(points=[-20,-60; -20,-72; 10,-72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[50,-72; 80,-72; 80,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[80,8; 80,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-60,20; -60,72; -80,72; -80,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Polygon(points=[-62,62; -58,62; -60,56; -62,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-52,44; -48,44; -50,50; -52,44], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-48,62; -44,62; -46,56; -48,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-46,34; -46,72; -42,72; 0,72; 0,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Polygon(points=[-34,62; -30,62; -32,56; -34,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-32,48; -32,68; 42,68; 42,102], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-50,30; -50,80; -40,80; -40,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[78,36; 82,36; 80,42; 78,36], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))));
        ThermoPower.Water.FlangeA From_SH_HP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-90,90; -70,110]);
        ThermoPower.Water.FlangeB To_RH_IP(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-50,90; -30,110]);
        ThermoPower.Water.FlangeA From_RH_IP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-10,90; 10,110]);
        ThermoPower.Water.FlangeA From_SH_LP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[30,90; 50,110]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[70,90; 90,110]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end STGroup2LRh;
      
      partial model STGroup3LRh 
        "Base class for Steam Turbine Group (three pressure levels and reheat)" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Line(points=[80,8; 80,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Polygon(points=[-80,20; -80,-20; -50,-50; -50,50; -80,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-20,20; -20,-20; 10,-50; 10,50; -20,20],   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[40,20; 40,-20; 70,-50; 70,50; 40,20],      style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-80,96; -80,20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-50,92; -50,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-20,20; -20,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[40,20; 40,94], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[10,96; 10,68; -50,68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[10,50; 10,60; 40,60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[38,62; 42,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[-52,70; -48,66], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[64,-90; 36,-62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Rectangle(extent=[44,-88; 56,-92], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[58,-82; 44,-82; 54,-76; 44,-70; 58,-70], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[50,-62; 50,-56; 70,-56; 70,-50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[80,-8; 80,-96; 50,-96; 50,-90], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1))));
        ThermoPower.Water.FlangeA From_SH_HP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-90,90; -70,110]);
        ThermoPower.Water.FlangeB To_RH_IP(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA From_RH_IP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-30,90; -10,110]);
        ThermoPower.Water.FlangeA From_SH_IP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[0,90; 20,110]);
        ThermoPower.Water.FlangeA From_SH_LP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[30,90; 50,110]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[70,90; 90,110]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end STGroup3LRh;
      
      partial model STGroup2LHU 
        "Base class for Steam Turbine Group (two pressure levels) with coupling Heat Usage" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-66,20; -66,-20; -26,-60; -26,60; -66,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[40,-60; 0,-20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[30,-30; 10,-30; 28,-40; 10,-50; 30,-50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-126,6; 34,-8],
              style(
                color=7,
                rgbcolor={255,255,255},
                thickness=2,
                fillPattern=1),
              string="2L"),
            Line(points=[-50,-36; -50,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-26,-60; -26,-72; 20,-72; 20,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[40,-40; 50,-40; 50,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[20,-20; 20,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[20,8; 20,46; 50,46; 50,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[-66,20; -66,76; -50,76; -50,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Line(points=[-48,38; -48,70; 0,70; 0,98], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-68,58; -64,58; -66,52; -68,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-50,58; -46,58; -48,52; -48,52; -50,58], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[32,48; 32,44; 38,46; 32,48], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-10,-70; -10,-74; -4,-72; -10,-70], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[48,-68; 52,-68; 50,-62; 48,-68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-52,-62; -48,-62; -50,-68; -52,-62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))));
        ThermoPower.Water.FlangeA From_SH_HP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-60,90; -40,110]);
        ThermoPower.Water.FlangeA From_SH_LP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-10,90; 10,110]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[40,90; 60,110]);
        ThermoPower.Water.FlangeA WaterFromHU(redeclare package Medium = 
              FluidMedium)                    annotation (extent=[40,-110; 60,-90]);
        ThermoPower.Water.FlangeB SteamForHU(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-60,-110; -40,-90]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end STGroup2LHU;
      
      partial model STGroup2LRhHU 
        "Base class for Steam Turbine Group (two pressure levels and reheat) with coupling Heat Usage" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-100,8; 100,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Polygon(points=[-66,20; -66,-20; -26,-60; -26,60; -66,20], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Ellipse(extent=[40,-60; 0,-20], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[30,-30; 10,-30; 28,-40; 10,-50; 30,-50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-124,6; 36,-8],
              style(
                color=7,
                rgbcolor={255,255,255},
                thickness=2,
                fillPattern=1),
              string="2LR"),
            Line(points=[-50,-36; -50,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[-26,-60; -26,-72; 20,-72; 20,-60], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[40,-40; 50,-40; 50,-100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillPattern=1)),
            Line(points=[20,-20; 20,-8], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Line(points=[20,8; 20,46; 80,46; 80,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Polygon(points=[-68,62; -64,62; -66,56; -68,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-66,20; -66,72; -80,72; -80,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Polygon(points=[-54,62; -50,62; -52,56; -54,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-40,62; -36,62; -38,56; -40,62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-38,48; -38,68; 38,68; 40,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-52,34; -52,72; -52,72; 0,72; 0,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-56,30; -56,80; -40,80; -40,100], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-58,44; -54,44; -56,50; -58,44], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-10,-70; -10,-74; -4,-72; -10,-70], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-52,-62; -48,-62; -50,-68; -52,-62], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[50,48; 50,44; 56,46; 50,48], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[48,-68; 52,-68; 50,-62; 48,-68], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))));
        ThermoPower.Water.FlangeA From_SH_HP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-90,90; -70,110]);
        ThermoPower.Water.FlangeB To_RH_IP(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[-50,90; -30,110]);
        ThermoPower.Water.FlangeA From_RH_IP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-10,90; 10,110]);
        ThermoPower.Water.FlangeA From_SH_LP(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[30,90; 50,110]);
        ThermoPower.Water.FlangeB WaterOut(redeclare package Medium = 
              FluidMedium)                 annotation (extent=[70,90; 90,110]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b Shaft_b 
          annotation (extent=[90,-10; 110,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a Shaft_a 
          annotation (extent=[-110,-10; -90,10]);
        ThermoPower.Water.FlangeB SteamForHU(redeclare package Medium = 
              FluidMedium)                   annotation (extent=[-60,-110; -40,-90]);
        ThermoPower.Water.FlangeA WaterFromHU(redeclare package Medium = 
              FluidMedium)                    annotation (extent=[40,-110; 60,-90]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        
      end STGroup2LRhHU;
    end Interfaces;
    
    package Components 
      
      model Condenser "Condenser" 
        extends Interfaces.Condenser(pstartout_cool=coolNomPressure-dpnom_cool);
        parameter SI.CoefficientOfHeatTransfer gamma_cond 
          "Coefficient of heat transfer on condensation surfaces";
        parameter SI.CoefficientOfHeatTransfer gamma_cool 
          "Coefficient of heat transfer of cooling fluid side";
        parameter Choices.Flow1D.FFtypes.Temp FFtype_cool = Choices.Flow1D.FFtypes.NoFriction 
          "Friction Factor Type";
        parameter Choices.Flow1D.HCtypes.Temp HCtype_cool = Choices.Flow1D.HCtypes.Downstream 
          "Location of the hydraulic capacitance";
        parameter SI.Pressure dpnom_cool=0 
          "Nominal pressure drop (friction term only!)";
        parameter Density rhonom_cool=0 "Nominal inlet density";
        
        //other data
        constant Real pi=Modelica.Constants.pi;
        
        Water.Flow1D flowCooling(
          Nt=1,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          L=coolExchSurface^2/(coolVol*pi*4),
          A=(coolVol*4/coolExchSurface)^2/4*pi,
          omega=coolVol*4/coolExchSurface*pi,
          Dhyd=coolVol*4/coolExchSurface,
          wnom=coolNomFlowRate,
          pstartin=pstartin_cool,
          pstartout=pstartout_cool,
          hstart=hstart_cool,
          N=N_cool,
          FFtype=FFtype_cool,
          dpnom=dpnom_cool,
          rhonom=rhonom_cool,
          HydraulicCapacitance=HCtype_cool,
          hstartin=hstart_cool_in,
          hstartout=hstart_cool_out) 
                            annotation (extent=[10,-2; 30,22],
          rotation=90);
        Thermal.ConvHT convHT(
          Tstart1=Tstart_M,
          gamma=gamma_cool,
          N=N_cool,
          Tstart2=Tstart_cool,
          Tstart11=Tstart_M_in,
          Tstart1N=Tstart_M_out,
          Tstart21=Tstart_cool_in,
          Tstart2N=Tstart_cool_out) 
          annotation (extent=[-32,0; -12,20],rotation=90);
        CondenserShell condenserShell(
          redeclare package Medium = FluidMedium,
          V=condVol,
          Mm=metalVol*rhoMetal,
          Ac=condExchSurface,
          Af=coolExchSurface,
          cm=cm,
          hc=gamma_cond,
          Nc=N_cool,
          pstart=pstart_cond,
          Vlstart=Vlstart_cond,
          initOpt=if SSInit then Options.steadyState else Options.noInit) 
          annotation (extent=[-66,-6; -34,26]);
        annotation (Diagram);
        Modelica.Blocks.Interfaces.RealOutput ratio_VvonVtot 
          annotation (extent=[-100,0; -80,20], rotation=180);
      equation 
        connect(flowCooling.infl, coolingIn) 
          annotation (points=[20,-2; 20,-28; 80,-28],
                                                  style(thickness=2));
        connect(flowCooling.outfl, coolingOut) 
          annotation (points=[20,22; 20,50; 80,50], style(thickness=2));
        connect(convHT.side2,flowCooling. wall) annotation (points=[-18.9,10;
              15,10],
                   style(color=45, rgbcolor={255,127,0}));
        connect(condenserShell.steam, steamIn) 
          annotation (points=[-50,26; -50,80; -20,80],
                                                     style(thickness=2));
        connect(condenserShell.condensate, waterOut) 
          annotation (points=[-50,-6; -50,-80; -20,-80],
                                                      style(thickness=2));
        connect(condenserShell.coolingFluid,convHT. side1) annotation (points=[-50,10;
              -25,10],       style(color=45, rgbcolor={255,127,0}));
        connect(condenserShell.ratio_VvVtot, ratio_VvonVtot) annotation (points=
             [-61.2,10; -90,10], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end Condenser;
      
      model CondenserPreP "Ideal condenser with prescribed pressure" 
        replaceable package Medium = Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialMedium "Medium model";
        //Parameters
        parameter SI.Pressure p "Nominal inlet pressure";
        parameter SI.Volume Vtot = 10 "Total volume of the fluid side";
        parameter SI.Volume Vlstart = 0.15*Vtot 
          "Start value of the liquid water volume";
        
        //Variable
        SI.Density rhol "Density of saturated liquid";
        SI.Density rhov "Density of saturated steam";
        Medium.SaturationProperties sat "Saturation properties";
        Medium.SpecificEnthalpy hl "Specific enthalpy of saturated liquid";
        SI.Mass M "Total mass, steam+liquid";
        SI.Mass Ml "Liquid mass";
        SI.Mass Mv "Steam mass";
        SI.Volume Vl(start=Vlstart) "Liquid volume";
        SI.Volume Vv "Steam volume";
        SI.Energy E "Internal energy";
        SI.Power Q "Thermal power";
        
        //Connectors
        Water.FlangeA steamIn( redeclare package Medium = Medium) 
                       annotation (extent=[-20,60; 20,100]);
        Water.FlangeB waterOut( redeclare package Medium = Medium) annotation (extent=[-20,-100;
              20,-60]);
        Modelica.Blocks.Interfaces.RealOutput Qcond annotation (extent=[-80,30;
              -60,50], rotation=180);
        Modelica.Blocks.Interfaces.RealOutput ratio_Vv_Vtot 
          annotation (extent=[-80,-30; -60,-10], rotation=180);
        annotation (
          Icon(
            Rectangle(extent=[-70,80; 70,-50],  style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,-50; 60,-80], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Line(points=[42,-30; -38,-30; 30,10; -38,50; 42,50],   style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2))),
          Diagram);
        
      equation 
        steamIn.p = p;
        steamIn.hAB = hl;
        sat.psat = p;
        sat.Tsat = Medium.saturationTemperature(p);
        hl = Medium.bubbleEnthalpy(sat);
        waterOut.p = p;
        waterOut.hBA = hl;
        rhol = Medium.bubbleDensity(sat);
        rhov = Medium.density_ph(steamIn.p,steamIn.hBA);
        
        Ml = Vl*rhol;
        Mv = Vv*rhov;
        Vtot= Vv+Vl;
        M = Ml + Mv;
        E = Ml*hl + Mv*steamIn.hBA - p*Vtot;
        
        //Energy and Mass Bilances 
        der(M) = steamIn.w + waterOut.w;
        der(E) = steamIn.w*steamIn.hBA + waterOut.w*hl - Q;
        
        //Output signal
        ratio_Vv_Vtot=Vv/Vtot;
        Qcond = Q;
        
      end CondenserPreP;
      
      model CondenserPreP_tap 
        "Ideal condenser with prescribed pressure and external tapping for ratio control" 
        replaceable package Medium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        parameter SI.Pressure p "Nominal inlet pressure";
        parameter SI.Volume Vtot = 10 "Total volume of the fluid side";
        parameter SI.Volume Vlstart = 0.15*Vtot;
        
        SI.Density rhol "Density of saturated liquid";
        SI.Density rhov "Density of saturated steam";
        Medium.SaturationProperties sat "Saturation properties";
        Medium.SpecificEnthalpy hl "Specific enthalpy of saturated liquid";
        
        SI.Mass M "Total mass, steam+liquid";
        SI.Mass Ml "Liquid mass";
        SI.Mass Mv "Steam mass";
        SI.Volume Vl(start=Vlstart) "Liquid volume";
        SI.Volume Vv "Steam volume";
        SI.Energy E "Internal energy";
        SI.Power Q "Thermal power";
        
        Water.FlangeA steamIn( redeclare package Medium = Medium) 
                       annotation (extent=[-20,60; 20,100]);
        Water.FlangeB waterOut( redeclare package Medium = Medium) annotation (extent=[-20,-100;
              20,-60]);
        Modelica.Blocks.Interfaces.RealOutput Qcond annotation (extent=[-80,30;
              -60,50], rotation=180);
        Modelica.Blocks.Interfaces.RealOutput ratio_Vv_Vtot 
          annotation (extent=[-80,-30; -60,-10], rotation=180);
        Water.FlangeA tapWater(redeclare package Medium = Medium) 
                       annotation (extent=[-70,-70; -50,-50]);
        annotation (
          Icon(
            Rectangle(extent=[-70,80; 70,-50],  style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Rectangle(extent=[-60,-50; 60,-80], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Line(points=[42,-30; -38,-30; 30,10; -38,50; 42,50],   style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2))),
          Diagram);
        
      equation 
        steamIn.p = p;
        steamIn.hAB = hl;
        sat.psat = p;
        sat.Tsat = Medium.saturationTemperature(p);
        hl = Medium.bubbleEnthalpy(sat);
        waterOut.p = p;
        waterOut.hBA = hl;
        rhol = Medium.bubbleDensity(sat);
        rhov = Medium.density_ph(steamIn.p,steamIn.hBA);
        
        hl=tapWater.hAB;
        tapWater.p=p;
        
        Ml = Vl*rhol;
        Mv = Vv*rhov;
        Vtot= Vv + Vl;
        M = Ml + Mv;
        E = Ml*hl + Mv*steamIn.hBA - p*Vtot;
        
        //Energy and Mass Bilances 
        der(M) = steamIn.w + (waterOut.w + tapWater.w);
        der(E) = steamIn.w*steamIn.hBA + (waterOut.w + tapWater.w)*hl - Q;
        
        //Output signal
        ratio_Vv_Vtot = Vv/Vtot;
        Qcond = Q;
        
      end CondenserPreP_tap;
      
      model CondenserShell 
        replaceable package Medium = 
            Modelica.Media.Interfaces.PartialTwoPhaseMedium "Medium model";
        parameter SI.Volume V "Total volume of condensation cavity";
        parameter SI.Mass Mm "Total mass of shell and tubes";
        parameter SI.Area Ac "Area of condensation surfaces";
        parameter SI.Area Af "Area of contact with the cooling fluid";
        parameter SI.CoefficientOfHeatTransfer hc 
          "Coefficient of heat transfer on condensation surfaces";
        parameter SI.SpecificHeatCapacity cm 
          "Specific heat capacity of the metal";
        parameter Integer Nc = 2 "Number of nodes for coolingFluid connector";
        parameter SI.Pressure pstart "Pressure start value" 
          annotation(Dialog(tab = "Initialisation"));
        parameter SI.Volume Vlstart "Start value of the liquid water volume" 
          annotation(Dialog(tab = "Initialisation"));
        parameter ThermoPower.Choices.Init.Options.Temp initOpt=ThermoPower.Choices.Init.Options.noInit 
          "Initialisation option" annotation(Dialog(tab = "Initialisation"));
        
        SI.Mass Ml "Liquid water mass";
        SI.Mass Mv "Steam mass";
        SI.Mass M "Total liquid+steam mass";
        SI.Energy E "Total liquid+steam energy";
        SI.Energy Em "Total energy of metal masses";
        SI.Volume Vl(start=Vlstart, stateSelect = StateSelect.prefer) 
          "Liquid water total volume";
        SI.Volume Vv "Steam volume";
        Medium.SaturationProperties sat "Saturation properties";
        Medium.AbsolutePressure p(start=pstart,stateSelect=StateSelect.prefer) 
          "Drum pressure";
        Medium.MassFlowRate ws "Steam mass flowrate";
        Medium.MassFlowRate wc "Condensate mass flowrate";
        SI.HeatFlowRate Qcool "Heat flow from the metal to the cooling fluid";
        SI.HeatFlowRate Qcond 
          "Heat flow from the condensing fluid to the metal";
        Medium.SpecificEnthalpy hs "Specific enthalpy of entering steam";
        Medium.SpecificEnthalpy hl "Specific enthalpy of saturated liquid";
        Medium.SpecificEnthalpy hv "Specific enthalpy of saturated steam";
        Medium.Temperature Ts "Saturation temperature";
        Medium.Temperature Tm(start = Medium.saturationTemperature(pstart), stateSelect = StateSelect.prefer) 
          "Average temperature of metal walls";
        Medium.Density rhol "Density of saturated liquid";
        Medium.Density rhov "Density of saturated steam";
        
        ThermoPower.Water.FlangeA steam(redeclare package Medium = Medium) 
                                        annotation (extent=[-20,80; 20,120]);
        ThermoPower.Water.FlangeB condensate(redeclare package Medium = Medium) 
                                             annotation (extent=[-20,-120; 20,-80]);
        ThermoPower.Thermal.DHT coolingFluid(N=Nc) annotation (extent=[-6,-40; 6,40]);
        annotation (Diagram, Icon(
            Rectangle(extent=[-54,88; -14,-86],style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=3,
                rgbfillColor={0,0,255})),
            Rectangle(extent=[-14,88; -6,-86],  style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Rectangle(extent=[6,88; 14,-86],  style(
                color=10,
                rgbcolor={135,135,135},
                fillColor=10,
                rgbfillColor={135,135,135})),
            Rectangle(extent=[14,88; 54,-86],  style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=3,
                rgbfillColor={0,0,255})),
            Rectangle(extent=[-54,88; 54,-86], style(
                color=10,
                rgbcolor={135,135,135},
                thickness=4)),
            Text(
              extent=[-102,-130; 108,-148],
              style(color=3, rgbcolor={0,0,255}),
              string="%name")));
        Modelica.Blocks.Interfaces.RealOutput ratio_VvVtot 
          annotation (extent=[-90,-20; -50,20], rotation=180);
      equation 
        Ml=Vl*rhol "Mass of liquid";
        Mv=Vv*rhov "Mass of vapour";
        M=Ml+Mv "Total mass";
        V = Vl + Vv "Total volume";
        E=Ml*hl+Mv*hv-p*V "Total liquid+steam energy";
        Em = Mm*cm*Tm "Metal tubes energy";
        der(M) = ws - wc "Mass balance";
        der(E) = ws*hs - wc*hl - Qcond "Energy balance (liquid+steam)";
        der(Em) = Qcond - Qcool "Energy balance (metal tubes)";
        Qcond = hc*Ac*(Ts - Tm);
        
        // Boundary conditions
        p = steam.p;
        p = condensate.p;
        ws = steam.w;
        hs = steam.hBA "Flow reversal not supported";
        steam.hAB = hv;
        wc = -condensate.w;
        condensate.hBA = hl;
        Qcool = -Af/Nc*sum(coolingFluid.phi);
        coolingFluid.T = ones(Nc)*Tm;
        
        // Fluid properties
        // sat = Medium.setSat_p(p);
        
        sat.psat = p;
        sat.Tsat = Medium.saturationTemperature(p);
        
        Ts = sat.Tsat;
        rhol=Medium.bubbleDensity(sat);
        rhov=Medium.dewDensity(sat);
        hl=Medium.bubbleEnthalpy(sat);
        hv=Medium.dewEnthalpy(sat);
        ratio_VvVtot=Vv/V;
      initial equation 
        if initOpt == ThermoPower.Choices.Init.Options.noInit then
          // do nothing
        elseif initOpt == ThermoPower.Choices.Init.Options.steadyState then
          der(M) = 0;
          der(E) = 0;
        else
          assert(false, "Unsupported initialisation option");
        end if;
      end CondenserShell;
      
      model SteamTurbineVarEta "Steam turbine with variable efficiency" 
        extends ThermoPower.Water.SteamTurbineBase;
        
        //Parameter
        parameter SI.Area Kt "Kt coefficient of Stodola's law";
        replaceable function curveEta_iso = Functions.curveEfficiency extends 
          ThermoPower.PowerPlants.SteamTurbineGroup.Functions 
          "Characteristich curve of efficiency";
        parameter Real eta_iso_nom=0.92 "Nominal isentropic efficiency";
        parameter Real x=0.5 "Degree of reaction";
        parameter Length Rm "Mean ray";
        parameter Integer n "Number of stages";
        
        //Variable
        Real y "Ratio uf/wiso";
        Real uf "Mean peripheral velocity of the rotor";
        Real viso "Mean velocity of the fluid in isentropic conditions";
        
      equation 
        w = Kt*partialArc*sqrt(steam_in.p*steam_in.d)*ThermoPower.Functions.sqrtReg(1-(1/PR)^2) 
          "Stodola's law";
        
        uf=omega*Rm;
        viso=sqrt(2*(hin-hiso)/n);
        y=uf/viso;
        eta_iso = curveEta_iso(eta_iso_nom, y, x) "Variable efficiency";
      end SteamTurbineVarEta;
      
      model SteamTurbine_1tapping "Turbine with one tapping" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        //Turbines parameters
        parameter SI.MassFlowRate wn "Inlet nominal flowrate";
        parameter SI.Area Kt "Coefficient of Stodola's law";
        
        //Start Value
        parameter SI.Pressure pstart_in "Inlet pressure start value" 
            annotation (Dialog(tab= "Initialization"));
        parameter SI.Pressure pstart_tap "Tapping pressure start value" 
            annotation (Dialog(tab= "Initialization"));
        parameter SI.Pressure pstart_out "Outlet pressure start value" 
            annotation (Dialog(tab= "Initialization"));
        parameter SI.MassFlowRate wstart "Mass flow rate start value" 
            annotation (Dialog(tab= "Initialization"));
        parameter SI.SpecificEnthalpy hstartin "Inlet enthalpy start value," 
            annotation (Dialog(tab= "Initialization"));
        parameter SI.SpecificEnthalpy hstarttap "Tapping enthalpy start value,"
            annotation (Dialog(tab= "Initialization"));
        parameter SI.SpecificEnthalpy hstartout "Outlet enthalpy start value" 
            annotation (Dialog(tab= "Initialization"));
        
        annotation (Diagram, Icon(
            Polygon(points=[-26,74; -26,26; -20,26; -20,80; -58,80; -58,74; -26,
                  74],          style(
                color=0,
                fillColor=3,
                thickness=2)),
            Polygon(points=[28,54; 34,54; 34,74; 62,74; 62,80; 28,80; 28,54],
                        style(
                color=0,
                fillColor=3,
                thickness=2)),
            Rectangle(extent=[-58,6; 62,-10],  style(
                color=76,
                gradient=3,
                fillColor=9)),
            Polygon(points=[-26,26; -26,-28; 34,-62; 34,58; -26,26],      style(
                color=0,
                fillColor=3,
                thickness=2,
                fillPattern=1)),
               Text(extent=[-126,134; 132,94],    string="%name"),
            Polygon(points=[2,-80; 4,-80; 4,-44; 2,-44; 2,-80], style(
                color=0,
                rgbcolor={0,0,0},
                fillPattern=1))));
        Modelica.Blocks.Interfaces.RealInput partialArc 
          annotation (extent=[-68,-50; -48,-30]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_a 
          annotation (extent=[-74,-12; -54,8]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_b shaft_b 
          annotation (extent=[56,-12; 76,8]);
        Water.FlangeB tap1(redeclare package Medium = FluidMedium) 
                                         annotation (extent=[-6,-90; 12,-72]);
        Water.SteamTurbineStodola ST_firstStages(
          redeclare package Medium = FluidMedium,
          pstart_in=pstart_in,
          pstart_out=pstart_tap,
          wstart=wstart,
          hstartin=hstartin,
          hstartout=hstarttap,
          wnom=wn,
          Kt=Kt)    annotation (extent=[-44,-20; -8,16]);
        Water.SteamTurbineStodola ST_secondStages(
          redeclare package Medium = FluidMedium,
          pstart_in=pstart_tap,
          pstart_out=pstart_out,
          wstart=wstart,
          hstartin=hstarttap,
          hstartout=hstartout,
          wnom=wn,
          Kt=Kt)    annotation (extent=[18,-20; 56,16]);
        Water.FlowSplit flowSplit annotation (extent=[-8,36; 6,50]);
        Water.FlangeA flangeA(redeclare package Medium = FluidMedium) 
          annotation (extent=[-90,60; -56,94]);
        Water.FlangeB flangeB(redeclare package Medium = FluidMedium) 
          annotation (extent=[58,60; 92,94]);
        
      equation 
        connect(Shaft_a, Shaft_a) annotation (points=[-50,0; -50,0; -50,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillPattern=1));
        connect(Shaft_b, Shaft_b) annotation (points=[48,0; 48,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillPattern=1));
        connect(shaft_b, ST_secondStages.shaft_b) annotation (points=[66,-2;
              49.16,-2],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_secondStages.shaft_a, ST_firstStages.shaft_b) annotation (
            points=[24.46,-2; -14.48,-2],
                                        style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_firstStages.shaft_a, shaft_a) annotation (points=[-37.88,-2;
              -64,-2], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(flowSplit.out1, ST_secondStages.inlet) annotation (points=[3.2,
              45.94; 12,45.94; 12,46; 22.75,46; 22.75,12.22],
                                                       style(thickness=2));
        connect(flowSplit.out2, tap1) 
          annotation (points=[3.2,40.2; 3.2,-81; 3,-81], style(thickness=2));
        connect(flangeA, ST_firstStages.inlet) 
          annotation (points=[-73,77; -39.5,77; -39.5,12.22],
                                                         style(thickness=2));
        connect(flangeB, ST_secondStages.outlet) 
          annotation (points=[75,77; 51.63,77; 51.63,12.4],
                                                        style(thickness=2));
        connect(flowSplit.in1, ST_firstStages.outlet) annotation (points=[-5.2,43;
              -12.14,43; -12.14,12.4], style(thickness=2));
        connect(partialArc, ST_firstStages.partialArc) annotation (points=[-58,
              -40; -36,-40; -36,-26; -52,-26; -52,-9.2; -35,-9.2], style(color=
                74, rgbcolor={0,0,127}));
      end SteamTurbine_1tapping;
      
      model EffectHE "Effect of ideal HE" 
        extends Icons.Water.PressDrop;
        parameter SI.SpecificEnthalpy dh "Increase of specific enthalpy";
        parameter SI.Pressure dp "Drop pressure";
        
        Water.FlangeA in1 annotation (extent=[-140,-40; -62,40]);
        Water.FlangeB out1 annotation (extent=[60,-40; 140,40]);
        annotation (Icon(
            Text(extent=[-100,-56; 100,-84],   string="%name")));
      equation 
        out1.p = in1.p - dp;
        in1.w + out1.w = 0;
        in1.hAB + dh= out1.hAB;
        in1.hBA = out1.hBA - dh;
      end EffectHE;
      
      model StateReader 
        "State reader for the visualization of the state in the simulation" 
        replaceable package Medium = Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance "Medium model";
        SI.Temperature T;
        SI.Pressure p;
        SI.SpecificEnthalpy h;
        SI.MassFlowRate w;
        Medium.BaseProperties fluid;
        
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = Medium) 
                                        annotation (extent=[-80,-20; -40,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = Medium) 
                                         annotation (extent=[40,-20; 80,20]);
        annotation (
          Diagram,
          Icon(Polygon(points=[-80,0; 0,30; 80,0; 0,-30; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)), Text(
              extent=[-80,20; 80,-20],
              string="S",
              style(
                color=7,
                rgbcolor={255,255,255},
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1))),
          Documentation(info="<HTML>
<p>This component can be inserted in a hydraulic circuit to measure the temperature of the fluid flowing through it.
<p>Flow reversal is supported.
</HTML>",   revisions="<html>
<ul>
<li><i>16 Dec 2004</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Standard medium definition added.</li>
<li><i>1 Jul 2004</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       Adapted to Modelica.Media.</li>
<li><i>1 Oct 2003</i>
    by <a href=\"mailto:francesco.casella@polimi.it\">Francesco Casella</a>:<br>
       First release.</li>
</ul>
</html>"));
      equation 
        inlet.w + outlet.w = 0 "Mass balance";
        inlet.p = outlet.p "No pressure drop";
        // Set fluid properties
        fluid.p=inlet.p;
        fluid.h = if inlet.w >= 0 then inlet.hBA else inlet.hAB;
        
        T=fluid.T;
        p=fluid.p;
        h=fluid.h;
        w=inlet.w;
        
        // Boundary conditions
        inlet.hAB = outlet.hAB;
        inlet.hBA = outlet.hBA;
      end StateReader;
      
      model PrescribedSpeedPump "Prescribed speed pump" 
        replaceable package WaterMedium = 
            Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,62; 58,-58],   style(gradient=3)),
            Polygon(points=[-32,34; -32,-26; 46,2; -32,34],     style(
                pattern=0,
                gradient=2,
                fillColor=7))), Diagram);
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalSteamPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalSteamFlow 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        
        function flowCharacteristic = 
            ThermoPower.Functions.PumpCharacteristics.quadraticFlow (
              q_nom = q_nom, head_nom = head_nom);
        ThermoPower.Water.FlangeA inlet(
          redeclare package Medium = WaterMedium) 
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(
          redeclare package Medium = WaterMedium) 
          annotation (extent=[80,-20; 120,20]);
        Water.Pump feedWaterPump(     redeclare package Medium = 
              WaterMedium,
          redeclare function flowCharacteristic = flowCharacteristic,
          pin_start=nominalCondensationPressure,
          pout_start=nominalSteamPressure,
          wstart=nominalSteamFlow,
          n0=n0,
          hstart=hstart) 
          annotation (extent=[-40,-24; 0,16]);
        Modelica.Blocks.Interfaces.RealInput pumpSpeed_rpm 
                                         annotation (extent=[-128,40; -88,80]);
        
      equation 
        connect(inlet, feedWaterPump.infl) 
          annotation (points=[-100,0; -67,0; -67,0.4; -36,0.4], style(thickness=
               2));
        connect(pumpSpeed_rpm, feedWaterPump.in_n) annotation (points=[-108,60;
              -25.2,60; -25.2,12], style(color=74, rgbcolor={0,0,127}));
        connect(outlet, feedWaterPump.outfl) annotation (points=[100,0; 10,0;
              10,10.4; -8,10.4], style(thickness=2));
      end PrescribedSpeedPump;
      
      model PumpControlFlowRate "Pump flow rate controlled " 
        import ThermoPower;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalWaterPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalWaterFlowRate 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        
        //PID for flow rate control
        parameter Real Kp=4 "Proportional gain (normalised units)" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time Ti=200 "Integral time" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time Td=0 "Derivative time" 
          annotation (Dialog(tab="PID"));
        parameter Real PVmin=-1 "Minimum value of process variable for scaling"
          annotation (Dialog(tab="PID"));
        parameter Real PVmax=1 "Maximum value of process variable for scaling" 
          annotation (Dialog(tab="PID"));
        parameter Real CSmin=500 "Minimum value of control signal for scaling" 
          annotation (Dialog(tab="PID"));
        parameter Real CSmax=2500 "Maximum value of control signal for scaling"
          annotation (Dialog(tab="PID"));
        parameter Real PVstart=0.5 "Start value of PV (scaled)" 
          annotation (Dialog(tab="PID"));
        parameter Real CSstart=0.5 "Start value of CS (scaled)" 
          annotation (Dialog(tab="PID"));
        parameter SI.Time T_filter=1 "Time Constant of the filter" 
          annotation (Dialog(tab="PID"));
        
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,60; 58,-60],   style(gradient=3)),
            Polygon(points=[-32,32; -32,-28; 46,0; -32,32],     style(
                pattern=0,
                gradient=2,
                fillColor=7)),
            Rectangle(extent=[-88,90; -48,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-86,88; -50,52],
              style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1),
              string="C"),
            Line(points=[-48,70; -2,70; -2,60], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-62,0; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-70,0; -70,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Polygon(points=[-70,46; -72,40; -68,40; -70,46], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255},
                fillPattern=1)),
            Polygon(points=[-30,72; -30,68; -24,70; -30,72], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=74,
                rgbfillColor={0,0,127},
                fillPattern=1))),
                                Diagram);
      public 
        ThermoPower.PowerPlants.HRSG.Components.PrescribedSpeedPump pump(
          redeclare package WaterMedium = FluidMedium,
          q_nom=q_nom,
          head_nom=head_nom,
          rho_nom=rho_nom,
          n0=n0,
          nominalSteamPressure=nominalWaterPressure,
          nominalCondensationPressure=nominalCondensationPressure,
          nominalSteamFlow=nominalWaterFlowRate,
          hstart=hstart)        annotation (extent=[-8,16; -40,-16], rotation=180);
        ThermoPower.Water.SensW feed_w(redeclare package Medium = FluidMedium) 
          annotation (extent=[40,14; 20,-6],      rotation=180);
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = FluidMedium)
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = FluidMedium)
          annotation (extent=[80,-20; 120,20]);
        Modelica.Blocks.Interfaces.RealInput setpoint_FlowRate 
                                         annotation (extent=[-120,54; -88,86]);
        ThermoPower.PowerPlants.Control.PID pID(
          Kp=Kp,
          Ti=Ti,
          Td=Td,
          PVmin=PVmin,
          PVmax=PVmax,
          CSmin=CSmin,
          CSmax=CSmax,
          PVstart=PVstart,
          CSstart=CSstart) annotation (extent=[-10,60; 10,40],  rotation=180);
        Modelica.Blocks.Continuous.FirstOrder firstOrder(T=T_filter, y_start=n0) 
          annotation (extent=[-26,40; -46,60], rotation=0);
        
      equation 
        connect(pump.inlet, inlet)          annotation (points=[-40,
              1.95937e-015; -67,1.95937e-015; -67,0; -100,0], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(pump.outlet, feed_w.inlet)          annotation (points=[-8,
              -1.95937e-015; 3,-1.95937e-015; 3,8.88178e-016; 24,8.88178e-016],
                                                                style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(feed_w.outlet, outlet) annotation (points=[36,-8.88178e-016;
              57.8,-8.88178e-016; 57.8,0; 100,0],
                              style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(pID.PV, feed_w.w) annotation (points=[10,46; 60,46; 60,10; 38,
              10],        style(color=74, rgbcolor={0,0,127}));
        connect(pID.SP, setpoint_FlowRate) annotation (points=[10,54; 20,54; 20,
              70; -104,70],    style(color=74, rgbcolor={0,0,127}));
        connect(firstOrder.u, pID.CS) annotation (points=[-24,50; -10.6,50],
            style(color=74, rgbcolor={0,0,127}));
        connect(firstOrder.y, pump.pumpSpeed_rpm)          annotation (points=[-47,50;
              -60,50; -60,9.6; -41.28,9.6],         style(color=74, rgbcolor={0,
                0,127}));
      end PumpControlFlowRate;
      
      model PumpFilter "Pump with filter" 
        import ThermoPower;
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        
        parameter SI.VolumeFlowRate q_nom[3] "Nominal volume flow rates";
        parameter SI.Height head_nom[3] "Nominal heads";
        parameter SI.Density rho_nom "Nominal density";
        parameter SI.Conversions.NonSIunits.AngularVelocity_rpm n0 
          "Nominal rpm";
        parameter SI.Pressure nominalWaterPressure 
          "Nominal live steam pressure";
        parameter SI.Pressure nominalCondensationPressure 
          "Nominal condensation pressure";
        parameter SI.MassFlowRate nominalWaterFlowRate 
          "Nominal steam mass flow rate";
        parameter SI.SpecificEnthalpy hstart 
          "Fluid Specific Enthalpy Start Value";
        parameter SI.Time T_filter=1 "Time Constant of the filter";
        
        annotation (Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=30,
                rgbfillColor={240,240,240})),
            Text(
              extent=[-100,-118; 100,-144],
              style(color=3, rgbcolor={0,0,255}),
              string="%name"),
            Ellipse(extent=[-62,60; 58,-60],   style(gradient=3)),
            Polygon(points=[-32,32; -32,-28; 46,0; -32,32],     style(
                pattern=0,
                gradient=2,
                fillColor=7)),
            Rectangle(extent=[-88,90; -48,50], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Text(
              extent=[-86,88; -50,52],
              style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=68,
                rgbfillColor={170,213,255},
                fillPattern=1),
              string="F"),
            Line(points=[-48,70; -2,70; -2,60], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Line(points=[-62,0; -80,0], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2,
                fillColor=30,
                rgbfillColor={240,240,240},
                fillPattern=1)),
            Polygon(points=[-30,72; -30,68; -24,70; -30,72], style(
                color=74,
                rgbcolor={0,0,127},
                fillColor=74,
                rgbfillColor={0,0,127},
                fillPattern=1))),
                                Diagram);
      public 
        ThermoPower.PowerPlants.HRSG.Components.PrescribedSpeedPump pump(
          redeclare package WaterMedium = FluidMedium,
          q_nom=q_nom,
          head_nom=head_nom,
          rho_nom=rho_nom,
          n0=n0,
          nominalSteamPressure=nominalWaterPressure,
          nominalCondensationPressure=nominalCondensationPressure,
          nominalSteamFlow=nominalWaterFlowRate,
          hstart=hstart)        annotation (extent=[20,20; -20,-20], rotation=180);
        ThermoPower.Water.FlangeA inlet(redeclare package Medium = FluidMedium)
          annotation (extent=[-120,-20; -80,20]);
        ThermoPower.Water.FlangeB outlet(redeclare package Medium = FluidMedium)
          annotation (extent=[80,-20; 120,20]);
        Modelica.Blocks.Interfaces.RealInput setpoint_FlowRate 
                                         annotation (extent=[-120,54; -88,86]);
        Modelica.Blocks.Continuous.FirstOrder firstOrder(T=T_filter, y_start=n0) 
          annotation (extent=[0,40; -20,60],   rotation=0);
      equation 
        connect(pump.inlet, inlet)          annotation (points=[-20,
              2.44921e-015; -67,2.44921e-015; -67,0; -100,0], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={240,240,240},
            fillPattern=1));
        connect(firstOrder.y, pump.pumpSpeed_rpm)          annotation (points=[-21,50;
              -60,50; -60,12; -21.6,12],            style(color=74, rgbcolor={0,
                0,127}));
        connect(pump.outlet, outlet)          annotation (points=[20,
              -2.44921e-015; 40,-2.44921e-015; 40,0; 100,0], style(thickness=2));
        connect(firstOrder.u, setpoint_FlowRate) annotation (points=[2,50; 20,
              50; 20,70; -104,70],style(color=74, rgbcolor={0,0,127}));
      end PumpFilter;
      
      model Comp_bubble_h 
        "Computation Specific enthalpy of saturated liquid, imposted pressure" 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialTwoPhaseMedium;
        parameter SI.Pressure p "Pressure value";
        FluidMedium.SaturationProperties sat "Saturation properties";
        SI.SpecificEnthalpy hl "Specific enthalpy of saturated liquid";
        
        Modelica.Blocks.Interfaces.RealOutput h 
          annotation (extent=[80,-10; 100,10]);
        annotation (Icon(Rectangle(extent=[-80,40; 80,-40], style(color=3,
                  rgbcolor={0,0,255})), Text(
              extent=[-60,20; 60,-20],
              style(color=3, rgbcolor={0,0,255}),
              string="Computation")));
      equation 
        sat.psat = p;
        sat.Tsat = FluidMedium.saturationTemperature(p);
        hl = FluidMedium.bubbleEnthalpy(sat);
        
        //Output signal
        h = hl;
      end Comp_bubble_h;
      
      model ConstantSpeed "External imposed Speed" 
        extends 
          Modelica.Mechanics.Rotational.Interfaces.PartialSpeedDependentTorque;
        
        annotation (
          Diagram,
          Icon(Line(points=[0,-100; 0,100], style(color=3))),
          Documentation(info="<HTML>
<p>
Model of <b>fixed</b> angular verlocity of flange, not dependent on torque.
</p>
</HTML>"));
        Modelica.Blocks.Interfaces.RealInput w_fixed 
                                         annotation (extent=[-116,44; -84,76]);
      equation 
        w = w_fixed;
      end ConstantSpeed;
      
    end Components;
    
    package Examples 
      
      model ST2LRh_base "Steam turbine with two pressure levels and reheat" 
        extends Interfaces.ST_2LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-76,-20; -36,20]);
        annotation (Diagram);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart)            annotation (extent=[-24,-20; 16,20]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[30,-20; 70,20]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[24,44; 44,64], rotation=270);
      equation 
        connect(ST_LP.shaft_a, ST_IP.shaft_b) annotation (points=[36.8,0; 8.8,0],
                  style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a, ST_HP.shaft_b) annotation (points=[-17.2,0;
              -43.2,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-69.2,0; -100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[62.8,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.outlet, LPT_Out) annotation (points=[65.4,16; 80,16; 80,
              -24; 70,-24; 70,-100], style(thickness=2));
        connect(ST_IP.inlet, IPT_In) annotation (points=[-19,15.8; -19,80; 10,
              80; 10,100], style(thickness=2));
        connect(ST_HP.outlet, HPT_Out) annotation (points=[-40.6,16; -40.6,80;
              -30,80; -30,100], style(thickness=2));
        connect(ST_HP.inlet, HPT_In) annotation (points=[-71,15.8; -71,80; -60,
              80; -60,100], style(thickness=2));
        connect(mixLP.in1, LPT_In) 
          annotation (points=[40,62; 40,100], style(thickness=2));
        connect(mixLP.in2, ST_IP.outlet) annotation (points=[28,61.9; 28,72;
              11.4,72; 11.4,16], style(thickness=2));
        connect(ST_LP.inlet,mixLP. out) 
          annotation (points=[35,15.8; 34,15.8; 34,44], style(thickness=2));
      end ST2LRh_base;
      
      model ST3LRh_base "Steam turbine with three pressure levels and reheat" 
        extends Interfaces.ST_3LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        parameter SI.Volume mixIP_V "Internal volume of the IP mixer";
        parameter SI.Enthalpy mixIP_hstart = HPT_hstart_out 
          "Enthalpy start value of the IP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "IP mixer"));
        parameter SI.Pressure mixIP_pstart = steamIPNomPressure 
          "Pressure start value of the IP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "IP mixer"));
        
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart,
          wnom=steamHPNomFlowRate)      annotation (extent=[-82,-40; -42,0]);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart)            annotation (extent=[-24,-40; 16,0]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[40,-40; 80,0]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixLP_V,
          pstart=mixLP_pstart,
          hstart=mixLP_hstart) 
                          annotation (extent=[34,22; 54,42],rotation=270);
        Water.Mixer mixIP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixIP_V,
          pstart=mixIP_pstart,
          hstart=mixIP_hstart) 
                           annotation (extent=[-50,58; -30,78], rotation=90);
        annotation (Diagram);
      equation 
        connect(ST_LP.shaft_a, ST_IP.shaft_b) annotation (points=[46.8,-20; 8.8,
              -20],      style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a, ST_HP.shaft_b) annotation (points=[-17.2,-20;
              -49.2,-20], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(mixIP.out, HPT_Out) 
          annotation (points=[-40,78; -40,100], style(thickness=2));
        connect(mixIP.in2, SteamToMix)  annotation (points=[-34,60.1; -34,52;
              20,52; 20,100], style(thickness=2));
        connect(mixIP.in1, ST_HP.outlet) 
          annotation (points=[-46,60; -46,-4; -46.6,-4],   style(thickness=2));
        connect(ST_HP.inlet, HPT_In) annotation (points=[-77,-4.2; -77,33.9;
              -70,33.9; -70,100], style(thickness=2));
        connect(ST_IP.inlet, IPT_In) annotation (points=[-19,-4.2; -19,70; -10,
              70; -10,100],       style(thickness=2));
        connect(mixLP.out, ST_LP.inlet) 
          annotation (points=[44,22; 44,-4.2; 45,-4.2],  style(thickness=2));
        connect(ST_IP.outlet,mixLP. in2) annotation (points=[11.4,-4; 11.4,46;
              38,46; 38,39.9], style(thickness=2));
        connect(mixLP.in1, LPT_In) 
          annotation (points=[50,40; 50,100], style(thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-75.2,-20; -90,-20;
              -90,0; -100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(LPT_Out, ST_LP.outlet) annotation (points=[80,-100; 80,-54; 84,
              -54; 84,-4; 75.4,-4], style(thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[72.8,-20; 90,-20;
              90,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end ST3LRh_base;
      
      model ST2LRh_valve 
        "Steam turbine with two pressure levels and reheat, inlet valves" 
        extends Interfaces.ST_2LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valve"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valve"));
        parameter Real valveIP_Cv=0 "Cv (US) flow coefficient of the IP valve" annotation(Dialog(group= "IP valve"));
        parameter SI.Pressure valveIP_dpnom 
          "Nominal pressure drop of the IP valve"                                   annotation(Dialog(group= "IP valve"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valve"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valve"));
        
        annotation (Diagram, Icon(
            Polygon(points=[-64,50; -56,50; -64,38; -56,38; -64,50],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[6,48; 14,48; 6,36; 14,36; 6,48],       style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[36,64; 44,64; 36,52; 44,52; 36,64],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255}))));
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-74,-62; -34,-22]);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart)            annotation (extent=[-22,-62; 18,-22]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[30,-62; 70,-22]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[24,22; 44,42], rotation=270);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstat_in) annotation (extent=[-60,10; -80,-10],
                                                                   rotation=90);
        Water.ValveVap valveIP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveIP_Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=valveIP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          hstart=IPT_hstart_in) 
                               annotation (extent=[-8,10; -28,-10],
                                                                  rotation=90);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          Cv=valveLP_Cv,
          hstart=LPT_hstart_in) 
                               annotation (extent=[44,10; 24,-10],
                                                                 rotation=90);
      equation 
        connect(Shaft_b, Shaft_b) annotation (points=[100,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_a,ST_IP. shaft_b) annotation (points=[36.8,-42;
              10.8,-42],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a,ST_HP. shaft_b) annotation (points=[-15.2,-42;
              -41.2,-42],
                    style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-67.2,-42; -90,-42;
              -90,0; -100,0],
                       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[62.8,-42; 84,-42;
              84,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(valveHP.outlet,ST_HP. inlet) annotation (points=[-70,-10; -70,
              -26.2; -69,-26.2], style(thickness=2));
        connect(valveIP.outlet,ST_IP. inlet) annotation (points=[-18,-10; -18,
              -26.2; -17,-26.2], style(thickness=2));
        connect(valveLP.outlet,ST_LP. inlet) 
          annotation (points=[34,-10; 34,-26.2; 35,-26.2], style(thickness=2));
        connect(mixLP.in1, LPT_In) 
          annotation (points=[40,40; 40,100], style(thickness=2));
        connect(valveHP.inlet, HPT_In) annotation (points=[-70,10; -70,80; -60,
              80; -60,100], style(thickness=2));
        connect(valveIP.inlet, IPT_In) annotation (points=[-18,10; -18,80; 10,
              80; 10,100], style(thickness=2));
        connect(ST_HP.outlet, HPT_Out) annotation (points=[-38.6,-26; -38.6,80;
              -30,80; -30,100], style(thickness=2));
        connect(ST_IP.outlet, mixLP.in2) annotation (points=[13.4,-26; 14,-26;
              14,60; 28,60; 28,39.9], style(thickness=2));
        connect(valveLP.inlet, mixLP.out) 
          annotation (points=[34,10; 34,22], style(thickness=2));
        connect(ST_LP.outlet, LPT_Out) annotation (points=[65.4,-26; 78,-26; 78,
              -82; 70,-82; 70,-100], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -30,-72; -30,-4.89843e-016; -62,-4.89843e-016],         style(
              color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_valveIP, valveIP.theta) annotation (points=[98,-72;
              20,-72; 20,-4.89843e-016; -10,-4.89843e-016],         style(color=
               52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=[98,-72;
              74,-72; 74,-4.89843e-016; 42,-4.89843e-016],
                                           style(color=52, rgbcolor={213,255,
                170}));
      end ST2LRh_valve;
      
      model ST3LRh_valve 
        "Steam turbine with three pressure levels and reheat, inlet valves" 
        extends Interfaces.ST_3LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        parameter SI.Volume mixIP_V "Internal volume of the IP mixer";
        parameter SI.Enthalpy mixIP_hstart = HPT_hstart_out 
          "Enthalpy start value of the IP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "IP mixer"));
        parameter SI.Pressure mixIP_pstart = steamIPNomPressure 
          "Pressure start value of the IP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "IP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valve"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valve"));
        parameter Real valveIP_Cv=0 "Cv (US) flow coefficient of the IP valve" annotation(Dialog(group= "IP valve"));
        parameter SI.Pressure valveIP_dpnom 
          "Nominal pressure drop of the IP valve"                                   annotation(Dialog(group= "IP valve"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valve"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valve"));
        
        annotation (Diagram, Icon(
            Polygon(points=[-14,48; -6,48; -14,36; -6,36; -14,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[46,48; 54,48; 46,36; 54,36; 46,48],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-74,48; -66,48; -74,36; -66,36; -74,48],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255}))));
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-74,-62; -34,-22]);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate)            annotation (extent=[-22,-62;
              18,-22]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[30,-62; 70,-22]);
        Water.Mixer mixIP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixIP_V,
          pstart=mixIP_pstart,
          hstart=mixIP_hstart) 
                          annotation (extent=[-50,60; -30,80],
                                                             rotation=90);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[24,22; 44,42], rotation=270);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstart_in) 
                               annotation (extent=[-60,10; -80,-10],
                                                                   rotation=90);
        Water.ValveVap valveIP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveIP_Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=valveIP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate,
          hstart=IPT_hstart_in) 
                               annotation (extent=[-8,10; -28,-10],
                                                                  rotation=90);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate,
          Cv=valveLP_Cv,
          hstart=LPT_hstart_in) 
                               annotation (extent=[44,10; 24,-10],
                                                                 rotation=90);
      equation 
        connect(ST_LP.shaft_a,ST_IP. shaft_b) annotation (points=[36.8,-42;
              10.8,-42],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a,ST_HP. shaft_b) annotation (points=[-15.2,-42;
              -41.2,-42],
                    style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(valveHP.outlet,ST_HP. inlet) annotation (points=[-70,-10; -70,
              -26.2; -69,-26.2], style(thickness=2));
        connect(valveIP.outlet,ST_IP. inlet) annotation (points=[-18,-10; -18,
              -26.2; -17,-26.2], style(thickness=2));
        connect(valveLP.outlet,ST_LP. inlet) 
          annotation (points=[34,-10; 34,-26.2; 35,-26.2], style(thickness=2));
        connect(valveLP.inlet, mixLP.out) 
          annotation (points=[34,10; 34,22], style(thickness=2));
        connect(valveIP.inlet, IPT_In) annotation (points=[-18,10; -18,80; -10,
              80; -10,100], style(thickness=2));
        connect(valveHP.inlet, HPT_In) 
          annotation (points=[-70,10; -70,100], style(thickness=2));
        connect(ST_HP.outlet, mixIP.in1) annotation (points=[-38.6,-26; -38.6,
              36; -46,36; -46,62], style(thickness=2));
        connect(mixIP.in2, SteamToMix) annotation (points=[-34,62.1; -34,54; 20,
              54; 20,100], style(thickness=2));
        connect(mixIP.out, HPT_Out) 
          annotation (points=[-40,80; -40,100], style(thickness=2));
        connect(mixLP.in1, LPT_In) annotation (points=[40,40; 40,48; 50,48; 50,
              100], style(thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-67.2,-42; -90,-42;
              -90,0; -100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[62.8,-42; 84,-42;
              84,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(mixLP.in2, ST_IP.outlet) annotation (points=[28,39.9; 28,48;
              13.4,48; 13.4,-26], style(thickness=2));
        connect(ST_LP.outlet, LPT_Out) annotation (points=[65.4,-26; 78,-26; 78,
              -82; 80,-82; 80,-100], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -30,-72; -30,-4.89843e-016; -62,-4.89843e-016],
                                                           style(color=52, rgbcolor={
                213,255,170}));
        connect(ActuatorsBus.Opening_valveIP, valveIP.theta) annotation (points=[98,-72;
              20,-72; 20,-4.89843e-016; -10,-4.89843e-016],
                                                      style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=[98,-72;
              74,-72; 74,-4.89843e-016; 42,-4.89843e-016],
                                        style(color=52, rgbcolor={213,255,170}));
      end ST3LRh_valve;
      
      model ST2LRh_bypass 
        "Steam turbine with two pressure levels and reheat, inlet and by-pass valves " 
        extends Interfaces.ST_2LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valves"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valves"));
        parameter Real bypassHP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass"                                 annotation(Dialog(group= "HP valves"));
        parameter Real valveIP_Cv=0 "Cv (US) flow coefficient of the IP valve" annotation(Dialog(group= "IP valves"));
        parameter SI.Pressure valveIP_dpnom 
          "Nominal pressure drop of the IP valve"                                   annotation(Dialog(group= "IP valves"));
        parameter Real bypassIP_Cv=0 
          "Cv (US) flow coefficient of the IP valve of bypass" annotation(Dialog(group= "IP valves"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valves"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valves"));
        parameter Real bypassLP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass" annotation(Dialog(group= "LP valves"));
        
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-82,-70; -42,-30]);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart)            annotation (extent=[-22,-70; 18,-30]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[38,-70; 78,-30]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[40,66; 52,78], rotation=270);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstart_in) 
                               annotation (extent=[-66,2; -86,-18],rotation=90);
        Water.ValveVap valveIP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveIP_Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=valveIP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          hstart=IPT_hstart_in) 
                               annotation (extent=[-6,2; -26,-18],rotation=90);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          Cv=valveLP_Cv,
          hstart=LPT_hstart_in) 
                               annotation (extent=[34,2; 54,-18],rotation=90);
        Water.ValveVap byPassHP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=steamHPNomPressure-steamIPNomPressure,
          Cv=bypassHP_Cv,
          hstart=HPT_hstart_in) annotation (extent=[-50,38; -70,18], rotation=90);
        Water.ValveVap byPassIP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=steamIPNomPressure-steamLPNomPressure,
          Cv=bypassIP_Cv,
          wnom=steamHPNomFlowRate,
          hstart=IPT_hstart_in) annotation (extent=[10,38; -10,18],rotation=90);
        Water.ValveVap byPassLP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          Cv=bypassLP_Cv,
          dpnom=steamLPNomPressure - pcond,
          wnom=steamLPNomFlowRate + steamHPNomFlowRate,
          hstart=LPT_hstart_in)  annotation (extent=[50,38; 70,18], rotation=90);
        Water.FlowJoin flowHPJoin(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-50,2; -38,14]);
        Water.FlowSplit flowHPSplit(redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-80,50; -68,62], rotation=270);
        Water.FlowJoin flowIPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[10,2; 22,14]);
        Water.FlowSplit flowIPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[-20,50; -8,62], rotation=270);
        Water.FlowJoin flowLPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[68,2; 82,14]);
        Water.FlowSplit flowLPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[40,50; 52,62], rotation=270);
        annotation (Diagram, Icon(
            Polygon(points=[-64,50; -56,50; -64,38; -56,38; -64,50],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[6,50; 14,50; 6,38; 14,38; 6,50],       style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[36,64; 44,64; 36,52; 44,52; 36,64],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-52,62; -52,70; -38,62; -38,70; -52,62],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[18,74; 18,82; 32,74; 32,82; 18,74],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[48,68; 48,76; 62,68; 62,76; 48,68],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-60,66; -52,66], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-38,66; -30,66], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[10,78; 18,78], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[32,78; 40,78], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[40,72; 48,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[70,50; 70,72; 62,72], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2))));
      equation 
        connect(ST_LP.shaft_a, ST_IP.shaft_b) annotation (points=[44.8,-50;
              10.8,-50],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a, ST_HP.shaft_b) annotation (points=[-15.2,-50;
              -49.2,-50],
                    style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-75.2,-50; -90,-50;
              -90,0; -100,0],
                       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[70.8,-50; 80,-50;
              80,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(valveHP.inlet, flowHPSplit.out2) 
          annotation (points=[-76,2; -76.4,2; -76.4,52.4], style(thickness=2));
        connect(byPassHP.inlet, flowHPSplit.out1) annotation (points=[-60,38;
              -60,46; -71.48,46; -71.48,52.4], style(thickness=2));
        connect(flowHPJoin.in1, byPassHP.outlet) annotation (points=[-47.6,10.4;
              -60,10.4; -60,18], style(thickness=2));
        connect(ST_HP.outlet, flowHPJoin.in2) annotation (points=[-46.6,-34;
              -46.6,0; -60,0; -60,5.6; -47.6,5.6], style(thickness=2));
        connect(valveHP.outlet, ST_HP.inlet) annotation (points=[-76,-18; -76,
              -34.2; -77,-34.2], style(thickness=2));
        connect(valveIP.outlet, ST_IP.inlet) annotation (points=[-16,-18; -16,
              -34.2; -17,-34.2], style(thickness=2));
        connect(valveIP.inlet, flowIPSplit.out2) annotation (points=[-16,2; -16,
              52.4; -16.4,52.4], style(thickness=2));
        connect(byPassIP.inlet, flowIPSplit.out1) annotation (points=[
              6.12303e-016,38; 0,38; 0,46; -11.48,46; -11.48,52.4], style(
              thickness=2));
        connect(flowIPJoin.in1, byPassIP.outlet) annotation (points=[12.4,10.4;
              -6.12303e-016,10.4; -6.12303e-016,18], style(thickness=2));
        connect(ST_IP.outlet, flowIPJoin.in2) annotation (points=[13.4,-34;
              13.4,0; 0,0; 0,5.6; 12.4,5.6], style(thickness=2));
        connect(valveLP.outlet, ST_LP.inlet) 
          annotation (points=[44,-18; 44,-34.2; 43,-34.2], style(thickness=2));
        connect(ST_LP.outlet, flowLPJoin.in2) annotation (points=[73.4,-34;
              73.4,0; 60,0; 60,5.6; 70.8,5.6], style(thickness=2));
        connect(flowLPJoin.in1, byPassLP.outlet) 
          annotation (points=[70.8,10.4; 60,10.4; 60,18], style(thickness=2));
        connect(byPassLP.inlet, flowLPSplit.out1) annotation (points=[60,38; 60,
              46; 48.52,46; 48.52,52.4], style(thickness=2));
        connect(valveLP.inlet, flowLPSplit.out2) 
          annotation (points=[44,2; 44,52.4; 43.6,52.4], style(thickness=2));
        connect(flowLPSplit.in1, mixLP.out) 
          annotation (points=[46,59.6; 46,66], style(thickness=2));
        connect(mixLP.in1, LPT_In) annotation (points=[49.6,76.8; 49.6,86; 40,
              86; 40,100], style(thickness=2));
        connect(mixLP.in2, flowIPJoin.out) annotation (points=[42.4,76.74; 42.4,
              82; 28,82; 28,8; 19.6,8], style(thickness=2));
        connect(flowIPSplit.in1, IPT_In) annotation (points=[-14,59.6; -14,80;
              10,80; 10,100], style(thickness=2));
        connect(flowHPJoin.out, HPT_Out) 
          annotation (points=[-40.4,8; -30,8; -30,100], style(thickness=2));
        connect(flowHPSplit.in1, HPT_In) annotation (points=[-74,59.6; -74,80;
              -60,80; -60,100; -60,100], style(thickness=2));
        connect(LPT_Out, flowLPJoin.out) annotation (points=[70,-100; 70,-84;
              86,-84; 86,8; 79.2,8], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -32,-72; -32,-8; -68,-8],                    style(color=52, rgbcolor={
                213,255,170}));
        connect(ActuatorsBus.Opening_valveIP, valveIP.theta) annotation (points=[98,-72;
              26,-72; 26,-8; -8,-8],                  style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=[98,-72;
              26,-72; 26,-8; 36,-8],    style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassHP, byPassHP.theta) annotation (
            points=[98,-72; -32,-72; -32,28; -52,28], style(color=52, rgbcolor=
                {213,255,170}));
        connect(ActuatorsBus.Opening_byPassIP, byPassIP.theta) annotation (
            points=[98,-72; 26,-72; 26,28; 8,28], style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_byPassLP, byPassLP.theta) annotation (
            points=[98,-72; 26,-72; 26,28; 52,28], style(color=52, rgbcolor={
                213,255,170}));
      end ST2LRh_bypass;
      
      model ST3LRh_bypass 
        "Steam turbine with three pressure levels and reheat, inlet and by-pass valves " 
        extends Interfaces.ST_3LRh;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart = LPT_hstart_in 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart = steamLPNomPressure 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        parameter SI.Volume mixIP_V "Internal volume of the IP mixer";
        parameter SI.Enthalpy mixIP_hstart = HPT_hstart_out 
          "Enthalpy start value of the IP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "IP mixer"));
        parameter SI.Pressure mixIP_pstart = steamIPNomPressure 
          "Pressure start value of the IP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "IP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valves"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valves"));
        parameter Real bypassHP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass"                                 annotation(Dialog(group= "HP valves"));
        parameter Real valveIP_Cv=0 "Cv (US) flow coefficient of the IP valve" annotation(Dialog(group= "IP valves"));
        parameter SI.Pressure valveIP_dpnom 
          "Nominal pressure drop of the IP valve"                                   annotation(Dialog(group= "IP valves"));
        parameter Real bypassIP_Cv=0 
          "Cv (US) flow coefficient of the IP valve of bypass" annotation(Dialog(group= "IP valves"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valves"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valves"));
        parameter Real bypassLP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass" annotation(Dialog(group= "LP valves"));
        
        annotation (Diagram, Icon(
            Polygon(points=[-74,48; -66,48; -74,36; -66,36; -74,48],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-14,48; -6,48; -14,36; -6,36; -14,48], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[46,48; 54,48; 46,36; 54,36; 46,48],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[-62,52; -62,60; -48,52; -48,60; -62,52],
                                                                   style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[-70,56; -62,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-48,56; -40,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[-10,56; -2,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[12,56; 20,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Polygon(points=[-2,52; -2,60; 12,52; 12,60; -2,52],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Polygon(points=[58,52; 58,60; 72,52; 72,60; 58,52],    style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=3,
                rgbfillColor={0,0,255})),
            Line(points=[50,56; 58,56], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2)),
            Line(points=[72,56; 80,56; 80,50], style(
                color=3,
                rgbcolor={0,0,255},
                thickness=2))));
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-82,-70; -42,-30]);
        Water.SteamTurbineStodola ST_IP(
          redeclare package Medium = FluidMedium,
          eta_mech=IPT_eta_mech,
          eta_iso_nom=IPT_eta_iso_nom,
          Kt=IPT_Kt,
          hstartin=IPT_hstart_in,
          hstartout=IPT_hstart_out,
          pstart_in=IPT_pstart_in,
          pstart_out=IPT_pstart_out,
          wstart=IPT_wstart,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[-22,-70; 18,-30]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate) 
                                        annotation (extent=[38,-70; 78,-30]);
        Water.Mixer mixIP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          V=mixIP_V,
          pstart=mixIP_pstart,
          hstart=mixIP_hstart) 
                          annotation (extent=[-46,70; -34,82],
                                                             rotation=90);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[40,66; 52,78], rotation=270);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstart_in) 
                               annotation (extent=[-66,2; -86,-18],rotation=90);
        Water.ValveVap valveIP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveIP_Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=valveIP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate,
          hstart=IPT_hstart_in) 
                               annotation (extent=[-6,2; -26,-18],rotation=90);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate,
          Cv=valveLP_Cv,
          hstart=LPT_hstart_in) 
                               annotation (extent=[34,2; 54,-18],rotation=90);
        Water.ValveVap byPassHP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=steamHPNomPressure - steamIPNomPressure,
          Cv=bypassHP_Cv,
          hstart=HPT_hstart_in) annotation (extent=[-50,38; -70,18], rotation=90);
        Water.ValveVap byPassIP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamIPNomPressure,
          CheckValve=true,
          dpnom=steamIPNomPressure - steamLPNomPressure,
          wnom=steamIPNomFlowRate + steamHPNomFlowRate,
          Cv=bypassIP_Cv,
          hstart=IPT_hstart_in) annotation (extent=[10,38; -10,18],rotation=90);
        Water.ValveVap byPassLP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          wnom=steamLPNomFlowRate + steamIPNomFlowRate + steamHPNomFlowRate,
          Cv=bypassLP_Cv,
          dpnom=steamLPNomPressure - pcond,
          hstart=LPT_hstart_in)  annotation (extent=[50,38; 70,18], rotation=90);
        Water.FlowJoin flowHPJoin(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-50,2; -38,14]);
        Water.FlowSplit flowHPSplit(redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-80,50; -68,62], rotation=270);
        Water.FlowJoin flowIPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[10,2; 22,14]);
        Water.FlowSplit flowIPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[-20,50; -8,62], rotation=270);
        Water.FlowJoin flowLPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[70,2; 82,14]);
        Water.FlowSplit flowLPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[40,50; 52,62], rotation=270);
        
      equation 
        connect(ST_LP.shaft_a,ST_IP. shaft_b) annotation (points=[44.8,-50;
              10.8,-50],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_IP.shaft_a,ST_HP. shaft_b) annotation (points=[-15.2,-50;
              -49.2,-50],
                    style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(valveHP.inlet,flowHPSplit. out2) 
          annotation (points=[-76,2; -76.4,2; -76.4,52.4], style(thickness=2));
        connect(byPassHP.inlet,flowHPSplit. out1) annotation (points=[-60,38;
              -60,46; -71.48,46; -71.48,52.4], style(thickness=2));
        connect(flowHPJoin.in1,byPassHP. outlet) annotation (points=[-47.6,10.4;
              -60,10.4; -60,18], style(thickness=2));
        connect(ST_HP.outlet,flowHPJoin. in2) annotation (points=[-46.6,-34;
              -46.6,0; -60,0; -60,5.6; -47.6,5.6], style(thickness=2));
        connect(valveHP.outlet,ST_HP. inlet) annotation (points=[-76,-18; -76,
              -34.2; -77,-34.2], style(thickness=2));
        connect(valveIP.outlet,ST_IP. inlet) annotation (points=[-16,-18; -16,
              -34.2; -17,-34.2], style(thickness=2));
        connect(valveIP.inlet,flowIPSplit. out2) annotation (points=[-16,2; -16,
              52.4; -16.4,52.4], style(thickness=2));
        connect(byPassIP.inlet,flowIPSplit. out1) annotation (points=[
              6.12303e-016,38; 6.12303e-016,46; -11.48,46; -11.48,52.4], style(
              thickness=2));
        connect(flowIPJoin.in1,byPassIP. outlet) annotation (points=[12.4,10.4;
              -6.12303e-016,10.4; -6.12303e-016,18], style(thickness=2));
        connect(ST_IP.outlet,flowIPJoin. in2) annotation (points=[13.4,-34;
              13.4,0; 0,0; 0,5.6; 12.4,5.6], style(thickness=2));
        connect(valveLP.outlet,ST_LP. inlet) 
          annotation (points=[44,-18; 44,-34.2; 43,-34.2], style(thickness=2));
        connect(ST_LP.outlet,flowLPJoin. in2) annotation (points=[73.4,-34;
              73.4,0; 60,0; 60,5.6; 72.4,5.6], style(thickness=2));
        connect(flowLPJoin.in1,byPassLP. outlet) 
          annotation (points=[72.4,10.4; 60,10.4; 60,18], style(thickness=2));
        connect(byPassLP.inlet,flowLPSplit. out1) annotation (points=[60,38; 60,
              46; 48.52,46; 48.52,52.4], style(thickness=2));
        connect(valveLP.inlet,flowLPSplit. out2) 
          annotation (points=[44,2; 44,52.4; 43.6,52.4], style(thickness=2));
        connect(flowLPSplit.in1,mixLP. out) 
          annotation (points=[46,59.6; 46,66], style(thickness=2));
        connect(mixLP.in2,flowIPJoin. out) annotation (points=[42.4,76.74; 42.4,
              82; 28,82; 28,8; 19.6,8], style(thickness=2));
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-75.2,-50; -90,-50;
              -90,0; -100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[70.8,-50; 80,-50;
              80,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(flowLPJoin.out, LPT_Out) annotation (points=[79.6,8; 86,8; 86,
              -84; 80,-84; 80,-100], style(thickness=2));
        connect(SteamToMix, mixIP.in2) annotation (points=[20,100; 20,64; -36.4,
              64; -36.4,71.26], style(thickness=2));
        connect(mixIP.out, HPT_Out) 
          annotation (points=[-40,82; -40,100], style(thickness=2));
        connect(mixIP.in1, flowHPJoin.out) annotation (points=[-43.6,71.2;
              -43.6,34; -30,34; -30,8; -40.4,8], style(thickness=2));
        connect(flowIPSplit.in1, IPT_In) annotation (points=[-14,59.6; -14,80;
              -10,80; -10,100], style(thickness=2));
        connect(flowHPSplit.in1, HPT_In) annotation (points=[-74,59.6; -74,80;
              -70,80; -70,100], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -32,-72; -32,-8; -68,-8],                    style(color=52, rgbcolor={
                213,255,170}));
        connect(ActuatorsBus.Opening_valveIP, valveIP.theta) annotation (points=[98,-72;
              26,-72; 26,-8; -8,-8],                  style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=[98,-72;
              26,-72; 26,-8; 36,-8],    style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassHP, byPassHP.theta) annotation (points=[98,-72;
              -32,-72; -32,28; -52,28],      style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassIP, byPassIP.theta) annotation (points=[98,
              -72; 26,-72; 26,28; 8,28], style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassLP, byPassLP.theta) annotation (points=[98,-72;
              26,-72; 26,28; 52,28],         style(color=52, rgbcolor={213,255,170}));
        connect(mixLP.in1, LPT_In) annotation (points=[49.6,76.8; 49.6,86.4; 50,86.4; 50,100],
            style(thickness=2));
      end ST3LRh_bypass;
      
      model ST_2LHU 
        "Steam Turbine Group (two pressure levels) with coupling Heat Usage" 
        extends Interfaces.ST_2LHU;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valves"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valves"));
        parameter Real bypassHP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass"                                 annotation(Dialog(group= "HP valves"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valves"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valves"));
        parameter Real bypassLP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass" annotation(Dialog(group= "LP valves"));
        parameter Real valveHU_Cv=0 
          "Cv (US) flow coefficient of the valve for HU"                           annotation(Dialog(group= "Heat Usage valve"));
        parameter SI.Pressure valveHU_dpnom 
          "Nominal pressure drop of the valve for HU"                                   annotation(Dialog(group= "Heat Usage valve"));
        
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-72,-34; -32,6]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamHPNomFlowRate)      annotation (extent=[10,-34; 50,6]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[-42,-70; -26,-54],
                                                             rotation=180);
        Water.ValveVap valveHU(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          redeclare package Medium = FluidMedium,
          Cv=valveHU_Cv,
          dpnom=valveHU_dpnom,
          pnom=steamLPNomPressure,
          wnom=steamHPNomFlowRate,
          hstart=HPT_hstart_out) 
                               annotation (extent=[-8,-28; -26,-46],
                                                                  rotation=90);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          Cv=valveLP_Cv,
          wnom=steamHPNomFlowRate,
          hstart=LPT_hstart_in) 
                               annotation (extent=[6,40; 26,20], rotation=90);
        Water.FlowSplit flowHUSplit(redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-20,-6; -8,6],   rotation=270);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstart_in) 
                               annotation (extent=[-76,40; -56,20],rotation=90);
        Water.ValveVap byPassHP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          Cv=bypassHP_Cv,
          dpnom=steamHPNomPressure - steamLPNomPressure,
          hstart=HPT_hstart_in) annotation (extent=[-46,58; -26,38], rotation=90);
        Water.FlowJoin flowHPJoin(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-20,12; -8,24], rotation=
              270);
        Water.FlowSplit flowHPSplit1(
                                    redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-56,70; -44,82], rotation=270);
        Water.ValveVap byPassLP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          Cv=bypassLP_Cv,
          dpnom=steamLPNomPressure - pcond,
          wnom=steamHPNomFlowRate,
          hstart=LPT_hstart_in)  annotation (extent=[36,58; 56,38], rotation=90);
        Water.FlowSplit flowLPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[22,70; 34,82], rotation=270);
        Water.FlowJoin flowLPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[54,24; 66,36], rotation=0);
        annotation (Diagram);
      equation 
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-65.2,-14; -82,-14;
              -82,0; -100,0],
                       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[42.8,-14; 58,-14;
              58,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_a, ST_HP.shaft_b) annotation (points=[16.8,-14;
              -39.2,-14], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(flowHPSplit1.in1, HPT_In) 
          annotation (points=[-50,79.6; -50,100; -50,100], style(thickness=2));
        connect(flowHPSplit1.out2, valveHP.inlet) annotation (points=[-52.4,
              72.4; -52.4,66; -66,66; -66,40], style(thickness=2));
        connect(valveHP.outlet, ST_HP.inlet) 
          annotation (points=[-66,20; -66,1.8; -67,1.8], style(thickness=2));
        connect(flowHPJoin.in1, byPassHP.outlet) annotation (points=[-11.6,21.6;
              -12,22; -12,32; -36,32; -36,38], style(thickness=2));
        connect(mixLP.out, SteamForHU) 
          annotation (points=[-42,-62; -50,-62; -50,-100], style(thickness=2));
        connect(valveHU.inlet, flowHUSplit.out2) annotation (points=[-17,-28;
              -16.4,-28; -16.4,-3.6], style(thickness=2));
        connect(LPT_In, mixLP.in1) annotation (points=[50,100; 50,80; 72,80; 72,
              -66; -27.6,-66; -27.6,-66.8], style(thickness=2));
        connect(valveLP.outlet, ST_LP.inlet) 
          annotation (points=[16,20; 16,1.8; 15,1.8], style(thickness=2));
        connect(flowHPJoin.in2, ST_HP.outlet) annotation (points=[-16.4,21.6;
              -16.4,26; -36.6,26; -36.6,2], style(thickness=2));
        connect(mixLP.in2, valveHU.outlet) annotation (points=[-27.68,-57.2;
              -17,-57.2; -17,-46], style(thickness=2));
        connect(byPassLP.inlet,flowLPSplit. out1) annotation (points=[46,58; 46,
              66; 30.52,66; 30.52,72.4], style(thickness=2));
        connect(flowLPSplit.out2, valveLP.inlet) annotation (points=[25.6,72.4;
              26,66; 16,66; 16,40], style(thickness=2));
        connect(flowLPSplit.in1, flowHUSplit.out1) annotation (points=[28,79.6;
              28,86; -4,86; -4,-10; -11.48,-10; -11.48,-3.6], style(thickness=2));
        connect(flowHUSplit.in1, flowHPJoin.out) 
          annotation (points=[-14,3.6; -14,14.4], style(thickness=2));
        connect(byPassHP.inlet, flowHPSplit1.out1) annotation (points=[-36,58;
              -36,66; -47.48,66; -47.48,72.4], style(thickness=2));
        connect(flowLPJoin.out, LPT_Out) annotation (points=[63.6,30; 80,30; 80,
              -80; 50,-80; 50,-100], style(thickness=2));
        connect(flowLPJoin.in1, byPassLP.outlet) 
          annotation (points=[56.4,32.4; 46,32.4; 46,38], style(thickness=2));
        connect(flowLPJoin.in2, ST_LP.outlet) annotation (points=[56.4,27.6;
              45.4,27.6; 45.4,2], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -88,-72; -88,30; -74,30],         style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=
             [98,-72; 0,-72; 0,30; 8,30], style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassHP, byPassHP.theta) annotation (
            points=[98,-72; -88,-72; -88,48; -44,48], style(color=52, rgbcolor=
                {213,255,170}));
        connect(ActuatorsBus.Opening_byPassLP, byPassLP.theta) annotation (
            points=[98,-72; 0,-72; 0,48; 38,48], style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveHU, valveHU.theta) annotation (points=
             [98,-72; 0,-72; 0,-37; -9.8,-37], style(color=52, rgbcolor={213,
                255,170}));
      end ST_2LHU;
      
      model ST_2LRhHU 
        "Steam Turbine Group (two pressure levels and reheat) with coupling Heat Usage" 
        extends Interfaces.ST_2LRhHU;
        
        //Mixers Parameters
        parameter SI.Volume mixLP_V "Internal volume of the LP mixer";
        parameter SI.Enthalpy mixLP_hstart 
          "Enthalpy start value of the LP mixer" annotation (Dialog(tab = "Initialization",
                                                                    group = "LP mixer"));
        parameter SI.Pressure mixLP_pstart 
          "Pressure start value of the LP mixer" 
              annotation (Dialog(tab = "Initialization",
                                 group = "LP mixer"));
        
        //Valves Parameters
        parameter Real valveHP_Cv=0 "Cv (US) flow coefficient of the HP valve" annotation(Dialog(group= "HP valves"));
        parameter SI.Pressure valveHP_dpnom 
          "Nominal pressure drop of the HP valve"                                   annotation(Dialog(group= "HP valves"));
        parameter Real bypassHP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass"                                 annotation(Dialog(group= "HP valves"));
        parameter Real valveLP_Cv=0 "Cv (US) flow coefficient of the LP valve" annotation(Dialog(group= "LP valves"));
        parameter SI.Pressure valveLP_dpnom 
          "Nominal pressure drop of the LP valve"                                   annotation(Dialog(group= "LP valves"));
        parameter Real bypassLP_Cv=0 
          "Cv (US) flow coefficient of the HP valve of bypass" annotation(Dialog(group= "LP valves"));
        
        Water.SteamTurbineStodola ST_HP(
          redeclare package Medium = FluidMedium,
          wnom=steamHPNomFlowRate,
          eta_mech=HPT_eta_mech,
          eta_iso_nom=HPT_eta_iso_nom,
          Kt=HPT_Kt,
          hstartin=HPT_hstart_in,
          hstartout=HPT_hstart_out,
          pstart_in=HPT_pstart_in,
          pstart_out=HPT_pstart_out,
          wstart=HPT_wstart)            annotation (extent=[-72,-40; -32,0]);
        Water.SteamTurbineStodola ST_LP(
          redeclare package Medium = FluidMedium,
          eta_mech=LPT_eta_mech,
          eta_iso_nom=LPT_eta_iso_nom,
          Kt=LPT_Kt,
          hstartin=LPT_hstart_in,
          hstartout=LPT_hstart_out,
          pstart_in=LPT_pstart_in,
          pstart_out=LPT_pstart_out,
          wstart=LPT_wstart,
          wnom=steamHPNomFlowRate)      annotation (extent=[12,-40; 52,0]);
        Water.Mixer mixLP(
          redeclare package Medium = FluidMedium,
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          hstart=mixLP_hstart,
          V=mixLP_V,
          pstart=mixLP_pstart) 
                          annotation (extent=[-36,-52; -24,-40],
                                                             rotation=180);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          dpnom=valveLP_dpnom,
          redeclare package Medium = FluidMedium,
          Cv=valveLP_Cv,
          wnom=steamHPNomFlowRate,
          hstart=LPT_hstart_in) 
                               annotation (extent=[8,40; 28,20], rotation=90);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          Cv=valveHP_Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          dpnom=valveHP_dpnom,
          redeclare package Medium = FluidMedium,
          hstart=HPT_hstart_in) 
                               annotation (extent=[-76,40; -56,20],rotation=90);
        Water.ValveVap byPassHP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamHPNomPressure,
          wnom=steamHPNomFlowRate,
          CheckValve=true,
          Cv=bypassHP_Cv,
          dpnom=steamHPNomPressure - steamLPNomPressure,
          hstart=HPT_hstart_in) annotation (extent=[-46,58; -26,38], rotation=90);
        Water.FlowJoin flowHPJoin(redeclare package Medium = FluidMedium) 
                                annotation (extent=[-22,10; -10,22],rotation=270);
        Water.FlowSplit flowHPSplit1(
                                    redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-66,72; -54,84], rotation=270);
        Water.ValveVap byPassLP(redeclare package Medium = FluidMedium,
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          pnom=steamLPNomPressure,
          CheckValve=true,
          Cv=bypassLP_Cv,
          dpnom=steamLPNomPressure - pcond,
          wnom=steamHPNomFlowRate,
          hstart=LPT_hstart_in)  annotation (extent=[36,58; 56,38], rotation=90);
        Water.FlowSplit flowLPSplit(redeclare package Medium = FluidMedium) 
                                   annotation (extent=[14,70; 26,82], rotation=270);
        Water.FlowJoin flowLPJoin(redeclare package Medium = FluidMedium) 
                                 annotation (extent=[54,14; 66,26], rotation=0);
        annotation (Diagram);
        Water.FlowSplit flowHUSplit(redeclare package Medium = FluidMedium) 
                                  annotation (extent=[-54,-68; -42,-56],
                                                                       rotation=270);
      equation 
        connect(ST_HP.shaft_a, Shaft_a) annotation (points=[-65.2,-20; -82,-20;
              -82,0; -100,0],
                       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_b, Shaft_b) annotation (points=[44.8,-20; 58,-20;
              58,0; 100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ST_LP.shaft_a, ST_HP.shaft_b) annotation (points=[18.8,-20;
              -39.2,-20],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(flowHPSplit1.in1, HPT_In) 
          annotation (points=[-60,81.6; -60,100], style(thickness=2));
        connect(flowHPSplit1.out2, valveHP.inlet) annotation (points=[-62.4,
              74.4; -62,66; -66,66; -66,40],
                                         style(thickness=2));
        connect(valveHP.outlet, ST_HP.inlet) 
          annotation (points=[-66,20; -66,-4.2; -67,-4.2],  style(thickness=2));
        connect(flowHPJoin.in1, byPassHP.outlet) annotation (points=[-13.6,19.6;
              -14,20; -14,30; -36,30; -36,38],
                                           style(thickness=2));
        connect(LPT_In, mixLP.in1) annotation (points=[50,100; 50,80; 74,80; 74,
              -49.6; -25.2,-49.6],     style(thickness=2));
        connect(valveLP.outlet, ST_LP.inlet) 
          annotation (points=[18,20; 18,-4.2; 17,-4.2],  style(thickness=2));
        connect(flowHPJoin.in2, ST_HP.outlet) annotation (points=[-18.4,19.6;
              -18.4,24; -36.6,24; -36.6,-4],
                                        style(thickness=2));
        connect(byPassLP.inlet,flowLPSplit. out1) annotation (points=[46,58; 46,
              64; 22.52,64; 22.52,72.4], style(thickness=2));
        connect(flowLPSplit.out2, valveLP.inlet) 
          annotation (points=[17.6,72.4; 18,54; 18,40], style(thickness=2));
        connect(flowLPJoin.out, LPT_Out) annotation (points=[63.6,20; 80,20; 80,
              -80; 50,-80; 50,-100],
                                style(thickness=2));
        connect(flowLPJoin.in1, byPassLP.outlet) 
          annotation (points=[56.4,22.4; 46,22.4; 46,38], style(thickness=2));
        connect(flowLPJoin.in2, ST_LP.outlet) 
          annotation (points=[56.4,17.6; 47.4,17.6; 47.4,-4],  style(thickness=2));
        connect(flowLPSplit.in1, IPT_In) 
          annotation (points=[20,79.6; 20,100], style(thickness=2));
        connect(ActuatorsBus.Opening_valveHP, valveHP.theta) annotation (points=[98,-72;
              -88,-72; -88,30; -74,30],         style(color=52, rgbcolor={213,
                255,170}));
        connect(ActuatorsBus.Opening_valveLP, valveLP.theta) annotation (points=[98,-72;
              0,-72; 0,30; 10,30],        style(color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.Opening_byPassHP, byPassHP.theta) annotation (
            points=[98,-72; -88,-72; -88,48; -44,48], style(color=52, rgbcolor=
                {213,255,170}));
        connect(ActuatorsBus.Opening_byPassLP, byPassLP.theta) annotation (
            points=[98,-72; 0,-72; 0,48; 38,48], style(color=52, rgbcolor={213,
                255,170}));
        connect(byPassHP.inlet, flowHPSplit1.out1) annotation (points=[-36,58;
              -36,66; -58,66; -58,74.4; -57.48,74.4], style(thickness=2));
        connect(mixLP.in2, flowHPJoin.out) annotation (points=[-25.26,-42.4;
              -16,-42.4; -16,12.4],
                                style(thickness=2));
        connect(SteamForHU, flowHUSplit.out2) annotation (points=[-50,-100; -50,
              -65.6; -50.4,-65.6], style(thickness=2));
        connect(flowHUSplit.in1, mixLP.out) annotation (points=[-48,-58.4; -48,
              -46; -36,-46], style(thickness=2));
        connect(flowHUSplit.out1, HPT_Out) annotation (points=[-45.48,-65.6;
              -45.48,-80; -6,-80; -6,60; -30,60; -30,100], style(thickness=2));
      end ST_2LRhHU;
      
      model CondPlant "Condensation Plant" 
        extends Interfaces.CondPlant;
        replaceable Components.Condenser condenser(
          redeclare package FluidMedium = FluidMedium,
          N_cool=N_cool,
          condNomFlowRate=condNomFlowRate,
          coolNomFlowRate=coolNomFlowRate,
          condNomPressure=condNomPressure,
          coolNomPressure=coolNomPressure,
          condExchSurface=condExchSurface,
          coolExchSurface=coolExchSurface,
          condVol=condVol,
          coolVol=coolVol,
          metalVol=metalVol,
          cm=cm,
          rhoMetal=rhoMetal,
          use_T=use_T,
          SSInit=SSInit,
          pstart_cond=pstart_cond,
          Tstart_M_in=Tstart_M_in,
          Tstart_M_out=Tstart_M_out,
          Tstart_cool_in=Tstart_cool_in,
          Tstart_cool_out=Tstart_cool_out,
          hstart_cool_in=hstart_cool_in,
          hstart_cool_out=hstart_cool_out)       extends Interfaces.Condenser(
          redeclare package FluidMedium = FluidMedium,
          N_cool=N_cool,
          condNomFlowRate=condNomFlowRate,
          coolNomFlowRate=coolNomFlowRate,
          condNomPressure=condNomPressure,
          coolNomPressure=coolNomPressure,
          condExchSurface=condExchSurface,
          coolExchSurface=coolExchSurface,
          condVol=condVol,
          coolVol=coolVol,
          metalVol=metalVol,
          cm=cm,
          rhoMetal=rhoMetal,
          use_T=use_T,
          SSInit=SSInit,
          pstart_cond=pstart_cond,
          Tstart_M_in=Tstart_M_in,
          Tstart_M_out=Tstart_M_out,
          Tstart_cool_in=Tstart_cool_in,
          Tstart_cool_out=Tstart_cool_out,
          hstart_cool_in=hstart_cool_in,
          hstart_cool_out=hstart_cool_out) 
                                       annotation (extent=[-16,-22; 24,18]);
        annotation (Diagram);
        Water.SourceW coolingIn(redeclare package Medium = FluidMedium,
          p0=coolNomPressure,
          w0=coolNomFlowRate,
          h=hstart_cool_in)   annotation (extent=[90,-24; 70,-4]);
        Water.SinkP coolingOut(redeclare package Medium = FluidMedium,
          p0=coolNomPressure,
          h=hstart_cool_out) 
                          annotation (extent=[70,30; 90,50]);
        Components.StateReader stateCoolingOut(redeclare package Medium = 
              FluidMedium) annotation (extent=[40,30; 60,50]);
        Components.StateReader stateCoolingIn(redeclare package Medium = 
              FluidMedium) annotation (extent=[40,-24; 60,-4], rotation=180);
        Modelica.Blocks.Interfaces.RealOutput ratio_VvonVtot 
          annotation (extent=[-116,-10; -96,10], rotation=180);
      equation 
        connect(condenser.steamIn, SteamIn) 
          annotation (points=[0,14; 0,100], style(thickness=2));
        connect(condenser.waterOut, WaterOut) 
          annotation (points=[0,-18; 0,-100], style(thickness=2));
        connect(stateCoolingOut.outlet, coolingOut.flange) annotation (points=[
              56,40; 70,40], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(stateCoolingOut.inlet, condenser.coolingOut) annotation (points=
             [44,40; 34,40; 34,8; 20,8], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(stateCoolingIn.inlet, coolingIn.flange) annotation (points=[56,
              -14; 70,-14], style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(stateCoolingIn.outlet, condenser.coolingIn) annotation (points=[44,-14;
              34,-14; 34,-7.6; 20,-7.6],          style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(condenser.ratio_VvonVtot, ratio_VvonVtot) annotation (points=[
              -14,0; -106,0], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
      end CondPlant;
      
      model CondPlantHU "Condensation Plant with coupling Heat Usage" 
        extends Interfaces.CondPlantHU;
        parameter SI.Volume mixCondenser_V "Internal volume of the mixer";
        parameter SI.Enthalpy mixCondenser_hstart=1e5 "Enthalpy start value" 
          annotation (Dialog(tab="Initialization"));
        parameter SI.Pressure mixCondenser_pstart=1e5 "Pressure start value" 
          annotation (Dialog(tab="Initialization"));
        
        annotation (Diagram);
        Water.Mixer mixCondenser(
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          V=mixCondenser_V,
          pstart=mixCondenser_pstart,
          hstart=mixCondenser_hstart) 
                          annotation (extent=[-54,-36; -34,-16], rotation=270);
        
      equation 
        connect(mixCondenser.in2, SteamToHU) 
                                      annotation (points=[-50,-18.1; -50,100],
            style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(WaterOut, mixCondenser.out) annotation (points=[0,-100; 0,-60;
              -44,-60; -44,-36], style(thickness=2));
      end CondPlantHU;
      
      model CondPlant_cc 
        "Condensation plant with condenser ratio control (type ImpPressureCondenser_tap)" 
        extends Interfaces.CondPlant_base;
        parameter Real setPoint_ratio 
          "SetPoint ratio Steam Volume / Total Volume";
        
        Components.StateReader stateTapping(redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-40,-36; -8,-4],  rotation=0);
        Control.PID pID(
          PVmax=1,
          PVmin=0.1,
          CSmin=-0.6,
          CSmax=0.6,
          Ti=2000,
          Kp=-3)      annotation (extent=[-42,30; -68,56], rotation=0);
        Modelica.Blocks.Sources.Constant setPoint(k=setPoint_ratio) 
                    annotation (extent=[-6,42; -18,54]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP_tap 
          condenserIdeal_tap(                            redeclare package 
            Medium = FluidMedium,
          p=p,
          Vtot=Vtot,
          Vlstart=Vlstart)                  annotation (extent=[0,-36; 80,44]);
        Water.SourceW sourceTap(
          redeclare package Medium = FluidMedium,
          p0=p)       annotation (extent=[-96,-36; -60,-4]);
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.Comp_bubble_h 
          BubbleEnthalpy(redeclare package FluidMedium = FluidMedium, p=p) 
                                annotation (extent=[-30,-8; -66,12]);
      equation 
        
        connect(setPoint.y, pID.SP) 
                                 annotation (points=[-18.6,48; -42,48; -42,48.2],
                             style(color=74, rgbcolor={0,0,127}));
        connect(pID.CS,sourceTap. in_w0) annotation (points=[-68.78,43; -85.2,
              43; -85.2,-10.4],                         style(color=74,
              rgbcolor={0,0,127}));
        connect(pID.PV,condenserIdeal_tap. ratio_Vv_Vtot) annotation (points=[-42,37.8;
              -28,37.8; -28,-4; 12,-4],                        style(color=74,
              rgbcolor={0,0,127}));
        connect(condenserIdeal_tap.steamIn, SteamIn) 
          annotation (points=[40,36; 40,64; 0,64; 0,100], style(thickness=2));
        connect(condenserIdeal_tap.waterOut, WaterOut) annotation (points=[40,-28;
              40,-52; 0,-52; 0,-100],     style(thickness=2));
        connect(BubbleEnthalpy.h, sourceTap.in_h)                  annotation (
            points=[-64.2,2; -70.8,2; -70.8,-10.4],           style(color=74,
              rgbcolor={0,0,127}));
        connect(SensorsBus.Cond_ratio, condenserIdeal_tap.ratio_Vv_Vtot) 
          annotation (points=[98,-40; -4,-40; -4,-4; 12,-4], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.Cond_Q, condenserIdeal_tap.Qcond) annotation (points=
             [98,-40; -4,-40; -4,20; 12,20], style(color=84, rgbcolor={255,170,
                213}));
        connect(stateTapping.outlet, condenserIdeal_tap.tapWater) 
          annotation (points=[-14.4,-20; 16,-20], style(thickness=2));
        connect(stateTapping.inlet, sourceTap.flange) 
          annotation (points=[-33.6,-20; -60,-20], style(thickness=2));
      end CondPlant_cc;
      
      model CondPlantHU_cc 
        "Condensation plant with condenser ratio control (type ImpPressureCondenser_tap) and coupling Heat Usage" 
        extends Interfaces.CondPlantHU_base;
        parameter SI.Volume mixCondenser_V "Internal volume of the mixer";
        parameter SI.Enthalpy mixCondenser_hstart=1e5 "Enthalpy start value";
        parameter SI.Pressure mixCondenser_pstart=1e5 "Pressure start value";
        
        CondPlant_cc condPlant_cc annotation (extent=[20,0; 80,60]);
        annotation (Diagram);
        Water.Mixer mixCondenser(
          initOpt=if SSInit then Options.steadyState else Options.noInit,
          redeclare package Medium = FluidMedium,
          V=mixCondenser_V,
          pstart=mixCondenser_pstart,
          hstart=mixCondenser_hstart) 
                          annotation (extent=[-10,-60; 10,-40],  rotation=270);
      equation 
        connect(condPlant_cc.SteamIn, SteamIn) 
          annotation (points=[50,60; 50,100], style(thickness=2));
        connect(WaterOut, mixCondenser.out) annotation (points=[0,-100; 0,-60;
              -1.83691e-015,-60], style(thickness=2));
        connect(mixCondenser.in1, condPlant_cc.WaterOut) 
          annotation (points=[6,-42; 6,-20; 50,-20; 50,0], style(thickness=2));
        connect(mixCondenser.in2, SteamToHU) annotation (points=[-6,-42.1; -6,
              -20; -48,-20; -48,100], style(thickness=2));
        connect(SensorsBus, condPlant_cc.SensorsBus) annotation (points=[98,-40;
              80,-40; 80,-20; 96,-20; 96,18; 79.4,18], style(color=84, rgbcolor=
               {255,170,213}));
        connect(ActuatorsBus, condPlant_cc.ActuatorsBus) annotation (points=[98,-72;
              72,-72; 72,-12; 88,-12; 88,8.4; 79.4,8.4],      style(color=52,
              rgbcolor={213,255,170}));
      end CondPlantHU_cc;
      
      model STG_3LRh "Steam turbine group (three pressure levels, reheat)" 
        extends Interfaces.STGroup3LRh;
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[14,-78; 34,-58], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          HPT_hstart_in=3.47e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          HPT_hstart_out=3.10745e6,
          IPT_hstart_in=3.54348e6,
          IPT_hstart_out=3.12011e6,
          LPT_hstart_in=3.11911e6,
          LPT_hstart_out=2.39102e6,
          mixLP_hstart=3.11911e6,
          mixLP_V=5,
          mixIP_V=5,
          steamIPNomFlowRate=81.3524 - 67.6,
          steamLPNomFlowRate=89.438 - 81.3524) 
                       annotation (extent=[-48,-40; 32,40]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
          condenserIdeal(redeclare package Medium = FluidMedium, p=5389.2) 
          annotation (extent=[40,-90; 60,-70], rotation=90);
      equation 
        connect(steamTurbines.Shaft_b, Shaft_b) annotation (points=[32,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.Shaft_a, Shaft_a) annotation (points=[-48,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.IPT_In, From_RH_IP) annotation (points=[-12,40;
              -12,80; -20,80; -20,100], style(thickness=2));
        connect(steamTurbines.LPT_In, From_SH_LP) annotation (points=[12,40; 12,
              60; 40,60; 40,100], style(thickness=2));
        connect(steamTurbines.SteamToMix, From_SH_IP) 
          annotation (points=[0,40; 0,80; 10,80; 10,100], style(thickness=2));
        connect(steamTurbines.HPT_Out, To_RH_IP) annotation (points=[-24,40;
              -24,72; -50,72; -50,100], style(thickness=2));
        connect(steamTurbines.HPT_In, From_SH_HP) annotation (points=[-36,40;
              -36,60; -80,60; -80,100], style(thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[24,-62; 24,-40], style(thickness=2));
        connect(condenserIdeal.steamIn, stateLPTout.outlet) 
          annotation (points=[42,-80; 24,-80; 24,-74], style(thickness=2));
        connect(condenserIdeal.waterOut, WaterOut) 
          annotation (points=[58,-80; 80,-80; 80,100], style(thickness=2));
        connect(SensorsBus.ratioVvVtot, condenserIdeal.ratio_Vv_Vtot) 
          annotation (points=[98,-40; 72,-40; 72,-94; 52,-94; 52,-87], style(
              color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.Qout_condenser, condenserIdeal.Qcond) annotation (
            points=[98,-40; 72,-40; 72,-94; 46,-94; 46,-87], style(color=84,
              rgbcolor={255,170,213}));
      end STG_3LRh;
      
      model STG_3LRh_valve 
        "Steam turbine group (three pressure levels, reheat) with inlet valves" 
        extends Interfaces.STGroup3LRh;
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[16,-78; 36,-58], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_valve 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomFlowRate=81.10 - 67.5,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          steamLPNomFlowRate=89.82 - 81.10,
          HPT_hstart_in=3.47e6,
          HPT_hstart_out=3.1076e6,
          IPT_hstart_in=3.554e6,
          IPT_hstart_out=3.12810e6,
          LPT_hstart_in=3.109e6,
          LPT_hstart_out=2.3854e6,
          valveHP_dpnom=1.6e5,
          valveIP_dpnom=5e4,
          mixLP_hstart=3.109e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          mixLP_V=20,
          mixIP_V=20,
          valveHP_Cv=1165,
          valveIP_Cv=5625,
          valveLP_Cv=14733,
          valveLP_dpnom=2.964e4,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004) 
                       annotation (extent=[-64,-50; 36,50]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
          condenserIdeal(                        p=5398.2,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[36,-96; 60,-72], rotation=90);
      equation 
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[26,-62; 26,-50], style(thickness=2));
        connect(steamTurbines.LPT_In, From_SH_LP) annotation (points=[11,50; 11,70;
              40,70; 40,100], style(thickness=2));
        connect(steamTurbines.SteamToMix, From_SH_IP) annotation (points=[-4,50;
              -4,80; 10,80; 10,100], style(thickness=2));
        connect(steamTurbines.IPT_In, From_RH_IP) annotation (points=[-19,50;
              -19,77; -20,77; -20,100], style(thickness=2));
        connect(steamTurbines.HPT_Out, To_RH_IP) annotation (points=[-34,50;
              -34,80; -50,80; -50,100], style(thickness=2));
        connect(steamTurbines.HPT_In, From_SH_HP) annotation (points=[-49,50;
              -49,70; -80,70; -80,100], style(thickness=2));
        connect(steamTurbines.Shaft_a, Shaft_a) annotation (points=[-64,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.Shaft_b, Shaft_b) annotation (points=[36,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(ActuatorsBus, steamTurbines.ActuatorsBus) annotation (points=[98,-72;
              60,-72; 60,-36; 35,-36],         style(color=52, rgbcolor={213,
                255,170}));
        connect(condenserIdeal.waterOut, WaterOut) 
          annotation (points=[57.6,-84; 80,-84; 80,100], style(thickness=2));
        connect(SensorsBus.ratioVvVtot, condenserIdeal.ratio_Vv_Vtot) annotation (
            points=[98,-40; 66,-40; 66,-98; 50.4,-98; 50.4,-92.4],   style(
              color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.Qout_condenser, condenserIdeal.Qcond) annotation (
            points=[98,-40; 66,-40; 66,-98; 43.2,-98; 43.2,-92.4],   style(
              color=84, rgbcolor={255,170,213}));
        connect(condenserIdeal.steamIn, stateLPTout.outlet) 
          annotation (points=[38.4,-84; 26,-84; 26,-74], style(thickness=2));
      end STG_3LRh_valve;
      
      model STG_3LRh_cc 
        "Steam turbine group (three pressure levels, reheat) and controlled condenser" 
        extends Interfaces.STGroup3LRh;
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[14,-78; 34,-58], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          HPT_hstart_in=3.47e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          HPT_hstart_out=3.10745e6,
          IPT_hstart_in=3.54348e6,
          IPT_hstart_out=3.12011e6,
          LPT_hstart_in=3.11911e6,
          LPT_hstart_out=2.39102e6,
          mixLP_hstart=3.11911e6,
          mixLP_V=5,
          mixIP_V=5,
          steamIPNomFlowRate=81.3524 - 67.6,
          steamLPNomFlowRate=89.438 - 81.3524) 
                       annotation (extent=[-48,-40; 32,40]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.CondPlant_cc 
          controlledCondeser(
          redeclare package FluidMedium = FluidMedium,
          p=5398.2,
          Vtot=10,
          Vlstart=1.5,
          setPoint_ratio=0.85) annotation (extent=[40,-94; 60,-74], rotation=90);
      equation 
        connect(steamTurbines.Shaft_b, Shaft_b) annotation (points=[32,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.Shaft_a, Shaft_a) annotation (points=[-48,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.IPT_In, From_RH_IP) annotation (points=[-12,40;
              -12,80; -20,80; -20,100], style(thickness=2));
        connect(steamTurbines.LPT_In, From_SH_LP) annotation (points=[12,40; 12,
              60; 40,60; 40,100], style(thickness=2));
        connect(steamTurbines.SteamToMix, From_SH_IP) 
          annotation (points=[0,40; 0,80; 10,80; 10,100], style(thickness=2));
        connect(steamTurbines.HPT_Out, To_RH_IP) annotation (points=[-24,40;
              -24,72; -50,72; -50,100], style(thickness=2));
        connect(steamTurbines.HPT_In, From_SH_HP) annotation (points=[-36,40;
              -36,60; -80,60; -80,100], style(thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[24,-62; 24,-40], style(thickness=2));
        connect(controlledCondeser.SteamIn, stateLPTout.outlet) 
          annotation (points=[40,-84; 24,-84; 24,-74], style(thickness=2));
        connect(controlledCondeser.WaterOut, WaterOut) 
          annotation (points=[60,-84; 80,-84; 80,100], style(thickness=2));
      end STG_3LRh_cc;
      
      model STG_3LRh_valve_cc 
        "Steam turbine group (three pressure levels, reheat) with inlet valves and controlled condenser" 
        extends Interfaces.STGroup3LRh;
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[14,-78; 34,-58], rotation=270);
        ST3LRh_valve steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          HPT_hstart_in=3.47e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          HPT_hstart_out=3.10745e6,
          IPT_hstart_in=3.54348e6,
          IPT_hstart_out=3.12011e6,
          LPT_hstart_in=3.11911e6,
          LPT_hstart_out=2.39102e6,
          mixLP_hstart=3.11911e6,
          mixLP_V=5,
          mixIP_V=5,
          steamIPNomFlowRate=81.3524 - 67.6,
          steamLPNomFlowRate=89.438 - 81.3524,
          valveHP_Cv=1165,
          valveHP_dpnom=1.6e5,
          valveIP_Cv=5625,
          valveIP_dpnom=5e4,
          valveLP_Cv=14733,
          valveLP_dpnom=2.964e4) 
                       annotation (extent=[-48,-40; 32,40]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.CondPlant_cc 
          controlledCondeser(
          redeclare package FluidMedium = FluidMedium,
          p=5398.2,
          Vtot=10,
          Vlstart=1.5,
          setPoint_ratio=0.85) annotation (extent=[40,-94; 60,-74], rotation=90);
      equation 
        connect(steamTurbines.Shaft_b, Shaft_b) annotation (points=[32,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.Shaft_a, Shaft_a) annotation (points=[-48,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.IPT_In, From_RH_IP) annotation (points=[-12,40;
              -12,80; -20,80; -20,100], style(thickness=2));
        connect(steamTurbines.LPT_In, From_SH_LP) annotation (points=[12,40; 12,
              60; 40,60; 40,100], style(thickness=2));
        connect(steamTurbines.SteamToMix, From_SH_IP) 
          annotation (points=[0,40; 0,80; 10,80; 10,100], style(thickness=2));
        connect(steamTurbines.HPT_Out, To_RH_IP) annotation (points=[-24,40;
              -24,72; -50,72; -50,100], style(thickness=2));
        connect(steamTurbines.HPT_In, From_SH_HP) annotation (points=[-36,40;
              -36,60; -80,60; -80,100], style(thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[24,-62; 24,-40], style(thickness=2));
        connect(controlledCondeser.SteamIn, stateLPTout.outlet) 
          annotation (points=[40,-84; 24,-84; 24,-74], style(thickness=2));
        connect(controlledCondeser.WaterOut, WaterOut) 
          annotation (points=[60,-84; 80,-84; 80,100], style(thickness=2));
        connect(ActuatorsBus, steamTurbines.ActuatorsBus) annotation (points=[98,-72;
              64,-72; 64,-28.8; 31.2,-28.8],      style(color=52, rgbcolor={213,
                255,170}));
      end STG_3LRh_valve_cc;
      
      model STG_3LRh_bypass_cc 
        "Steam turbine group (three pressure levels, reheat) with inlet and bypass valves and controlled condenser" 
        extends Interfaces.STGroup3LRh;
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[26,-90; 46,-70], rotation=0,
          style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        ST3LRh_bypass steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          HPT_hstart_in=3.47e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          HPT_hstart_out=3.10745e6,
          IPT_hstart_in=3.54348e6,
          IPT_hstart_out=3.12011e6,
          LPT_hstart_in=3.11911e6,
          LPT_hstart_out=2.39102e6,
          mixLP_hstart=3.11911e6,
          mixLP_V=5,
          mixIP_V=5,
          steamIPNomFlowRate=81.3524 - 67.6,
          steamLPNomFlowRate=89.438 - 81.3524,
          valveHP_Cv=1165,
          valveHP_dpnom=1.6e5,
          valveIP_Cv=5625,
          valveIP_dpnom=5e4,
          valveLP_Cv=14733,
          valveLP_dpnom=2.964e4,
          bypassHP_Cv=272,
          bypassIP_Cv=1595,
          bypassLP_Cv=7540) 
                       annotation (extent=[-74,-40; 6,40]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.CondPlant_cc 
          controlledCondeser(
          redeclare package FluidMedium = FluidMedium,
          p=5398.2,
          Vtot=10,
          Vlstart=1.5,
          setPoint_ratio=0.85) annotation (extent=[60,20; 100,60],  rotation=180);
      equation 
        connect(steamTurbines.Shaft_b, Shaft_b) annotation (points=[6,0; 100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.Shaft_a, Shaft_a) annotation (points=[-74,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(steamTurbines.IPT_In, From_RH_IP) annotation (points=[-38,40;
              -38,80; -20,80; -20,100], style(thickness=2));
        connect(steamTurbines.LPT_In, From_SH_LP) annotation (points=[-14,40;
              -14,60; 40,60; 40,100],
                                  style(thickness=2));
        connect(steamTurbines.SteamToMix, From_SH_IP) 
          annotation (points=[-26,40; -26,70; 10,70; 10,100],
                                                          style(thickness=2));
        connect(steamTurbines.HPT_Out, To_RH_IP) annotation (points=[-50,40;
              -50,100],                 style(thickness=2));
        connect(steamTurbines.HPT_In, From_SH_HP) annotation (points=[-62,40;
              -62,60; -80,60; -80,100], style(thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[30,-80; -2,-80; -2,-40],
                                               style(thickness=2));
        connect(ActuatorsBus, controlledCondeser.ActuatorsBus) annotation (
            points=[98,-72; 48,-72; 48,54.4; 60.4,54.4], style(color=52,
              rgbcolor={213,255,170}));
        connect(ActuatorsBus, steamTurbines.ActuatorsBus) annotation (points=[98,-72;
              48,-72; 48,-28.8; 5.2,-28.8],         style(color=52, rgbcolor={
                213,255,170}));
        connect(SensorsBus, steamTurbines.SensorsBus) annotation (points=[98,-40;
              52,-40; 52,-16; 5.2,-16],      style(color=84, rgbcolor={255,170,
                213}));
        connect(SensorsBus, controlledCondeser.SensorsBus) annotation (points=[
              98,-40; 52,-40; 52,48; 60.4,48], style(color=84, rgbcolor={255,
                170,213}));
        connect(stateLPTout.outlet, controlledCondeser.SteamIn) 
          annotation (points=[42,-80; 80,-80; 80,20], style(thickness=2));
        connect(controlledCondeser.WaterOut, WaterOut) 
          annotation (points=[80,60; 80,100], style(thickness=2));
      end STG_3LRh_bypass_cc;
    end Examples;
    
    package Tests 
      model computation_states 
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        parameter SI.SpecificEnthalpy h=2.39102e6 "value of specific enthalpy";
        parameter SI.Pressure p=2e5 "value of pressure";
        parameter SI.Temperature T=288 "value of temperature";
        
        SI.Temperature Tf "Temperature (p,h)";
        SI.SpecificEnthalpy hf "Specific enthalpy (p,T)";
        SI.Temperature Ts "Saturation temperature (p)";
        SI.SpecificEnthalpy hv "Dew specific enthalpy (p)";
        SI.SpecificEnthalpy hl "Bubble specific enthalpy (p)";
        SI.Density rhov "Dew density (p)";
        SI.Density rhol "Bubble density (p)";
        FluidMedium.SaturationProperties sat "Saturation properties";
        
      equation 
        sat.psat = p;
        sat.Tsat = FluidMedium.saturationTemperature(p);
        
        Ts = sat.Tsat;
        hl=FluidMedium.bubbleEnthalpy(sat);
        hv=FluidMedium.dewEnthalpy(sat);
        Tf=FluidMedium.temperature_ph(p,h);
        hf=FluidMedium.specificEnthalpy_pT(p,T);
        rhov=FluidMedium.density_ph(p,h);
        rhol=FluidMedium.bubbleDensity(sat);
      end computation_states;
      
      model TestPump 
        
      public 
        Components.PrescribedSpeedPump prescribedSpeedPump(
          rho_nom=1000,
          n0=1500,
          nominalCondensationPressure=5.3982e3,
          nominalSteamFlow=89.8,
          nominalSteamPressure=7.19e5,
          redeclare package WaterMedium = Water.StandardWater,
          dh=2.44e5 - 1.43495e5,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0},
          hstart=1.43495e5)     annotation (extent=[12,10; -8,-10],  rotation=
              180);
      public 
        Modelica.Blocks.Sources.Constant n_pump(k=1500) 
          annotation (extent=[10,30; 0,40]);
        Water.SourceP sourceHPT(p0=5398.2, h=1.43495e5) 
          annotation (extent=[-58,-6; -46,6],  rotation=0);
        Water.SinkP sinkLPT(p0=719e3, h=2.44e5) 
                           annotation (extent=[48,-6; 60,6],    rotation=0);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateRedearIn 
          annotation (extent=[-36,-10; -16,10]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateRedearOut 
          annotation (extent=[22,-10; 42,10]);
        annotation (Diagram);
      equation 
        connect(n_pump.y,prescribedSpeedPump. pumpSpeed_rpm) annotation (points=[-0.5,35;
              -20,35; -20,6; -8.8,6],          style(color=74, rgbcolor={0,0,
                127}));
        connect(stateRedearOut.outlet, sinkLPT.flange) 
          annotation (points=[38,0; 48,0], style(thickness=2));
        connect(stateRedearOut.inlet, prescribedSpeedPump.outlet) 
          annotation (points=[26,0; 19,0; 19,-1.22461e-015; 12,-1.22461e-015],
            style(thickness=2));
        connect(prescribedSpeedPump.inlet, stateRedearIn.outlet) annotation (
            points=[-8,1.22461e-015; -20,1.22461e-015; -20,0], style(thickness=
                2));
        connect(stateRedearIn.inlet, sourceHPT.flange) 
          annotation (points=[-32,0; -46,0], style(thickness=2));
      end TestPump;
      
      model TestSettingTurbineHP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-40,-40; 20,20]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[30,60; 50,80]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[70,-20; 50,0]);
        Water.SourceP sourceP(h=3.47e6, p0=1.28e7) 
          annotation (extent=[-80,60; -60,80]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              13.1,70; 13.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[50,-10; 9.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(sourceP.flange, steamTurbineStodola.inlet) annotation (points=[
              -60,70; -32.5,70; -32.5,13.7], style(thickness=2));
      end TestSettingTurbineHP;
      
      model TestSettingTurbineIP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=2.68e6,
          pstart_out=6e5,
          wstart=81.10,
          hstartin=3.554e6,
          hstartout=3.1281e6,
          wnom=81.10,
          eta_iso_nom=0.903,
          Kt=0.018883)     annotation (extent=[-40,-40; 20,20]);
        Water.SinkP sinkP(p0=6e5, h=3.1281e6) 
          annotation (extent=[30,60; 50,80]);
        Water.SourceP sourceP(            h=3.554e6, p0=2.68e6) 
          annotation (extent=[-80,60; -60,80]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[70,-20; 50,0]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              13.1,70; 13.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(sourceP.flange, steamTurbineStodola.inlet) annotation (points=[
              -60,70; -32.5,70; -32.5,13.7], style(thickness=2));
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[50,-10; 9.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestSettingTurbineIP;
      
      model TestSettingTurbineLP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=6e5,
          pstart_out=5.3982e3,
          wstart=89.82,
          hstartin=3.109e6,
          hstartout=2.3854e6,
          wnom=89.82,
          eta_iso_nom=0.903,
          Kt=0.078004)     annotation (extent=[-42,-40; 18,20]);
        Water.SinkP sinkP(p0=5.3982e3, h=2.3854e6) 
          annotation (extent=[30,60; 50,80]);
        Water.SourceP sourceP(        h=3.109e6, p0=6e5) 
          annotation (extent=[-80,60; -60,80]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[80,-20; 60,0]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              11.1,70; 11.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(sourceP.flange, steamTurbineStodola.inlet) annotation (points=[
              -60,70; -34.5,70; -34.5,13.7], style(thickness=2));
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[60,-10; 7.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestSettingTurbineLP;
      
      model TestValveTurbineHP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-42,-40; 18,20]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[30,60; 50,80]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-24,58; -44,38],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-80,60; -60,80]);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP(k=0.7) 
          annotation (extent=[4,38; -16,58]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[80,-20; 60,0]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              11.1,70; 11.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(valveHP.outlet, steamTurbineStodola.inlet) annotation (points=[-34,38;
              -34,13.7; -34.5,13.7],         style(thickness=2));
        connect(sourceP.flange, valveHP.inlet) 
          annotation (points=[-60,70; -34,70; -34,58], style(thickness=2));
        connect(com_valveHP.y, valveHP.theta) annotation (points=[-17,48; -26,
              48],
            style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[60,-10; 7.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestValveTurbineHP;
      
      model TestValveTurbineIP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=2.68e6,
          pstart_out=6e5,
          wstart=81.10,
          hstartin=3.554e6,
          hstartout=3.1281e6,
          wnom=81.10,
          eta_iso_nom=0.903,
          Kt=0.018883)     annotation (extent=[-42,-40; 18,20]);
        Water.SinkP sinkP(p0=6e5, h=3.1281e6) 
          annotation (extent=[30,60; 50,80]);
        Water.ValveVap valveIP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=81.1,
          hstart=3.554e6,
          dpnom=5e4,
          pnom=2.73e6,
          Cv=5625)             annotation (extent=[-24,60; -44,40],rotation=90);
        Water.SourceP sourceP(            h=3.554e6, p0=2.73e6) 
          annotation (extent=[-80,60; -60,80]);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP 
          annotation (extent=[4,40; -16,60]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[74,-20; 54,0]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              11.1,70; 11.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(valveIP.outlet, steamTurbineStodola.inlet) annotation (points=[-34,40;
              -34,13.7; -34.5,13.7],         style(thickness=2));
        connect(sourceP.flange,valveIP. inlet) 
          annotation (points=[-60,70; -34,70; -34,60], style(thickness=2));
        connect(com_valveHP.y, valveIP.theta) 
                                           annotation (points=[-17,50; -26,50],
            style(color=74, rgbcolor={0,0,127}));
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[54,-10; 7.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestValveTurbineIP;
      
      model TestValveTurbineLP 
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=6e5,
          pstart_out=5.3982e3,
          wstart=89.82,
          hstartin=3.109e6,
          hstartout=2.3854e6,
          wnom=89.82,
          eta_iso_nom=0.903,
          Kt=0.078004)     annotation (extent=[-42,-40; 18,20]);
        Water.SinkP sinkP(p0=5.3982e3, h=2.3854e6) 
          annotation (extent=[30,60; 50,80]);
        Water.ValveVap valveLP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=89.82,
          hstart=3.109e6,
          pnom=6.296e5,
          dpnom=2.964e4,
          Cv=14733)            annotation (extent=[-24,60; -44,40],rotation=90);
        Water.SourceP sourceP(        h=3.109e6, p0=6.296e5) 
          annotation (extent=[-80,60; -60,80]);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP 
          annotation (extent=[4,40; -16,60]);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
                      annotation (extent=[70,-20; 50,0]);
      equation 
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[30,70;
              11.1,70; 11.1,14],               style(thickness=2));
        annotation (Diagram);
        connect(valveLP.inlet, sourceP.flange) annotation (points=[-34,60; -34,
              70; -60,70], style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(valveLP.outlet, steamTurbineStodola.inlet) annotation (points=[-34,40;
              -34,13.7; -34.5,13.7],         style(
            thickness=2,
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(com_valveHP.y, valveLP.theta) annotation (points=[-17,50; -26,
              50], style(
            color=74,
            rgbcolor={0,0,127},
            fillColor=30,
            rgbfillColor={230,230,230},
            fillPattern=1));
        connect(constantSpeed.flange, steamTurbineStodola.shaft_b) annotation (
            points=[50,-10; 7.2,-10],                             style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestValveTurbineLP;
      
      model TestTurbineHPefficiency 
        
        Components.SteamTurbineVarEta steamTurbineVarEta(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078,
          n=20,
          Rm=0.936)   annotation (extent=[-58,-88; 2,-28]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[14,12; 34,32]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-40,12; -60,-8],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-96,12; -76,32]);
        annotation (Diagram);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP(
          offset=1,
          height=-0.9,
          duration=50,
          startTime=1000) 
          annotation (extent=[14,74; -6,94]);
        Components.ConstantSpeed constantSpeed 
          annotation (extent=[54,-68; 34,-48]);
      public 
        Modelica.Blocks.Sources.Ramp rif_velocity(
          height=-70,
          offset=314.16/2,
          duration=50,
          startTime=10) 
          annotation (extent=[100,36; 80,56]);
        Modelica.Blocks.Math.Add add 
          annotation (extent=[-36,54; -24,66], rotation=180);
        Modelica.Blocks.Math.Add add1 
          annotation (extent=[60,2; 72,14], rotation=180);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP1(
          offset=0,
          height=0.2,
          duration=50,
          startTime=80000) 
          annotation (extent=[14,40; -6,60]);
      public 
        Modelica.Blocks.Sources.Ramp rif_velocity1(
          height=30,
          offset=0,
          duration=50,
          startTime=80) 
          annotation (extent=[100,-40; 80,-20]);
      equation 
        connect(sinkP.flange, steamTurbineVarEta.outlet)  annotation (points=[14,22;
              -4.9,22; -4.9,-34],              style(thickness=2));
        connect(valveHP.outlet, steamTurbineVarEta.inlet)  annotation (points=[-50,-8;
              -50,-34.3; -50.5,-34.3],       style(thickness=2));
        connect(sourceP.flange, valveHP.inlet) 
          annotation (points=[-76,22; -50,22; -50,12], style(thickness=2));
        connect(constantSpeed.flange, steamTurbineVarEta.shaft_b)  annotation (
            points=[34,-58; -8.8,-58],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(com_valveHP1.y, add.u1) annotation (points=[-7,50; -14,50; -14,
              56.4; -22.8,56.4], style(color=74, rgbcolor={0,0,127}));
        connect(com_valveHP.y, add.u2) annotation (points=[-7,84; -14,84; -14,
              64; -22,64; -22.8,63.6], style(color=74, rgbcolor={0,0,127}));
        connect(add.y, valveHP.theta) annotation (points=[-36.6,60; -48,60; -48,
              28; -24,28; -24,2; -42,2], style(color=74, rgbcolor={0,0,127}));
        connect(rif_velocity.y, add1.u2) annotation (points=[79,46; 70,46; 70,
              24; 88,24; 88,11.6; 73.2,11.6], style(color=74, rgbcolor={0,0,127}));
        connect(rif_velocity1.y, add1.u1) annotation (points=[79,-30; 70,-30;
              70,-8; 88,-8; 88,4.4; 73.2,4.4], style(color=74, rgbcolor={0,0,
                127}));
        connect(add1.y, constantSpeed.w_fixed) annotation (points=[59.4,8; 50,8;
              50,-38; 66,-38; 66,-52; 54,-52],   style(color=74, rgbcolor={0,0,
                127}));
      end TestTurbineHPefficiency;
      
      model TestST3LRh_base 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomFlowRate=81.10 - 67.5,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          steamLPNomFlowRate=89.82 - 81.10,
          HPT_hstart_in=3.47e6,
          HPT_hstart_out=3.1076e6,
          IPT_hstart_in=3.554e6,
          IPT_hstart_out=3.12810e6,
          LPT_hstart_in=3.109e6,
          LPT_hstart_out=2.3854e6,
          mixLP_hstart=3.109e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          mixLP_V=10,
          mixIP_V=10)  annotation (extent=[-80,-40; 0,40]);
        annotation (Diagram);
        Water.SinkP sinkLPT(
          redeclare package Medium = FluidMedium,
          p0=5.3982e3,
          h=2.3854e6)      annotation (extent=[4,-66; 16,-54],  rotation=0);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[66,-10; 46,10]);
        Water.SourceP sourceHPT(h=3.47e6, p0=1.28e7) 
          annotation (extent=[-74,54; -62,66], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6e5) 
          annotation (extent=[-26,54; -14,66], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
          annotation (extent=[-38,68; -26,80], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.68e6) 
          annotation (extent=[-44,76; -56,88], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRedear 
          annotation (extent=[-66,54; -46,74], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRedear1 
          annotation (extent=[-54,74; -34,54], rotation=90);
      equation 
        connect(constantSpeed.flange, steamTurbines.Shaft_b) 
                                                           annotation (points=[46,0; 0,
              0],      style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(sinkLPT.flange, steamTurbines.LPT_Out) 
          annotation (points=[4,-60; -8,-60; -8,-40], style(thickness=2));
        connect(steamTurbines.LPT_In, sourceLPT.flange) 
          annotation (points=[-20,40; -20,54], style(thickness=2));
        connect(steamTurbines.HPT_In, sourceHPT.flange) 
          annotation (points=[-68,40; -68,54], style(thickness=2));
        connect(sourceToMix.flange, steamTurbines.SteamToMix) 
          annotation (points=[-32,68; -32,40], style(thickness=2));
        connect(steamTurbines.HPT_Out, stateRedear.inlet) 
          annotation (points=[-56,40; -56,58], style(thickness=2));
        connect(stateRedear1.outlet, steamTurbines.IPT_In) 
          annotation (points=[-44,58; -44,40], style(thickness=2));
        connect(stateRedear.outlet, Rh.in1) annotation (points=[-56,70; -56,82;
              -56.06,82],         style(thickness=2));
        connect(stateRedear1.inlet, Rh.out1) 
          annotation (points=[-44,70; -44,82], style(thickness=2));
      end TestST3LRh_base;
      
      model TestST3LRh_valve 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_valve 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomFlowRate=81.10 - 67.5,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          steamLPNomFlowRate=89.82 - 81.10,
          HPT_hstart_in=3.47e6,
          HPT_hstart_out=3.1076e6,
          IPT_hstart_in=3.554e6,
          IPT_hstart_out=3.12810e6,
          LPT_hstart_in=3.109e6,
          LPT_hstart_out=2.3854e6,
          valveHP_dpnom=1.6e5,
          valveIP_dpnom=5e4,
          mixLP_hstart=3.109e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          mixLP_V=20,
          mixIP_V=20,
          valveHP_Cv=1165,
          valveIP_Cv=5625,
          valveLP_Cv=14733,
          valveLP_dpnom=2.964e4,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004) 
                       annotation (extent=[-80,-40; 0,40]);
        annotation (Diagram);
        Water.SinkP sinkLPT_p(
          redeclare package Medium = FluidMedium,
          p0=5.3982e3,
          h=2.3854e6)      annotation (extent=[-26,-64; -38,-52],
                                                                rotation=0);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[66,30; 46,50]);
      protected 
        Buses.Actuators actuators annotation (extent=[32,-60; 42,-20], rotation=
             180);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP 
          annotation (extent=[92,-10; 72,10]);
      public 
        Modelica.Blocks.Sources.Constant com_valveLP(k=1) 
          annotation (extent=[92,-90; 72,-70]);
        Water.SourceP sourceHPT_p(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-74,54; -62,66], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6.296e5) 
          annotation (extent=[-26,54; -14,66], rotation=270);
        Modelica.Blocks.Sources.Ramp com_valveIP(
          duration=10,
          offset=1,
          startTime=40,
          height=-0.5)  annotation (extent=[92,-50; 72,-30]);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
          annotation (extent=[-38,68; -26,80], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.73e6) 
          annotation (extent=[-44,76; -56,88], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPTout 
          annotation (extent=[-66,54; -46,74], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPTin 
          annotation (extent=[-54,74; -34,54], rotation=90);
      equation 
        connect(actuators, steamTurbines.ActuatorsBus)   annotation (points=[37,-40;
              10,-40; 10,-28.8; -0.8,-28.8],      style(color=52, rgbcolor={213,
                255,170}));
        connect(constantSpeed.flange, steamTurbines.Shaft_b)   annotation (
            points=[46,40; 24,40; 24,0; 0,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(sinkLPT_p.flange, steamTurbines.LPT_Out) 
          annotation (points=[-26,-58; -8,-58; -8,-40], style(thickness=2));
        connect(steamTurbines.LPT_In, sourceLPT.flange) 
          annotation (points=[-20,40; -20,54], style(thickness=2));
        connect(steamTurbines.HPT_In, sourceHPT_p.flange) 
          annotation (points=[-68,40; -68,54], style(thickness=2));
        connect(com_valveHP.y, actuators.Opening_valveHP) annotation (points=[
              71,0; 54,0; 54,-40; 34,-40; 34,-42], style(color=74, rgbcolor={0,
                0,127}));
        connect(com_valveIP.y, actuators.Opening_valveIP) annotation (points=[
              71,-40; 36,-40], style(color=74, rgbcolor={0,0,127}));
        connect(com_valveLP.y, actuators.Opening_valveLP) annotation (points=[
              71,-80; 54,-80; 54,-40; 38,-40], style(color=74, rgbcolor={0,0,
                127}));
        connect(sourceToMix.flange, steamTurbines.SteamToMix) 
          annotation (points=[-32,68; -32,40], style(thickness=2));
        connect(stateIPTin.outlet, steamTurbines.IPT_In) 
          annotation (points=[-44,58; -44,40], style(thickness=2));
        connect(stateHPTout.inlet, steamTurbines.HPT_Out) 
          annotation (points=[-56,58; -56,40], style(thickness=2));
        connect(stateHPTout.outlet, Rh.in1) annotation (points=[-56,70; -56,76;
              -56,82; -56.06,82], style(thickness=2));
        connect(stateIPTin.inlet, Rh.out1) 
          annotation (points=[-44,70; -44,82], style(thickness=2));
      end TestST3LRh_valve;
      
      model TestST3LRh_bypass 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        Examples.ST3LRh_bypass steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomFlowRate=81.10 - 67.5,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          mixLP_V=50,
          mixIP_V=50,
          steamLPNomFlowRate=89.82 - 81.10,
          HPT_hstart_in=3.47e6,
          HPT_hstart_out=3.1076e6,
          IPT_hstart_in=3.554e6,
          IPT_hstart_out=3.12810e6,
          LPT_hstart_in=3.109e6,
          LPT_hstart_out=2.3854e6,
          valveHP_dpnom=1.6e5,
          valveIP_dpnom=5e4,
          valveLP_dpnom=2.64e4,
          mixLP_hstart=3.109e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          valveHP_Cv=1165,
          valveIP_Cv=5625,
          valveLP_Cv=14733,
          bypassHP_Cv=272,
          bypassIP_Cv=1595,
          bypassLP_Cv=7540,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004) 
                       annotation (extent=[-94,-40; -14,40]);
        annotation (Diagram);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[20,-10; 0,10]);
      protected 
        Buses.Actuators actuators annotation (extent=[46,-80; 86,-68], rotation=
             180);
      public 
        Modelica.Blocks.Sources.Constant com_valveHP(k=1) 
          annotation (extent=[96,30; 76,50]);
      public 
        Modelica.Blocks.Sources.Constant com_valveIP(k=1) 
          annotation (extent=[96,-10; 76,10]);
      public 
        Modelica.Blocks.Sources.Constant com_valveLP(k=1) 
          annotation (extent=[96,-50; 76,-30]);
      public 
        Modelica.Blocks.Sources.Constant com_bypassHP(k=0) 
          annotation (extent=[36,30; 56,50]);
      public 
        Modelica.Blocks.Sources.Constant com_bypassIP(k=0) 
          annotation (extent=[36,-10; 56,10]);
      public 
        Modelica.Blocks.Sources.Constant com_bypassLP(k=0) 
          annotation (extent=[36,-50; 56,-30]);
        Water.SinkP sinkLPT_p(
          redeclare package Medium = FluidMedium,
          p0=5.3982e3,
          h=2.3854e6)      annotation (extent=[-34,-66; -46,-54],
                                                                rotation=0);
        Water.SourceP sourceHPT_p(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-88,54; -76,66], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6.296e5) 
          annotation (extent=[-40,54; -28,66], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
          annotation (extent=[-52,68; -40,80], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.73e6) 
          annotation (extent=[-58,76; -70,88], rotation=180);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPTout 
          annotation (extent=[-80,54; -60,74], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPTin 
          annotation (extent=[-68,74; -48,54], rotation=90);
      equation 
        connect(com_valveHP.y, actuators.Opening_valveHP) 
                                                      annotation (points=[75,40;
              66,40; 66,-74],        style(color=74, rgbcolor={0,0,127}));
        connect(com_valveIP.y, actuators.Opening_valveIP) 
                                                      annotation (points=[75,0; 66,
              0; 66,-74],   style(color=74, rgbcolor={0,0,127}));
        connect(com_valveLP.y, actuators.Opening_valveLP) 
                                                      annotation (points=[75,-40;
              66,-40; 66,-74],              style(color=74, rgbcolor={0,0,127}));
        connect(actuators,steamTurbines. ActuatorsBus) annotation (points=[66,-74;
              18,-74; 18,-28.8; -14.8,-28.8],
                                          style(color=52, rgbcolor={213,255,170}));
        connect(steamTurbines.Shaft_b, constantSpeed.flange) annotation (points=
             [-14,0; 0,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(com_bypassHP.y, actuators.Opening_byPassHP) 
                                                        annotation (points=[57,
              40; 66,40; 66,-74], style(color=74, rgbcolor={0,0,127}));
        connect(com_bypassIP.y, actuators.Opening_byPassIP) 
                                                        annotation (points=[57,
              0; 66,0; 66,-74], style(color=74, rgbcolor={0,0,127}));
        connect(com_bypassLP.y, actuators.Opening_byPassLP) 
                                                        annotation (points=[57,
              -40; 66,-40; 66,-74], style(color=74, rgbcolor={0,0,127}));
        connect(sinkLPT_p.flange, steamTurbines.LPT_Out) 
          annotation (points=[-34,-60; -22,-60; -22,-40], style(thickness=2));
        connect(steamTurbines.LPT_In,sourceLPT. flange) 
          annotation (points=[-34,40; -34,54], style(thickness=2));
        connect(steamTurbines.HPT_In,sourceHPT_p. flange) 
          annotation (points=[-82,40; -82,54], style(thickness=2));
        connect(sourceToMix.flange, steamTurbines.SteamToMix) 
          annotation (points=[-46,68; -46,40], style(thickness=2));
        connect(stateIPTin.outlet, steamTurbines.IPT_In) 
          annotation (points=[-58,58; -58,40], style(thickness=2));
        connect(stateHPTout.inlet, steamTurbines.HPT_Out) 
          annotation (points=[-70,58; -70,40], style(thickness=2));
        connect(stateHPTout.outlet, Rh.in1) annotation (points=[-70,70; -70,76;
              -70,82; -70.06,82], style(thickness=2));
        connect(stateIPTin.inlet, Rh.out1) 
          annotation (points=[-58,70; -58,82], style(thickness=2));
      end TestST3LRh_bypass;
      
      model TestSTG_simp 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        //other data
        constant Real pi=Modelica.Constants.pi;
        
        annotation (Diagram);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[30,0; 10,20]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateCondOut(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[24,-56; 44,-36], rotation=90);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-30,-58; -10,-38],
                                               rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomFlowRate=81.10 - 67.5,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          mixLP_V=50,
          mixIP_V=50,
          steamLPNomFlowRate=89.82 - 81.10,
          HPT_hstart_in=3.47e6,
          HPT_hstart_out=3.1076e6,
          IPT_hstart_in=3.554e6,
          IPT_hstart_out=3.12810e6,
          LPT_hstart_in=3.109e6,
          LPT_hstart_out=2.3854e6,
          mixLP_hstart=3.109e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004) 
                       annotation (extent=[-92,-30; -12,50]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.CondPlant 
          condenserPlant(
          condNomFlowRate=89.82,
          coolNomFlowRate=22.782,
          condNomPressure=5.3982e3,
          coolNomPressure=3e5,
          condExchSurface=0.02*pi*514*4.88,
          coolExchSurface=(0.02 - (2*0.0016))*pi*514*4.88,
          condVol=4.162 - (0.02^2/4*pi*514*4.88),
          cm=419,
          rhoMetal=7500,
          coolVol=(0.02 - (2*0.0016))^2/4*pi*514*4.88,
          pstart_cond=5.3982e3,
          redeclare package FluidMedium = FluidMedium,
          condenser(gamma_cond=1536, gamma_cool=5006),
          metalVol=(0.02^2/4*pi*514*4.88) - ((0.02 - (2*0.0016))^2/4*pi*514*
              4.88),
          use_T=false,
          SSInit=false,
          Tstart_M_in=FluidMedium.temperature_ph(3e5, 62641),
          Tstart_M_out=FluidMedium.temperature_ph(3e5, 140760),
          hstart_cool_in=62641,
          hstart_cool_out=140760) 
          annotation (extent=[-10,-52; 30,-92],rotation=90);
        Water.SourceP sourceHPT(h=3.47e6, p0=1.28e7,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,62; -74,74], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,62; -26,74], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,76; -38,88], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.68e6) 
          annotation (extent=[-68,94; -56,82], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRedear 
          annotation (extent=[-78,60; -58,80], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRedear1 
          annotation (extent=[-66,80; -46,60], rotation=90);
        Water.SinkW sinkW(
          w0=89.8,
          p0=5.3982e3,
          h=1.43495e5,
          redeclare package Medium = FluidMedium) 
                       annotation (extent=[56,-30; 76,-10]);
      equation 
        connect(steamTurbines.Shaft_b, constantSpeed.flange) annotation (points=[-12,10;
              10,10],         style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[-20,-42; -20,-30], style(thickness=2));
        connect(condenserPlant.WaterOut,stateCondOut. inlet) 
          annotation (points=[30,-72; 34,-72; 34,-52], style(thickness=2));
        connect(condenserPlant.SteamIn, stateLPTout.outlet) 
          annotation (points=[-10,-72; -20,-72; -20,-54], style(thickness=2));
        connect(steamTurbines.LPT_In,sourceLPT. flange) 
          annotation (points=[-32,50; -32,62], style(thickness=2));
        connect(steamTurbines.HPT_In,sourceHPT. flange) 
          annotation (points=[-80,50; -80,62], style(thickness=2));
        connect(sourceToMix.flange, steamTurbines.SteamToMix) 
          annotation (points=[-44,76; -44,50], style(thickness=2));
        connect(steamTurbines.HPT_Out,stateRedear. inlet) 
          annotation (points=[-68,50; -68,64], style(thickness=2));
        connect(stateRedear.outlet,Rh. in1) annotation (points=[-68,76; -68,88;
              -68.06,88],         style(thickness=2));
        connect(stateRedear1.outlet, steamTurbines.IPT_In) 
          annotation (points=[-56,64; -56,50], style(thickness=2));
        connect(stateRedear1.inlet,Rh. out1) 
          annotation (points=[-56,76; -56,88], style(thickness=2));
        connect(sinkW.flange, stateCondOut.outlet) 
          annotation (points=[56,-20; 34,-20; 34,-40], style(thickness=2));
      end TestSTG_simp;
      
      model TestST3LRh_base_condIdeal 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[26,2; 6,22]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateCondOut(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[46,-70; 66,-50], rotation=90);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateLPTout(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-30,-60; -10,-40],
                                               rotation=270);
        Water.SourceP sourceHPT(h=3.47e6, p0=1.28e7,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,62; -74,74], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,62; -26,74], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,76; -38,88], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.68e6) 
          annotation (extent=[-68,94; -56,82], rotation=0);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIn(
            redeclare package Medium = FluidMedium) 
          annotation (extent=[-78,60; -58,80], rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhOut(
            redeclare package Medium = FluidMedium) 
          annotation (extent=[-66,80; -46,60], rotation=90);
        Water.SinkP sinkP_condenser(
          redeclare package Medium = FluidMedium,
          h=2.44e5,
          p0=7.19e5)       annotation (extent=[84,-98; 64,-78], rotation=0);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateWater_outPump(redeclare package Medium = FluidMedium) 
          annotation (extent=[80,-70; 100,-50], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
          condenserIdeal(                        p=5398.2,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-8,-60; 32,-100],rotation=90);
        Modelica.Blocks.Sources.Ramp const(
          startTime=3000,
          duration=500,
          height=0,
          offset=0.85) annotation (extent=[0,-20; 10,-10]);
        Control.PID pID(
          CSmin=500,
          PVmax=1,
          Kp=3,
          CSmax=2506,
          PVmin=0.1,
          Ti=600)     annotation (extent=[22,-32; 38,-16], rotation=0);
      public 
        HRSG.Components.PrescribedSpeedPump pump(
          rho_nom=1000,
          redeclare package WaterMedium = FluidMedium,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0},
          nominalSteamPressure=7.19048e5,
          nominalCondensationPressure=5398.2,
          hstart=1.43495e5,
          n0=1500,
          nominalSteamFlow=89.8) 
                                annotation (extent=[84,-20; 64,-40], rotation=180);
        ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
          steamTurbines(
          redeclare package FluidMedium = FluidMedium,
          steamHPNomFlowRate=67.6,
          steamHPNomPressure=1.28e7,
          steamIPNomPressure=2.68e6,
          steamLPNomPressure=6e5,
          pcond=5.3982e3,
          HPT_hstart_in=3.47e6,
          mixIP_hstart=3.1076e6,
          HPT_eta_iso_nom=0.833,
          IPT_eta_iso_nom=0.903,
          LPT_eta_iso_nom=0.876,
          HPT_Kt=0.0032078,
          IPT_Kt=0.018883,
          LPT_Kt=0.078004,
          HPT_hstart_out=3.10745e6,
          IPT_hstart_in=3.54348e6,
          IPT_hstart_out=3.12011e6,
          LPT_hstart_in=3.11911e6,
          LPT_hstart_out=2.39102e6,
          mixLP_hstart=3.11911e6,
          mixLP_V=5,
          mixIP_V=5,
          steamIPNomFlowRate=81.3524 - 67.6,
          steamLPNomFlowRate=89.438 - 81.3524) 
                       annotation (extent=[-92,-28; -12,52]);
      equation 
        connect(stateRhIn.outlet, Rh.in1)   annotation (points=[-68,76; -68,88;
              -68.06,88],         style(thickness=2));
        connect(stateRhOut.inlet, Rh.out1) 
          annotation (points=[-56,76; -56,88], style(thickness=2));
        connect(stateWater_outPump.outlet,sinkP_condenser. flange) 
          annotation (points=[90,-66; 90,-88; 84,-88],
                                               style(thickness=2));
        connect(condenserIdeal.waterOut, stateCondOut.inlet) annotation (points=[28,-80;
              56,-80; 56,-66],         style(
            color=3,
            rgbcolor={0,0,255},
            thickness=2));
        connect(condenserIdeal.steamIn, stateLPTout.outlet) 
          annotation (points=[-4,-80; -20,-80; -20,-56],style(thickness=2));
        connect(pID.PV, condenserIdeal.ratio_Vv_Vtot) annotation (points=[22,-27.2;
              16,-27.2; 16,-66],    style(color=74, rgbcolor={0,0,127}));
        connect(stateCondOut.outlet, pump.inlet) 
          annotation (points=[56,-54; 56,-30; 64,-30], style(thickness=2));
        connect(stateWater_outPump.inlet, pump.outlet) 
          annotation (points=[90,-54; 90,-30; 84,-30], style(thickness=2));
        connect(pID.SP, const.y) annotation (points=[22,-20.8; 18,-20.8; 18,-15;
              10.5,-15], style(color=74, rgbcolor={0,0,127}));
        connect(steamTurbines.Shaft_b, constantSpeed.flange) annotation (points=
             [-12,12; 6,12], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
          annotation (points=[-20,-44; -20,-28], style(thickness=2));
        connect(steamTurbines.LPT_In, sourceLPT.flange) 
          annotation (points=[-32,52; -32,62], style(thickness=2));
        connect(steamTurbines.SteamToMix, sourceToMix.flange) 
          annotation (points=[-44,52; -44,76], style(thickness=2));
        connect(steamTurbines.IPT_In, stateRhOut.outlet) 
          annotation (points=[-56,52; -56,64], style(thickness=2));
        connect(steamTurbines.HPT_Out, stateRhIn.inlet) 
          annotation (points=[-68,52; -68,64], style(thickness=2));
        connect(steamTurbines.HPT_In, sourceHPT.flange) 
          annotation (points=[-80,52; -80,62], style(thickness=2));
        connect(pID.CS, pump.pumpSpeed_rpm) annotation (points=[38.48,-24; 63.2,
              -24], style(color=74, rgbcolor={0,0,127}));
      end TestST3LRh_base_condIdeal;
      
      model TestSTG 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[36,-30; 16,-10]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateCondOut(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-24,32; -8,48],  rotation=90);
        Water.SourceP sourceHPT(h=3.47e6, p0=1.28e7,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-86,68; -74,80], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-38,54; -26,66], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-50,68; -38,80], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.68e6) 
          annotation (extent=[-68,66; -56,54], rotation=0);
        Water.SinkP sinkP_condenser(
          redeclare package Medium = FluidMedium,
          h=2.44e5,
          p0=7.19e5)       annotation (extent=[80,-66; 68,-54], rotation=0);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateWater_outPump 
          annotation (extent=[82,-38; 102,-18], rotation=270);
        Examples.STG_3LRh sTG_3LRh(redeclare package FluidMedium = FluidMedium)
                                   annotation (extent=[-88,-60; -8,20]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-88,48; -72,32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                     redeclare package Medium 
            = FluidMedium) annotation (extent=[-52,48; -36,32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-40,48; -24,32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-64,48; -48,32],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-76,48; -60,32],   rotation=270);
      protected 
        Buses.Sensors sensors annotation (extent=[42,-40; 50,-32]);
      public 
        Modelica.Blocks.Sources.Ramp const(
          startTime=3000,
          duration=500,
          height=0,
          offset=0.85) annotation (extent=[-4,32; 12,48]);
      public 
        HRSG.Components.PrescribedSpeedPump pump(
          rho_nom=1000,
          redeclare package WaterMedium = FluidMedium,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0},
          nominalSteamPressure=7.19048e5,
          nominalCondensationPressure=5398.2,
          hstart=1.43495e5,
          n0=1500,
          nominalSteamFlow=89.8) 
                                annotation (extent=[84,60; 64,80],   rotation=180);
        Control.PID pID(
          CSmin=500,
          PVmin=0.1,
          PVmax=1,
          Kp=3,
          CSmax=2506,
          Ti=600)     annotation (extent=[26,26; 46,46],   rotation=0);
      equation 
        connect(stateWater_outPump.outlet,sinkP_condenser. flange) 
          annotation (points=[92,-34; 92,-60; 80,-60],
                                               style(thickness=2));
        connect(constantSpeed.flange, sTG_3LRh.Shaft_b) annotation (points=[16,
              -20; -8,-20], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(stateCondOut.inlet, sTG_3LRh.WaterOut) 
          annotation (points=[-16,35.2; -16,20], style(thickness=2));
        connect(sTG_3LRh.From_SH_HP, stateHPT_in.outlet) 
          annotation (points=[-80,20; -80,35.2], style(thickness=2));
        connect(sTG_3LRh.To_RH_IP, stateHPT_out.inlet) 
          annotation (points=[-68,20; -68,35.2], style(thickness=2));
        connect(sTG_3LRh.From_RH_IP, stateIPT_in.outlet) 
          annotation (points=[-56,20; -56,35.2], style(thickness=2));
        connect(sTG_3LRh.From_SH_IP, stateToMix.outlet) 
          annotation (points=[-44,20; -44,35.2], style(thickness=2));
        connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
          annotation (points=[-32,20; -32,35.2], style(thickness=2));
        connect(stateLPT_in.inlet, sourceLPT.flange) 
          annotation (points=[-32,44.8; -32,54], style(thickness=2));
        connect(stateToMix.inlet, sourceToMix.flange) 
          annotation (points=[-44,44.8; -44,68], style(thickness=2));
        connect(stateIPT_in.inlet, Rh.out1) 
          annotation (points=[-56,44.8; -56,60], style(thickness=2));
        connect(stateHPT_out.outlet, Rh.in1) annotation (points=[-68,44.8; -68,
              60; -68.06,60], style(thickness=2));
        connect(stateHPT_in.inlet, sourceHPT.flange) 
          annotation (points=[-80,44.8; -80,68], style(thickness=2));
        connect(sensors, sTG_3LRh.SensorsBus) annotation (points=[46,-36; -8.8,
              -36], style(color=84, rgbcolor={255,170,213}));
        connect(stateCondOut.outlet, pump.inlet) 
          annotation (points=[-16,44.8; -16,70; 64,70], style(thickness=2));
        connect(pump.outlet, stateWater_outPump.inlet) 
          annotation (points=[84,70; 92,70; 92,-22], style(thickness=2));
        connect(pID.CS, pump.pumpSpeed_rpm) annotation (points=[46.6,36; 54,36;
              54,64; 63.2,64], style(color=74, rgbcolor={0,0,127}));
        connect(pID.SP, const.y) annotation (points=[26,40; 12.8,40],
                        style(color=74, rgbcolor={0,0,127}));
        connect(pID.PV, sensors.ratioVvVtot) annotation (points=[26,32; 20,32;
              20,8; 56,8; 56,-36; 46,-36], style(color=74, rgbcolor={0,0,127}));
      end TestSTG;
      
      model TestSTG_cc "Test of STG with condenser control" 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=
              314.16/2) 
          annotation (extent=[26,-26; 6,-6]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateCondOut(                     redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-26,36; -10,52], rotation=90);
        Water.SourceP sourceHPT(h=3.47e6, p0=1.28e7,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-88,72; -76,84], rotation=270);
        Water.SourceP sourceLPT(h=3.109e6, p0=6e5,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-40,58; -28,70], rotation=270);
        Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-52,72; -40,84], rotation=270);
        Components.EffectHE Rh(dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.68e6) 
          annotation (extent=[-70,70; -58,58], rotation=0);
        Examples.STG_3LRh_bypass_cc sTG_3LRh(
                                   redeclare package FluidMedium = FluidMedium)
                                   annotation (extent=[-90,-56; -10,24]);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-90,52; -74,36],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                     redeclare package Medium 
            = FluidMedium) annotation (extent=[-54,52; -38,36],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-42,52; -26,36],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                      redeclare package Medium 
            = FluidMedium) annotation (extent=[-66,52; -50,36],   rotation=90);
        ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                  redeclare package Medium = 
              FluidMedium) annotation (extent=[-78,52; -62,36],   rotation=270);
        Water.SinkW sinkWater(
          redeclare package Medium = FluidMedium,
          p0=5398.2,
          h=1.43495e5,
          w0=89.8) annotation (extent=[-26,68; -10,84],
                                                      rotation=90);
      equation 
        connect(constantSpeed.flange, sTG_3LRh.Shaft_b) annotation (points=[6,-16;
              -10,-16],     style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(stateCondOut.inlet, sTG_3LRh.WaterOut) 
          annotation (points=[-18,39.2; -18,24], style(thickness=2));
        connect(sTG_3LRh.From_SH_HP, stateHPT_in.outlet) 
          annotation (points=[-82,24; -82,39.2], style(thickness=2));
        connect(sTG_3LRh.To_RH_IP, stateHPT_out.inlet) 
          annotation (points=[-70,24; -70,39.2], style(thickness=2));
        connect(sTG_3LRh.From_RH_IP, stateIPT_in.outlet) 
          annotation (points=[-58,24; -58,39.2], style(thickness=2));
        connect(sTG_3LRh.From_SH_IP, stateToMix.outlet) 
          annotation (points=[-46,24; -46,39.2], style(thickness=2));
        connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
          annotation (points=[-34,24; -34,39.2], style(thickness=2));
        connect(stateLPT_in.inlet, sourceLPT.flange) 
          annotation (points=[-34,48.8; -34,58], style(thickness=2));
        connect(stateToMix.inlet, sourceToMix.flange) 
          annotation (points=[-46,48.8; -46,72], style(thickness=2));
        connect(stateIPT_in.inlet, Rh.out1) 
          annotation (points=[-58,48.8; -58,64], style(thickness=2));
        connect(stateHPT_out.outlet, Rh.in1) annotation (points=[-70,48.8; -70,
              64; -70.06,64], style(thickness=2));
        connect(stateHPT_in.inlet, sourceHPT.flange) 
          annotation (points=[-82,48.8; -82,72], style(thickness=2));
        connect(stateCondOut.outlet, sinkWater.flange) 
          annotation (points=[-18,48.8; -18,68],
                                               style(thickness=2));
      end TestSTG_cc;
      
      model TestCondenserControl 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        Water.SinkP sinkP_condenser(
          redeclare package Medium = FluidMedium,
          h=2.44e5,
          p0=7.19e5)       annotation (extent=[72,-58; 52,-38], rotation=0);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateWater_outPump 
          annotation (extent=[80,-38; 100,-18], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
          condenserIdeal(                        p=5398.2,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-40,-4; 0,36], rotation=0);
        Control.PID pID(
          CSmin=500,
          PVmax=1,
          Kp=2,
          Ti=600,
          PVmin=0.1,
          CSmax=2516) annotation (extent=[-20,-50; 0,-30], rotation=0);
      public 
        Components.PrescribedSpeedPump pump(
          rho_nom=1000,
          n0=1500,
          nominalCondensationPressure=5.3982e3,
          redeclare package WaterMedium = FluidMedium,
          nominalSteamFlow=89.8,
          nominalSteamPressure=7.19e5,
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0},
          hstart=1.43495e5)     annotation (extent=[52,-20; 32,0],   rotation=
              180);
        Water.SourceW sourceW(
          redeclare package Medium = FluidMedium,
          w0=89.8,
          p0=5389.2,
          h=2.3854e6) annotation (extent=[-76,50; -56,70]);
        Components.StateReader stateCondIn(redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-48,50; -28,70], rotation=0);
        Components.StateReader stateCondOut(
                                           redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-6,-20; 14,0],   rotation=0);
        Modelica.Blocks.Sources.Ramp const(
          startTime=3000,
          duration=1000,
          offset=0.85,
          height=0.1) 
                    annotation (extent=[-60,-32; -48,-20]);
      equation 
        connect(stateWater_outPump.outlet,sinkP_condenser. flange) 
          annotation (points=[90,-34; 90,-48; 72,-48],
                                               style(thickness=2));
        connect(pump.outlet, stateWater_outPump.inlet) 
          annotation (points=[52,-10; 90,-10; 90,-22],
                                                     style(thickness=2));
        connect(pID.CS, pump.pumpSpeed_rpm)                annotation (points=[0.6,-40;
              20,-40; 20,-16; 31.2,-16],          style(color=74, rgbcolor={0,0,
                127}));
        connect(stateCondIn.inlet, sourceW.flange) 
          annotation (points=[-44,60; -56,60], style(thickness=2));
        connect(stateCondIn.outlet, condenserIdeal.steamIn) 
          annotation (points=[-32,60; -20,60; -20,32], style(thickness=2));
        connect(stateCondOut.inlet, condenserIdeal.waterOut) 
          annotation (points=[-2,-10; -20,-10; -20,0],
                                                     style(thickness=2));
        connect(stateCondOut.outlet, pump.inlet) 
          annotation (points=[10,-10; 21,-10; 21,-10; 32,-10],
                                                           style(thickness=2));
        connect(condenserIdeal.ratio_Vv_Vtot, pID.PV) annotation (points=[-34,12;
              -87,12; -87,-44; -20,-44],     style(color=74, rgbcolor={0,0,127}));
        connect(const.y, pID.SP) annotation (points=[-47.4,-26; -34,-26; -34,
              -36; -20,-36], style(color=74, rgbcolor={0,0,127}));
      end TestCondenserControl;
      
      model TestCondenserControl_tap 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateTapping(redeclare package Medium = FluidMedium) 
          annotation (extent=[-30,-2; -10,18],  rotation=0);
        Control.PID pID(
          PVmax=1,
          PVmin=0.1,
          CSmin=-0.6,
          CSmax=0.6,
          Ti=2000,
          Kp=-3)      annotation (extent=[-20,-80; 0,-60], rotation=0);
        Water.SourceW sourceSteam(
          redeclare package Medium = FluidMedium,
          w0=89.8,
          p0=5389.2,
          h=2.3854e6) annotation (extent=[-76,50; -56,70]);
        Components.StateReader stateCondIn(redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-10,50; 10,70],  rotation=0);
        Components.StateReader stateCondOut(
                                           redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[34,-20; 54,0],   rotation=0);
        Modelica.Blocks.Sources.Ramp const(
          offset=0.85,
          duration=500,
          startTime=8000,
          height=0.1) 
                    annotation (extent=[-60,-66; -48,-54]);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP_tap 
          condenserIdeal_tap(                            redeclare package 
            Medium = FluidMedium, p=5398.2) annotation (extent=[0,0; 40,40]);
        Water.SinkW sinkWater(
          redeclare package Medium = FluidMedium,
          p0=5398.2,
          h=1.43495e5,
          w0=89.8) annotation (extent=[70,-20; 90,0]);
        Water.SourceW sourceTap(
          redeclare package Medium = FluidMedium,
          p0=5389.2,
          h=1.43495e5) 
                      annotation (extent=[-60,-2; -40,18]);
      equation 
        connect(stateCondIn.inlet, sourceSteam.flange) 
          annotation (points=[-6,60; -56,60],  style(thickness=2));
        connect(const.y, pID.SP) annotation (points=[-47.4,-60; -34,-60; -34,
              -66; -20,-66], style(color=74, rgbcolor={0,0,127}));
        connect(stateCondOut.inlet, condenserIdeal_tap.waterOut) 
          annotation (points=[38,-10; 20,-10; 20,4], style(thickness=2));
        connect(stateCondIn.outlet, condenserIdeal_tap.steamIn) 
          annotation (points=[6,60; 20,60; 20,36], style(thickness=2));
        connect(sinkWater.flange, stateCondOut.outlet) 
          annotation (points=[70,-10; 50,-10], style(thickness=2));
        connect(stateTapping.outlet, condenserIdeal_tap.tapWater) 
          annotation (points=[-14,8; 8,8], style(thickness=2));
        connect(sourceTap.flange, stateTapping.inlet) 
          annotation (points=[-40,8; -26,8], style(thickness=2));
        connect(pID.CS, sourceTap.in_w0) annotation (points=[0.6,-70; 20,-70;
              20,-20; -70,-20; -70,20; -54,20; -54,14], style(color=74,
              rgbcolor={0,0,127}));
        connect(pID.PV, condenserIdeal_tap.ratio_Vv_Vtot) annotation (points=[-20,-74;
              -80,-74; -80,24; -20,24; -20,16; 6,16],          style(color=74,
              rgbcolor={0,0,127}));
      end TestCondenserControl_tap;
      
      model TestCondenserControl_Flow 
        
        replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
          Modelica.Media.Interfaces.PartialPureSubstance;
        
        annotation (Diagram);
        Water.SinkP sinkP_condenser(
          redeclare package Medium = FluidMedium,
          h=2.44e5,
          p0=7.19e5)       annotation (extent=[80,-60; 60,-40], rotation=0);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
          stateWater_outPump 
          annotation (extent=[80,-34; 100,-14], rotation=270);
        ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
          condenserIdeal(                        p=5398.2,
          redeclare package Medium = FluidMedium) 
          annotation (extent=[-40,-4; 0,36], rotation=0);
        Control.PID pID(
          Kp=3,
          Ti=600,
          CSmin=50,
          CSmax=130,
          PVmin=0.2,
          PVmax=0.9)  annotation (extent=[-20,-82; 0,-62], rotation=0);
        Water.SourceW sourceW(
          redeclare package Medium = FluidMedium,
          w0=89.8,
          p0=5389.2,
          h=2.3854e6) annotation (extent=[-76,50; -56,70]);
        Components.StateReader stateCondIn(redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-48,50; -28,70], rotation=0);
        Components.StateReader stateCondOut(
                                           redeclare package Medium = 
              FluidMedium) 
          annotation (extent=[-6,-20; 14,0],   rotation=0);
        Modelica.Blocks.Sources.Ramp const(
          startTime=3000,
          duration=1000,
          offset=0.85,
          height=0.1) 
                    annotation (extent=[-62,-56; -50,-44]);
        HRSG.Components.PumpControlFlowRate pumpControlFlowRate(
          q_nom={0.0898,0,0.1},
          head_nom={72.74,130,0},
          nominalWaterPressure=7.19048e5,
          nominalCondensationPressure=5398.2,
          nominalWaterFlowRate=89.8,
          redeclare package FluidMedium = FluidMedium,
          rho_nom=1000,
          n0=1500,
          hstart=1.43495e5,
          totalFeedPump(feedWaterPump(redeclare function 
                efficiencyCharacteristic = 
                  Functions.PumpCharacteristics.constantEfficiency (eta_nom=
                      0.0071)))) annotation (extent=[40,0; 60,-20]);
      equation 
        connect(stateWater_outPump.outlet,sinkP_condenser. flange) 
          annotation (points=[90,-30; 90,-50; 80,-50],
                                               style(thickness=2));
        connect(stateCondIn.inlet, sourceW.flange) 
          annotation (points=[-44,60; -56,60], style(thickness=2));
        connect(stateCondIn.outlet, condenserIdeal.steamIn) 
          annotation (points=[-32,60; -20,60; -20,32], style(thickness=2));
        connect(stateCondOut.inlet, condenserIdeal.waterOut) 
          annotation (points=[-2,-10; -20,-10; -20,0],
                                                     style(thickness=2));
        connect(condenserIdeal.ratio_Vv_Vtot, pID.PV) annotation (points=[-34,
              12; -87,12; -87,-76; -20,-76], style(color=74, rgbcolor={0,0,127}));
        connect(const.y, pID.SP) annotation (points=[-49.4,-50; -34,-50; -34,
              -68; -20,-68], style(color=74, rgbcolor={0,0,127}));
        connect(pID.CS, pumpControlFlowRate.setpoint_FlowRate) annotation (
            points=[0.6,-72; 28,-72; 28,-17; 39.6,-17], style(color=74,
              rgbcolor={0,0,127}));
        connect(pumpControlFlowRate.inlet, stateCondOut.outlet) 
          annotation (points=[40,-10; 10,-10], style(thickness=2));
        connect(pumpControlFlowRate.outlet, stateWater_outPump.inlet) 
          annotation (points=[60,-10; 90,-10; 90,-18], style(thickness=2));
      end TestCondenserControl_Flow;
      
    end Tests;
    
    package Functions 
      
      function curveEfficiency "curve for efficiency calculation" 
        input Real eta_nom "Nominal efficiency (maximum)";
        input Real k "Ratio uf/wiso";
        input Real x "Degree of reaction";
        output Real eta "Value of efficient correspondent";
      protected 
        Real a;
      algorithm 
        a:=sqrt(1 - x);
        eta:=2*k*((a - k) + sqrt((a - k)^2 + 1 - (a^2)))*eta_nom;
      end curveEfficiency;
      
    end Functions;
  end SteamTurbineGroup;
  
  package ElectricGeneratorGroup 
    package Interfaces 
      partial model SingleShaft 
        "Base Class for alternator group, configuration single-shaft (one generator)" 
        parameter SI.Frequency fn=50 "Nominal frequency of the grid";
        parameter SI.Power Pn "Nominal power installed on the grid";
        parameter Real eta=1 "Conversion efficiency of the electric generator";
        parameter SI.MomentOfInertia J_shaft=0 "Total inertia of the system";
        parameter Real d_shaft=0 "Damping constant of the shaft";
        parameter SI.AngularVelocity omega_nom=0 
          "Nominal angular velocity of the shaft";
        
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
          annotation (extent=[-110,-10; -90,10]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[6,40; 86,-40], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=51,
                rgbfillColor={255,255,170})),
            Rectangle(extent=[-100,8; -54,-8], style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,30; -10,-30], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,20; -20,-20],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Rectangle(extent=[6,4; -10,-4], style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Line(points=[48,-10; 58,-24], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 68,8], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,22; 56,28], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[6,0; 26,0; 48,-10], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 48,12], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[26,0; 36,22; 48,12; 54,18], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,-20; 26,0], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Ellipse(extent=[54,30; 58,26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[34,24; 38,20], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[52,20; 56,16], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,14; 50,10], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[66,10; 70,6], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[56,-22; 60,-26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,-8; 50,-12], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[24,2; 28,-2], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[34,-18; 38,-22], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
      end SingleShaft;
      
      partial model DoubleShaft 
        "Base Class for alternator group, configuration double-shaft (two generator)" 
        
        //grid
        parameter SI.Frequency fn=50 "Nominal frequency of the grid";
        parameter SI.Power Pn "Nominal power installed on the grid";
        
        //generators
        parameter Real eta_A=1 
          "Conversion efficiency of the electric generator"                          annotation (Dialog(group = "Generator-Shaft A"));
        parameter Real eta_B=1 
          "Conversion efficiency of the electric generator"                          annotation (Dialog(group = "Generator-Shaft B"));
        
        //other parameter
        parameter SI.MomentOfInertia J_shaft_A=0 
          "Total inertia of the steam turbogenerator"                             annotation (Dialog(group = "Generator-Shaft A"));
        parameter Real d_shaft_A=0 "Damping constant of the shaft" annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.AngularVelocity omega_nom_A=0 
          "Nominal angular velocity of the shaft"                                  annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.MomentOfInertia J_shaft_B=0 
          "Total inertia of the steam turbogenerator"                             annotation (Dialog(group = "Generator-Shaft B"));
        parameter Real d_shaft_B=0 "Damping constant of the shaft" annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.AngularVelocity omega_nom_B=0 
          "Nominal angular velocity of the shaft"                                  annotation (Dialog(group = "Generator-Shaft B"));
        
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_B 
          annotation (extent=[-110,-70; -90,-50]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_A 
          annotation (extent=[-110,50; -90,70]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[6,40; 86,-40], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=51,
                rgbfillColor={255,255,170})),
            Rectangle(extent=[-98,68; -52,52], style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,90; -10,30],  style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,80; -20,40],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Rectangle(extent=[-2,-2; -10,-64],
                                            style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Line(points=[48,-10; 58,-24], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 68,8], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,22; 56,28], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[6,0; 26,0; 48,-10], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 48,12], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[26,0; 36,22; 48,12; 54,18], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,-20; 26,0], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Ellipse(extent=[54,30; 58,26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[34,24; 38,20], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[52,20; 56,16], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,14; 50,10], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[66,10; 70,6], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[56,-22; 60,-26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,-8; 50,-12], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[24,2; 28,-2], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Rectangle(extent=[-102,-52; -56,-68],
                                               style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,-30; -10,-90],style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,-40; -20,-80],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Rectangle(extent=[-2,64; -10,0],style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Rectangle(extent=[6,4; -10,-4], style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Ellipse(extent=[34,-18; 38,-22], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
      end DoubleShaft;
      
      partial model TripleShaft 
        "Base Class for alternator group, configuration triple-shaft (three generator)" 
        
        //grid
        parameter SI.Frequency fn=50 "Nominal frequency of the grid";
        parameter SI.Power Pn "Nominal power installed on the grid";
        
        //generators
        parameter Real eta_A=1 
          "Conversion efficiency of the electric generator"                          annotation (Dialog(group = "Generator-Shaft A"));
        parameter Real eta_B=1 
          "Conversion efficiency of the electric generator"                          annotation (Dialog(group = "Generator-Shaft B"));
        parameter Real eta_C=1 
          "Conversion efficiency of the electric generator"                          annotation (Dialog(group = "Generator-Shaft C"));
        
        //other parameter
        parameter SI.MomentOfInertia J_shaft_A=0 
          "Total inertia of the steam turbogenerator"                             annotation (Dialog(group = "Generator-Shaft A"));
        parameter Real d_shaft_A=0 "Damping constant of the shaft" annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.AngularVelocity omega_nom_A=0 
          "Nominal angular velocity of the shaft"                                  annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.MomentOfInertia J_shaft_B=0 
          "Total inertia of the steam turbogenerator"                             annotation (Dialog(group = "Generator-Shaft B"));
        parameter Real d_shaft_B=0 "Damping constant of the shaft" annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.AngularVelocity omega_nom_B=0 
          "Nominal angular velocity of the shaft"                                  annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.MomentOfInertia J_shaft_C=0 
          "Total inertia of the steam turbogenerator"                             annotation (Dialog(group = "Generator-Shaft C"));
        parameter Real d_shaft_C=0 "Damping constant of the shaft" annotation (Dialog(group = "Generator-Shaft C"));
        parameter SI.AngularVelocity omega_nom_C=0 
          "Nominal angular velocity of the shaft"                                  annotation (Dialog(group = "Generator-Shaft C"));
        
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_B 
          annotation (extent=[-110,-10; -90,10]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_A 
          annotation (extent=[-110,54; -90,74]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_C 
          annotation (extent=[-110,-74; -90,-54]);
        Buses.Sensors SensorsBus annotation (extent=[88,-50; 108,-30]);
        Buses.Actuators ActuatorsBus annotation (extent=[108,-82; 88,-62]);
        annotation (Diagram, Icon(
            Rectangle(extent=[-100,100; 100,-100], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=30,
                rgbfillColor={230,230,230})),
            Ellipse(extent=[6,40; 86,-40], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=51,
                rgbfillColor={255,255,170})),
            Rectangle(extent=[-100,72; -54,56], style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=3,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,94; -10,34],  style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,84; -20,44],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Line(points=[48,-10; 58,-24], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 68,8], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,22; 56,28], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[6,0; 26,0; 48,-10], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[48,-10; 48,12], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[26,0; 36,22; 48,12; 54,18], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Line(points=[36,-20; 26,0], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Ellipse(extent=[54,30; 58,26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[34,24; 38,20], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[52,20; 56,16], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,14; 50,10], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[66,10; 70,6], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[56,-22; 60,-26], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[46,-8; 50,-12], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Ellipse(extent=[24,2; 28,-2], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1)),
            Rectangle(extent=[-100,8; -54,-8], style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,30; -10,-30], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,20; -20,-20],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Rectangle(extent=[-100,-56; -54,-72],
                                               style(
                color=10,
                rgbcolor={95,95,95},
                thickness=2,
                gradient=2,
                fillColor=10,
                rgbfillColor={135,135,135})),
            Ellipse(extent=[-70,-34; -10,-94],style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255})),
            Text(
              extent=[-60,-44; -20,-84],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1),
              string="G"),
            Rectangle(extent=[-2,0; -10,-66],
                                            style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Rectangle(extent=[-2,66; -10,0],style(
                color=0,
                rgbcolor={0,0,0},
                gradient=3)),
            Rectangle(extent=[-10,4; 6,-4], style(
                color=3,
                rgbcolor={0,0,255},
                gradient=3)),
            Ellipse(extent=[34,-18; 38,-22], style(
                color=3,
                rgbcolor={0,0,255},
                fillColor=7,
                rgbfillColor={255,255,255},
                fillPattern=1))));
        
      end TripleShaft;
    end Interfaces;
    
    package Components 
      model PowerSensor "Measures power flow through the component" 
        Electrical.PowerConnection port_a 
                               annotation (extent=[-110,-10; -90,10]);
        Electrical.PowerConnection port_b 
                               annotation (extent=[90,-12; 110,8]);
      annotation (Diagram, Icon(
            Ellipse(extent=[-70,70; 70,-70],   style(color=0, fillColor=7)),
            Line(points=[0,70; 0,40],   style(color=0)),
            Line(points=[22.9,32.8; 40.2,57.3],   style(color=0)),
            Line(points=[-22.9,32.8; -40.2,57.3],   style(color=0)),
            Line(points=[37.6,13.7; 65.8,23.9],   style(color=0)),
            Line(points=[-37.6,13.7; -65.8,23.9],   style(color=0)),
            Line(points=[0,0; 9.02,28.6],   style(color=0)),
            Polygon(points=[-0.48,31.6; 18,26; 18,57.2; -0.48,31.6],     style(
                color=0,
                fillColor=0,
                fillPattern=1)),
            Ellipse(extent=[-5,5; 5,-5],   style(
                color=0,
                gradient=0,
                fillColor=0,
                fillPattern=1)),
               Text(
              extent=[-29,-11; 30,-70],
              style(color=0),
            string="W"),
            Line(points=[-70,0; -90,0],   style(color=0)),
            Line(points=[100,0; 70,0], style(color=0, rgbcolor={0,0,0})),
            Text(extent=[-148,88; 152,128],   string="%name"),
          Line(points=[0,-70; 0,-84], style(color=0, rgbcolor={0,0,0}))));
        Modelica.Blocks.Interfaces.RealOutput W 
          "Power flowing from port_a to port_b" 
            annotation (extent=[-10,-104; 10,-84], rotation=-90);
      equation 
        port_a.W+port_b.W = 0;
        port_a.f = port_b.f;
        W = port_a.W;
      end PowerSensor;
      
      model FrequencySensor "Measures the frequency at the connector" 
        Electrical.PowerConnection port 
                             annotation (extent=[-110,-10; -90,10]);
      annotation (Diagram, Icon(
            Ellipse(extent=[-70,70; 70,-70],   style(color=0, fillColor=7)),
            Line(points=[0,70; 0,40],   style(color=0)),
            Line(points=[22.9,32.8; 40.2,57.3],   style(color=0)),
            Line(points=[-22.9,32.8; -40.2,57.3],   style(color=0)),
            Line(points=[37.6,13.7; 65.8,23.9],   style(color=0)),
            Line(points=[-37.6,13.7; -65.8,23.9],   style(color=0)),
            Line(points=[0,0; 9.02,28.6],   style(color=0)),
            Polygon(points=[-0.48,31.6; 18,26; 18,57.2; -0.48,31.6],     style(
                color=0,
                fillColor=0,
                fillPattern=1)),
            Ellipse(extent=[-5,5; 5,-5],   style(
                color=0,
                gradient=0,
                fillColor=0,
                fillPattern=1)),
               Text(
              extent=[-29,-11; 30,-70],
              style(color=0),
            string="f"),
            Line(points=[-70,0; -90,0],   style(color=0)),
            Line(points=[100,0; 70,0], style(color=0, rgbcolor={0,0,0})),
            Text(extent=[-148,88; 152,128],   string="%name")));
        Modelica.Blocks.Interfaces.RealOutput f "Frequency at the connector" 
            annotation (extent=[92,-10; 112,10], rotation=0);
      equation 
        port.W = 0;
        f = port.f;
      end FrequencySensor;
      
      model Grid_2in "Ideal grid with finite droop and two inlet" 
        parameter SI.Frequency fn=50 "Nominal frequency";
        parameter SI.Power Pn "Nominal power installed on the network";
        parameter Real droop(unit="pu")=0.05 "Network droop";
        SI.Power Wtot "Total power";
        Electrical.PowerConnection connection_A 
                                   annotation (extent=[-100,26; -72,54]);
        Electrical.PowerConnection connection_B 
                                   annotation (extent=[-100,-54; -72,-26]);
        annotation (Diagram, Icon(
            Line(points=[18,-16; 2,-38], style(color=0, rgbcolor={0,0,0})),
            Line(points=[-72,-40; -36,-20],
                                        style(color=0, rgbcolor={0,0,0})),
            Ellipse(extent=[100,-68; -40,68], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[-40,0; -6,0; 24,36; 54,50], style(color=0, rgbcolor={0,0,
                    0})),
            Line(points=[24,36; 36,-6], style(color=0, rgbcolor={0,0,0})),
            Line(points=[-6,0; 16,-14; 40,-52], style(color=0, rgbcolor={0,0,0})),
            Line(points=[18,-14; 34,-6; 70,-22], style(color=0, rgbcolor={0,0,0})),
            Line(points=[68,18; 36,-4; 36,-4], style(color=0, rgbcolor={0,0,0})),
            Ellipse(extent=[-8,2; -2,-4], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[20,38; 26,32], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[52,54; 58,48], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[14,-12; 20,-18], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[66,22; 72,16], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[32,-2; 38,-8], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[38,-50; 44,-56], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[66,-18; 72,-24], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[0,-34; 6,-40], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[-72,40; -36,20],
                                        style(color=0, rgbcolor={0,0,0}))));
      equation 
        connection_A.f = fn + droop*fn*connection_A.W/Pn;
        connection_B.f = fn + droop*fn*connection_B.W/Pn;
        Wtot = connection_A.W + connection_B.W;
        
      end Grid_2in;
      
      model Grid_3in "Ideal grid with finite droop and three inlet" 
        parameter SI.Frequency fn=50 "Nominal frequency";
        parameter SI.Power Pn "Nominal power installed on the network";
        parameter Real droop(unit="pu")=0.05 "Network droop";
        SI.Power Wtot "Total power";
        Electrical.PowerConnection connection_A 
                                   annotation (extent=[-100,66; -72,94]);
        Electrical.PowerConnection connection_B 
                                   annotation (extent=[-100,-14; -72,14]);
        Electrical.PowerConnection connection_C 
                                   annotation (extent=[-100,-94; -72,-66]);
        annotation (Diagram, Icon(
            Line(points=[18,-16; 2,-38], style(color=0, rgbcolor={0,0,0})),
            Line(points=[-72,-80; -20,-48],
                                        style(color=0, rgbcolor={0,0,0})),
            Ellipse(extent=[100,-68; -40,68], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2)),
            Line(points=[-72,0; -6,0; 24,36; 54,50], style(color=0, rgbcolor={0,0,
                    0})),
            Line(points=[24,36; 36,-6], style(color=0, rgbcolor={0,0,0})),
            Line(points=[-6,0; 16,-14; 40,-52], style(color=0, rgbcolor={0,0,0})),
            Line(points=[18,-14; 34,-6; 70,-22], style(color=0, rgbcolor={0,0,0})),
            Line(points=[68,18; 36,-4; 36,-4], style(color=0, rgbcolor={0,0,0})),
            Ellipse(extent=[-8,2; -2,-4], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[20,38; 26,32], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[52,54; 58,48], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[14,-12; 20,-18], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[66,22; 72,16], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[32,-2; 38,-8], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[38,-50; 44,-56], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[66,-18; 72,-24], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Ellipse(extent=[0,-34; 6,-40], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=7,
                rgbfillColor={255,255,255})),
            Line(points=[-72,80; -26,40],
                                        style(color=0, rgbcolor={0,0,0}))));
      equation 
        connection_A.f = fn + droop*fn*connection_A.W/Pn;
        connection_B.f = fn + droop*fn*connection_B.W/Pn;
        connection_C.f = fn + droop*fn*connection_C.W/Pn;
        Wtot = connection_A.W + connection_B.W + connection_C.W;
        
      end Grid_3in;
      
      model Generator_SE 
        "Electric generator inclusive of approximate swing equation" 
        //Parameter
        parameter Real eta=1 "Conversion efficiency";
        parameter Integer Np=2 "Number of couple of electrical poles";
        parameter SI.Power Pmax "Output maximum power";
        parameter Real J "Moment of inertia of the system-shaft";
        parameter Real r=0.3 "Damping of the system";
        parameter SI.AngularVelocity omega_nom 
          "Nominal angulary velocity of shaft";
        parameter SI.Angle delta_start "Loaded angle start value";
        
        //Variable  
        SI.AngularVelocity omega "Shaft angular velocity";
        SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
        SI.Angle delta(start=delta_start) "Loaded angle";
        SI.AngularVelocity d_delta "Variation of loaded angle";
        SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
        SI.Power Pe "Outlet electric power";
        SI.Power Pm "Inlet mechanical power";
        Real M "Auxiliary variable";
        Real D "Auxiliary variable";
        
        //Connector
        Electrical.PowerConnection powerConnection 
                                          annotation (extent=[58,-14; 86,14]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
          annotation (extent=[-100,-10; -80,10]);
        annotation (Icon(
            Rectangle(extent=[-60,8; -90,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=9,
                rgbfillColor={175,175,175})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-60,60; 60,-20],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230},
                fillPattern=1),
              string="G"),
            Text(
              extent=[-60,-10; 60,-50],
              style(color=58, rgbcolor={0,127,0}),
              string="SE")),Diagram);
        
      equation 
        M=J/(Np^2)*omega_nom*Np;
        D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
        omega=der(shaft.phi);
        Pm=omega*shaft.tau;
        n = Modelica.SIunits.Conversions.to_rpm(omega) 
          "Rotational speed in rpm";
        omegaGrid = 2*Modelica.Constants.pi*powerConnection.f;
        powerConnection.W = - Pe;
        
        //Definition of loaded angle
        d_delta = omega*Np - omegaGrid;
        der(delta) = d_delta;
        
        //Swing Equation  
        M*der(d_delta) + D*d_delta = Pm - Pe/eta;
        Pe = Pmax*Modelica.Math.sin(delta);
        
      end Generator_SE;
      
      model Generator_SE_com 
        "Electric generator inclusive of complex swing equation" 
        parameter Real eta=1 "Conversion efficiency";
        parameter Integer Np=2 "Number of couple of electrical poles";
        parameter SI.Power Pmax "Output maximum power";
        parameter Real J "Moment of inertia of the system-shaft";
        parameter Real r=0.3 "Damping of the system";
        parameter SI.Angle delta_start "Start value of loaded angle";
        
        SI.AngularVelocity omega "Shaft angular velocity";
        SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
        SI.Angle delta(start=delta_start) "Loaded angle";
        SI.AngularVelocity d_delta "Variation of loaded angle";
        SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
        SI.Power Pe "Outlet electric power";
        SI.Power Pm "Inlet mechanical power";
        Real M "Auxiliary variable";
        Real D "Auxiliary variable";
        
        Electrical.PowerConnection powerConnection 
                                          annotation (extent=[58,-14; 86,14]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
          annotation (extent=[-100,-10; -80,10]);
        annotation (Icon(
            Rectangle(extent=[-60,8; -90,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=9,
                rgbfillColor={175,175,175})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-60,60; 60,-20],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230},
                fillPattern=1),
              string="G"),
            Text(
              extent=[-60,-10; 60,-50],
              string="SE",
              style(color=58, rgbcolor={0,127,0}))),
                            Diagram);
        
      equation 
        M=J/(Np^2)*omega*Np;
        D=2*r*sqrt(Pmax*J*omega*Np/(Np^2));
        omega=der(shaft.phi);
        Pm=omega*shaft.tau;
        n = Modelica.SIunits.Conversions.to_rpm(omega) 
          "Rotational speed in rpm";
        omegaGrid = 2*Modelica.Constants.pi*powerConnection.f;
        powerConnection.W = - Pe;
        
        //Definition of loaded angle  
        d_delta = omega*Np - omegaGrid;
        der(delta) = d_delta;
        
        //Swing Equation    
        M*der(d_delta) + D*d_delta = Pm - Pe;
        Pe = Pmax*Modelica.Math.sin(delta);
        
      end Generator_SE_com;
      
      model Generator_SE_Breaker 
        "Electic generator inclusive of approximate swing equation and breaker for connection grid" 
        //Parameters 
        parameter Real eta=1 "Conversion efficiency";
        parameter Integer Np=2 "Number of couple of electrical poles";
        parameter SI.Power Pmax "Maximum power of generator";
        parameter Real J "Moment of inertia of the system-shaft";
        parameter Real r=0.3 "Damping of the system";
        parameter SI.AngularVelocity omega_nom 
          "Nominal angulary velocity of shaft";
        parameter SI.Angle delta_start "Loaded angle start value";
        parameter SI.AngularVelocity omega_start 
          "Angulaty velocity of shaft start value";
        
        SI.AngularVelocity omega(start=omega_start) "Shaft angular velocity";
        SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
        SI.Angle delta(start=delta_start) "Loaded angle";
        SI.AngularVelocity d_delta "Variation of loaded angle";
        SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
        SI.Power Pe "Outlet electric power";
        SI.Power Pm "Inlet mechanical power";
        Real M "Auxiliary variable";
        Real D "Auxiliary variable";
        
        Electrical.PowerConnection powerConnection 
                                          annotation (extent=[58,-14; 86,14]);
        Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
          annotation (extent=[-100,-10; -80,10]);
        annotation (Icon(
            Rectangle(extent=[-60,8; -90,-8], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                gradient=2,
                fillColor=9,
                rgbfillColor={175,175,175})),
            Ellipse(extent=[-60,60; 60,-60], style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230})),
            Text(
              extent=[-60,60; 60,-20],
              style(
                color=0,
                rgbcolor={0,0,0},
                thickness=2,
                fillColor=30,
                rgbfillColor={230,230,230},
                fillPattern=1),
              string="G"),
            Text(
              extent=[-60,-10; 60,-50],
              string="SE",
              style(color=58, rgbcolor={0,127,0}))),
                            Diagram);
               annotation (Diagram);
        Modelica.Blocks.Interfaces.BooleanInput closed 
          annotation (extent=[-10,58; 10,78],  rotation=-90);
        Modelica.Blocks.Interfaces.RealOutput delta_out 
          annotation (extent=[-10,-78; 10,-58],
                                              rotation=270);
      equation 
        M=J/(Np^2)*omega_nom*Np;
        D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
        omega=der(shaft.phi);
        Pm=omega*shaft.tau;
        n = Modelica.SIunits.Conversions.to_rpm(omega) 
          "Rotational speed in rpm";
        omegaGrid = 2*Modelica.Constants.pi*powerConnection.f;
        powerConnection.W = - Pe;
        
        //Definition loaded angle
        d_delta = omega*Np - omegaGrid;
        der(delta) = d_delta;
        
        //swing equation
        M*der(d_delta) + D*d_delta = Pm - Pe/eta;
        if closed then
          Pe = Pmax*Modelica.Math.sin(delta);
        else
          //Free turbine and not connection a grid
          Pe = 0;
        end if;
        
        //Output signal
        delta_out = delta - integer(delta/(2*Modelica.Constants.pi))*2*Modelica.Constants.pi;
        
      end Generator_SE_Breaker;
      
      model SwingEquation 
        
        parameter SI.Power Pmax "Output maximum power";
        parameter Real J "Moment of inertia of the system-shaft";
        parameter Real r=0.3 "Damping of the system";
        parameter SI.Angle delta_start "Start value of loaded angle";
        parameter SI.AngularVelocity omega_nom 
          "Nominal angulary velocity of shaft";
        
        SI.Angle delta(start=delta_start) "Loaded angle";
        SI.AngularVelocity d_delta "Variation of loaded angle";
        SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
        SI.AngularVelocity omegaGen "Angulary velocity of the generator";
        SI.Power Pe "Outlet electric power";
        SI.Power Pm "Inlet mechanical power";
        Real M "Auxiliary variable";
        Real D "Auxiliary variable";
        
        ThermoPower.Electrical.PowerConnection powerConnection_a 
          annotation (extent=[-94,-14; -66,14]);
        ThermoPower.Electrical.PowerConnection powerConnection_b 
                                          annotation (extent=[66,-14; 94,14]);
        Modelica.Blocks.Interfaces.RealOutput delta_out 
          annotation (extent=[-10,56; 10,76], rotation=90);
        annotation (Diagram, Icon(Rectangle(extent=[-80,60; 80,-60], style(
                color=0,
                rgbcolor={0,0,0},
                fillColor=30,
                rgbfillColor={230,230,230})), Text(
              extent=[-80,40; 86,-40],
              style(color=0, rgbcolor={0,0,0}),
              string="S.E.")));
        
      equation 
        M=J/(Np^2)*omega_nom*Np;
        D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
        Pm=powerConnection_a.W;
        omegaGrid = 2*Modelica.Constants.pi*powerConnection_b.f;
        omegaGen = 2*Modelica.Constants.pi*powerConnection_a.f;
        powerConnection_b.W = - Pe;
        
        //Definition of loaded angle  
        d_delta = omega*Np - omegaGrid;
        der(delta) = d_delta;
        
        //Swing Equation    
        M*der(d_delta) + D*d_delta = Pm - Pe/eta;
        Pe = Pmax*Modelica.Math.sin(delta);
        
        //Output signal
        delta_out = delta - integer(delta/(2*Modelica.Constants.pi))*2*Modelica.Constants.pi;
        
      end SwingEquation;
      
      connector SwingEqConnection 
        flow SI.Power W "Active power";
        SI.AngularVelocity omega;
        annotation (Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=46,
                rgbcolor={127,127,0},
                thickness=1,
                fillColor=46,
                rgbfillColor={127,127,0}))));
      end SwingEqConnection;
      
      connector ConnectorSE 
        flow SI.Power W "Active power";
        SI.Angle delta;
        annotation (Icon(Rectangle(extent=[-100,100; 100,-100], style(
                color=46,
                rgbcolor={127,127,0},
                thickness=1,
                fillColor=46,
                rgbfillColor={127,127,0}))));
      end ConnectorSE;
      
      package prove 
        
        model Generator_SE_om 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax;
          parameter Real J;
          parameter Real D;
          parameter SI.Angle delta_start;
          
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.AngularVelocity d_thetaGrid;
          SI.Power Pe;
          SI.Power Pm;
          
          Electrical.PowerConnection powerConnection 
                                            annotation (extent=[58,-14; 86,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,40; 60,-40],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G")), Diagram);
                 annotation (Diagram);
        equation 
          omega=der(shaft.phi) "Mechanical boundary condition";
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          d_delta = omega*Np - d_thetaGrid;
          d_thetaGrid = 2*Modelica.Constants.pi*powerConnection.f;
          der(delta) = d_delta;
          
          J/4*omega*Np*der(d_delta) + D*(omega*Np)^2/4= Pm - Pe;
          Pe = Pmax*Modelica.Math.sin(delta);
          powerConnection.W = - Pe;
          
        end Generator_SE_om;
        
        model Generator_SE_usatneiTest 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax=30e6;
          parameter Real J;
          parameter Real D;
          parameter SI.Angle delta_start;
          parameter SI.AngularVelocity omegaGen_nom;
          
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.AngularVelocity d_thetaGrid;
          SI.Power Pe;
          SI.Power Pm;
          Real M;
          Real R;
          
          Electrical.PowerConnection powerConnection 
                                            annotation (extent=[58,-14; 86,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,40; 60,-40],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G")), Diagram);
                 annotation (Diagram);
        equation 
          M=J/4*omega*Np;
          R=D/4*omega*Np;
          omega=der(shaft.phi) "Mechanical boundary condition";
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          d_delta = omega*Np - d_thetaGrid;
          d_thetaGrid = 2*Modelica.Constants.pi*powerConnection.f;
          der(delta) = d_delta;
          
          M*der(d_delta) + R*d_delta = Pm - Pe - R*d_thetaGrid;
          Pe = Pmax*Modelica.Math.sin(delta);
          powerConnection.W = - Pe;
          
        end Generator_SE_usatneiTest;
        
        model Grid_om "Ideal grid with finite droop" 
          parameter Frequency fn=50 "Nominal frequency";
          parameter Power Pn "Nominal power installed on the network";
          parameter Real droop(unit="pu")=0.05 "Network droop";
          
          Electrical.PowerConnection connection 
                                     annotation (extent=[-100,-14; -72,14]);
          annotation (Diagram, Icon(
              Line(points=[18,-16; 2,-38], style(color=0, rgbcolor={0,0,0})),
              Line(points=[-72,0; -40,0], style(color=0, rgbcolor={0,0,0})),
              Ellipse(extent=[100,-68; -40,68], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2)),
              Line(points=[-40,0; -6,0; 24,36; 54,50], style(color=0, rgbcolor={0,0,
                      0})),
              Line(points=[24,36; 36,-6], style(color=0, rgbcolor={0,0,0})),
              Line(points=[-6,0; 16,-14; 40,-52], style(color=0, rgbcolor={0,0,0})),
              Line(points=[18,-14; 34,-6; 70,-22], style(color=0, rgbcolor={0,0,0})),
              Line(points=[68,18; 36,-4; 36,-4], style(color=0, rgbcolor={0,0,0})),
              Ellipse(extent=[-8,2; -2,-4], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[20,38; 26,32], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[52,54; 58,48], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[14,-12; 20,-18], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[66,22; 72,16], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[32,-2; 38,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[38,-50; 44,-56], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[66,-18; 72,-24], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255})),
              Ellipse(extent=[0,-34; 6,-40], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255}))));
        equation 
          connection.f = fn + droop*fn*connection.W/Pn;
        end Grid_om;
        
        model SwingEquation_omega 
          
          parameter SI.Power Pmax;
          parameter SI.MomentOfInertia J;
          parameter Real D;
          parameter SI.Angle delta_start;
          
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.AngularVelocity d_thetaGen;
          SI.AngularVelocity d_thetaGrid;
          SI.Power Pe;
          
          ThermoPower.Electrical.PowerConnection powerConnection_a 
            annotation (extent=[-94,-14; -66,14]);
          ThermoPower.Electrical.PowerConnection powerConnection_b 
                                            annotation (extent=[66,-14; 94,14]);
          Modelica.Blocks.Interfaces.RealOutput delta_out 
            annotation (extent=[-10,56; 10,76], rotation=90);
          annotation (Diagram, Icon(Rectangle(extent=[-80,60; 80,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=30,
                  rgbfillColor={230,230,230})), Text(
                extent=[-80,40; 86,-40],
                style(color=0, rgbcolor={0,0,0}),
                string="S.E.")));
          
        equation 
          d_thetaGen = 2*Modelica.Constants.pi*powerConnection_a.f;
          d_thetaGrid = 2*Modelica.Constants.pi*powerConnection_b.f;
          d_delta = d_thetaGen - d_thetaGrid;
          der(delta) = d_delta;
          J*d_thetaGen/4*der(d_delta)+ D*d_thetaGen^2/4 + Pe = powerConnection_a.W;
          Pe = Pmax*Modelica.Math.sin(delta);
          powerConnection_b.W = - Pe;
          
          delta_out = delta;
          
        end SwingEquation_omega;
        
        model SwingEquation_omega_approx 
          
          parameter SI.Power Pmax;
          parameter SI.MomentOfInertia M=6e6;
          parameter Real R=6e5;
          parameter SI.Angle delta_start;
          
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.AngularVelocity d_thetaGen;
          SI.AngularVelocity d_thetaGrid;
          SI.Power Pe;
          
          ThermoPower.Electrical.PowerConnection powerConnection_a 
            annotation (extent=[-94,-14; -66,14]);
          ThermoPower.Electrical.PowerConnection powerConnection_b 
                                            annotation (extent=[66,-14; 94,14]);
          Modelica.Blocks.Interfaces.RealOutput delta_out 
            annotation (extent=[-10,56; 10,76], rotation=90);
          annotation (Diagram, Icon(Rectangle(extent=[-80,60; 80,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=30,
                  rgbfillColor={230,230,230})), Text(
                extent=[-80,40; 86,-40],
                style(color=0, rgbcolor={0,0,0}),
                string="S.E.")));
          
        equation 
          d_thetaGen = 2*Modelica.Constants.pi*powerConnection_a.f;
          d_thetaGrid = 2*Modelica.Constants.pi*powerConnection_b.f;
          d_delta = d_thetaGen - d_thetaGrid;
          der(delta) = d_delta;
          M*der(d_delta) + R = powerConnection_a.W - Pe;
          Pe = Pmax*Modelica.Math.sin(delta);
          powerConnection_b.W = - Pe;
          
          delta_out = delta;
          
        end SwingEquation_omega_approx;
        
        model test_GenGridBreaker 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-72,-34; -12,26]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,74; 12,94]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-54,74; -74,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-94,74; -74,94]);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            height=-0.5,
            offset=1,
            startTime=500,
            duration=3) 
            annotation (extent=[-24,54; -44,74]);
          Modelica.Mechanics.Rotational.Inertia inertia(w_start=314.16/2, J=
                7000) 
            annotation (extent=[-6,-14; 14,6]);
          Modelica.Mechanics.Rotational.Damper damper(d=25) 
            annotation (extent=[20,-72; 40,-52],   rotation=0);
          Modelica.Mechanics.Rotational.Fixed fixed 
            annotation (extent=[62,-84; 82,-64]);
          Modelica.Blocks.Sources.BooleanStep booleanStep(startTime=
                400000000000, startValue=true) 
            annotation (extent=[26,28; 46,48]);
          Generatorjj generator annotation (extent=[26,-14; 46,6]);
          Electrical.Breaker breaker annotation (extent=[52,-14; 72,6]);
          Electrical.Grid grid(Pn=50e8) annotation (extent=[82,-14; 102,6]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,84;
                -18.9,84; -18.9,20],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-64,54;
                -64,19.7; -64.5,19.7],         style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-74,84; -64,84; -64,74], style(thickness=2));
          connect(com_valveHP.y,valveHP. theta) annotation (points=[-45,64; -56,
                64],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(damper.flange_b,fixed. flange_b) annotation (points=[40,-62;
                72,-62; 72,-74],   style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2,
              fillColor=7,
              rgbfillColor={255,255,255},
              fillPattern=1));
          connect(inertia.flange_a, steamTurbineStodola.shaft_b) annotation (
              points=[-6,-4; -22.8,-4], style(color=0, rgbcolor={0,0,0}));
          connect(damper.flange_a, steamTurbineStodola.shaft_b) annotation (
              points=[20,-62; -14,-62; -14,-4; -22.8,-4], style(color=0,
                rgbcolor={0,0,0}));
          connect(generator.shaft, inertia.flange_b) annotation (points=[27.4,
                -4; 14,-4], style(color=0, rgbcolor={0,0,0}));
          connect(breaker.connection1, generator.powerConnection) annotation (
              points=[53.4,-4; 44.6,-4], style(pattern=0, thickness=2));
          connect(breaker.closed, booleanStep.y) annotation (points=[62,4; 56,4;
                56,38; 47,38], style(color=5, rgbcolor={255,0,255}));
          connect(grid.connection, breaker.connection2) annotation (points=[
                83.4,-4; 70.6,-4], style(pattern=0, thickness=2));
        end test_GenGridBreaker;
        
        model test_GenSE_om 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-72,-34; -12,26]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,74; 12,94]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-54,74; -74,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-94,74; -74,94]);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            offset=0.2,
            startTime=2000,
            duration=20,
            height=0.8) 
            annotation (extent=[-24,54; -44,74]);
          Grid_om grid(                                                     Pn=
                50e8, droop=0)       annotation (extent=[48,-14; 68,6]);
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.prove.Generator_SE_usatneiTest
            generator_SE_om_approx(
            J=7000,
            D=25,
            delta_start=0.4,
            omegaGen_nom=314.16) annotation (extent=[2,-14; 22,6]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,84;
                -18.9,84; -18.9,20],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-64,54;
                -64,19.7; -64.5,19.7],         style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-74,84; -64,84; -64,74], style(thickness=2));
          connect(com_valveHP.y,valveHP. theta) annotation (points=[-45,64; -56,
                64],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(generator_SE_om_approx.shaft, steamTurbineStodola.shaft_b) 
            annotation (points=[3,-4; -22.8,-4], style(color=0, rgbcolor={0,0,0}));
          connect(generator_SE_om_approx.powerConnection, grid.connection) 
            annotation (points=[19.2,-4; 49.4,-4], style(pattern=0, thickness=2));
        end test_GenSE_om;
        
        model testST_ok 
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          annotation (Diagram, experiment(StopTime=15000, NumberOfIntervals=
                  1000));
          SteamTurbineGroup.Examples.ST3LRh_valve steamTurbines(
            redeclare package FluidMedium = FluidMedium,
            steamHPNomFlowRate=67.6,
            steamHPNomPressure=1.28e7,
            steamIPNomFlowRate=81.10 - 67.5,
            steamIPNomPressure=2.68e6,
            steamLPNomPressure=6e5,
            pcond=5.3982e3,
            steamLPNomFlowRate=89.82 - 81.10,
            HPT_hstart_in=3.47e6,
            HPT_hstart_out=3.1076e6,
            IPT_hstart_in=3.554e6,
            IPT_hstart_out=3.12810e6,
            LPT_hstart_in=3.109e6,
            LPT_hstart_out=2.3854e6,
            valveHP_dpnom=1.6e5,
            valveIP_dpnom=5e4,
            mixLP_hstart=3.109e6,
            mixIP_hstart=3.1076e6,
            HPT_eta_iso_nom=0.833,
            IPT_eta_iso_nom=0.903,
            LPT_eta_iso_nom=0.876,
            mixLP_V=20,
            mixIP_V=20,
            valveHP_Cv=1165,
            valveIP_Cv=5625,
            valveLP_Cv=14733,
            valveLP_dpnom=2.964e4,
            HPT_Kt=0.0032078,
            IPT_Kt=0.018883,
            LPT_Kt=0.078004) 
                         annotation (extent=[-88,-42; -8,38]);
          Water.SinkP sinkLPT_p(
            redeclare package Medium = FluidMedium,
            p0=5.3982e3,
            h=2.3854e6)      annotation (extent=[-34,-66; -46,-54],
                                                                  rotation=0);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            height=0.8,
            offset=0.2,
            startTime=10000,
            duration=5) 
            annotation (extent=[84,-12; 64,8]);
          Water.SourceP sourceHPT_p(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-82,52; -70,64], rotation=270);
          Water.SourceP sourceLPT(h=3.109e6, p0=6.296e5) 
            annotation (extent=[-34,52; -22,64], rotation=270);
          Modelica.Blocks.Sources.Ramp com_valveIP(
            offset=1,
            startTime=12000,
            height=-0.9,
            duration=5)   annotation (extent=[84,-52; 64,-32]);
          Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
            annotation (extent=[-46,66; -34,78], rotation=270);
          SteamTurbineGroup.Components.EffectHE Rh(
                                 dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.73e6) 
            annotation (extent=[-52,74; -64,86], rotation=180);
          HRSG.Components.StateReader_water stateHPTout 
            annotation (extent=[-74,52; -54,72], rotation=90);
          HRSG.Components.StateReader_water stateIPTin 
            annotation (extent=[-62,72; -42,52], rotation=90);
        protected 
          Buses.Actuators actuators annotation (extent=[24,-62; 34,-22], rotation=
               180);
        public 
          Modelica.Blocks.Sources.Ramp com_valveLP(
            height=0,
            offset=1,
            startTime=0,
            duration=10)  annotation (extent=[84,-90; 64,-70]);
          Grid_om grid(                                                     Pn=
                50e8, droop=0)       annotation (extent=[60,30; 80,50]);
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.prove.Generator_SE_usatneiTest
            generator_SE_om_approx(
            Pmax=130e6,
            D=25,
            omegaGen_nom=314.16,
            J=30000,
            delta_start=1.03682) annotation (extent=[18,30; 38,50]);
        equation 
          connect(actuators,steamTurbines. ActuatorsBus)   annotation (points=[29,-42;
                2,-42; 2,-30.8; -8.8,-30.8],        style(color=52, rgbcolor={213,
                  255,170}));
          connect(sinkLPT_p.flange,steamTurbines. LPT_Out) 
            annotation (points=[-34,-60; -16,-60; -16,-42],
                                                          style(thickness=2));
          connect(steamTurbines.LPT_In,sourceLPT. flange) 
            annotation (points=[-28,38; -28,52], style(thickness=2));
          connect(steamTurbines.HPT_In,sourceHPT_p. flange) 
            annotation (points=[-76,38; -76,52], style(thickness=2));
          connect(com_valveHP.y,actuators. Opening_valveHP) annotation (points=[63,-2;
                46,-2; 46,-42; 29,-42],              style(color=74, rgbcolor={0,
                  0,127}));
          connect(com_valveIP.y,actuators. Opening_valveIP) annotation (points=[63,-42;
                29,-42],         style(color=74, rgbcolor={0,0,127}));
          connect(sourceToMix.flange,steamTurbines. SteamToMix) 
            annotation (points=[-40,66; -40,38], style(thickness=2));
          connect(stateIPTin.outlet,steamTurbines. IPT_In) 
            annotation (points=[-52,56; -52,38], style(thickness=2));
          connect(stateHPTout.inlet,steamTurbines. HPT_Out) 
            annotation (points=[-64,56; -64,38], style(thickness=2));
          connect(stateHPTout.outlet,Rh. in1) annotation (points=[-64,68; -64,
                80; -64.06,80],     style(thickness=2));
          connect(stateIPTin.inlet,Rh. out1) 
            annotation (points=[-52,68; -52,80], style(thickness=2));
          connect(com_valveLP.y, actuators.Opening_valveLP) annotation (points=
                [63,-80; 46,-80; 46,-42; 29,-42], style(color=74, rgbcolor={0,0,
                  127}));
          connect(generator_SE_om_approx.powerConnection, grid.connection) 
            annotation (points=[35.2,40; 61.4,40], style(pattern=0, thickness=2));
          connect(generator_SE_om_approx.shaft, steamTurbines.Shaft_b) 
            annotation (points=[19,40; 4,40; 4,-2; -8,-2], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
        end testST_ok;
        
        model test_SE_breaker_f 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-72,-34; -12,26]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,74; 12,94]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-54,74; -74,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-94,74; -74,94]);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            duration=10,
            startTime=500,
            height=+0.8,
            offset=0.2) 
            annotation (extent=[-24,54; -44,74]);
        public 
          Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=false) 
            annotation (extent=[16,36; 36,56]);
          SwingEquation_omega swingEquation_omega(
            Pmax=30e5,
            J=7000,
            D=25,
            delta_start=0.5) annotation (extent=[22,-14; 42,6]);
          Electrical.Generator generator annotation (extent=[-6,-14; 14,6]);
          Electrical.Breaker breaker annotation (extent=[48,-14; 68,6]);
          Electrical.Grid grid(Pn=50e8) annotation (extent=[80,-14; 100,6]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,84;
                -18.9,84; -18.9,20],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-64,54;
                -64,19.7; -64.5,19.7],         style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-74,84; -64,84; -64,74], style(thickness=2));
          connect(com_valveHP.y,valveHP. theta) annotation (points=[-45,64; -56,
                64],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(generator.powerConnection, swingEquation_omega.powerConnection_a) 
            annotation (points=[12.6,-4; 24,-4], style(pattern=0, thickness=2));
          connect(generator.shaft, steamTurbineStodola.shaft_b) annotation (
              points=[-4.6,-4; -22.8,-4], style(color=0, rgbcolor={0,0,0}));
          connect(breaker.connection1, swingEquation_omega.powerConnection_b) 
            annotation (points=[49.4,-4; 40,-4], style(pattern=0, thickness=2));
          connect(grid.connection, breaker.connection2) annotation (points=[
                81.4,-4; 66.6,-4], style(pattern=0, thickness=2));
          connect(breaker.closed, booleanConstant.y) annotation (points=[58,4;
                58,46; 37,46], style(color=5, rgbcolor={255,0,255}));
        end test_SE_breaker_f;
        
        model testSTgrid2 
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          annotation (Diagram, experiment(StopTime=15000, NumberOfIntervals=
                  1000));
          SteamTurbineGroup.Examples.ST3LRh_valve steamTurbines(
            redeclare package FluidMedium = FluidMedium,
            steamHPNomFlowRate=67.6,
            steamHPNomPressure=1.28e7,
            steamIPNomFlowRate=81.10 - 67.5,
            steamIPNomPressure=2.68e6,
            steamLPNomPressure=6e5,
            pcond=5.3982e3,
            steamLPNomFlowRate=89.82 - 81.10,
            HPT_hstart_in=3.47e6,
            HPT_hstart_out=3.1076e6,
            IPT_hstart_in=3.554e6,
            IPT_hstart_out=3.12810e6,
            LPT_hstart_in=3.109e6,
            LPT_hstart_out=2.3854e6,
            valveHP_dpnom=1.6e5,
            valveIP_dpnom=5e4,
            mixLP_hstart=3.109e6,
            mixIP_hstart=3.1076e6,
            HPT_eta_iso_nom=0.833,
            IPT_eta_iso_nom=0.903,
            LPT_eta_iso_nom=0.876,
            mixLP_V=20,
            mixIP_V=20,
            valveHP_Cv=1165,
            valveIP_Cv=5625,
            valveLP_Cv=14733,
            valveLP_dpnom=2.964e4,
            HPT_Kt=0.0032078,
            IPT_Kt=0.018883,
            LPT_Kt=0.078004) 
                         annotation (extent=[-88,-42; -8,38]);
          Water.SinkP sinkLPT_p(
            redeclare package Medium = FluidMedium,
            p0=5.3982e3,
            h=2.3854e6)      annotation (extent=[-34,-66; -46,-54],
                                                                  rotation=0);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP 
            annotation (extent=[84,-12; 64,8]);
          Water.SourceP sourceHPT_p(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-82,52; -70,64], rotation=270);
          Water.SourceP sourceLPT(h=3.109e6, p0=6.296e5) 
            annotation (extent=[-34,52; -22,64], rotation=270);
          Modelica.Blocks.Sources.Ramp com_valveIP(
            offset=0.3,
            height=0.7,
            duration=20,
            startTime=222222222222) 
                          annotation (extent=[84,-52; 64,-32]);
          Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
            annotation (extent=[-46,66; -34,78], rotation=270);
          SteamTurbineGroup.Components.EffectHE Rh(
                                 dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.73e6) 
            annotation (extent=[-52,74; -64,86], rotation=180);
          HRSG.Components.StateReader_water stateHPTout 
            annotation (extent=[-74,52; -54,72], rotation=90);
          HRSG.Components.StateReader_water stateIPTin 
            annotation (extent=[-62,72; -42,52], rotation=90);
        protected 
          Buses.Actuators actuators annotation (extent=[24,-62; 34,-22], rotation=
               180);
        public 
          Modelica.Blocks.Sources.Ramp com_valveLP(
            height=-0.7,
            offset=1,
            duration=40,
            startTime=22210000) 
                          annotation (extent=[84,-90; 64,-70]);
          SwingEquation_omega swingEquation_omega(
            Pmax=130e6,
            J=25000,
            D=25,
            delta_start=1) annotation (extent=[36,36; 56,56]);
          Electrical.Generator generator annotation (extent=[4,36; 24,56]);
          Electrical.Grid grid(Pn=50e8) annotation (extent=[80,36; 100,56]);
        equation 
          connect(actuators,steamTurbines. ActuatorsBus)   annotation (points=[29,-42;
                2,-42; 2,-30.8; -8.8,-30.8],        style(color=52, rgbcolor={213,
                  255,170}));
          connect(sinkLPT_p.flange,steamTurbines. LPT_Out) 
            annotation (points=[-34,-60; -16,-60; -16,-42],
                                                          style(thickness=2));
          connect(steamTurbines.LPT_In,sourceLPT. flange) 
            annotation (points=[-28,38; -28,52], style(thickness=2));
          connect(steamTurbines.HPT_In,sourceHPT_p. flange) 
            annotation (points=[-76,38; -76,52], style(thickness=2));
          connect(com_valveHP.y,actuators. Opening_valveHP) annotation (points=[63,-2;
                46,-2; 46,-42; 29,-42],              style(color=74, rgbcolor={0,
                  0,127}));
          connect(com_valveIP.y,actuators. Opening_valveIP) annotation (points=[63,-42;
                29,-42],         style(color=74, rgbcolor={0,0,127}));
          connect(sourceToMix.flange,steamTurbines. SteamToMix) 
            annotation (points=[-40,66; -40,38], style(thickness=2));
          connect(stateIPTin.outlet,steamTurbines. IPT_In) 
            annotation (points=[-52,56; -52,38], style(thickness=2));
          connect(stateHPTout.inlet,steamTurbines. HPT_Out) 
            annotation (points=[-64,56; -64,38], style(thickness=2));
          connect(stateHPTout.outlet,Rh. in1) annotation (points=[-64,68; -64,
                80; -64.06,80],     style(thickness=2));
          connect(stateIPTin.inlet,Rh. out1) 
            annotation (points=[-52,68; -52,80], style(thickness=2));
          connect(com_valveLP.y, actuators.Opening_valveLP) annotation (points=
                [63,-80; 46,-80; 46,-42; 29,-42], style(color=74, rgbcolor={0,0,
                  127}));
          connect(generator.shaft, steamTurbines.Shaft_b) annotation (points=[5.4,46;
                2,46; 2,-2; -8,-2],         style(color=0, rgbcolor={0,0,0}));
          connect(swingEquation_omega.electricConnect_b, grid.connection) 
            annotation (points=[54,46; 81.4,46], style(pattern=0, thickness=2));
          connect(swingEquation_omega.electricConnect_a, generator.powerConnection) 
            annotation (points=[38,46; 22.6,46], style(pattern=0, thickness=2));
        end testSTgrid2;
        
        model test_SwingEquation_om 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-72,-34; -12,26]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,74; 12,94]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-54,74; -74,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-94,74; -74,94]);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            height=+0.8,
            offset=0.2,
            duration=30,
            startTime=2000) 
            annotation (extent=[-24,54; -44,74]);
          Electrical.Generator generator 
                              annotation (extent=[-8,-24; 32,16]);
          SwingEquation_omega_approx swingEquation_theta(
            delta_start=0.5, Pmax=30e6) 
                  annotation (extent=[48,-14; 68,6]);
          Grid_om grid(
                    Pn=50e8, droop=0) annotation (extent=[76,-14; 96,6]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,84;
                -18.9,84; -18.9,20],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-64,54;
                -64,19.7; -64.5,19.7],         style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-74,84; -64,84; -64,74], style(thickness=2));
          connect(com_valveHP.y,valveHP. theta) annotation (points=[-45,64; -56,
                64],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(generator.shaft, steamTurbineStodola.shaft_b) annotation (
              points=[-5.2,-4; -14,-4; -14,-4; -22.8,-4],
                                        style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
          connect(swingEquation_theta.powerConnection_a, generator.powerConnection) 
            annotation (points=[50,-4; 39.6,-4; 39.6,-4; 29.2,-4], style(
                pattern=0, thickness=2));
          connect(swingEquation_theta.powerConnection_b, grid.connection) 
            annotation (points=[66,-4; 77.4,-4], style(pattern=0, thickness=2));
        end test_SwingEquation_om;
        
        model Generatorjj "Active power generator" 
          import Modelica.SIunits.Conversions.NonSIunits.*;
          parameter Real eta=1 "Conversion efficiency";
          parameter Boolean hasInertia = false 
            "Model accounts for rotational inertia";
          parameter MomentOfInertia J=0 "Moment of inertia";
          parameter Integer Np=2 "Number of electrical poles";
          Energy E "Rotational kinetic energy";
          AngularVelocity omega "Shaft angular velocity";
          AngularVelocity_rpm n "Rotational speed";
          Frequency f "Electrical frequency";
          Real Pm;
          Electrical.PowerConnection powerConnection 
                                          annotation (extent=[72,-14; 100,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-14; -72,14]);
        equation 
          omega=der(shaft.phi) "Mechanical boundary condition";
          f=Np*omega/(2*Modelica.Constants.pi) "Electrical frequency";
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          Pm=omega*shaft.tau;
          powerConnection.f=f "Electrical boundary condition";
          if hasInertia then
            E=1/2*J*omega^2 "Kinetic energy";
            der(E)=omega*shaft.tau-powerConnection.W/eta "Energy balance";
          else
            E=0 "Kinetic energy";
            0=omega*shaft.tau+powerConnection.W/eta "Energy balance";
          end if annotation (Diagram);
          annotation (Icon(
              Rectangle(extent=[-72,6; -48,-8],  style(
                  color=76,
                  gradient=2,
                  fillColor=9)),
              Ellipse(extent=[50,-50; -50,50], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=7,
                  rgbfillColor={255,255,255},
                  fillPattern=1)),
              Line(points=[50,0; 72,0], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255},
                  fillPattern=1)),
              Text(
                extent=[-26,24; 28,-28],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=7,
                  rgbfillColor={255,255,255},
                  fillPattern=1),
                string="G")));
        end Generatorjj;
        
        model Prova 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-72,-34; -12,26]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,74; 12,94]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-54,74; -74,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-94,74; -74,94]);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            height=0.7,
            duration=5,
            offset=0.3,
            startTime=1000) 
            annotation (extent=[-24,54; -44,74]);
          Modelica.Mechanics.Rotational.Inertia inertia(w_start=314.16/2, J=
                7000) 
            annotation (extent=[-6,-14; 14,6]);
          Modelica.Mechanics.Rotational.Damper damper(d=25) 
            annotation (extent=[20,-72; 40,-52],   rotation=0);
          Modelica.Mechanics.Rotational.Fixed fixed 
            annotation (extent=[62,-84; 82,-64]);
          Modelica.Blocks.Sources.BooleanStep booleanStep(startTime=
                400000000000, startValue=true) 
            annotation (extent=[26,28; 46,48]);
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.prove.Generator_SE_usatneiTest
            generator(
            J=25000,
            D=25,
            delta_start=0.5,
            omegaGen_nom=314.16) annotation (extent=[26,-14; 46,6]);
          Electrical.Breaker breaker annotation (extent=[52,-14; 72,6]);
          Electrical.Grid grid(Pn=50e8) annotation (extent=[82,-14; 102,6]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,84;
                -18.9,84; -18.9,20],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-64,54;
                -64,19.7; -64.5,19.7],         style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-74,84; -64,84; -64,74], style(thickness=2));
          connect(com_valveHP.y,valveHP. theta) annotation (points=[-45,64; -56,
                64],
              style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=30,
              rgbfillColor={230,230,230},
              fillPattern=1));
          connect(damper.flange_b,fixed. flange_b) annotation (points=[40,-62;
                72,-62; 72,-74],   style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2,
              fillColor=7,
              rgbfillColor={255,255,255},
              fillPattern=1));
          connect(inertia.flange_a, steamTurbineStodola.shaft_b) annotation (
              points=[-6,-4; -22.8,-4], style(color=0, rgbcolor={0,0,0}));
          connect(damper.flange_a, steamTurbineStodola.shaft_b) annotation (
              points=[20,-62; -14,-62; -14,-4; -22.8,-4], style(color=0,
                rgbcolor={0,0,0}));
          connect(generator.shaft, inertia.flange_b) annotation (points=[27,-4;
                14,-4], style(color=0, rgbcolor={0,0,0}));
          connect(breaker.connection1, generator.powerConnection) annotation (
              points=[53.4,-4; 43.2,-4], style(pattern=0, thickness=2));
          connect(breaker.closed, booleanStep.y) annotation (points=[62,4; 56,4;
                56,38; 47,38], style(color=5, rgbcolor={255,0,255}));
          connect(grid.connection, breaker.connection2) annotation (points=[
                83.4,-4; 70.6,-4], style(pattern=0, thickness=2));
        end Prova;
        
        model Generator_SE_provaBreaker 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax;
          parameter Real J;
          parameter Real D;
          parameter SI.Angle delta_start;
          parameter SI.AngularVelocity omegaGen_nom;
          parameter SI.AngularVelocity omega_start;
          
          SI.AngularVelocity omega( start=omega_start) "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.AngularVelocity d_thetaGrid;
          SI.Power Pe;
          SI.Power Pm;
          Real M;
          Real R;
          
          Electrical.PowerConnection powerConnection 
                                            annotation (extent=[58,-14; 86,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,40; 60,-40],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G")), Diagram);
                 annotation (Diagram);
          Modelica.Blocks.Interfaces.BooleanInput closed 
            annotation (extent=[-10,60; 10,80],  rotation=-90);
        equation 
          M=J/4*omegaGen_nom;
          R=D/4*omegaGen_nom;
          omega=der(shaft.phi) "Mechanical boundary condition";
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          d_delta = omega*Np - d_thetaGrid;
          d_thetaGrid = 2*Modelica.Constants.pi*powerConnection.f;
          powerConnection.W = - Pe;
          der(delta) = d_delta;
          
          if closed then
            Pe = Pmax*Modelica.Math.sin(delta);
            M*der(d_delta) + R*d_delta = Pm - Pe - R*d_thetaGrid;
            
          else
            J*omega*der(omega) + D*omega^2 = Pm;
            Pe = 0;
            
          end if;
          
        end Generator_SE_provaBreaker;
        
        model testST_proveBreaker 
          replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
            Modelica.Media.Interfaces.PartialPureSubstance;
          
          annotation (Diagram, experiment(StopTime=15000, NumberOfIntervals=
                  50000));
          SteamTurbineGroup.Examples.ST3LRh_valve steamTurbines(
            redeclare package FluidMedium = FluidMedium,
            steamHPNomFlowRate=67.6,
            steamHPNomPressure=1.28e7,
            steamIPNomFlowRate=81.10 - 67.5,
            steamIPNomPressure=2.68e6,
            steamLPNomPressure=6e5,
            pcond=5.3982e3,
            steamLPNomFlowRate=89.82 - 81.10,
            HPT_hstart_in=3.47e6,
            HPT_hstart_out=3.1076e6,
            IPT_hstart_in=3.554e6,
            IPT_hstart_out=3.12810e6,
            LPT_hstart_in=3.109e6,
            LPT_hstart_out=2.3854e6,
            valveHP_dpnom=1.6e5,
            valveIP_dpnom=5e4,
            mixLP_hstart=3.109e6,
            mixIP_hstart=3.1076e6,
            HPT_eta_iso_nom=0.833,
            IPT_eta_iso_nom=0.903,
            LPT_eta_iso_nom=0.876,
            mixLP_V=20,
            mixIP_V=20,
            valveHP_Cv=1165,
            valveIP_Cv=5625,
            valveLP_Cv=14733,
            valveLP_dpnom=2.964e4,
            HPT_Kt=0.0032078,
            IPT_Kt=0.018883,
            LPT_Kt=0.078004) 
                         annotation (extent=[-88,-42; -8,38]);
          Water.SinkP sinkLPT_p(
            redeclare package Medium = FluidMedium,
            p0=5.3982e3,
            h=2.3854e6)      annotation (extent=[-34,-66; -46,-54],
                                                                  rotation=0);
        public 
          Modelica.Blocks.Sources.Ramp com_valveHP(
            height=0.8,
            offset=0.2,
            startTime=10000,
            duration=10) 
            annotation (extent=[84,-12; 64,8]);
          Water.SourceP sourceHPT_p(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-82,52; -70,64], rotation=270);
          Water.SourceP sourceLPT(h=3.109e6, p0=6.296e5) 
            annotation (extent=[-34,52; -22,64], rotation=270);
          Modelica.Blocks.Sources.Ramp com_valveIP(
            offset=1,
            startTime=12000,
            height=-0.9,
            duration=10)  annotation (extent=[84,-52; 64,-32]);
          Water.SourceP sourceToMix(p0=2.98e6, h=3.1076e6) 
            annotation (extent=[-46,66; -34,78], rotation=270);
          SteamTurbineGroup.Components.EffectHE Rh(
                                 dh=3.544e6 - 3.108e6, dp=2.98e6 - 2.73e6) 
            annotation (extent=[-52,74; -64,86], rotation=180);
          HRSG.Components.StateReader_water stateHPTout 
            annotation (extent=[-74,52; -54,72], rotation=90);
          HRSG.Components.StateReader_water stateIPTin 
            annotation (extent=[-62,72; -42,52], rotation=90);
        protected 
          Buses.Actuators actuators annotation (extent=[24,-62; 34,-22], rotation=
               180);
        public 
          Modelica.Blocks.Sources.Ramp com_valveLP(
            height=0,
            offset=1,
            startTime=0,
            duration=10)  annotation (extent=[84,-90; 64,-70]);
          Grid_om grid(                                                     Pn=
                50e8, droop=0)       annotation (extent=[60,30; 80,50]);
          Generator_SE_provaBreaker generator_SE_om_approx(
            Pmax=130e6,
            D=25,
            J=30000,
            delta_start=1.03682,
            omegaGen_nom=314.16,
            omega_start=314.16/2) 
                            annotation (extent=[18,30; 38,50]);
        public 
          Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
            annotation (extent=[-12,60; 8,80]);
        equation 
          connect(actuators,steamTurbines. ActuatorsBus)   annotation (points=[29,-42;
                2,-42; 2,-30.8; -8.8,-30.8],        style(color=52, rgbcolor={213,
                  255,170}));
          connect(sinkLPT_p.flange,steamTurbines. LPT_Out) 
            annotation (points=[-34,-60; -16,-60; -16,-42],
                                                          style(thickness=2));
          connect(steamTurbines.LPT_In,sourceLPT. flange) 
            annotation (points=[-28,38; -28,52], style(thickness=2));
          connect(steamTurbines.HPT_In,sourceHPT_p. flange) 
            annotation (points=[-76,38; -76,52], style(thickness=2));
          connect(com_valveHP.y,actuators. Opening_valveHP) annotation (points=[63,-2;
                46,-2; 46,-42; 29,-42],              style(color=74, rgbcolor={0,
                  0,127}));
          connect(com_valveIP.y,actuators. Opening_valveIP) annotation (points=[63,-42;
                29,-42],         style(color=74, rgbcolor={0,0,127}));
          connect(sourceToMix.flange,steamTurbines. SteamToMix) 
            annotation (points=[-40,66; -40,38], style(thickness=2));
          connect(stateIPTin.outlet,steamTurbines. IPT_In) 
            annotation (points=[-52,56; -52,38], style(thickness=2));
          connect(stateHPTout.inlet,steamTurbines. HPT_Out) 
            annotation (points=[-64,56; -64,38], style(thickness=2));
          connect(stateHPTout.outlet,Rh. in1) annotation (points=[-64,68; -64,
                80; -64.06,80],     style(thickness=2));
          connect(stateIPTin.inlet,Rh. out1) 
            annotation (points=[-52,68; -52,80], style(thickness=2));
          connect(com_valveLP.y, actuators.Opening_valveLP) annotation (points=
                [63,-80; 46,-80; 46,-42; 29,-42], style(color=74, rgbcolor={0,0,
                  127}));
          connect(generator_SE_om_approx.powerConnection, grid.connection) 
            annotation (points=[35.2,40; 61.4,40], style(pattern=0, thickness=2));
          connect(generator_SE_om_approx.shaft, steamTurbines.Shaft_b) 
            annotation (points=[19,40; 4,40; 4,-2; -8,-2], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
          connect(booleanConstant.y, generator_SE_om_approx.closed) annotation (
             points=[9,70; 28,70; 28,47], style(color=5, rgbcolor={255,0,255}));
        end testST_proveBreaker;
        
        model Generator_SE_ngen 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax;
          parameter Real J;
          parameter Real D;
          parameter SI.Angle delta_start;
          parameter SI.AngularVelocity omegaRef "System reference frequency";
          parameter SI.AngularVelocity omegaGen_nom;
          
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start);
          SI.AngularVelocity d_delta;
          SI.Angle delta_ext;
          SI.Angle delta_int;
          SI.Power Pe;
          SI.Power Pm;
          Real M;
          Real R;
          
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,40; 60,-40],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G")), Diagram);
                 annotation (Diagram);
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.SwingEqConnection
            SEconnection annotation (extent=[60,-16; 92,16]);
        equation 
          M=J/4*omegaGen_nom;
          R=D/4*omegaGen_nom;
          omega=der(shaft.phi) "Mechanical boundary condition";
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          der(delta) = d_delta;
          d_delta = omega*Np - omegaRef;
          M*der(d_delta) + R*d_delta = Pm - Pe - R*omegaRef;
          SEconnection.W = - Pe;
          Pe=Pmax*sin(delta_int - delta_ext);
          delta_int = SEconnection.delta_int;
          delta_ext = SEconnection.delta_ext;
        end Generator_SE_ngen;
        
        model SE_2Gen 
          
          SwingEqConnection SEconnection_a annotation (extent=[-96,-16; -64,16]);
          SwingEqConnection SEconnection_b annotation (extent=[64,-16; 96,16]);
          annotation (Diagram);
          
        equation 
          SEconnection_a.W + SEconnection_b.W = 0;
          SEconnection_a.delta_int = SEconnection_b.delta_ext;
          SEconnection_b.delta_int = SEconnection_a.delta_ext;
        end SE_2Gen;
        
        model test_SE2Gen 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-60,8; -20,48]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,70; 12,90]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-60,74; -80,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-100,74; -80,94]);
          Water.SteamTurbineStodola steamTurbineStodola1(
            pstart_in=2.68e6,
            pstart_out=6e5,
            wstart=81.10,
            hstartin=3.554e6,
            hstartout=3.1281e6,
            wnom=81.10,
            eta_iso_nom=0.903,
            Kt=0.018883)     annotation (extent=[-60,-100; -20,-60]);
          Water.SinkP sinkP1(
                            p0=6e5, h=3.1281e6) 
            annotation (extent=[-12,-50; 8,-30]);
          Water.ValveVap valveIP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=81.1,
            hstart=3.554e6,
            dpnom=5e4,
            pnom=2.73e6,
            Cv=5625)             annotation (extent=[-62,-32; -82,-52],
                                                                     rotation=90);
          Water.SourceP sourceP1(           h=3.554e6, p0=2.73e6) 
            annotation (extent=[-100,-30; -80,-10]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP1 
            annotation (extent=[-32,-52; -52,-32]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP2 
            annotation (extent=[-30,54; -50,74]);
          Generator_SE_ngen_2 generator_SE_ngen_2_1 
            annotation (extent=[4,18; 24,38]);
          Generator_SE_ngen_2 generator_SE_ngen_2_2 
            annotation (extent=[4,-90; 24,-70]);
          SE_2Gen_2 sE_2Gen_2_1(
            Ja=7000,
            Jb=7000,
            Da=25,
            Db=25,
            omegaGen_nom=314.16,
            omegaRef=314.16,
            Pmax=4e6) annotation (extent=[52,-28; 72,-8]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,80;
                -24.6,80; -24.6,44],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-70,54;
                -70,43.8; -55,43.8],           style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-80,84; -70,84; -70,74], style(thickness=2));
          connect(sinkP1.flange, steamTurbineStodola1.outlet) 
                                                            annotation (points=[-12,-40;
                -24.6,-40; -24.6,-64],           style(thickness=2));
          connect(valveIP.outlet, steamTurbineStodola1.inlet) 
                                                             annotation (points=[-72,-52;
                -72,-64.2; -55,-64.2],         style(thickness=2));
          connect(sourceP1.flange, valveIP.inlet) 
            annotation (points=[-80,-20; -72,-20; -72,-32],
                                                         style(thickness=2));
          connect(com_valveHP1.y, valveIP.theta) 
                                             annotation (points=[-53,-42; -64,
                -42],
              style(color=74, rgbcolor={0,0,127}));
          connect(com_valveHP2.y, valveHP.theta) annotation (points=[-51,64;
                -62,64], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(generator_SE_ngen_2_1.shaft, steamTurbineStodola.shaft_b) 
            annotation (points=[5,28; -27.2,28], style(
              color=0,
              rgbcolor={0,0,0},
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(generator_SE_ngen_2_2.shaft, steamTurbineStodola1.shaft_b) 
            annotation (points=[5,-80; -27.2,-80], style(
              color=0,
              rgbcolor={0,0,0},
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(sE_2Gen_2_1.SEconnection_a, generator_SE_ngen_2_1.SEconnection) 
            annotation (points=[54,-18; 40,-18; 40,28; 21.6,28], style(
              color=46,
              rgbcolor={127,127,0},
              thickness=1,
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(sE_2Gen_2_1.SEconnection_b, generator_SE_ngen_2_2.SEconnection) 
            annotation (points=[70,-18; 90,-18; 90,-80; 21.6,-80], style(
              color=46,
              rgbcolor={127,127,0},
              thickness=1,
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
        end test_SE2Gen;
        
        model Generator_SE_ngen_2 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          
          SI.AngularVelocity omegaGen;
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Power Pm;
          
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,40; 60,-40],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G")), Diagram);
                 annotation (Diagram);
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.SwingEqConnection
            SEconnection annotation (extent=[60,-16; 92,16]);
        equation 
          
          omega=der(shaft.phi) "Mechanical boundary condition";
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          omegaGen=omega*Np;
          SEconnection.W = - Pm;
          SEconnection.omega = omegaGen;
          
        end Generator_SE_ngen_2;
        
        model SE_2Gen_2 
          parameter SI.Power Pmax;
          parameter Real Ja;
          parameter Real Jb;
          parameter Real Da;
          parameter Real Db;
          parameter Real omegaGen_nom;
          parameter Real omegaRef;
          
          SI.Angle delta_a;
          SI.Angle delta_b;
          SI.AngularVelocity d_delta_a;
          SI.AngularVelocity d_delta_b;
          SI.AngularVelocity omega_a;
          SI.AngularVelocity omega_b;
          SI.Power Pma;
          SI.Power Pmb;
          SI.Power Pa;
          SI.Power Pb;
          Real Ma;
          Real Mb;
          Real Ra;
          Real Rb;
          
          SwingEqConnection SEconnection_a annotation (extent=[-96,-16; -64,16]);
          SwingEqConnection SEconnection_b annotation (extent=[64,-16; 96,16]);
          annotation (Diagram);
          
        equation 
          Ma=Ja/4*omegaGen_nom;
          Ra=Da/4*omegaGen_nom;
          Mb=Jb/4*omegaGen_nom;
          Rb=Db/4*omegaGen_nom;
          
          Pma=SEconnection_a.W;
          Pmb=SEconnection_b.W;
          omega_a=SEconnection_a.omega;
          omega_b=SEconnection_b.omega;
          d_delta_a=omega_a-omegaRef;
          d_delta_b=omega_b-omegaRef;
          d_delta_a=der(delta_a);
          d_delta_b=der(delta_b);
          
          Ma*der(d_delta_a) + Ra*d_delta_a = Pma - Pa - Ra*omegaRef;
          Mb*der(d_delta_b) + Rb*d_delta_b = Pmb - Pb - Rb*omegaRef;
          Pa=Pmax*sin(delta_a - delta_b);
          Pb=Pmax*sin(delta_b - delta_a);
          
        end SE_2Gen_2;
      end prove;
      
      package copie 
        model Generator_SE_com 
          "Electric generator inclusive of complex swing equation" 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax "Output maximum power";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real D "Damping constant of shaft";
          parameter SI.Angle delta_start "Start value of loaded angle";
          
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          SI.Power Pe "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          Real M "Auxiliary variable";
          Real R "Auxiliary variable";
          
          Electrical.PowerConnection powerConnection 
                                            annotation (extent=[58,-14; 86,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,60; 60,-20],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G"),
              Text(
                extent=[-60,-10; 60,-50],
                string="SE",
                style(color=58, rgbcolor={0,127,0}))),
                              Diagram);
          
        equation 
          M=J/4*157.08*Np;
          R=D/4*157.08*Np;
          omega=der(shaft.phi);
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          omegaGrid = 2*Modelica.Constants.pi*powerConnection.f;
          powerConnection.W = - Pe;
          
          //Definition of loaded angle  
          d_delta = omega*Np - omegaGrid;
          der(delta) = d_delta;
          
          //Swing Equation    
          M*der(d_delta) + R*d_delta = Pm - Pe - R*omegaGrid;
          Pe = Pmax*Modelica.Math.sin(delta);
          
        end Generator_SE_com;
        
        model Generator_SE_Breaker 
          "Electic generator inclusive of approximate swing equation and breaker for connection grid" 
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax "Maximum power of generator";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real D "Damping constant of shaft";
          parameter SI.Angle delta_start "Loaded angle start value";
          parameter SI.AngularVelocity omega_nom 
            "Nominal angulary velocity of shaft";
          parameter SI.AngularVelocity omega_start 
            "Angulaty velocity of shaft start value";
          
          SI.AngularVelocity omega( start=omega_start) "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          SI.Power Pe "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          Real M "Auxiliary variable";
          Real R "Auxiliary variable";
          
          Electrical.PowerConnection powerConnection 
                                            annotation (extent=[58,-14; 86,14]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,60; 60,-20],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G"),
              Text(
                extent=[-60,-10; 60,-50],
                string="SE",
                style(color=58, rgbcolor={0,127,0}))),
                              Diagram);
                 annotation (Diagram);
          Modelica.Blocks.Interfaces.BooleanInput closed 
            annotation (extent=[-10,58; 10,78],  rotation=-90);
          Modelica.Blocks.Interfaces.RealOutput delta_out 
            annotation (extent=[-10,-78; 10,-58],
                                                rotation=270);
        equation 
          M=J/4*omega_nom*Np;
          R=D/4*omega_nom*Np;
          omega=der(shaft.phi);
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          omegaGrid = 2*Modelica.Constants.pi*powerConnection.f;
          powerConnection.W = - Pe;
          
          //Definition loaded angle
          d_delta = omega*Np - omegaGrid;
          der(delta) = d_delta;
          
          if closed then
            //swing equation
            Pe = Pmax*Modelica.Math.sin(delta);
            M*der(d_delta) + R*d_delta = Pm - Pe - R*omegaGrid;
          else
            //Free turbine and not connection a grid
            J*omega*der(omega) + D*omega^2 = Pm;
            Pe = 0;
          end if;
          
          //Output signal
          delta_out = delta - integer(delta/(2*Modelica.Constants.pi))*2*Modelica.Constants.pi;
          
        end Generator_SE_Breaker;
        
        model SwingEquation 
          
          parameter SI.Power Pmax "Output maximum power";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real D "Damping constant of shaft";
          parameter SI.Angle delta_start "Start value of loaded angle";
          
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          SI.AngularVelocity omegaGen "Angulary velocity of the generator";
          SI.Power Pe "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          Real M "Auxiliary variable";
          Real R "Auxiliary variable";
          
          ThermoPower.Electrical.PowerConnection powerConnection_a 
            annotation (extent=[-94,-14; -66,14]);
          ThermoPower.Electrical.PowerConnection powerConnection_b 
                                            annotation (extent=[66,-14; 94,14]);
          Modelica.Blocks.Interfaces.RealOutput delta_out 
            annotation (extent=[-10,56; 10,76], rotation=90);
          annotation (Diagram, Icon(Rectangle(extent=[-80,60; 80,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  fillColor=30,
                  rgbfillColor={230,230,230})), Text(
                extent=[-80,40; 86,-40],
                style(color=0, rgbcolor={0,0,0}),
                string="S.E.")));
          
        equation 
          M=J/4*omegaGen;
          R=D/4*omegaGen;
          Pm=powerConnection_a.W;
          omegaGrid = 2*Modelica.Constants.pi*powerConnection_b.f;
          omegaGen = 2*Modelica.Constants.pi*powerConnection_a.f;
          powerConnection_b.W = - Pe;
          
          //Definition of loaded angle  
          d_delta = omega*Np - omegaGrid;
          der(delta) = d_delta;
          
          //Swing Equation    
          M*der(d_delta) + R*d_delta = Pm - Pe - R*omegaGrid;
          Pe = Pmax*Modelica.Math.sin(delta);
          
          //Output signal
          delta_out = delta - integer(delta/(2*Modelica.Constants.pi))*2*Modelica.Constants.pi;
          
        end SwingEquation;
      end copie;
      
      package prove2 
        model Generator_SE 
          "Electric generator inclusive of approximate swing equation" 
          //Parameter
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax "Output maximum power";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real r=0.3 "Damping of the system";
          parameter SI.AngularVelocity omega_nom 
            "Nominal angulary velocity of shaft";
          parameter SI.Angle delta_start "Loaded angle start value";
          
          //Variable  
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.Power P "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          Real M "Auxiliary variable";
          Real D "Auxiliary variable";
          
          //Connector
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,60; 60,-20],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G"),
              Text(
                extent=[-60,-10; 60,-50],
                style(color=58, rgbcolor={0,127,0}),
                string="SE")),Diagram);
          ConnectorSE connectorSE annotation (extent=[70,-10; 90,10]);
          
        equation 
          M=J/(Np^2)*omega_nom*Np;
          D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
          omega=der(shaft.phi);
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          delta = connectorSE.delta;
          connectorSE.W = - P;
          d_delta = der(delta);
          
          //Swing Equation  
          P = Pm - M*der(d_delta) - D*d_delta;
          
        end Generator_SE;
        
        model Generator_SE_prov 
          "Electric generator inclusive of approximate swing equation" 
          //Parameter
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax "Output maximum power";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real r=0.3 "Damping of the system";
          parameter SI.AngularVelocity f "Grid frequnacy";
          parameter SI.AngularVelocity omega_nom 
            "Nominal angulary velocity of shaft";
          parameter SI.Angle delta_start "Loaded angle start value";
          
          //Variable  
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          SI.Power Pe "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          SI.Power Pext;
          Real M "Auxiliary variable";
          Real D "Auxiliary variable";
          
          //Connector
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,60; 60,-20],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G"),
              Text(
                extent=[-60,-10; 60,-50],
                style(color=58, rgbcolor={0,127,0}),
                string="SE")),Diagram);
          
          ConnectorSE connectorSE annotation (extent=[50,-10; 70,10]);
        equation 
          M=J/(Np^2)*omega_nom*Np;
          D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
          omega=der(shaft.phi);
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          omegaGrid = 2*Modelica.Constants.pi*f;
          connectorSE.delta = delta;
          Pext = connectorSE.W;
          
          //Definition of loaded angle
          d_delta = omega*Np - omegaGrid;
          der(delta) = d_delta;
          
          //Swing Equation  
          M*der(d_delta) + D*d_delta = Pm - Pe/eta - Pext;
          Pe = Pmax*Modelica.Math.sin(delta);
          
        end Generator_SE_prov;
        
        model Generator_SE_close 
          "Electric generator inclusive of approximate swing equation" 
          //Parameter
          parameter Real eta=1 "Conversion efficiency";
          parameter Integer Np=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax "Output maximum power";
          parameter Real J "Moment of inertia of the system-shaft";
          parameter Real r=0.3 "Damping of the system";
          parameter SI.AngularVelocity f "Grid frequnacy";
          parameter SI.AngularVelocity omega_nom 
            "Nominal angulary velocity of shaft";
          parameter SI.Angle delta_start "Loaded angle start value";
          
          //Variable  
          SI.AngularVelocity omega "Shaft angular velocity";
          SI.Conversions.NonSIunits.AngularVelocity_rpm n "Rotational speed";
          SI.Angle delta(start=delta_start) "Loaded angle";
          SI.AngularVelocity d_delta "Variation of loaded angle";
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          SI.Power Pe "Outlet electric power";
          SI.Power Pm "Inlet mechanical power";
          Real M "Auxiliary variable";
          Real D "Auxiliary variable";
          
          //Connector
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft 
            annotation (extent=[-100,-10; -80,10]);
          annotation (Icon(
              Rectangle(extent=[-60,8; -90,-8], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  gradient=2,
                  fillColor=9,
                  rgbfillColor={175,175,175})),
              Ellipse(extent=[-60,60; 60,-60], style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230})),
              Text(
                extent=[-60,60; 60,-20],
                style(
                  color=0,
                  rgbcolor={0,0,0},
                  thickness=2,
                  fillColor=30,
                  rgbfillColor={230,230,230},
                  fillPattern=1),
                string="G"),
              Text(
                extent=[-60,-10; 60,-50],
                style(color=58, rgbcolor={0,127,0}),
                string="SE")),Diagram);
          
        equation 
          M=J/(Np^2)*omega_nom*Np;
          D=2*r*sqrt(Pmax*J*omega_nom*Np/(Np^2));
          omega=der(shaft.phi);
          Pm=omega*shaft.tau;
          n = Modelica.SIunits.Conversions.to_rpm(omega) 
            "Rotational speed in rpm";
          omegaGrid = 2*Modelica.Constants.pi*f;
          
          //Definition of loaded angle
          d_delta = omega*Np - omegaGrid;
          der(delta) = d_delta;
          
          //Swing Equation  
          M*der(d_delta) + D*d_delta = Pm - Pe/eta;
          Pe = Pmax*Modelica.Math.sin(delta);
          
        end Generator_SE_close;
        
        model SE 
          parameter SI.Power Pmax_a;
          parameter SI.Power Pmax_b;
          
          SI.Power Pext_a;
          SI.Power Pext_b;
          
          ConnectorSE connectorSE_a annotation (extent=[-90,-10; -70,10]);
          ConnectorSE connectorSE_b annotation (extent=[70,-10; 90,10]);
          
        equation 
          Pext_a = Pmax_a*Modelica.Math.sin(connectorSE_a.delta - connectorSE_b.delta);
          connectorSE_a.W = Pext_a;
          Pext_b = -Pext_a;
          connectorSE_b.W = Pext_b;
        end SE;
        
        model test_SE2Gen 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-60,8; -20,48]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,70; 12,90]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-60,74; -80,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-100,74; -80,94]);
          Water.SteamTurbineStodola steamTurbineStodola1(
            pstart_in=2.68e6,
            pstart_out=6e5,
            wstart=81.10,
            hstartin=3.554e6,
            hstartout=3.1281e6,
            wnom=81.10,
            eta_iso_nom=0.903,
            Kt=0.018883)     annotation (extent=[-60,-100; -20,-60]);
          Water.SinkP sinkP1(
                            p0=6e5, h=3.1281e6) 
            annotation (extent=[-12,-50; 8,-30]);
          Water.ValveVap valveIP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=81.1,
            hstart=3.554e6,
            dpnom=5e4,
            pnom=2.73e6,
            Cv=5625)             annotation (extent=[-62,-32; -82,-52],
                                                                     rotation=90);
          Water.SourceP sourceP1(           h=3.554e6, p0=2.73e6) 
            annotation (extent=[-100,-30; -80,-10]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP1 
            annotation (extent=[-32,-52; -52,-32]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP2 
            annotation (extent=[-30,54; -50,74]);
          Generator_SE_prov generator_SE_a(
            Pmax=30e6,
            eta=0.96,
            r=0.2,
            J=15000,
            omega_nom=157.08,
            f=314.16,
            delta_start=0.876683) 
                       annotation (extent=[0,8; 40,48]);
          Generator_SE_prov generator_SE_b(
            eta=0.96,
            r=0.2,
            J=15000,
            omega_nom=157.08,
            f=314.16,
            Pmax=38e6,
            delta_start=0.948846) 
                       annotation (extent=[0,-100; 40,-60]);
          SE sE(Pmax_a=400e6, Pmax_b=400e6) annotation (extent=[60,-20; 80,0]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,80;
                -24.6,80; -24.6,44],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-70,54;
                -70,43.8; -55,43.8],           style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-80,84; -70,84; -70,74], style(thickness=2));
          connect(sinkP1.flange, steamTurbineStodola1.outlet) 
                                                            annotation (points=[-12,-40;
                -24.6,-40; -24.6,-64],           style(thickness=2));
          connect(valveIP.outlet, steamTurbineStodola1.inlet) 
                                                             annotation (points=[-72,-52;
                -72,-64.2; -55,-64.2],         style(thickness=2));
          connect(sourceP1.flange, valveIP.inlet) 
            annotation (points=[-80,-20; -72,-20; -72,-32],
                                                         style(thickness=2));
          connect(com_valveHP1.y, valveIP.theta) 
                                             annotation (points=[-53,-42; -64,
                -42],
              style(color=74, rgbcolor={0,0,127}));
          connect(com_valveHP2.y, valveHP.theta) annotation (points=[-51,64;
                -62,64], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(generator_SE_a.shaft, steamTurbineStodola.shaft_b) 
            annotation (points=[2,28; -27.2,28], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
          connect(generator_SE_b.shaft, steamTurbineStodola1.shaft_b) 
            annotation (points=[2,-80; -27.2,-80], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
          connect(sE.connectorSE_a, generator_SE_a.connectorSE) annotation (
              points=[62,-10; 48,-10; 48,28; 32,28], style(
              color=46,
              rgbcolor={127,127,0},
              thickness=1));
          connect(sE.connectorSE_b, generator_SE_b.connectorSE) annotation (
              points=[78,-10; 90,-10; 90,-80; 32,-80], style(
              color=46,
              rgbcolor={127,127,0},
              thickness=1));
        end test_SE2Gen;
        
        model SE_2 
          
          parameter SI.AngularVelocity f "Grid frequnacy";
          
          parameter Real eta_a=1 "Conversion efficiency";
          parameter Integer Np_a=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax_a "Output maximum power";
          parameter Real J_a "Moment of inertia of the system-shaft";
          parameter Real r_a=0.3 "Damping of the system";
          parameter SI.AngularVelocity omega_nom_a 
            "Nominal angulary velocity of shaft";
          parameter SI.Angle delta_a_start "Loaded angle start value";
          
          parameter Real eta_b=1 "Conversion efficiency";
          parameter Integer Np_b=2 "Number of couple of electrical poles";
          parameter SI.Power Pmax_b "Output maximum power";
          parameter Real J_b "Moment of inertia of the system-shaft";
          parameter Real r_b=0.3 "Damping of the system";
          parameter SI.AngularVelocity omega_nom_b 
            "Nominal angulary velocity of shaft";
          parameter SI.Angle delta_b_start "Loaded angle start value";
          
          SI.AngularVelocity omegaGrid "Angulary velocity in the grid";
          
          SI.AngularVelocity omega_a "Shaft angular velocity";
          SI.Angle delta_a( start=delta_a_start) "Loaded angle";
          SI.AngularVelocity d_delta_a "Variation of loaded angle";
          SI.Power Pe_a "Outlet electric power";
          SI.Power Pm_a "Inlet mechanical power";
          SI.Power Pext_a;
          Real M_a "Auxiliary variable";
          Real D_a "Auxiliary variable";
          
          SI.AngularVelocity omega_b "Shaft angular velocity";
          SI.Angle delta_b( start=delta_b_start) "Loaded angle";
          SI.AngularVelocity d_delta_b "Variation of loaded angle";
          SI.Power Pe_b "Outlet electric power";
          SI.Power Pm_b "Inlet mechanical power";
          SI.Power Pext_b;
          Real M_b "Auxiliary variable";
          Real D_b "Auxiliary variable";
          
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_a 
            annotation (extent=[-90,-10; -70,10]);
          Modelica.Mechanics.Rotational.Interfaces.Flange_a shaft_b 
            annotation (extent=[70,-10; 90,10]);
        equation 
          omegaGrid = 2*Modelica.Constants.pi*f;
          
          M_a=J_a/(Np_a^2)*omega_nom_a*Np_a;
          D_a=2*r_a*sqrt(Pmax_a*J_a*omega_nom_a*Np_a/(Np_a^2));
          omega_a=der(shaft_a.phi);
          Pm_a=omega_a*shaft_a.tau;
          
          //Definition of loaded angle
          d_delta_a = omega_a*Np_a - omegaGrid;
          der(delta_a) = d_delta_a;
          
          //Swing Equation  
          M_a*der(d_delta_a) + D_a*d_delta_a = Pm_a - Pe_a/eta_a - Pext_a;
          Pe_a = Pmax_a*Modelica.Math.sin(delta_a);
          Pext_a = Pmax_a*Modelica.Math.sin(delta_a - delta_b);
          
          M_b=J_b/(Np_b^2)*omega_nom_b*Np_b;
          D_b=2*r_b*sqrt(Pmax_b*J_b*omega_nom_b*Np_b/(Np_b^2));
          omega_b=der(shaft_b.phi);
          Pm_b=omega_b*shaft_b.tau;
          
          //Definition of loaded angle
          d_delta_b = omega_b*Np_a - omegaGrid;
          der(delta_b) = d_delta_b;
          
          //Swing Equation  
          M_b*der(d_delta_b) + D_b*d_delta_b = Pm_b - Pe_b/eta_b - Pext_b;
          Pe_b = Pmax_b*Modelica.Math.sin(delta_b);
          Pext_b = -Pext_a;
          annotation (Diagram);
        end SE_2;
        
        model test_SE2Gen_2 
          annotation (Diagram);
          Water.SteamTurbineStodola steamTurbineStodola(
            pstart_in=1.28e7,
            pstart_out=2.98e6,
            wstart=67.6,
            hstartin=3.47e6,
            hstartout=3.1076e6,
            wnom=67.6,
            eta_iso_nom=0.833,
            Kt=0.0032078) 
                        annotation (extent=[-60,8; -20,48]);
          Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
            annotation (extent=[-8,70; 12,90]);
          Water.ValveVap valveHP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=67.6,
            hstart=3.47e6,
            pnom=1.296e7,
            dpnom=1.6e5,
            Cv=1165)             annotation (extent=[-60,74; -80,54],rotation=90);
          Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
            annotation (extent=[-100,74; -80,94]);
          Water.SteamTurbineStodola steamTurbineStodola1(
            pstart_in=2.68e6,
            pstart_out=6e5,
            wstart=81.10,
            hstartin=3.554e6,
            hstartout=3.1281e6,
            wnom=81.10,
            eta_iso_nom=0.903,
            Kt=0.018883)     annotation (extent=[-60,-100; -20,-60]);
          Water.SinkP sinkP1(
                            p0=6e5, h=3.1281e6) 
            annotation (extent=[-12,-50; 8,-30]);
          Water.ValveVap valveIP(
            CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
            CheckValve=true,
            wnom=81.1,
            hstart=3.554e6,
            dpnom=5e4,
            pnom=2.73e6,
            Cv=5625)             annotation (extent=[-62,-32; -82,-52],
                                                                     rotation=90);
          Water.SourceP sourceP1(           h=3.554e6, p0=2.73e6) 
            annotation (extent=[-100,-30; -80,-10]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP1 
            annotation (extent=[-32,-52; -52,-32]);
        public 
          Modelica.Blocks.Sources.Constant com_valveHP2 
            annotation (extent=[-30,54; -50,74]);
          SE_2 generator_SE_a(
            Pmax_a=30e6,
            J_a=1500,
            r_a=0.2,
            omega_nom_a=157.08,
            delta_a_start=0.876683,
            Pmax_b=40e6,
            J_b=15000,
            r_b=0.2,
            omega_nom_b=157.08,
            delta_b_start=0.948846,
            f=50)      annotation (extent=[20,0; 60,40]);
        equation 
          connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-8,80;
                -24.6,80; -24.6,44],             style(thickness=2));
          connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-70,54;
                -70,43.8; -55,43.8],           style(thickness=2));
          connect(sourceP.flange,valveHP. inlet) 
            annotation (points=[-80,84; -70,84; -70,74], style(thickness=2));
          connect(sinkP1.flange, steamTurbineStodola1.outlet) 
                                                            annotation (points=[-12,-40;
                -24.6,-40; -24.6,-64],           style(thickness=2));
          connect(valveIP.outlet, steamTurbineStodola1.inlet) 
                                                             annotation (points=[-72,-52;
                -72,-64.2; -55,-64.2],         style(thickness=2));
          connect(sourceP1.flange, valveIP.inlet) 
            annotation (points=[-80,-20; -72,-20; -72,-32],
                                                         style(thickness=2));
          connect(com_valveHP1.y, valveIP.theta) 
                                             annotation (points=[-53,-42; -64,
                -42],
              style(color=74, rgbcolor={0,0,127}));
          connect(com_valveHP2.y, valveHP.theta) annotation (points=[-51,64;
                -62,64], style(
              color=74,
              rgbcolor={0,0,127},
              fillColor=46,
              rgbfillColor={127,127,0},
              fillPattern=1));
          connect(generator_SE_a.shaft_a, steamTurbineStodola.shaft_b) 
            annotation (points=[24,20; -2,20; -2,28; -27.2,28], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
          connect(generator_SE_a.shaft_b, steamTurbineStodola1.shaft_b) 
            annotation (points=[56,20; 70,20; 70,-80; -27.2,-80], style(
              color=0,
              rgbcolor={0,0,0},
              thickness=2));
        end test_SE2Gen_2;
      end prove2;
    end Components;
    
    package Examples 
      model SingleShaft_static 
        "Alternator group in configuration single-shaft (one generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.SingleShaft;
        
        Electrical.Grid grid(fn=fn, Pn=Pn) annotation (extent=[68,-10; 88,10]);
        Electrical.Generator generator(eta=eta) 
                 annotation (extent=[-44,-20; -4,20]);
        Components.PowerSensor powerSensor annotation (extent=[12,-8; 28,8]);
        annotation (Diagram);
        Components.FrequencySensor frequencySensor 
          annotation (extent=[12,20; 28,36]);
        Modelica.Mechanics.Rotational.Inertia inertia(J=J_shaft, w_start=omega_nom,
          initType=Options.steadyState) 
          annotation (extent=[-78,-10; -58,10]);
        Modelica.Mechanics.Rotational.Damper damper(d=d_shaft) 
          annotation (extent=[-72,-38; -52,-18], rotation=0);
        Modelica.Mechanics.Rotational.Fixed fixed 
          annotation (extent=[-50,-50; -30,-30]);
        Electrical.Breaker breaker annotation (extent=[40,10; 60,-10]);
      equation 
        connect(inertia.flange_a, shaft) annotation (points=[-78,0; -100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper.flange_a, shaft) annotation (points=[-72,-28; -90,-28;
              -90,0; -100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper.flange_b, fixed.flange_b) annotation (points=[-52,-28;
              -40,-28; -40,-40], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia.flange_b, generator.shaft) annotation (points=[-58,0;
              -50.6,0; -50.6,3.55271e-016; -41.2,3.55271e-016], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(generator.powerConnection, powerSensor.port_a) annotation (
            points=[-6.8,3.55271e-016; 0.6,3.55271e-016; 0.6,0; 12,0], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor.port, generator.powerConnection) annotation (
            points=[12,28; 0,28; 0,3.55271e-016; -6.8,3.55271e-016], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor.port_b, breaker.connection1) annotation (points=[28,-0.16;
              34,-0.16; 34,-1.77636e-016; 41.4,-1.77636e-016],      style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(breaker.connection2, grid.connection) annotation (points=[58.6,
              -1.77636e-016; 64,-3.1606e-022; 64,1.77636e-016; 69.4,
              1.77636e-016], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(ActuatorsBus.breakerClosed, breaker.closed) annotation (points=
              [98,-72; 50,-72; 50,-8], style(color=52, rgbcolor={213,255,170}));
        connect(SensorsBus.power, powerSensor.W) annotation (points=[98,-40; 20,
              -40; 20,-7.52], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.frequency, frequencySensor.f) annotation (points=[98,
              -40; 34,-40; 34,28; 28.16,28], style(color=84, rgbcolor={255,170,
                213}));
      end SingleShaft_static;
      
      model DoubleShaft_static 
        "Alternator group in configuration double-shaft (two generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.DoubleShaft;
        Electrical.Generator generator_A(eta=eta_A) 
                                       annotation (extent=[-40,40; 0,80]);
        Modelica.Mechanics.Rotational.Inertia inertia_A(J=J_shaft_A, w_start=
              omega_nom_A) 
          annotation (extent=[-76,50; -56,70]);
        Modelica.Mechanics.Rotational.Damper damper_A(d=d_shaft_A) 
          annotation (extent=[-72,10; -52,30], rotation=0);
        Modelica.Mechanics.Rotational.Fixed fixed 
          annotation (extent=[-46,-10; -26,10], rotation=90);
        Electrical.Breaker breaker_A 
                                   annotation (extent=[40,70; 60,50]);
        Electrical.Generator generator_B(eta=eta_B) 
                                        annotation (extent=[-40,-80; 0,-40]);
        Modelica.Mechanics.Rotational.Inertia inertia_B(J=J_shaft_B, w_start=
              omega_nom_B) 
          annotation (extent=[-76,-70; -56,-50]);
        Modelica.Mechanics.Rotational.Damper damper_B(d=d_shaft_B) 
          annotation (extent=[-72,-30; -52,-10], rotation=0);
        Electrical.Breaker breaker_B 
                                    annotation (extent=[40,-70; 60,-50]);
        Components.PowerSensor powerSensor_A 
                                            annotation (extent=[16,52; 32,68]);
        Components.FrequencySensor frequencySensor_A 
          annotation (extent=[14,74; 30,90]);
        Components.PowerSensor powerSensor_B 
                                            annotation (extent=[14,-68; 30,-52]);
        Components.FrequencySensor frequencySensor_B 
          annotation (extent=[14,-42; 30,-26]);
        annotation (Diagram);
        ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.Grid_2in grid(
            Pn=Pn, fn=fn) 
                   annotation (extent=[74,0; 94,20]);
      equation 
        connect(inertia_B.flange_a, shaft_B) annotation (points=[-76,-60; -100,
              -60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(generator_B.shaft, inertia_B.flange_b) annotation (points=[-37.2,
              -60; -56,-60],                         style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor_B.port_a, generator_B.powerConnection) 
                                                                  annotation (
            points=[14,-60; -2.8,-60], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor_B.port, generator_B.powerConnection) 
                                                                    annotation (
           points=[14,-34; 8,-34; 8,-60; -2.8,-60], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(breaker_B.connection1, powerSensor_B.port_b) 
                                                           annotation (points=[
              41.4,-60; 35.7,-60; 35.7,-60.16; 30,-60.16], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(breaker_A.connection1, powerSensor_A.port_b) 
                                                          annotation (points=[41.4,60;
              35.7,60; 35.7,59.84; 32,59.84],          style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor_A.port_a, generator_A.powerConnection) 
                                                                  annotation (
            points=[16,60; -2.8,60], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor_A.port, generator_A.powerConnection) 
                                                                    annotation (
           points=[14,82; 8,82; 8,60; -2.8,60], style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_B.flange_a, shaft_B) annotation (points=[-72,-20; -88,
              -20; -88,-60; -100,-60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_B.flange_b, fixed.flange_b) annotation (points=[-52,-20;
              -36,-20; -36,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_A.flange_b, fixed.flange_b) annotation (points=[-52,20;
              -36,20; -36,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_A.flange_a, shaft_A) annotation (points=[-72,20; -86,20;
              -86,60; -100,60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_A.flange_a, shaft_A) annotation (points=[-76,60; -100,
              60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_A.flange_b, generator_A.shaft) annotation (points=[-56,
              60; -37.2,60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(ActuatorsBus.breakerClosed_shaftA, breaker_A.closed) 
          annotation (points=[98,-72; 78,-72; 78,-20; 50,-20; 50,52], style(
              color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.breakerClosed_shaftB, breaker_B.closed) 
          annotation (points=[98,-72; 78,-72; 78,-20; 50,-20; 50,-52], style(
              color=52, rgbcolor={213,255,170}));
        connect(SensorsBus.power_shaftA, powerSensor_A.W) annotation (points=[
              98,-40; 36,-40; 36,40; 24,40; 24,52.48], style(color=84, rgbcolor=
               {255,170,213}));
        connect(SensorsBus.power_shaftB, powerSensor_B.W) annotation (points=[
              98,-40; 36,-40; 36,-80; 22,-80; 22,-67.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftA, frequencySensor_A.f) annotation (
            points=[98,-40; 36,-40; 36,82; 30.16,82], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.frequency_shaftB, frequencySensor_B.f) annotation (
            points=[98,-40; 36,-40; 36,-34; 30.16,-34], style(color=84,
              rgbcolor={255,170,213}));
        connect(grid.connection_B, breaker_B.connection2) annotation (points=[
              75.4,6; 68,6; 68,-60; 58.6,-60], style(pattern=0, thickness=2));
        connect(grid.connection_A, breaker_A.connection2) annotation (points=[
              75.4,14; 68,14; 68,60; 58.6,60], style(pattern=0, thickness=2));
      end DoubleShaft_static;
      
      model TripleShaft_static 
        "Alternator group in configuration triple-shaft (three generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.TripleShaft;
        Electrical.Generator generator_A(eta=eta_A) 
                                       annotation (extent=[-42,44; -2,84]);
        Components.PowerSensor powerSensor_A 
                                           annotation (extent=[12,56; 28,72]);
        Components.FrequencySensor frequencySensor_A 
          annotation (extent=[12,78; 28,94]);
        Modelica.Mechanics.Rotational.Inertia inertia_A(J=J_shaft_A, w_start=
              omega_nom_A) 
          annotation (extent=[-80,54; -60,74]);
        Modelica.Mechanics.Rotational.Damper damper_A(d=d_shaft_A) 
          annotation (extent=[-80,28; -60,48], rotation=0);
        Electrical.Breaker breaker_A 
                                   annotation (extent=[40,54; 60,74]);
        Electrical.Generator generator_B(eta=eta_B) 
                                        annotation (extent=[-42,-20; -2,20]);
        Components.PowerSensor powerSensor_B 
                                            annotation (extent=[12,-8; 28,8]);
        Components.FrequencySensor frequencySensor_B 
          annotation (extent=[12,14; 28,30]);
        Modelica.Mechanics.Rotational.Inertia inertia_B(J=J_shaft_B, w_start=
              omega_nom_B) 
          annotation (extent=[-80,-10; -60,10]);
        Modelica.Mechanics.Rotational.Damper damper_B(d=d_shaft_B) 
          annotation (extent=[-80,-40; -60,-20], rotation=0);
        Modelica.Mechanics.Rotational.Fixed fixed 
          annotation (extent=[-58,-40; -38,-20], rotation=90);
        Electrical.Breaker breaker_B 
                                    annotation (extent=[40,-10; 60,10]);
        Electrical.Generator generator_C(eta=eta_C) 
                                        annotation (extent=[-42,-84; -2,-44]);
        Components.PowerSensor powerSensor_C 
                                            annotation (extent=[12,-72; 28,-56]);
        Components.FrequencySensor frequencySensor_C 
          annotation (extent=[12,-48; 28,-32]);
        Modelica.Mechanics.Rotational.Inertia inertia_C(J=J_shaft_C, w_start=
              omega_nom_C) 
          annotation (extent=[-80,-74; -60,-54]);
        Modelica.Mechanics.Rotational.Damper damper_C(d=d_shaft_C) 
          annotation (extent=[-80,-96; -60,-76], rotation=0);
        Electrical.Breaker breaker_C 
                                    annotation (extent=[40,-74; 60,-54]);
        annotation (Diagram);
        Components.Grid_3in grid_3in(Pn=Pn, fn=fn) 
          annotation (extent=[76,-10; 96,10], rotation=0);
      equation 
        connect(fixed.flange_b, damper_B.flange_b) annotation (points=[-48,-30;
              -60,-30], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_C.flange_b, fixed.flange_b) annotation (points=[-60,-86;
              -48,-86; -48,-30], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(fixed.flange_b, damper_A.flange_b) annotation (points=[-48,-30;
              -48,38; -60,38], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_C.flange_b, generator_C.shaft) annotation (points=[-60,-64;
              -39.2,-64],      style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(generator_C.powerConnection, powerSensor_C.port_a) annotation (
            points=[-4.8,-64; 12,-64],style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor_C.port_b, breaker_C.connection1) annotation (points=[28,
              -64.16; 48,-64.16; 48,-64; 41.4,-64],    style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(breaker_B.connection1, powerSensor_B.port_b) annotation (points=[41.4,
              1.77636e-016; 53.55,1.77636e-016; 53.55,-0.16; 28,-0.16],
            style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor_B.port_a, generator_B.powerConnection) annotation (
            points=[12,0; 13.6,0; 13.6,3.55271e-016; -4.8,3.55271e-016],style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(generator_B.shaft, inertia_B.flange_b) annotation (points=[-39.2,
              3.55271e-016; -40.6,3.55271e-016; -40.6,0; -60,0],       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_B.flange_a, shaft_B) annotation (points=[-80,0; -100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_C.flange_a, shaft_C) annotation (points=[-80,-64; -100,
              -64], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_A.flange_a, shaft_A) annotation (points=[-80,64; -100,
              64],              style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(inertia_A.flange_b, generator_A.shaft) annotation (points=[-60,64;
              -39.2,64],               style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(generator_A.powerConnection, powerSensor_A.port_a) annotation (
            points=[-4.8,64; 12,64],style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(powerSensor_A.port_b, breaker_A.connection1) annotation (points=[28,63.84;
              48,63.84; 48,64; 41.4,64],           style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor_A.port, generator_A.powerConnection) 
          annotation (points=[12,86; 4,86; 4,64; -4.8,64],  style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor_B.port, generator_B.powerConnection) 
          annotation (points=[12,22; 4,22; 4,0; -6,0; -6,3.55271e-016; -4.8,
              3.55271e-016],
            style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(frequencySensor_C.port, generator_C.powerConnection) 
          annotation (points=[12,-40; 4,-40; 4,-64; -4.8,-64],  style(
            pattern=0,
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_C.flange_a, shaft_C) annotation (points=[-80,-86; -90,
              -86; -90,-64; -100,-64], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_B.flange_a, shaft_B) annotation (points=[-80,-30; -90,
              -30; -90,0; -100,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(damper_A.flange_a, shaft_A) annotation (points=[-80,38; -90,38;
              -90,64; -100,64], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2,
            fillColor=7,
            rgbfillColor={255,255,255},
            fillPattern=1));
        connect(ActuatorsBus.breakerClosed_shaftC, breaker_C.closed) 
          annotation (points=[98,-72; 66,-72; 66,-14; 50,-14; 50,-56], style(
              color=52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.breakerClosed_shaftB, breaker_B.closed) 
          annotation (points=[98,-72; 66,-72; 66,20; 50,20; 50,8], style(color=
                52, rgbcolor={213,255,170}));
        connect(ActuatorsBus.breakerClosed_shaftA, breaker_A.closed) 
          annotation (points=[98,-72; 66,-72; 66,78; 50,78; 50,72], style(color=
               52, rgbcolor={213,255,170}));
        connect(SensorsBus.power_shaftC, powerSensor_C.W) annotation (points=[
              98,-40; 38,-40; 38,-88; 20,-88; 20,-71.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftC, frequencySensor_C.f) annotation (
            points=[98,-40; 28.16,-40], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.power_shaftB, powerSensor_B.W) annotation (points=[
              98,-40; 38,-40; 38,-14; 20,-14; 20,-7.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftB, frequencySensor_B.f) annotation (
            points=[98,-40; 38,-40; 38,22; 28.16,22], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.power_shaftA, powerSensor_A.W) annotation (points=[
              98,-40; 38,-40; 38,48; 20,48; 20,56.48], style(color=84, rgbcolor=
               {255,170,213}));
        connect(SensorsBus.frequency_shaftA, frequencySensor_A.f) annotation (
            points=[98,-40; 38,-40; 38,86; 28.16,86], style(color=84, rgbcolor=
                {255,170,213}));
        connect(grid_3in.connection_B, breaker_B.connection2) annotation (
            points=[77.4,1.77636e-016; 67.7,1.77636e-016; 67.7,1.77636e-016;
              58.6,1.77636e-016], style(pattern=0, thickness=2));
        connect(grid_3in.connection_C, breaker_C.connection2) annotation (
            points=[77.4,-8; 70,-8; 70,-64; 58.6,-64], style(pattern=0,
              thickness=2));
        connect(grid_3in.connection_A, breaker_A.connection2) annotation (
            points=[77.4,8; 70,8; 70,64; 58.6,64], style(pattern=0, thickness=2));
      end TripleShaft_static;
      
      model SingleShaft_SE 
        "Alternator group in configuration single-shaft (one generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.SingleShaft;
        parameter SI.Power Pmax "Outlet maximum power";
        parameter SI.Angle delta_start "Loaded angle start value";
        
        Electrical.Grid grid(fn=fn, Pn=Pn) annotation (extent=[48,-10; 68,10]);
        Components.PowerSensor powerSensor annotation (extent=[12,-8; 28,8]);
        annotation (Diagram);
        Components.FrequencySensor frequencySensor 
          annotation (extent=[12,20; 28,36]);
        Components.Generator_SE generator_SE(
          eta=eta,
          Pmax=Pmax,
          J=J_shaft,
          delta_start=delta_start,
          omega_nom=omega_nom)    annotation (extent=[-62,-20; -22,20]);
      equation 
        connect(SensorsBus.power, powerSensor.W) annotation (points=[98,-40; 20,
              -40; 20,-7.52], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.frequency, frequencySensor.f) annotation (points=[98,
              -40; 34,-40; 34,28; 28.16,28], style(color=84, rgbcolor={255,170,
                213}));
        connect(generator_SE.shaft, shaft) annotation (points=[-60,0; -100,0],
            style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(generator_SE.powerConnection, powerSensor.port_a) annotation (
            points=[-27.6,3.55271e-016; -8.8,3.55271e-016; -8.8,0; 12,0], style(
              pattern=0, thickness=2));
        connect(powerSensor.port_b, grid.connection) annotation (points=[28,-0.16;
              48,-0.16; 48,1.77636e-016; 49.4,1.77636e-016],        style(
              pattern=0, thickness=2));
        connect(frequencySensor.port, generator_SE.powerConnection) annotation (
           points=[12,28; -6,28; -6,3.55271e-016; -27.6,3.55271e-016], style(
              pattern=0, thickness=2));
      end SingleShaft_SE;
      
      model DoubleShaft_SE 
        "Alternator group in configuration double-shaft (two generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.DoubleShaft;
        parameter SI.Power Pmax_A "Outlet maximum power" annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.Angle delta_start_A "Loaded angle start value" 
                                         annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.Power Pmax_B "Outlet maximum power" annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.Angle delta_start_B "Loaded angle start value" 
                                         annotation (Dialog(group = "Generator-Shaft B"));
        
        Components.PowerSensor powerSensor_A 
                                            annotation (extent=[16,52; 32,68]);
        Components.FrequencySensor frequencySensor_A 
          annotation (extent=[14,74; 30,90]);
        Components.PowerSensor powerSensor_B 
                                            annotation (extent=[14,-68; 30,-52]);
        Components.FrequencySensor frequencySensor_B 
          annotation (extent=[14,-42; 30,-26]);
        annotation (Diagram);
        ThermoPower.PowerPlants.ElectricGeneratorGroup.Components.Grid_2in grid(
            Pn=Pn, fn=fn) 
                   annotation (extent=[74,0; 94,20]);
        Components.Generator_SE generator_SE_A(
          eta=eta_A,
          Pmax=Pmax_A,
          J=J_shaft_A,
          D=d_shaft_A,
          delta_start=delta_start_A,
          omega_nom=omega_nom_A)    annotation (extent=[-62,40; -22,80]);
        Components.Generator_SE generator_SE_B(
          eta=eta_B,
          Pmax=Pmax_B,
          J=J_shaft_B,
          D=d_start_B,
          delta_start=delta_start_B,
          omega_nom=omega_nom_B)    annotation (extent=[-62,-80; -22,-40]);
        
      equation 
        connect(SensorsBus.power_shaftA, powerSensor_A.W) annotation (points=[
              98,-40; 36,-40; 36,40; 24,40; 24,52.48], style(color=84, rgbcolor=
               {255,170,213}));
        connect(SensorsBus.power_shaftB, powerSensor_B.W) annotation (points=[
              98,-40; 36,-40; 36,-80; 22,-80; 22,-67.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftA, frequencySensor_A.f) annotation (
            points=[98,-40; 36,-40; 36,82; 30.16,82], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.frequency_shaftB, frequencySensor_B.f) annotation (
            points=[98,-40; 36,-40; 36,-34; 30.16,-34], style(color=84,
              rgbcolor={255,170,213}));
        connect(powerSensor_B.port_b, grid.connection_B) annotation (points=[30,
              -60.16; 46,-60.16; 46,-60; 60,-60; 60,6; 75.4,6], style(pattern=0,
              thickness=2));
        connect(grid.connection_A, powerSensor_A.port_b) annotation (points=[
              75.4,14; 60,14; 60,59.84; 32,59.84], style(pattern=0, thickness=2));
        connect(generator_SE_B.powerConnection, powerSensor_B.port_a) 
          annotation (points=[-27.6,-60; 14,-60], style(pattern=0, thickness=2));
        connect(frequencySensor_B.port, generator_SE_B.powerConnection) 
          annotation (points=[14,-34; 0,-34; 0,-60; -27.6,-60], style(pattern=0,
              thickness=2));
        connect(powerSensor_A.port_a, generator_SE_A.powerConnection) 
          annotation (points=[16,60; -27.6,60], style(pattern=0, thickness=2));
        connect(frequencySensor_A.port, generator_SE_A.powerConnection) 
          annotation (points=[14,82; 0,82; 0,60; -27.6,60], style(pattern=0,
              thickness=2));
        connect(generator_SE_A.shaft, shaft_A) annotation (points=[-60,60; -100,
              60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(generator_SE_B.shaft, shaft_B) annotation (points=[-60,-60;
              -100,-60], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end DoubleShaft_SE;
      
      model TripleShaft_SE 
        "Alternator group in configuration triple-shaft (three generator)" 
        extends 
          ThermoPower.PowerPlants.ElectricGeneratorGroup.Interfaces.TripleShaft;
        parameter SI.Power Pmax_A "Outlet maximum power" annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.Angle delta_start_A "Loaded angle start value" 
                                         annotation (Dialog(group = "Generator-Shaft A"));
        parameter SI.Power Pmax_B "Outlet maximum power" annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.Angle delta_start_B "Loaded angle start value" 
                                         annotation (Dialog(group = "Generator-Shaft B"));
        parameter SI.Power Pmax_C "Outlet maximum power" annotation (Dialog(group = "Generator-Shaft C"));
        parameter SI.Angle delta_start_C "Loaded angle start value" 
                                         annotation (Dialog(group = "Generator-Shaft C"));
        
        Components.PowerSensor powerSensor_A 
                                           annotation (extent=[12,56; 28,72]);
        Components.FrequencySensor frequencySensor_A 
          annotation (extent=[12,78; 28,94]);
        Components.PowerSensor powerSensor_B 
                                            annotation (extent=[12,-8; 28,8]);
        Components.FrequencySensor frequencySensor_B 
          annotation (extent=[12,14; 28,30]);
        Components.PowerSensor powerSensor_C 
                                            annotation (extent=[12,-72; 28,-56]);
        Components.FrequencySensor frequencySensor_C 
          annotation (extent=[12,-48; 28,-32]);
        annotation (Diagram);
        Components.Grid_3in grid_3in(Pn=Pn, fn=fn) 
          annotation (extent=[76,-10; 96,10], rotation=0);
        Components.Generator_SE generator_SE_A(
          eta=eta_A,
          Pmax=Pmax_A,
          J=J_shaft_A,
          D=d_shaft_A,
          delta_start=delta_start_A,
          omega_nom=omega_nom_A)    annotation (extent=[-60,44; -20,84]);
        Components.Generator_SE generator_SE_B(
          eta=eta_B,
          Pmax=Pmax_B,
          J=J_shaft_B,
          D=d_start_B,
          delta_start=delta_start_B,
          omega_nom=omega_nom_B)    annotation (extent=[-60,-20; -20,20]);
        Components.Generator_SE generator_SE_B1(
          eta=eta_C,
          Pmax=Pmax_C,
          J=J_shaft_C,
          D=d_start_C,
          delta_start=delta_start_C,
          omega_nom=omega_nom_C)    annotation (extent=[-60,-84; -20,-44]);
      equation 
        connect(SensorsBus.power_shaftC, powerSensor_C.W) annotation (points=[
              98,-40; 38,-40; 38,-88; 20,-88; 20,-71.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftC, frequencySensor_C.f) annotation (
            points=[98,-40; 28.16,-40], style(color=84, rgbcolor={255,170,213}));
        connect(SensorsBus.power_shaftB, powerSensor_B.W) annotation (points=[
              98,-40; 38,-40; 38,-14; 20,-14; 20,-7.52], style(color=84,
              rgbcolor={255,170,213}));
        connect(SensorsBus.frequency_shaftB, frequencySensor_B.f) annotation (
            points=[98,-40; 38,-40; 38,22; 28.16,22], style(color=84, rgbcolor=
                {255,170,213}));
        connect(SensorsBus.power_shaftA, powerSensor_A.W) annotation (points=[
              98,-40; 38,-40; 38,48; 20,48; 20,56.48], style(color=84, rgbcolor=
               {255,170,213}));
        connect(SensorsBus.frequency_shaftA, frequencySensor_A.f) annotation (
            points=[98,-40; 38,-40; 38,86; 28.16,86], style(color=84, rgbcolor=
                {255,170,213}));
        connect(generator_SE_B1.powerConnection, powerSensor_C.port_a) 
          annotation (points=[-25.6,-64; 12,-64], style(pattern=0, thickness=2));
        connect(frequencySensor_C.port, generator_SE_B1.powerConnection) 
          annotation (points=[12,-40; -4,-40; -4,-64; -25.6,-64], style(pattern=
               0, thickness=2));
        connect(powerSensor_B.port_a, generator_SE_B.powerConnection) 
          annotation (points=[12,0; -6.8,0; -6.8,3.55271e-016; -25.6,
              3.55271e-016], style(pattern=0, thickness=2));
        connect(frequencySensor_B.port, generator_SE_B.powerConnection) 
          annotation (points=[12,22; -4,22; -4,3.55271e-016; -25.6,3.55271e-016],
            style(pattern=0, thickness=2));
        connect(powerSensor_A.port_a, generator_SE_A.powerConnection) 
          annotation (points=[12,64; -25.6,64], style(pattern=0, thickness=2));
        connect(frequencySensor_A.port, generator_SE_A.powerConnection) 
          annotation (points=[12,86; -4,86; -4,64; -25.6,64], style(pattern=0,
              thickness=2));
        connect(generator_SE_A.shaft, shaft_A) annotation (points=[-58,64; -100,
              64], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(generator_SE_B.shaft, shaft_B) annotation (points=[-58,0; -100,
              0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(generator_SE_B1.shaft, shaft_C) annotation (points=[-58,-64;
              -100,-64], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(grid_3in.connection_A, powerSensor_A.port_b) annotation (points=
             [77.4,8; 60,8; 60,63.84; 28,63.84], style(pattern=0, thickness=2));
        connect(grid_3in.connection_B, powerSensor_B.port_b) annotation (points=[77.4,
              1.77636e-016; 51.7,1.77636e-016; 51.7,-0.16; 28,-0.16],
            style(pattern=0, thickness=2));
        connect(grid_3in.connection_C, powerSensor_C.port_b) annotation (points=
             [77.4,-8; 60,-8; 60,-64.16; 28,-64.16], style(pattern=0, thickness=
               2));
      end TripleShaft_SE;
    end Examples;
    
    package Tests 
      
      model Test_Generator_SE 
        annotation (Diagram, experiment(StopTime=32, NumberOfIntervals=50000));
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-80,-24; -48,8]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-44,34; -32,46]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-70,30; -82,18],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-96,34; -84,46]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_a(
          offset=0.2,
          startTime=5,
          height=+0.7,
          duration=3) 
          annotation (extent=[0,76; -12,88]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_b(
          offset=0,
          duration=5,
          height=-0.8,
          startTime=15) 
          annotation (extent=[0,54; -12,66]);
        Modelica.Blocks.Math.Add add 
          annotation (extent=[-56,62; -42,76], rotation=180);
        Components.Generator_SE generator_SE(
          Pmax=30e6,
          eta=0.96,
          r=0.2,
          J=15000,
          delta_start=0.5073,
          omega_nom=157.08) 
                     annotation (extent=[-30,-48; 50,32]);
        Electrical.Grid grid(Pn=50e8, droop=0) 
          annotation (extent=[66,-18; 86,2]);
      equation 
        connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-44,40;
              -51.68,40; -51.68,4.8],          style(thickness=2));
        connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-76,18;
              -76,4.64],                     style(thickness=2));
        connect(sourceP.flange,valveHP. inlet) 
          annotation (points=[-84,40; -76,40; -76,30], style(thickness=2));
        connect(add.y, valveHP.theta) annotation (points=[-56.7,69; -62,69; -62,
              24; -71.2,24],                                                 style(
              color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_b.y, add.u1) annotation (points=[-12.6,60; -30,60;
              -30,64; -40,64; -40.6,64.8],
                           style(color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_a.y, add.u2) annotation (points=[-12.6,82; -30,82;
              -30,74; -40.6,74; -40.6,73.2],
                                     style(color=74, rgbcolor={0,0,127}));
        connect(generator_SE.shaft, steamTurbineStodola.shaft_b) annotation (
            points=[-26,-8; -53.76,-8],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(grid.connection, generator_SE.powerConnection) annotation (
            points=[67.4,-8; 53.1,-8; 53.1,-8; 38.8,-8],
                                         style(pattern=0, thickness=2));
      end Test_Generator_SE;
      
      model Test_Generator_SE_com 
        annotation (Diagram, experiment(StopTime=3000, NumberOfIntervals=30000));
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-80,-24; -48,8]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-44,34; -32,46]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-70,30; -82,18],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-96,34; -84,46]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_a(
          height=+0.8,
          offset=0.2,
          duration=5,
          startTime=1000) 
          annotation (extent=[0,76; -12,88]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_b(
          height=-0.9,
          offset=0,
          duration=5,
          startTime=2000) 
          annotation (extent=[0,54; -12,66]);
        Modelica.Blocks.Math.Add add 
          annotation (extent=[-56,62; -42,76], rotation=180);
        Components.Generator_SE_com generator_SE(
          J=7000,
          delta_start=0.77,
          Pmax=20e6,
          r=0.2)     annotation (extent=[-30,-48; 50,32]);
        Electrical.Grid grid(Pn=50e8, droop=0) 
          annotation (extent=[66,-18; 86,2]);
      equation 
        connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-44,40;
              -51.68,40; -51.68,4.8],          style(thickness=2));
        connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-76,18;
              -76,4.64],                     style(thickness=2));
        connect(sourceP.flange,valveHP. inlet) 
          annotation (points=[-84,40; -76,40; -76,30], style(thickness=2));
        connect(add.y, valveHP.theta) annotation (points=[-56.7,69; -62,69; -62,
              24; -71.2,24],                                                 style(
              color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_b.y, add.u1) annotation (points=[-12.6,60; -30,60;
              -30,64; -40,64; -40.6,64.8],
                           style(color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_a.y, add.u2) annotation (points=[-12.6,82; -30,82;
              -30,74; -40.6,74; -40.6,73.2],
                                     style(color=74, rgbcolor={0,0,127}));
        connect(generator_SE.shaft, steamTurbineStodola.shaft_b) annotation (
            points=[-26,-8; -53.76,-8],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(grid.connection, generator_SE.powerConnection) annotation (
            points=[67.4,-8; 53.1,-8; 53.1,-8; 38.8,-8],
                                         style(pattern=0, thickness=2));
      end Test_Generator_SE_com;
      
      model Test_Generator_SE_breaker 
        annotation (Diagram, experiment(StopTime=32, NumberOfIntervals=50000));
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-80,-24; -48,8]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-44,34; -32,46]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-70,30; -82,18],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-96,34; -84,46]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_a(
          offset=0.2,
          startTime=5,
          height=+0.7,
          duration=3) 
          annotation (extent=[0,76; -12,88]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_b(
          offset=0,
          duration=5,
          height=-0.8,
          startTime=15) 
          annotation (extent=[0,54; -12,66]);
        Modelica.Blocks.Math.Add add 
          annotation (extent=[-56,62; -42,76], rotation=180);
        Components.Generator_SE_Breaker generator_SE(
          Pmax=30e6,
          omega_nom=157.08,
          eta=0.96,
          J=15000,
          delta_start=0.5073,
          omega_start=157.08,
          r=0.2)     annotation (extent=[-30,-48; 50,32]);
        Electrical.Grid grid(Pn=50e8, droop=0) 
          annotation (extent=[66,-18; 86,2]);
      public 
        Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=false) 
          annotation (extent=[38,46; 58,66]);
      equation 
        connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-44,40;
              -51.68,40; -51.68,4.8],          style(thickness=2));
        connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-76,18;
              -76,4.64],                     style(thickness=2));
        connect(sourceP.flange,valveHP. inlet) 
          annotation (points=[-84,40; -76,40; -76,30], style(thickness=2));
        connect(add.y, valveHP.theta) annotation (points=[-56.7,69; -62,69; -62,
              24; -71.2,24],                                                 style(
              color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_b.y, add.u1) annotation (points=[-12.6,60; -30,60;
              -30,64; -40,64; -40.6,64.8],
                           style(color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_a.y, add.u2) annotation (points=[-12.6,82; -30,82;
              -30,74; -40.6,74; -40.6,73.2],
                                     style(color=74, rgbcolor={0,0,127}));
        connect(generator_SE.shaft, steamTurbineStodola.shaft_b) annotation (
            points=[-26,-8; -53.76,-8],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(grid.connection, generator_SE.powerConnection) annotation (
            points=[67.4,-8; 53.1,-8; 53.1,-8; 38.8,-8],
                                         style(pattern=0, thickness=2));
        connect(booleanConstant.y, generator_SE.closed) annotation (points=[59,56;
              78,56; 78,30; 10,30; 10,19.2],     style(color=5, rgbcolor={255,0,
                255}));
      end Test_Generator_SE_breaker;
      
      model Test_Generator_SE_close 
        annotation (Diagram, experiment(StopTime=32, NumberOfIntervals=50000));
        Water.SteamTurbineStodola steamTurbineStodola(
          pstart_in=1.28e7,
          pstart_out=2.98e6,
          wstart=67.6,
          hstartin=3.47e6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.833,
          Kt=0.0032078) 
                      annotation (extent=[-80,-24; -48,8]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-44,34; -32,46]);
        Water.ValveVap valveHP(
          CvData=ThermoPower.Choices.Valve.CvTypes.Cv,
          CheckValve=true,
          wnom=67.6,
          hstart=3.47e6,
          pnom=1.296e7,
          dpnom=1.6e5,
          Cv=1165)             annotation (extent=[-70,30; -82,18],rotation=90);
        Water.SourceP sourceP(h=3.47e6, p0=1.296e7) 
          annotation (extent=[-96,34; -84,46]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_a(
          offset=0.2,
          startTime=5,
          height=+0.7,
          duration=3) 
          annotation (extent=[0,76; -12,88]);
      public 
        Modelica.Blocks.Sources.Ramp com_valveHP_b(
          offset=0,
          duration=5,
          height=-0.8,
          startTime=15) 
          annotation (extent=[0,54; -12,66]);
        Modelica.Blocks.Math.Add add 
          annotation (extent=[-56,62; -42,76], rotation=180);
        Components.prove2.Generator_SE_close generator_SE(
          Pmax=30e6,
          eta=0.96,
          r=0.2,
          J=15000,
          delta_start=0.5073,
          omega_nom=157.08,
          f=314.16)  annotation (extent=[-30,-48; 50,32]);
      equation 
        connect(sinkP.flange,steamTurbineStodola. outlet) annotation (points=[-44,40;
              -51.68,40; -51.68,4.8],          style(thickness=2));
        connect(valveHP.outlet,steamTurbineStodola. inlet) annotation (points=[-76,18;
              -76,4.64],                     style(thickness=2));
        connect(sourceP.flange,valveHP. inlet) 
          annotation (points=[-84,40; -76,40; -76,30], style(thickness=2));
        connect(add.y, valveHP.theta) annotation (points=[-56.7,69; -62,69; -62,
              24; -71.2,24],                                                 style(
              color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_b.y, add.u1) annotation (points=[-12.6,60; -30,60;
              -30,64; -40,64; -40.6,64.8],
                           style(color=74, rgbcolor={0,0,127}));
        connect(com_valveHP_a.y, add.u2) annotation (points=[-12.6,82; -30,82;
              -30,74; -40.6,74; -40.6,73.2],
                                     style(color=74, rgbcolor={0,0,127}));
        connect(generator_SE.shaft, steamTurbineStodola.shaft_b) annotation (
            points=[-26,-8; -53.76,-8],style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end Test_Generator_SE_close;
      
      model TestSingleShaft 
        ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
          singleShaft(
          Pn=50e8,
          omega_nom=314.16/2,
          eta=0.9,
          J_shaft=100,
          d_shaft=0)  annotation (extent=[0,-40; 80,40]);
        annotation (Diagram);
        Water.SteamTurbineStodola steamTurbineStodola(
          hstartin=3.47e6,
          pstart_in=128e5,
          pstart_out=29.8e5,
          wstart=67.6,
          hstartout=3.1076e6,
          wnom=67.6,
          eta_iso_nom=0.83387,
          Kt=0.00307) 
                   annotation (extent=[-80,-22; -44,22]);
        Water.SourceW sourceW(
          h=3.47e6,
          w0=67.6,
          p0=128e5) annotation (extent=[-102,50; -82,70]);
        Water.SinkP sinkP(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-36,50; -16,70]);
      protected 
        Buses.Sensors sensors annotation (extent=[62,44; 82,56],  rotation=180);
        Buses.Actuators actuators 
          annotation (extent=[64,-56; 84,-44],  rotation=0);
      public 
        Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
          annotation (extent=[10,-90; 30,-70]);
      equation 
        connect(steamTurbineStodola.shaft_b, singleShaft.shaft) annotation (
            points=[-50.48,0; 0,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(sourceW.flange, steamTurbineStodola.inlet) annotation (points=[
              -82,60; -75.5,60; -75.5,17.38], style(thickness=2));
        connect(sinkP.flange, steamTurbineStodola.outlet) annotation (points=[
              -36,60; -48.14,60; -48.14,17.6], style(thickness=2));
        connect(sensors, singleShaft.SensorsBus) annotation (points=[72,50; 90,
              50; 90,-16; 79.2,-16], style(color=84, rgbcolor={255,170,213}));
        connect(actuators, singleShaft.ActuatorsBus) annotation (points=[74,-50;
              90,-50; 90,-28.8; 79.2,-28.8], style(color=52, rgbcolor={213,255,
                170}));
        connect(booleanConstant.y, actuators.breakerClosed) annotation (points=[31,-80;
              50,-80; 50,-50; 74,-50],
                                 style(color=5, rgbcolor={255,0,255}));
      end TestSingleShaft;
      
      model TestDoubleShaft 
        annotation (Diagram);
        Water.SteamTurbineStodola Turbine1(
          pstart_in=130e5,
          pstart_out=28.5e5,
          wstart=70.59,
          hstartout=3.11e6,
          wnom=70.59,
          hstartin=3.47e6,
          Kt=0.00307,
          eta_iso_nom=0.83) 
                     annotation (extent=[-76,8; -36,48]);
        Water.SourceW sourceW1(
          h=3.47e6,
          w0=67.6,
          p0=128e5) annotation (extent=[-96,54; -82,68]);
        Water.SinkP sinkP1(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-30,54; -18,66]);
      protected 
        Buses.Sensors sensors annotation (extent=[62,44; 82,56],  rotation=180);
        Buses.Actuators actuators 
          annotation (extent=[64,-36; 84,-24],  rotation=0);
      public 
        Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
          annotation (extent=[20,-70; 40,-50]);
        ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.DoubleShaft_static
          doubleShaft(
          Pn=50e8,
          J_shaft_A=2000,
          omega_nom_A=314.16/2,
          J_shaft_B=2000,
          omega_nom_B=314.16/2) annotation (extent=[20,-20; 80,40]);
        Water.SteamTurbineStodola Turbine2(
          hstartin=3.55e6,
          eta_iso_nom=0.9,
          Kt=0.01478,
          pstart_in=26.8e5,
          pstart_out=6e5,
          wstart=81.1,
          hstartout=3.128e6,
          wnom=81.1) 
                   annotation (extent=[-76,-50; -36,-10]);
        Water.SourceW sourceW2(
          w0=81.1,
          p0=26.8e5,
          h=3.554e6) annotation (extent=[-96,-6; -82,8]);
        Water.SinkP sinkP2(p0=6e5, h=3.128e6) 
          annotation (extent=[-30,-6; -18,6]);
      equation 
        connect(sourceW1.flange, Turbine1.inlet) 
          annotation (points=[-82,61; -71,61; -71,43.8], style(thickness=2));
        connect(sinkP1.flange, Turbine1.outlet) 
          annotation (points=[-30,60; -40.6,60; -40.6,44], style(thickness=2));
        connect(sourceW2.flange, Turbine2.inlet) 
          annotation (points=[-82,1; -71,1; -71,-14.2], style(thickness=2));
        connect(sinkP2.flange, Turbine2.outlet) 
          annotation (points=[-30,0; -40.6,0; -40.6,-14], style(thickness=2));
        connect(Turbine2.shaft_b, doubleShaft.shaft_B) annotation (points=[-43.2,
              -30; 0,-30; 0,-8; 20,-8],       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(Turbine1.shaft_b, doubleShaft.shaft_A) annotation (points=[-43.2,28;
              20,28],           style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(actuators, doubleShaft.ActuatorsBus) annotation (points=[74,-30;
              92,-30; 92,-11.6; 79.4,-11.6], style(color=52, rgbcolor={213,255,
                170}));
        connect(booleanConstant.y, actuators.breakerClosed_shaftA) annotation (
            points=[41,-60; 60,-60; 60,-30; 74,-30], style(color=5, rgbcolor={
                255,0,255}));
        connect(booleanConstant.y, actuators.breakerClosed_shaftB) annotation (
            points=[41,-60; 52,-60; 52,-30; 74,-30], style(color=5, rgbcolor={
                255,0,255}));
        connect(doubleShaft.SensorsBus, sensors) annotation (points=[79.4,-2;
              92,-2; 92,50; 72,50], style(color=84, rgbcolor={255,170,213}));
      end TestDoubleShaft;
      
      model TestTripleShaft 
        annotation (Diagram);
      protected 
        Buses.Sensors sensors annotation (extent=[62,44; 82,56],  rotation=180);
        Buses.Actuators actuators 
          annotation (extent=[64,-56; 84,-44],  rotation=0);
      public 
        Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
          annotation (extent=[20,-98; 40,-78]);
        ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.TripleShaft_static
          tripleShaft(
          Pn=50e8,
          J_shaft_A=2000,
          J_shaft_B=2000,
          J_shaft_C=2000,
          omega_nom_A=314.16/2,
          omega_nom_B=314.16/2,
          omega_nom_C=314.16/2) annotation (extent=[0,-40; 80,40]);
        Water.SteamTurbineStodola Turbine1(
          pstart_in=130e5,
          pstart_out=28.5e5,
          wstart=70.59,
          hstartout=3.11e6,
          wnom=70.59,
          hstartin=3.47e6,
          Kt=0.00307,
          eta_iso_nom=0.83) 
                     annotation (extent=[-84,40; -44,80]);
        Water.SourceW sourceW1(
          h=3.47e6,
          w0=67.6,
          p0=128e5) annotation (extent=[-100,80; -86,94]);
        Water.SinkP sinkP1(p0=29.8e5, h=3.1076e6) 
          annotation (extent=[-40,82; -28,94]);
        Water.SteamTurbineStodola Turbine2(
          hstartin=3.55e6,
          eta_iso_nom=0.9,
          Kt=0.01478,
          pstart_in=26.8e5,
          pstart_out=6e5,
          wstart=81.1,
          hstartout=3.128e6,
          wnom=81.1)       annotation (extent=[-84,-20; -44,20]);
        Water.SourceW sourceW2(
          w0=81.1,
          p0=26.8e5,
          h=3.554e6) annotation (extent=[-100,24; -86,38]);
        Water.SinkP sinkP2(p0=6e5, h=3.128e6) 
          annotation (extent=[-40,26; -28,38]);
        Water.SteamTurbineStodola Turbine3(
          pstart_in=6e5,
          pstart_out=5.3982e3,
          wstart=89.82,
          hstartin=3.109e6,
          hstartout=2.3854e6,
          wnom=89.82,
          Kt=0.0769)       annotation (extent=[-84,-78; -44,-38]);
        Water.SourceW sourceW3(
          w0=89.82,
          p0=6e5,
          h=3.109e6) annotation (extent=[-100,-36; -86,-22]);
        Water.SinkP sinkP3(p0=5.3982e3, h=2.3854) 
                           annotation (extent=[-40,-34; -28,-22]);
      equation 
        connect(tripleShaft.SensorsBus, sensors) annotation (points=[79.2,-16;
              92,-16; 92,50; 72,50], style(color=84, rgbcolor={255,170,213}));
        connect(actuators, tripleShaft.ActuatorsBus) annotation (points=[74,-50;
              92,-50; 92,-28.8; 79.2,-28.8], style(color=52, rgbcolor={213,255,
                170}));
        connect(booleanConstant.y, actuators.breakerClosed_shaftA) annotation (
            points=[41,-88; 60,-88; 60,-50; 74,-50],style(color=5, rgbcolor={
                255,0,255}));
        connect(booleanConstant.y, actuators.breakerClosed_shaftB) annotation (
            points=[41,-88; 54,-88; 54,-50; 74,-50],style(color=5, rgbcolor={
                255,0,255}));
        connect(booleanConstant.y, actuators.breakerClosed_shaftC) annotation (
            points=[41,-88; 48,-88; 48,-50; 74,-50],style(color=5, rgbcolor={
                255,0,255}));
        connect(sourceW1.flange, Turbine1.inlet) 
          annotation (points=[-86,87; -79,87; -79,75.8], style(thickness=2));
        connect(sinkP1.flange, Turbine1.outlet) 
          annotation (points=[-40,88; -48.6,88; -48.6,76], style(thickness=2));
        connect(sourceW2.flange, Turbine2.inlet) 
          annotation (points=[-86,31; -79,31; -79,15.8], style(thickness=2));
        connect(sinkP2.flange, Turbine2.outlet) 
          annotation (points=[-40,32; -48.6,32; -48.6,16], style(thickness=2));
        connect(Turbine1.shaft_b, tripleShaft.shaft_A) annotation (points=[
              -51.2,60; -20,60; -20,25.6; 0,25.6], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(Turbine2.shaft_b, tripleShaft.shaft_B) annotation (points=[
              -51.2,0; 0,0], style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
        connect(sourceW3.flange, Turbine3.inlet) annotation (points=[-86,-29;
              -79,-29; -79,-42.2], style(thickness=2));
        connect(sinkP3.flange, Turbine3.outlet) annotation (points=[-40,-28;
              -48.6,-28; -48.6,-42], style(thickness=2));
        connect(Turbine3.shaft_b, tripleShaft.shaft_C) annotation (points=[-51.2,
              -58; -20,-58; -20,-25.6; 0,-25.6],       style(
            color=0,
            rgbcolor={0,0,0},
            thickness=2));
      end TestTripleShaft;
    end Tests;
  end ElectricGeneratorGroup;
  
  package Control 
    model PID "ISA PID controller with anti-windup" 
      parameter Real Kp "Proportional gain (normalised units)";
      parameter Time Ti "Integral time";
      parameter Time Td = 0 "Derivative time";
      parameter Real Nd = 1 "Derivative action up to Nd / Td rad/s";
      parameter Real Ni = 1 
        "Ni*Ti is the time constant of anti-windup compensation";
      parameter Real b = 1 "Setpoint weight on proportional action";
      parameter Real c = 0 "Setpoint weight on derivative action";
      parameter Real PVmin "Minimum value of process variable for scaling";
      parameter Real PVmax "Maximum value of process variable for scaling";
      parameter Real CSmin "Minimum value of control signal for scaling";
      parameter Real CSmax "Maximum value of control signal for scaling";
      parameter Real PVstart = 0.5 "Start value of PV (scaled)";
      parameter Real CSstart = 0.5 "Start value of CS (scaled)";
      parameter Boolean steadyStateInit = false;
      
      Real P "Proportional action / Kp";
      Real I(start = CSstart/Kp) "Integral action / Kp";
      Real D "Derivative action / Kp";
      Real Dx(start = c*PVstart - PVstart) "State of approximated derivator";
      Real PVs "Process variable scaled in per unit";
      Real SPs "Setpoint variable scaled in per unit";
      Real CSs(start = CSstart) "Control signal scaled in per unit";
      Real CSbs(start = CSstart) 
        "Control signal scaled in per unit before saturation";
      Real track "Tracking signal for anti-windup integral action";
      
      Modelica.Blocks.Interfaces.RealInput PV "Process variable signal" 
                    annotation (extent=[-112,-52; -88,-28]);
      annotation (Diagram, Icon(
          Rectangle(extent=[-100,100; 100,-100], style(
              color=0,
              rgbcolor={0,0,0},
              fillColor=30,
              rgbfillColor={240,240,240})),
          Text(
            extent=[-54,40; 52,-34],
            string="PID",
            style(color=0, rgbcolor={0,0,0})),
          Text(
            extent=[-110,-108; 110,-142],
            style(
              color=3,
              rgbcolor={0,0,255},
              thickness=2),
            string="%name")));
      Modelica.Blocks.Interfaces.RealOutput CS "Control signal" 
        annotation (extent=[94,-12; 118,12]);
      Modelica.Blocks.Interfaces.RealInput SP "Set point signal" 
                    annotation (extent=[-112,28; -88,52]);
      
    equation 
      // Scaling
      SPs=(SP-PVmin)/(PVmax-PVmin);
      PVs=(PV-PVmin)/(PVmax-PVmin);
      CS = CSmin + CSs*(CSmax-CSmin);
      // Controller actions  
      P = b*SPs - PVs;
      if Ti>0 then
        Ti*der(I) = SPs - PVs + track;
      else
        I = 0;
      end if;
      if Td > 0 then
        Td/Nd*der(Dx) + Dx = c*SPs - PVs 
          "State equation of approximated derivator";
        D = Nd*((c*SPs - PVs) - Dx) "Output equation of approximated derivator";
      else
        Dx = 0;
        D = 0;
      end if;
      CSbs = Kp*(P+I+D) "Control signal before saturation";
      CSs = smooth(0, if CSbs > 1 then 1 else if CSbs < 0 then 0 else CSbs) 
        "Saturated control signal";
      track = (CSs-CSbs)/(Kp*Ni);
    initial equation 
      if steadyStateInit then
        if Ti > 0 then
          der(I) = 0;
        end if;
        if Td > 0 then
          D = 0;
        end if;
      end if;
    end PID;
    
    model LevelSetPoint 
      parameter Pressure p1;
      parameter Pressure p2;
      parameter Length y1;
      parameter Length y2;
      Modelica.Blocks.Interfaces.RealInput drumPressure 
        annotation (extent=[-112,-12; -88,12]);
      Modelica.Blocks.Interfaces.RealOutput levelSetPoint 
        annotation (extent=[94,-12; 118,12]);
    equation 
      levelSetPoint = noEvent(
        if drumPressure < p1 then y1 else 
        if drumPressure > p2 then y2 else y1 + (y2-y1)/(p2-p1)*(drumPressure-p1));
      annotation (Diagram, Icon(Rectangle(extent=[-100,100; 100,-100], style(
              color=0,
              rgbcolor={0,0,0},
              fillColor=30,
              rgbfillColor={240,240,240})),
                                      Text(
            extent=[-132,-104; 146,-154],
            style(color=3, rgbcolor={0,0,255}),
            string="%name"),
          Text(
            extent=[-80,40; 80,-40],
            style(
              color=0,
              rgbcolor={0,0,0},
              fillColor=30,
              rgbfillColor={240,240,240},
              fillPattern=1),
            string="SetPoint")));
    end LevelSetPoint;
    
  end Control;
  
  package Buses 
    
    expandable connector Sensors 
     // Empty connector, defined by expansion 
      
      annotation (Icon(Polygon(points=[-80,80; 60,80; 100,0; 60,-80; -80,-80; -80, 80],
                          style(
                            color=84,
                            rgbcolor={255,170,213},
                            fillColor=78,
                            rgbfillColor={127,0,127},
                            fillPattern=1)),
                       Text(extent=[-60,60; 60,-60],
                          string="S",
                          style(
                            color=7,
                            rgbcolor={255,255,255},
                            fillColor=78,
                            rgbfillColor={127,0,127},
                            fillPattern=1))));
    end Sensors;
    
    expandable connector Actuators 
     // Empty connector, defined by expansion
      annotation (Icon(Polygon(points=[-80,80; 60,80; 100,0; 60,-80; -80,-80; -80, 80], style(
              color=52,
              rgbcolor={213,255,170},
              fillColor=62,
              rgbfillColor={0,127,127},
              fillPattern=1)),
                       Text(extent=[-60,60; 60,-60],
                         style(
                          color=7,
                          rgbcolor={255,255,255},
                          fillColor=78,
                          rgbfillColor={127,0,127},
                          fillPattern=1),
                         string="A")));
    end Actuators;
  end Buses;
  
  package Tests 
    
    model Test_ST_HRSG "Test of ST and HRSG connected " 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      
    public 
      Water.SourceW sourceWater(
        p0=1.98e6,
        h=2.440e5,
        w0=89.82)  annotation (extent=[34,8; 22,20]);
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,52; -86,64]);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                       annotation (extent=[44,52; 56,64]);
      Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
        annotation (extent=[100,18; 86,32]);
      Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
        annotation (extent=[60,18; 74,32]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-82,50; -66,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[20,50; 36,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-58,20; -46,8],    rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-30,20; -18,8],    rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-20,20; -8,8],     rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                 redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,20; -28,8],    rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-48,20; -36,8],    rotation=270);
    protected 
      Buses.Actuators actuators annotation (extent=[84,38; 76,46]);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
        steamTurbines(
        redeclare package FluidMedium = FluidMedium,
        steamHPNomFlowRate=67.6,
        steamHPNomPressure=1.28e7,
        steamIPNomFlowRate=81.10 - 67.5,
        steamIPNomPressure=2.68e6,
        steamLPNomPressure=6e5,
        pcond=5.3982e3,
        steamLPNomFlowRate=89.82 - 81.10,
        HPT_hstart_in=3.47e6,
        HPT_hstart_out=3.1076e6,
        IPT_hstart_in=3.554e6,
        IPT_hstart_out=3.12810e6,
        LPT_hstart_in=3.109e6,
        LPT_hstart_out=2.3854e6,
        mixLP_hstart=3.109e6,
        mixIP_hstart=3.1076e6,
        HPT_eta_iso_nom=0.833,
        IPT_eta_iso_nom=0.903,
        LPT_eta_iso_nom=0.876,
        HPT_Kt=0.0032078,
        IPT_Kt=0.018883,
        LPT_Kt=0.078004,
        mixLP_V=10,
        mixIP_V=10)  annotation (extent=[-60,-60; 0,0]);
      Water.SinkP sinkLPT(
        redeclare package Medium = FluidMedium,
        p0=5.3982e3,
        h=2.3854e6)      annotation (extent=[24,-98; 36,-86], rotation=0);
      Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=314.16/
            2) 
        annotation (extent=[46,-40; 26,-20]);
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wafp hRSG 
                              annotation (extent=[-58,30; 4,92]);
    equation 
      
      annotation (Diagram);
      connect(com_pumpFeedIP.y,actuators. flowRate_feedIP) 
                                                   annotation (points=[74.7,25;
            80,25; 80,42], style(color=74, rgbcolor={0,0,127}));
      connect(com_pumpFeedHP.y,actuators. flowRate_feedHP) 
                                                   annotation (points=[85.3,25;
            80,25; 80,42],        style(color=74, rgbcolor={0,0,127}));
      connect(stateGas_in.inlet,sourceGas. flange) annotation (points=[-78.8,58;
            -86,58],       style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(sinkGas.flange,stateGas_out. outlet) annotation (points=[44,58;
            32.8,58],style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(constantSpeed.flange,steamTurbines. Shaft_b) 
                                                         annotation (points=[26,-30;
            0,-30],  style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2));
      connect(sinkLPT.flange,steamTurbines. LPT_Out) 
        annotation (points=[24,-92; -6,-92; -6,-60],style(thickness=2));
      connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-69.2,58;
            -63.75,58; -63.75,57.9; -58,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[23.2,58;
            12.75,58; 12.75,57.9; 4,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(steamTurbines.HPT_In, stateShHP_out.outlet) annotation (points=[
            -51,0; -51,4; -52,4; -52,10.4], style(thickness=2));
      connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-52,17.6; -52,30; -51.8,30], style(thickness=2));
      connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) annotation (points=[-42,17.6;
            -42,28; -42.5,28; -42.5,30], style(thickness=2));
      connect(stateRhIP_in.inlet, steamTurbines.HPT_Out) 
        annotation (points=[-42,10.4; -42,0], style(thickness=2));
      connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-34,17.6; -34,30; -33.2,30], style(thickness=2));
      connect(stateShIP_out.outlet, steamTurbines.SteamToMix) 
        annotation (points=[-24,10.4; -24,0], style(thickness=2));
      connect(stateRhIP_out.outlet, steamTurbines.IPT_In) annotation (points=[
            -34,10.4; -34,6; -33,6; -33,0], style(thickness=2));
      connect(steamTurbines.LPT_In, stateShLP_out.outlet) annotation (points=[
            -15,0; -15,6; -14,6; -14,10.4], style(thickness=2));
      connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,17.6; -14,30; -14.6,30], style(thickness=2));
      connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) annotation (points=[-24,17.6;
            -23.9,17.6; -23.9,30], style(thickness=2));
      connect(sourceWater.flange, hRSG.WaterIn) 
        annotation (points=[22,14; -2.2,14; -2.2,30], style(thickness=2));
      connect(actuators, hRSG.ActuatorsBus) annotation (points=[80,42; 68,42;
            68,72.16; 3.38,72.16], style(color=52, rgbcolor={213,255,170}));
    end Test_ST_HRSG;
    
    model Test_STG_HRSG_open "Test of STG and HRSG, open circuit" 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      constant Real pi=Modelica.Constants.pi;
      
    public 
      Water.SourceW sourceWater(
        p0=1.98e6,
        h=2.440e5,
        w0=89.82)  annotation (extent=[34,8; 22,20]);
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,52; -86,64]);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                       annotation (extent=[44,52; 56,64]);
      Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
        annotation (extent=[100,18; 86,32]);
      Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
        annotation (extent=[60,18; 74,32]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-82,50; -66,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[20,50; 36,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-58,24; -46,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-30,24; -18,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-20,24; -8,12],    rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                 redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,24; -28,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-48,24; -36,12],   rotation=270);
    protected 
      Buses.Actuators actuators annotation (extent=[84,68; 76,76]);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
        steamTurbines(
        redeclare package FluidMedium = FluidMedium,
        steamHPNomFlowRate=67.6,
        steamHPNomPressure=1.28e7,
        steamIPNomFlowRate=81.10 - 67.5,
        steamIPNomPressure=2.68e6,
        steamLPNomPressure=6e5,
        pcond=5.3982e3,
        steamLPNomFlowRate=89.82 - 81.10,
        HPT_hstart_in=3.47e6,
        HPT_hstart_out=3.1076e6,
        IPT_hstart_in=3.554e6,
        IPT_hstart_out=3.12810e6,
        LPT_hstart_in=3.109e6,
        LPT_hstart_out=2.3854e6,
        mixLP_hstart=3.109e6,
        mixIP_hstart=3.1076e6,
        HPT_eta_iso_nom=0.833,
        IPT_eta_iso_nom=0.903,
        LPT_eta_iso_nom=0.876,
        HPT_Kt=0.0032078,
        IPT_Kt=0.018883,
        LPT_Kt=0.078004,
        mixLP_V=10,
        mixIP_V=10)  annotation (extent=[-60,-56; 0,4]);
      Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=314.16/
            2) 
        annotation (extent=[46,-36; 26,-16]);
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wafp hRSG 
                              annotation (extent=[-58,30; 4,92]);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateLPTout(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-16,-80; 4,-60], rotation=270);
      annotation (Diagram);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut1(                    redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[56,-80; 76,-60], rotation=90);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
        condenserIdeal(                                          p=5398.2, h=
            2.3854e6) annotation (extent=[22,-94; 42,-74]);
      Water.SinkW sinkW(
        w0=89.8,
        p0=5.3982e3,
        h=1.43495e5) annotation (extent=[78,-56; 98,-36]);
    equation 
      connect(com_pumpFeedIP.y,actuators. flowRate_feedIP) 
                                                   annotation (points=[74.7,25;
            80,25; 80,72], style(color=74, rgbcolor={0,0,127}));
      connect(com_pumpFeedHP.y,actuators. flowRate_feedHP) 
                                                   annotation (points=[85.3,25;
            80,25; 80,72],        style(color=74, rgbcolor={0,0,127}));
      connect(stateGas_in.inlet,sourceGas. flange) annotation (points=[-78.8,58;
            -86,58],       style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(sinkGas.flange,stateGas_out. outlet) annotation (points=[44,58;
            32.8,58],style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(constantSpeed.flange,steamTurbines. Shaft_b) 
                                                         annotation (points=[26,-26;
            0,-26],  style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2));
      connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-69.2,58;
            -63.75,58; -63.75,57.9; -58,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[23.2,58;
            12.75,58; 12.75,57.9; 4,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(steamTurbines.HPT_In, stateShHP_out.outlet) 
        annotation (points=[-51,4; -52,4; -52,14.4], style(thickness=2));
      connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-52,21.6; -52,30; -51.8,30], style(thickness=2));
      connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) annotation (points=[-42,21.6;
            -42,28; -42.5,28; -42.5,30], style(thickness=2));
      connect(stateRhIP_in.inlet, steamTurbines.HPT_Out) 
        annotation (points=[-42,14.4; -42,4], style(thickness=2));
      connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-34,21.6; -34,30; -33.2,30], style(thickness=2));
      connect(stateShIP_out.outlet, steamTurbines.SteamToMix) 
        annotation (points=[-24,14.4; -24,4], style(thickness=2));
      connect(stateRhIP_out.outlet, steamTurbines.IPT_In) annotation (points=[
            -34,14.4; -34,6; -33,6; -33,4], style(thickness=2));
      connect(steamTurbines.LPT_In, stateShLP_out.outlet) annotation (points=[
            -15,4; -15,6; -14,6; -14,14.4], style(thickness=2));
      connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,21.6; -14,30; -14.6,30], style(thickness=2));
      connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) annotation (points=[-24,21.6;
            -23.9,21.6; -23.9,30], style(thickness=2));
      connect(sourceWater.flange, hRSG.WaterIn) 
        annotation (points=[22,14; -2.2,14; -2.2,30], style(thickness=2));
      connect(actuators, hRSG.ActuatorsBus) annotation (points=[80,72; 68,72;
            68,72.16; 3.38,72.16], style(color=52, rgbcolor={213,255,170}));
      connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
        annotation (points=[-6,-64; -6,-60; -6,-60; -6,-56],
                                               style(thickness=2));
      connect(condenserIdeal.waterOut, stateCondOut1.inlet) 
        annotation (points=[32,-92; 66,-92; 66,-76]);
      connect(sinkW.flange, stateCondOut1.outlet) 
        annotation (points=[78,-46; 66,-46; 66,-64]);
      connect(condenserIdeal.steamIn, stateLPTout.outlet) 
        annotation (points=[32,-76; -6,-76; -6,-76]);
    end Test_STG_HRSG_open;
    
    model Test_STG_HRSG 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      constant Real pi=Modelica.Constants.pi;
      
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,52; -86,64]);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=379.448) 
                       annotation (extent=[44,52; 56,64]);
      Modelica.Blocks.Sources.Constant com_pumpFeedHP(k=64.5) 
        annotation (extent=[100,18; 86,32]);
      Modelica.Blocks.Sources.Constant com_pumpFeedIP(k=13.5) 
        annotation (extent=[60,18; 74,32]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-82,50; -66,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[20,50; 36,66],   rotation=0);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShHP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-58,24; -46,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShIP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-30,24; -18,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateShLP_out(
          redeclare package Medium = FluidMedium) 
                         annotation (extent=[-20,24; -8,12],    rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_out(
                                                 redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,24; -28,12],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateRhIP_in(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-48,24; -36,12],   rotation=270);
    protected 
      Buses.Actuators actuators annotation (extent=[84,68; 76,76]);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Examples.ST3LRh_base 
        steamTurbines(
        redeclare package FluidMedium = FluidMedium,
        steamHPNomFlowRate=67.6,
        steamHPNomPressure=1.28e7,
        steamIPNomFlowRate=81.10 - 67.5,
        steamIPNomPressure=2.68e6,
        steamLPNomPressure=6e5,
        pcond=5.3982e3,
        steamLPNomFlowRate=89.82 - 81.10,
        HPT_hstart_in=3.47e6,
        HPT_hstart_out=3.1076e6,
        IPT_hstart_in=3.554e6,
        IPT_hstart_out=3.12810e6,
        LPT_hstart_in=3.109e6,
        LPT_hstart_out=2.3854e6,
        mixLP_hstart=3.109e6,
        mixIP_hstart=3.1076e6,
        HPT_eta_iso_nom=0.833,
        IPT_eta_iso_nom=0.903,
        LPT_eta_iso_nom=0.876,
        HPT_Kt=0.0032078,
        IPT_Kt=0.018883,
        LPT_Kt=0.078004,
        mixLP_V=10,
        mixIP_V=10)  annotation (extent=[-60,-56; 0,4]);
      Modelica.Mechanics.Rotational.ConstantSpeed constantSpeed(w_fixed=314.16/
            2) 
        annotation (extent=[34,-36; 14,-16]);
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wafp hRSG 
                              annotation (extent=[-58,30; 4,92]);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateLPTout(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-12,-72; 0,-60], rotation=270);
      annotation (Diagram);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateInletHRSG(                                       redeclare package
          Medium = FluidMedium) 
        annotation (extent=[24,2; 38,16],    rotation=180);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                                       redeclare package 
          Medium = FluidMedium) 
        annotation (extent=[40,-78; 54,-64], rotation=90);
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.CondenserPreP 
        condenserIdeal(                                          p=5398.2, h=
            2.3854e6) annotation (extent=[-16,-94; 4,-74]);
    public 
      SteamTurbineGroup.Components.PrescribedSpeedPump prescribedSpeedPump(
        rho_nom=1000,
        n0=1500,
        nominalCondensationPressure=5.3982e3,
        redeclare package WaterMedium = FluidMedium,
        nominalSteamFlow=89.8,
        nominalSteamPressure=7.19e5,
        feedWaterPump(hstart=1.44e5),
        dh=2.44e5 - 1.43495e5,
        q_nom={0.0898,0,0.1},
        head_nom={72.74,130,0}) 
                              annotation (extent=[76,-50; 60,-66], rotation=
            180);
    public 
      Modelica.Blocks.Sources.Constant n_pump(k=1500) 
        annotation (extent=[78,-20; 68,-10]);
    equation 
      connect(com_pumpFeedIP.y,actuators. flowRate_feedIP) 
                                                   annotation (points=[74.7,25;
            80,25; 80,72], style(color=74, rgbcolor={0,0,127}));
      connect(com_pumpFeedHP.y,actuators. flowRate_feedHP) 
                                                   annotation (points=[85.3,25;
            80,25; 80,72],        style(color=74, rgbcolor={0,0,127}));
      connect(stateGas_in.inlet,sourceGas. flange) annotation (points=[-78.8,58;
            -86,58],       style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(sinkGas.flange,stateGas_out. outlet) annotation (points=[44,58;
            32.8,58],style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2,
          fillColor=76,
          rgbfillColor={170,170,255},
          fillPattern=1));
      connect(constantSpeed.flange,steamTurbines. Shaft_b) 
                                                         annotation (points=[14,-26;
            0,-26],  style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2));
      connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-69.2,58;
            -63.75,58; -63.75,57.9; -58,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[23.2,58;
            12.75,58; 12.75,57.9; 4,57.9],      style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(steamTurbines.HPT_In, stateShHP_out.outlet) 
        annotation (points=[-51,4; -52,4; -52,14.4], style(thickness=2));
      connect(stateShHP_out.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-52,21.6; -52,30; -51.8,30], style(thickness=2));
      connect(stateRhIP_in.outlet, hRSG.Rh_IP_In) annotation (points=[-42,21.6;
            -42,28; -42.5,28; -42.5,30], style(thickness=2));
      connect(stateRhIP_in.inlet, steamTurbines.HPT_Out) 
        annotation (points=[-42,14.4; -42,4], style(thickness=2));
      connect(stateRhIP_out.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-34,21.6; -34,30; -33.2,30], style(thickness=2));
      connect(stateShIP_out.outlet, steamTurbines.SteamToMix) 
        annotation (points=[-24,14.4; -24,4], style(thickness=2));
      connect(stateRhIP_out.outlet, steamTurbines.IPT_In) annotation (points=[
            -34,14.4; -34,6; -33,6; -33,4], style(thickness=2));
      connect(steamTurbines.LPT_In, stateShLP_out.outlet) annotation (points=[
            -15,4; -15,6; -14,6; -14,14.4], style(thickness=2));
      connect(stateShLP_out.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,21.6; -14,30; -14.6,30], style(thickness=2));
      connect(stateShIP_out.inlet, hRSG.Sh_IP_Out) annotation (points=[-24,21.6;
            -23.9,21.6; -23.9,30], style(thickness=2));
      connect(actuators, hRSG.ActuatorsBus) annotation (points=[80,72; 68,72;
            68,72.16; 3.38,72.16], style(color=52, rgbcolor={213,255,170}));
      connect(stateLPTout.inlet, steamTurbines.LPT_Out) 
        annotation (points=[-6,-62.4; -6,-59.2; -6,-59.2; -6,-56],
                                               style(thickness=2));
      connect(condenserIdeal.waterOut, stateCondOut.inlet) 
        annotation (points=[-6,-92; -6,-98; 47,-98; 47,-75.2],
                                                     style(thickness=2));
      connect(stateInletHRSG.outlet, hRSG.WaterIn) 
        annotation (points=[26.8,9; -2.2,9; -2.2,30], style(thickness=2));
      connect(condenserIdeal.steamIn, stateLPTout.outlet) 
        annotation (points=[-6,-76; -6,-72.8; -6,-69.6; -6,-69.6],
                                                    style(thickness=2));
      connect(n_pump.y,prescribedSpeedPump. pumpSpeed_rpm) annotation (points=[67.5,-15;
            48,-15; 48,-53.2; 59.36,-53.2],  style(color=74, rgbcolor={0,0,
              127}));
      connect(stateCondOut.outlet, prescribedSpeedPump.inlet) 
        annotation (points=[47,-66.8; 47,-58; 60,-58],
                                                     style(thickness=2));
      connect(prescribedSpeedPump.outlet, stateInletHRSG.inlet) 
        annotation (points=[76,-58; 90,-58; 90,9; 35.2,9], style(thickness=2));
    end Test_STG_HRSG;
    
    model TestSteamPlant 
      "Test total plant with parameter initial resetting and without control" 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                   cylindersBodies(
          fluidHPNomPressure=1.22116e7,
          fluidIPNomPressure=2.63694e6,
          fluidLPNomPressure=6.047e5,
          HPd_hvstart=2.61182e6,
          HPd_hlstart=1.411212e6,
          IPd_hvstart=2.79542e6,
          IPd_hlstart=9.22034e5,
          LPd_hvstart=2.75273e6,
          LPd_hlstart=6.10909e5), HeatExchangersGroup(
          fluidHPNomPressure_Sh=1.22116e7,
          fluidHPNomPressure_Ev=1.22116e7,
          fluidHPNomPressure_Ec=1.22116e7,
          fluidIPNomPressure_Rh=2.63694e6,
          fluidIPNomPressure_Sh=2.63694e6,
          fluidIPNomPressure_Ev=2.63694e6,
          fluidIPNomPressure_Ec=2.63694e6,
          fluidLPNomPressure_Sh=6.0474e5,
          fluidLPNomPressure_Ev=6.0474e5,
          fluidLPNomPressure_Ec=6.0474e5,
          fluidHPNomFlowRate_Sh=62.8,
          fluidHPNomFlowRate_Ec=64.5,
          fluidIPNomFlowRate_Rh=77.36,
          fluidIPNomFlowRate_Sh=14.5,
          fluidIPNomFlowRate_Ec=13.5,
          fluidLPNomFlowRate_Sh=10.95,
          fluidLPNomFlowRate_Ec=89.8,
          Ec2_HP_Tstart_G_In=605.074,
          Ec2_HP_Tstart_G_Out=548.522,
          Ec2_HP_Tstart_M_In=488.443,
          Ec2_HP_Tstart_M_Out=588.719,
          Ec2_HP_Tstart_F_In=476.660,
          Ec2_HP_Tstart_F_Out=585.495,
          Ec1_HP_Tstart_M_In=426.384,
          Ec1_HP_Tstart_M_Out=479.885,
          Ec1_HP_Tstart_F_In=420.129,
          Ec1_HP_Tstart_F_Out=476.660,
          Ec_IP_Tstart_G_In=501.802,
          Ec_IP_Tstart_G_Out=468.900,
          Ec_IP_Tstart_M_In=427.707,
          Ec_IP_Tstart_M_Out=490.160,
          Ec_IP_Tstart_F_In=421.552,
          Ec_IP_Tstart_F_Out=488.422,
          Ec_LP_Tstart_G_In=427.671,
          Ec_LP_Tstart_M_In=336.404,
          Ec_LP_Tstart_M_Out=419.330,
          Ec_LP_Tstart_F_In=331.506,
          Ec_LP_Tstart_F_Out=418.193,
          Ev_HP_Tstart_G_In=732.000,
          Ev_HP_Tstart_G_Out=611.190,
          Ev_HP_Tstart_M_In=594.933,
          Ev_HP_Tstart_M_Out=603.160,
          Ev_HP_hstart_F_In=1.46797e6,
          Ev_HP_hstart_F_Out=1.90129e6,
          Ev_IP_Tstart_G_In=548.522,
          Ev_IP_Tstart_G_Out=503.810,
          Ev_IP_Tstart_M_In=497.865,
          Ev_IP_Tstart_M_Out=501.763,
          Ev_IP_hstart_F_In=9.64527e5,
          Ev_IP_hstart_F_Out=1.36736e6,
          Ev_LP_Tstart_G_In=468.900,
          Ev_LP_Tstart_G_Out=427.671,
          Ev_LP_Tstart_M_In=422.216,
          Ev_LP_Tstart_M_Out=434.622,
          Ev_LP_hstart_F_In=6.26623e5,
          Ev_LP_hstart_F_Out=1.22154e6,
          Sh2_HP_Tstart_G_In=884.650,
          Sh2_HP_Tstart_G_Out=849.290,
          Sh2_HP_Tstart_M_In=801.698,
          Sh2_HP_Tstart_M_Out=861.343,
          Sh2_HP_Tstart_F_In=792.680,
          Sh2_HP_Tstart_F_Out=857.106,
          Sh1_HP_Tstart_G_In=849.290,
          Sh1_HP_Tstart_G_Out=732.000,
          Sh1_HP_Tstart_M_In=624.205,
          Sh1_HP_Tstart_M_Out=803.585,
          Sh1_HP_Tstart_F_In=599.180,
          Sh1_HP_Tstart_F_Out=792.680,
          Rh2_IP_Tstart_M_In=793.962,
          Rh2_IP_Tstart_M_Out=863.890,
          Rh2_IP_Tstart_F_In=787.973,
          Rh2_IP_Tstart_F_Out=861.625,
          Rh1_IP_Tstart_M_In=641.307,
          Rh1_IP_Tstart_M_Out=793.753,
          Rh1_IP_Tstart_F_In=631.882,
          Rh1_IP_Tstart_F_Out=787.973,
          Sh_IP_Tstart_G_In=611.19,
          Sh_IP_Tstart_G_Out=605.074,
          Sh_IP_Tstart_M_In=504.237,
          Sh_IP_Tstart_M_Out=594.703,
          Sh_IP_Tstart_F_In=499.962,
          Sh_IP_Tstart_F_Out=594.001,
          Sh_LP(gamma_G=30, gamma_F=4000),
          Sh_LP_N_F=4,
          Ec_LP_Tstart_G_Out=372.309)) 
                              annotation (extent=[-56,8; 4,68]);
      SteamTurbineGroup.Examples.STG_3LRh sTG_3LRh(steamTurbines(
          steamHPNomPressure=1.2202e7,
          steamIPNomPressure=2.63681e6,
          steamLPNomPressure=6.047e5,
          HPT_hstart_in=3.56678e6,
          HPT_hstart_out=3.16451e6,
          IPT_hstart_in=3.65985e6,
          IPT_hstart_out=3.21285e6,
          LPT_hstart_in=3.16961e6,
          LPT_hstart_out=2.41849e6,
          mixLP_hstart=3.16953e6,
          mixIP_hstart=3.14446e6,
          steamHPNomFlowRate=62.8,
          steamIPNomFlowRate=14.5,
          steamLPNomFlowRate=10.9)) 
        annotation (extent=[-56,-86; 4,-26]);
      annotation (Diagram);
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-100,28; -86,42]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-80,26; -62,44],   rotation=0);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=362.309) 
                       annotation (extent=[46,28; 60,42]);
      Modelica.Blocks.Sources.Constant feedHP(k=64.5) 
        annotation (extent=[72,64; 60,76]);
      Modelica.Blocks.Sources.Constant feedIP(k=13.5) 
        annotation (extent=[32,64; 44,76]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[16,26; 32,44],   rotation=0);
    protected 
      Buses.Actuators actuators annotation (extent=[58,44; 46,54]);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-10,-18; 6,-2],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-58,-2; -42,-18],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                   redeclare package Medium = 
            FluidMedium) annotation (extent=[-32,-2; -16,-18],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-22,-2; -6,-18],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,-2; -24,-18],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-50,-2; -34,-18],  rotation=270);
    public 
      Modelica.Blocks.Sources.Constant feedLP(k=89.8) 
        annotation (extent=[88,86; 76,98]);
      ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
        singleShaft(
        Pn=50e8,
        omega_nom=314.16/2,
        eta=0.9,
        J_shaft=100,
        d_shaft=0)  annotation (extent=[20,-86; 80,-26]);
    public 
      Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
        annotation (extent=[32,-18; 44,-6]);
    protected 
      Buses.Actuators actuators1 
        annotation (extent=[64,-18; 76,-6],   rotation=0);
    equation 
      connect(actuators, hRSG.ActuatorsBus) annotation (points=[52,49; 28.6,49;
            28.6,48.8; 3.4,48.8], style(color=52, rgbcolor={213,255,170}));
      connect(sTG_3LRh.WaterOut, stateCondOut.inlet) annotation (points=[-2,-26;
            -2,-20.4; -2,-14.8; -2,-14.8], style(thickness=2));
      connect(stateCondOut.outlet, hRSG.WaterIn) 
        annotation (points=[-2,-5.2; -2,1.4; -2,1.4; -2,8],
                                            style(thickness=2));
      connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
        annotation (points=[-14,-26; -14,-14.8], style(thickness=2));
      connect(stateLPT_in.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,-5.2; -14,8], style(thickness=2));
      connect(stateToMix.outlet, sTG_3LRh.From_SH_IP) annotation (points=[-24,
            -14.8; -24,-24.4; -23,-24.4; -23,-26], style(thickness=2));
      connect(stateToMix.inlet, hRSG.Sh_IP_Out) 
        annotation (points=[-24,-5.2; -24,8; -23,8], style(thickness=2));
      connect(stateIPT_in.outlet, sTG_3LRh.From_RH_IP) 
        annotation (points=[-32,-14.8; -32,-26], style(thickness=2));
      connect(stateIPT_in.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-32,-5.2; -32,8], style(thickness=2));
      connect(stateHPT_out.inlet, sTG_3LRh.To_RH_IP) 
        annotation (points=[-42,-14.8; -42,-26; -41,-26], style(thickness=2));
      connect(stateHPT_out.outlet, hRSG.Rh_IP_In) 
        annotation (points=[-42,-5.2; -42,8; -41,8], style(thickness=2));
      connect(stateHPT_in.outlet, sTG_3LRh.From_SH_HP) 
        annotation (points=[-50,-14.8; -50,-26], style(thickness=2));
      connect(stateHPT_in.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-50,-5.2; -50,8], style(thickness=2));
      connect(stateGas_in.inlet, sourceGas.flange) annotation (points=[-76.4,35;
            -86,35], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_in.outlet, hRSG.GasIn) annotation (points=[-65.6,35; -56,
            35], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[46,35;
            28.8,35],               style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[19.2,35; 4,
            35], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(booleanConstant.y, actuators1.breakerClosed) 
                                                          annotation (points=[44.6,-12;
            70,-12],           style(color=5, rgbcolor={255,0,255}));
      connect(actuators1, singleShaft.ActuatorsBus) annotation (points=[70,-12;
            92,-12; 92,-77.6; 79.4,-77.6], style(
          color=52,
          rgbcolor={213,255,170},
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(singleShaft.shaft, sTG_3LRh.Shaft_b) annotation (points=[20,-56;
            4,-56], style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2,
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(feedHP.y, actuators.flowRate_feedHP) annotation (points=[59.4,70;
            52,70; 52,50], style(color=74, rgbcolor={0,0,127}));
      connect(feedIP.y, actuators.flowRate_feedIP) annotation (points=[44.6,70;
            52,70; 52,50], style(color=74, rgbcolor={0,0,127}));
      connect(feedLP.y, actuators.flowRate_feedLP) annotation (points=[75.4,92;
            52,92; 52,50], style(color=74, rgbcolor={0,0,127}));
    end TestSteamPlant;
    
    model TestSteamPlant_valve 
      "Test total plant with parameter initial resetting, level control and inlet valve on the steam turbine group" 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                   cylindersBodies(
          fluidHPNomPressure=1.22116e7,
          fluidIPNomPressure=2.63694e6,
          fluidLPNomPressure=6.047e5,
          HPd_hvstart=2.61182e6,
          HPd_hlstart=1.411212e6,
          IPd_hvstart=2.79542e6,
          IPd_hlstart=9.22034e5,
          LPd_hvstart=2.75273e6,
          LPd_hlstart=6.10909e5), HeatExchangersGroup(
          fluidHPNomPressure_Sh=1.22116e7,
          fluidHPNomPressure_Ev=1.22116e7,
          fluidHPNomPressure_Ec=1.22116e7,
          fluidIPNomPressure_Rh=2.63694e6,
          fluidIPNomPressure_Sh=2.63694e6,
          fluidIPNomPressure_Ev=2.63694e6,
          fluidIPNomPressure_Ec=2.63694e6,
          fluidLPNomPressure_Sh=6.0474e5,
          fluidLPNomPressure_Ev=6.0474e5,
          fluidLPNomPressure_Ec=6.0474e5,
          fluidHPNomFlowRate_Sh=62.8,
          fluidHPNomFlowRate_Ec=64.5,
          fluidIPNomFlowRate_Rh=77.36,
          fluidIPNomFlowRate_Sh=14.5,
          fluidIPNomFlowRate_Ec=13.5,
          fluidLPNomFlowRate_Sh=10.95,
          fluidLPNomFlowRate_Ec=89.8,
          Ec2_HP_Tstart_G_In=605.074,
          Ec2_HP_Tstart_G_Out=548.522,
          Ec2_HP_Tstart_M_In=488.443,
          Ec2_HP_Tstart_M_Out=588.719,
          Ec2_HP_Tstart_F_In=476.660,
          Ec2_HP_Tstart_F_Out=585.495,
          Ec1_HP_Tstart_M_In=426.384,
          Ec1_HP_Tstart_M_Out=479.885,
          Ec1_HP_Tstart_F_In=420.129,
          Ec1_HP_Tstart_F_Out=476.660,
          Ec_IP_Tstart_G_In=501.802,
          Ec_IP_Tstart_G_Out=468.900,
          Ec_IP_Tstart_M_In=427.707,
          Ec_IP_Tstart_M_Out=490.160,
          Ec_IP_Tstart_F_In=421.552,
          Ec_IP_Tstart_F_Out=488.422,
          Ec_LP_Tstart_G_In=427.671,
          Ec_LP_Tstart_M_In=336.404,
          Ec_LP_Tstart_M_Out=419.330,
          Ec_LP_Tstart_F_In=331.506,
          Ec_LP_Tstart_F_Out=418.193,
          Ev_HP_Tstart_G_In=732.000,
          Ev_HP_Tstart_G_Out=611.190,
          Ev_HP_Tstart_M_In=594.933,
          Ev_HP_Tstart_M_Out=603.160,
          Ev_HP_hstart_F_In=1.46797e6,
          Ev_HP_hstart_F_Out=1.90129e6,
          Ev_IP_Tstart_G_In=548.522,
          Ev_IP_Tstart_G_Out=503.810,
          Ev_IP_Tstart_M_In=497.865,
          Ev_IP_Tstart_M_Out=501.763,
          Ev_IP_hstart_F_In=9.64527e5,
          Ev_IP_hstart_F_Out=1.36736e6,
          Ev_LP_Tstart_G_In=468.900,
          Ev_LP_Tstart_G_Out=427.671,
          Ev_LP_Tstart_M_In=422.216,
          Ev_LP_Tstart_M_Out=434.622,
          Ev_LP_hstart_F_In=6.26623e5,
          Ev_LP_hstart_F_Out=1.22154e6,
          Sh2_HP_Tstart_G_In=884.650,
          Sh2_HP_Tstart_G_Out=849.290,
          Sh2_HP_Tstart_M_In=801.698,
          Sh2_HP_Tstart_M_Out=861.343,
          Sh2_HP_Tstart_F_In=792.680,
          Sh2_HP_Tstart_F_Out=857.106,
          Sh1_HP_Tstart_G_In=849.290,
          Sh1_HP_Tstart_G_Out=732.000,
          Sh1_HP_Tstart_M_In=624.205,
          Sh1_HP_Tstart_M_Out=803.585,
          Sh1_HP_Tstart_F_In=599.180,
          Sh1_HP_Tstart_F_Out=792.680,
          Rh2_IP_Tstart_M_In=793.962,
          Rh2_IP_Tstart_M_Out=863.890,
          Rh2_IP_Tstart_F_In=787.973,
          Rh2_IP_Tstart_F_Out=861.625,
          Rh1_IP_Tstart_M_In=641.307,
          Rh1_IP_Tstart_M_Out=793.753,
          Rh1_IP_Tstart_F_In=631.882,
          Rh1_IP_Tstart_F_Out=787.973,
          Sh_IP_Tstart_G_In=611.19,
          Sh_IP_Tstart_G_Out=605.074,
          Sh_IP_Tstart_M_In=504.237,
          Sh_IP_Tstart_M_Out=594.703,
          Sh_IP_Tstart_F_In=499.962,
          Sh_IP_Tstart_F_Out=594.001,
          Sh_LP(gamma_G=30, gamma_F=4000),
          Sh_LP_N_F=4,
          Ec_LP_Tstart_G_Out=372.309,
          Ev_LP(gamma_G=80, gamma_F=20000))) 
                              annotation (extent=[-56,4; 4,64]);
      SteamTurbineGroup.Examples.STG_3LRh_valve steamTurbineGroup(steamTurbines(
          steamHPNomPressure=1.2202e7,
          steamIPNomPressure=2.63681e6,
          steamLPNomPressure=6.047e5,
          HPT_hstart_in=3.56678e6,
          HPT_hstart_out=3.16451e6,
          IPT_hstart_in=3.65985e6,
          IPT_hstart_out=3.21285e6,
          LPT_hstart_in=3.16961e6,
          LPT_hstart_out=2.41849e6,
          mixLP_hstart=3.16953e6,
          mixIP_hstart=3.14446e6,
          steamHPNomFlowRate=62.8,
          steamIPNomFlowRate=14.5,
          steamLPNomFlowRate=10.9)) 
        annotation (extent=[-56,-86; 4,-26]);
      annotation (Diagram);
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-100,24; -86,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-80,22; -62,40],   rotation=0);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=362.309) 
                       annotation (extent=[38,24; 52,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[14,22; 30,40],   rotation=0);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-10,-20; 6,-4],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-58,-4; -42,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                   redeclare package Medium = 
            FluidMedium) annotation (extent=[-32,-4; -16,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-22,-4; -6,-20],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,-4; -24,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-50,-4; -34,-20],  rotation=270);
      ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
        singleShaft(
        Pn=50e8,
        omega_nom=314.16/2,
        eta=0.9,
        J_shaft=100,
        d_shaft=0)  annotation (extent=[20,-86; 80,-26]);
    public 
      Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
        annotation (extent=[32,-18; 44,-6]);
    protected 
      Buses.Actuators actuators1 
        annotation (extent=[64,-18; 76,-6],   rotation=0);
    public 
      ThermoPower.PowerPlants.HRSG.Control.levelsControl 
        levelsControlSimplified(
          CSmin_levelLP=500, CSmax_levelLP=2500) 
        annotation (extent=[40,60; 60,80]);
    protected 
      Buses.Actuators actuators annotation (extent=[-18,-98; -10,-90]);
    public 
      Modelica.Blocks.Sources.Ramp valveHP_com(height=0, offset=1) 
        annotation (extent=[-96,-46; -84,-34]);
      Modelica.Blocks.Sources.Ramp valveIP_com(height=0, offset=1) 
        annotation (extent=[-96,-66; -84,-54]);
      Modelica.Blocks.Sources.Ramp valveLP_com(height=0, offset=1) 
        annotation (extent=[-96,-86; -84,-74]);
    equation 
      connect(steamTurbineGroup.WaterOut, stateCondOut.inlet) 
                                                     annotation (points=[-2,-26;
            -2,-21.4; -2,-16.8; -2,-16.8], style(thickness=2));
      connect(stateCondOut.outlet, hRSG.WaterIn) 
        annotation (points=[-2,-7.2; -2,-1.6; -2,-1.6; -2,4],
                                            style(thickness=2));
      connect(steamTurbineGroup.From_SH_LP, stateLPT_in.outlet) 
        annotation (points=[-14,-26; -14,-16.8], style(thickness=2));
      connect(stateLPT_in.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,-7.2; -14,4], style(thickness=2));
      connect(stateToMix.outlet, steamTurbineGroup.From_SH_IP) 
                                                      annotation (points=[-24,
            -16.8; -24,-24.4; -23,-24.4; -23,-26], style(thickness=2));
      connect(stateToMix.inlet, hRSG.Sh_IP_Out) 
        annotation (points=[-24,-7.2; -24,4; -23,4], style(thickness=2));
      connect(stateIPT_in.outlet, steamTurbineGroup.From_RH_IP) 
        annotation (points=[-32,-16.8; -32,-26], style(thickness=2));
      connect(stateIPT_in.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-32,-7.2; -32,4], style(thickness=2));
      connect(stateHPT_out.inlet, steamTurbineGroup.To_RH_IP) 
        annotation (points=[-42,-16.8; -42,-26; -41,-26], style(thickness=2));
      connect(stateHPT_out.outlet, hRSG.Rh_IP_In) 
        annotation (points=[-42,-7.2; -42,4; -41,4], style(thickness=2));
      connect(stateHPT_in.outlet, steamTurbineGroup.From_SH_HP) 
        annotation (points=[-50,-16.8; -50,-26], style(thickness=2));
      connect(stateHPT_in.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-50,-7.2; -50,4], style(thickness=2));
      connect(booleanConstant.y, actuators1.breakerClosed) 
                                                          annotation (points=[44.6,-12;
            70,-12],           style(color=5, rgbcolor={255,0,255}));
      connect(actuators1, singleShaft.ActuatorsBus) annotation (points=[70,-12;
            92,-12; 92,-77.6; 79.4,-77.6], style(
          color=52,
          rgbcolor={213,255,170},
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(singleShaft.shaft, steamTurbineGroup.Shaft_b) 
                                                   annotation (points=[20,-56;
            4,-56], style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2,
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[38,31;
            26.8,31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[17.2,31; 4,
            31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(hRSG.GasIn, stateGas_in.outlet) annotation (points=[-56,31; -65.6,
            31],                   style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(sourceGas.flange, stateGas_in.inlet) annotation (points=[-86,31;
            -82,31; -82,31; -76.4,31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(levelsControlSimplified.SensorsBus, hRSG.SensorsBus) annotation (
          points=[40.2,70; 20,70; 20,54.4; 3.4,54.4], style(color=84, rgbcolor=
              {255,170,213}));
      connect(hRSG.ActuatorsBus, levelsControlSimplified.ActuatorsBus) 
        annotation (points=[3.4,44.8; 82,44.8; 82,70; 60,70], style(color=52,
            rgbcolor={213,255,170}));
      connect(actuators, steamTurbineGroup.ActuatorsBus) annotation (points=[-14,-94;
            14,-94; 14,-77.6; 3.4,-77.6],          style(color=52, rgbcolor={
              213,255,170}));
      connect(actuators.Opening_valveHP, valveHP_com.y) annotation (points=[-14,
            -94; -72,-94; -72,-40; -83.4,-40], style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveIP, valveIP_com.y) annotation (points=[-14,
            -94; -72,-94; -72,-60; -83.4,-60], style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveLP, valveLP_com.y) annotation (points=[-14,
            -94; -72,-94; -72,-80; -83.4,-80], style(color=52, rgbcolor={213,
              255,170}));
    end TestSteamPlant_valve;
    
    model TestSteamPlant_controls 
      "Test total plant with levels control and ratio control on the condenser " 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                  HeatExchangersGroup(
          fluidHPNomPressure_Sh=1.22116e7,
          fluidHPNomPressure_Ev=1.22116e7,
          fluidHPNomPressure_Ec=1.22116e7,
          fluidIPNomPressure_Rh=2.63694e6,
          fluidIPNomPressure_Sh=2.63694e6,
          fluidIPNomPressure_Ev=2.63694e6,
          fluidIPNomPressure_Ec=2.63694e6,
          fluidLPNomPressure_Sh=6.0474e5,
          fluidLPNomPressure_Ev=6.0474e5,
          fluidLPNomPressure_Ec=6.0474e5,
          fluidHPNomFlowRate_Sh=62.8,
          fluidHPNomFlowRate_Ec=64.5,
          fluidIPNomFlowRate_Rh=77.36,
          fluidIPNomFlowRate_Sh=14.5,
          fluidIPNomFlowRate_Ec=13.5,
          fluidLPNomFlowRate_Sh=10.95,
          fluidLPNomFlowRate_Ec=89.8,
          Ec2_HP_Tstart_G_In=605.074,
          Ec2_HP_Tstart_G_Out=548.522,
          Ec2_HP_Tstart_M_In=488.443,
          Ec2_HP_Tstart_M_Out=588.719,
          Ec2_HP_Tstart_F_In=476.660,
          Ec2_HP_Tstart_F_Out=585.495,
          Ec1_HP_Tstart_M_In=426.384,
          Ec1_HP_Tstart_M_Out=479.885,
          Ec1_HP_Tstart_F_In=420.129,
          Ec1_HP_Tstart_F_Out=476.660,
          Ec_IP_Tstart_G_In=501.802,
          Ec_IP_Tstart_G_Out=468.900,
          Ec_IP_Tstart_M_In=427.707,
          Ec_IP_Tstart_M_Out=490.160,
          Ec_IP_Tstart_F_In=421.552,
          Ec_IP_Tstart_F_Out=488.422,
          Ec_LP_Tstart_G_In=427.671,
          Ec_LP_Tstart_M_In=336.404,
          Ec_LP_Tstart_M_Out=419.330,
          Ec_LP_Tstart_F_In=331.506,
          Ec_LP_Tstart_F_Out=418.193,
          Ev_HP_Tstart_G_In=732.000,
          Ev_HP_Tstart_G_Out=611.190,
          Ev_HP_Tstart_M_In=594.933,
          Ev_HP_Tstart_M_Out=603.160,
          Ev_HP_hstart_F_In=1.46797e6,
          Ev_HP_hstart_F_Out=1.90129e6,
          Ev_IP_Tstart_G_In=548.522,
          Ev_IP_Tstart_G_Out=503.810,
          Ev_IP_Tstart_M_In=497.865,
          Ev_IP_Tstart_M_Out=501.763,
          Ev_IP_hstart_F_In=9.64527e5,
          Ev_IP_hstart_F_Out=1.36736e6,
          Ev_LP_Tstart_G_In=468.900,
          Ev_LP_Tstart_G_Out=427.671,
          Ev_LP_Tstart_M_In=422.216,
          Ev_LP_Tstart_M_Out=434.622,
          Ev_LP_hstart_F_In=6.26623e5,
          Ev_LP_hstart_F_Out=1.22154e6,
          Sh2_HP_Tstart_G_In=884.650,
          Sh2_HP_Tstart_G_Out=849.290,
          Sh2_HP_Tstart_M_In=801.698,
          Sh2_HP_Tstart_M_Out=861.343,
          Sh2_HP_Tstart_F_In=792.680,
          Sh2_HP_Tstart_F_Out=857.106,
          Sh1_HP_Tstart_G_In=849.290,
          Sh1_HP_Tstart_G_Out=732.000,
          Sh1_HP_Tstart_M_In=624.205,
          Sh1_HP_Tstart_M_Out=803.585,
          Sh1_HP_Tstart_F_In=599.180,
          Sh1_HP_Tstart_F_Out=792.680,
          Rh2_IP_Tstart_M_In=793.962,
          Rh2_IP_Tstart_M_Out=863.890,
          Rh2_IP_Tstart_F_In=787.973,
          Rh2_IP_Tstart_F_Out=861.625,
          Rh1_IP_Tstart_M_In=641.307,
          Rh1_IP_Tstart_M_Out=793.753,
          Rh1_IP_Tstart_F_In=631.882,
          Rh1_IP_Tstart_F_Out=787.973,
          Sh_IP_Tstart_G_In=611.19,
          Sh_IP_Tstart_G_Out=605.074,
          Sh_IP_Tstart_M_In=504.237,
          Sh_IP_Tstart_M_Out=594.703,
          Sh_IP_Tstart_F_In=499.962,
          Sh_IP_Tstart_F_Out=594.001,
          Sh_LP(gamma_G=30, gamma_F=4000),
          Sh_LP_N_F=4,
          Ec_LP_Tstart_G_Out=372.309,
          Ec_LP(gamma_G=35, gamma_F=3000),
          Ev_LP(gamma_G=60, gamma_F=20000),
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=70,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_F_A=4000,
            gamma_F_B=4000,
            gamma_G_A=70,
            gamma_G_B=70)),            cylindersBodies(
          fluidHPNomPressure=1.22116e7,
          fluidIPNomPressure=2.63694e6,
          fluidLPNomPressure=6.047e5,
          HPd_hvstart=2.61182e6,
          HPd_hlstart=1.411212e6,
          IPd_hvstart=2.79542e6,
          IPd_hlstart=9.22034e5,
          LPd_hvstart=2.75273e6,
          LPd_hlstart=6.10909e5)) 
                              annotation (extent=[-56,4; 4,64]);
      SteamTurbineGroup.Examples.STG_3LRh_cc sTG_3LRh(steamTurbines(
          steamHPNomPressure=1.2202e7,
          steamIPNomPressure=2.63681e6,
          steamLPNomPressure=6.047e5,
          HPT_hstart_in=3.56678e6,
          HPT_hstart_out=3.16451e6,
          IPT_hstart_in=3.65985e6,
          IPT_hstart_out=3.21285e6,
          LPT_hstart_in=3.16961e6,
          LPT_hstart_out=2.41849e6,
          mixLP_hstart=3.16953e6,
          mixIP_hstart=3.14446e6,
          steamHPNomFlowRate=62.8,
          steamIPNomFlowRate=14.5,
          steamLPNomFlowRate=10.9), controlledCondeser(Vlstart=5)) 
        annotation (extent=[-56,-86; 4,-26]);
      annotation (Diagram, experiment(StopTime=20000));
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,24; -84,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-80,22; -62,40],   rotation=0);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=362.309) 
                       annotation (extent=[38,24; 52,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[14,22; 30,40],   rotation=0);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-10,-20; 6,-4],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-58,-4; -42,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                   redeclare package Medium = 
            FluidMedium) annotation (extent=[-32,-4; -16,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-22,-4; -6,-20],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,-4; -24,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-50,-4; -34,-20],  rotation=270);
      ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
        singleShaft(
        Pn=50e8,
        omega_nom=314.16/2,
        eta=0.9,
        J_shaft=100,
        d_shaft=0)  annotation (extent=[20,-86; 80,-26]);
    public 
      Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
        annotation (extent=[32,-18; 44,-6]);
    protected 
      Buses.Actuators actuators1 
        annotation (extent=[64,-18; 76,-6],   rotation=0);
    public 
      HRSG.Control.levelsControl levelsControl(
        CSmin_levelHP=30,
        CSmax_levelHP=96,
        CSmin_levelIP=5,
        CSmax_levelIP=25,
        CSmax_levelLP=2400) 
        annotation (extent=[40,60; 60,80]);
      Modelica.Blocks.Sources.Ramp ramp(
        height=-50,
        duration=500,
        offset=585.5,
        startTime=5000) annotation (extent=[-98,60; -78,80]);
    equation 
      connect(sTG_3LRh.WaterOut, stateCondOut.inlet) annotation (points=[-2,-26;
            -2,-24; -4.44089e-016,-24; -4.44089e-016,-22; -2,-22; -2,-16.8],
                                           style(thickness=2));
      connect(stateCondOut.outlet, hRSG.WaterIn) 
        annotation (points=[-2,-7.2; -2,-1.6; -2,-1.6; -2,4],
                                            style(thickness=2));
      connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
        annotation (points=[-14,-26; -14,-16.8], style(thickness=2));
      connect(stateLPT_in.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,-7.2; -14,4], style(thickness=2));
      connect(stateToMix.outlet, sTG_3LRh.From_SH_IP) annotation (points=[-24,
            -16.8; -24,-24.4; -23,-24.4; -23,-26], style(thickness=2));
      connect(stateToMix.inlet, hRSG.Sh_IP_Out) 
        annotation (points=[-24,-7.2; -24,4; -23,4], style(thickness=2));
      connect(stateIPT_in.outlet, sTG_3LRh.From_RH_IP) 
        annotation (points=[-32,-16.8; -32,-26], style(thickness=2));
      connect(stateIPT_in.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-32,-7.2; -32,4], style(thickness=2));
      connect(stateHPT_out.inlet, sTG_3LRh.To_RH_IP) 
        annotation (points=[-42,-16.8; -42,-26; -41,-26], style(thickness=2));
      connect(stateHPT_out.outlet, hRSG.Rh_IP_In) 
        annotation (points=[-42,-7.2; -42,4; -41,4], style(thickness=2));
      connect(stateHPT_in.outlet, sTG_3LRh.From_SH_HP) 
        annotation (points=[-50,-16.8; -50,-26], style(thickness=2));
      connect(stateHPT_in.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-50,-7.2; -50,4], style(thickness=2));
      connect(booleanConstant.y, actuators1.breakerClosed) 
                                                          annotation (points=[44.6,-12;
            70,-12],           style(color=5, rgbcolor={255,0,255}));
      connect(actuators1, singleShaft.ActuatorsBus) annotation (points=[70,-12;
            92,-12; 92,-77.6; 79.4,-77.6], style(
          color=52,
          rgbcolor={213,255,170},
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(singleShaft.shaft, sTG_3LRh.Shaft_b) annotation (points=[20,-56;
            4,-56], style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2,
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[38,31;
            26.8,31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[17.2,31; 4,
            31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(hRSG.GasIn, stateGas_in.outlet) annotation (points=[-56,31; -65.6,
            31],                   style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(sourceGas.flange, stateGas_in.inlet) annotation (points=[-84,31;
            -76.4,31],                 style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(levelsControl.SensorsBus, hRSG.SensorsBus) annotation (points=[40.2,70;
            20,70; 20,54.4; 3.4,54.4], style(color=84, rgbcolor={255,170,213}));
      connect(levelsControl.ActuatorsBus, hRSG.ActuatorsBus) annotation (points=[60,70;
            82,70; 82,44.8; 3.4,44.8],        style(color=52, rgbcolor={213,255,
              170}));
      connect(ramp.y, sourceGas.in_w0) annotation (points=[-77,70; -72,70; -72,
            44; -95.2,44; -95.2,34.5], style(color=74, rgbcolor={0,0,127}));
    end TestSteamPlant_controls;
    
    model TestSteamPlant_Sim1 
      "Test total plant with levels control and ratio control on the condenser, inlet valves" 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                  HeatExchangersGroup(
          fluidHPNomPressure_Sh=1.22116e7,
          fluidHPNomPressure_Ev=1.22116e7,
          fluidHPNomPressure_Ec=1.22116e7,
          fluidIPNomPressure_Rh=2.63694e6,
          fluidIPNomPressure_Sh=2.63694e6,
          fluidIPNomPressure_Ev=2.63694e6,
          fluidIPNomPressure_Ec=2.63694e6,
          fluidLPNomPressure_Sh=6.0474e5,
          fluidLPNomPressure_Ev=6.0474e5,
          fluidLPNomPressure_Ec=6.0474e5,
          fluidHPNomFlowRate_Sh=62.8,
          fluidHPNomFlowRate_Ec=64.5,
          fluidIPNomFlowRate_Rh=77.36,
          fluidIPNomFlowRate_Sh=14.5,
          fluidIPNomFlowRate_Ec=13.5,
          fluidLPNomFlowRate_Sh=10.95,
          fluidLPNomFlowRate_Ec=89.8,
          Ec2_HP_Tstart_G_In=605.074,
          Ec2_HP_Tstart_G_Out=548.522,
          Ec2_HP_Tstart_M_In=488.443,
          Ec2_HP_Tstart_M_Out=588.719,
          Ec2_HP_Tstart_F_In=476.660,
          Ec2_HP_Tstart_F_Out=585.495,
          Ec1_HP_Tstart_M_In=426.384,
          Ec1_HP_Tstart_M_Out=479.885,
          Ec1_HP_Tstart_F_In=420.129,
          Ec1_HP_Tstart_F_Out=476.660,
          Ec_IP_Tstart_G_In=501.802,
          Ec_IP_Tstart_G_Out=468.900,
          Ec_IP_Tstart_M_In=427.707,
          Ec_IP_Tstart_M_Out=490.160,
          Ec_IP_Tstart_F_In=421.552,
          Ec_IP_Tstart_F_Out=488.422,
          Ec_LP_Tstart_G_In=427.671,
          Ec_LP_Tstart_M_In=336.404,
          Ec_LP_Tstart_M_Out=419.330,
          Ec_LP_Tstart_F_In=331.506,
          Ec_LP_Tstart_F_Out=418.193,
          Ev_HP_Tstart_G_In=732.000,
          Ev_HP_Tstart_G_Out=611.190,
          Ev_HP_Tstart_M_In=594.933,
          Ev_HP_Tstart_M_Out=603.160,
          Ev_HP_hstart_F_In=1.46797e6,
          Ev_HP_hstart_F_Out=1.90129e6,
          Ev_IP_Tstart_G_In=548.522,
          Ev_IP_Tstart_G_Out=503.810,
          Ev_IP_Tstart_M_In=497.865,
          Ev_IP_Tstart_M_Out=501.763,
          Ev_IP_hstart_F_In=9.64527e5,
          Ev_IP_hstart_F_Out=1.36736e6,
          Ev_LP_Tstart_G_In=468.900,
          Ev_LP_Tstart_G_Out=427.671,
          Ev_LP_Tstart_M_In=422.216,
          Ev_LP_Tstart_M_Out=434.622,
          Ev_LP_hstart_F_In=6.26623e5,
          Ev_LP_hstart_F_Out=1.22154e6,
          Sh2_HP_Tstart_G_In=884.650,
          Sh2_HP_Tstart_G_Out=849.290,
          Sh2_HP_Tstart_M_In=801.698,
          Sh2_HP_Tstart_M_Out=861.343,
          Sh2_HP_Tstart_F_In=792.680,
          Sh2_HP_Tstart_F_Out=857.106,
          Sh1_HP_Tstart_G_In=849.290,
          Sh1_HP_Tstart_G_Out=732.000,
          Sh1_HP_Tstart_M_In=624.205,
          Sh1_HP_Tstart_M_Out=803.585,
          Sh1_HP_Tstart_F_In=599.180,
          Sh1_HP_Tstart_F_Out=792.680,
          Rh2_IP_Tstart_M_In=793.962,
          Rh2_IP_Tstart_M_Out=863.890,
          Rh2_IP_Tstart_F_In=787.973,
          Rh2_IP_Tstart_F_Out=861.625,
          Rh1_IP_Tstart_M_In=641.307,
          Rh1_IP_Tstart_M_Out=793.753,
          Rh1_IP_Tstart_F_In=631.882,
          Rh1_IP_Tstart_F_Out=787.973,
          Sh_IP_Tstart_G_In=611.19,
          Sh_IP_Tstart_G_Out=605.074,
          Sh_IP_Tstart_M_In=504.237,
          Sh_IP_Tstart_M_Out=594.703,
          Sh_IP_Tstart_F_In=499.962,
          Sh_IP_Tstart_F_Out=594.001,
          Sh_LP(gamma_G=30, gamma_F=4000),
          Sh_LP_N_F=4,
          Ec_LP_Tstart_G_Out=372.309,
          Ec_LP(gamma_G=35, gamma_F=3000),
          Ev_LP(gamma_G=60, gamma_F=20000),
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=70,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_F_A=4000,
            gamma_F_B=4000,
            gamma_G_A=70,
            gamma_G_B=70)),            cylindersBodies(
          fluidHPNomPressure=1.22116e7,
          fluidIPNomPressure=2.63694e6,
          fluidLPNomPressure=6.047e5,
          HPd_hvstart=2.61182e6,
          HPd_hlstart=1.411212e6,
          IPd_hvstart=2.79542e6,
          IPd_hlstart=9.22034e5,
          LPd_hvstart=2.75273e6,
          LPd_hlstart=6.10909e5)) 
                              annotation (extent=[-56,4; 4,64]);
      SteamTurbineGroup.Examples.STG_3LRh_valve_cc sTG_3LRh(
                                                      steamTurbines(
          steamHPNomPressure=1.2202e7,
          steamIPNomPressure=2.63681e6,
          steamLPNomPressure=6.047e5,
          HPT_hstart_in=3.56678e6,
          HPT_hstart_out=3.16451e6,
          IPT_hstart_in=3.65985e6,
          IPT_hstart_out=3.21285e6,
          LPT_hstart_in=3.16961e6,
          LPT_hstart_out=2.41849e6,
          mixLP_hstart=3.16953e6,
          mixIP_hstart=3.14446e6,
          steamHPNomFlowRate=62.8,
          steamIPNomFlowRate=14.5,
          steamLPNomFlowRate=10.9), controlledCondeser(Vlstart=5,
            setPoint_ratio=0.5)) 
        annotation (extent=[-56,-86; 4,-26]);
      annotation (Diagram, experiment(
          StartTime=-8000,
          StopTime=10000,
          NumberOfIntervals=10000));
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,24; -84,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-80,22; -62,40],   rotation=0);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=366.309) 
                       annotation (extent=[38,24; 52,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[14,22; 30,40],   rotation=0);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-10,-20; 6,-4],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-58,-4; -42,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                   redeclare package Medium = 
            FluidMedium) annotation (extent=[-32,-4; -16,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-22,-4; -6,-20],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,-4; -24,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-50,-4; -34,-20],  rotation=270);
    public 
      HRSG.Control.levelsControl levelsControl(
        CSmin_levelHP=30,
        CSmax_levelHP=96,
        CSmin_levelIP=5,
        CSmax_levelIP=25,
        CSmax_levelLP=2400) 
        annotation (extent=[40,60; 60,80]);
    public 
      Modelica.Blocks.Sources.Ramp valveHP_com(height=0, offset=1,
        duration=5) 
        annotation (extent=[-96,-28; -80,-12]);
      Modelica.Blocks.Sources.Ramp valveIP_com(height=0, offset=1,
        duration=5) 
        annotation (extent=[-96,-58; -80,-42]);
      Modelica.Blocks.Sources.Ramp valveLP_com(height=0, offset=1,
        duration=5) 
        annotation (extent=[-96,-88; -80,-72]);
    protected 
      Buses.Actuators actuators annotation (extent=[-74,-96; -66,-88]);
    public 
      Modelica.Blocks.Sources.Ramp flowRate(
        duration=500,
        offset=585.5,
        height=-80,
        startTime=500)  annotation (extent=[-94,60; -78,76]);
      ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
        singleShaft(
        Pn=50e8,
        omega_nom=314.16/2,
        eta=0.9,
        J_shaft=100,
        d_shaft=0)  annotation (extent=[26,-86; 86,-26]);
    public 
      Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
        annotation (extent=[38,-18; 50,-6]);
    protected 
      Buses.Actuators actuators1 
        annotation (extent=[70,-18; 82,-6],   rotation=0);
    equation 
      connect(sTG_3LRh.WaterOut, stateCondOut.inlet) annotation (points=[-2,-26;
            -2,-21.4; -2,-16.8; -2,-16.8], style(thickness=2));
      connect(stateCondOut.outlet, hRSG.WaterIn) 
        annotation (points=[-2,-7.2; -2,-1.6; -2,-1.6; -2,4],
                                            style(thickness=2));
      connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
        annotation (points=[-14,-26; -14,-16.8], style(thickness=2));
      connect(stateLPT_in.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,-7.2; -14,4], style(thickness=2));
      connect(stateToMix.outlet, sTG_3LRh.From_SH_IP) annotation (points=[-24,
            -16.8; -24,-24.4; -23,-24.4; -23,-26], style(thickness=2));
      connect(stateToMix.inlet, hRSG.Sh_IP_Out) 
        annotation (points=[-24,-7.2; -24,4; -23,4], style(thickness=2));
      connect(stateIPT_in.outlet, sTG_3LRh.From_RH_IP) 
        annotation (points=[-32,-16.8; -32,-26], style(thickness=2));
      connect(stateIPT_in.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-32,-7.2; -32,4], style(thickness=2));
      connect(stateHPT_out.inlet, sTG_3LRh.To_RH_IP) 
        annotation (points=[-42,-16.8; -42,-26; -41,-26], style(thickness=2));
      connect(stateHPT_out.outlet, hRSG.Rh_IP_In) 
        annotation (points=[-42,-7.2; -42,4; -41,4], style(thickness=2));
      connect(stateHPT_in.outlet, sTG_3LRh.From_SH_HP) 
        annotation (points=[-50,-16.8; -50,-26], style(thickness=2));
      connect(stateHPT_in.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-50,-7.2; -50,4], style(thickness=2));
      connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[38,31;
            26.8,31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[17.2,31; 4,
            31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(hRSG.GasIn, stateGas_in.outlet) annotation (points=[-56,31; -65.6,
            31],                   style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(sourceGas.flange, stateGas_in.inlet) annotation (points=[-84,31;
            -76.4,31],                 style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(levelsControl.SensorsBus, hRSG.SensorsBus) annotation (points=[40.2,70;
            20,70; 20,54.4; 3.4,54.4], style(color=84, rgbcolor={255,170,213}));
      connect(levelsControl.ActuatorsBus, hRSG.ActuatorsBus) annotation (points=[60,70;
            82,70; 82,44.8; 3.4,44.8],        style(color=52, rgbcolor={213,255,
              170}));
      connect(actuators.Opening_valveHP,valveHP_com. y) annotation (points=[-70,-92;
            -70,-20; -79.2,-20],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveIP,valveIP_com. y) annotation (points=[-70,-92;
            -70,-50; -79.2,-50],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveLP,valveLP_com. y) annotation (points=[-70,-92;
            -70,-80; -79.2,-80],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators, sTG_3LRh.ActuatorsBus) annotation (points=[-70,-92; 12,
            -92; 12,-77.6; 3.4,-77.6], style(color=52, rgbcolor={213,255,170}));
      connect(flowRate.y, sourceGas.in_w0) annotation (points=[-77.2,68; -72,68;
            -72,40; -95.2,40; -95.2,34.5],
                                       style(color=74, rgbcolor={0,0,127}));
      connect(booleanConstant.y,actuators1. breakerClosed) 
                                                          annotation (points=[50.6,-12;
            76,-12],           style(color=5, rgbcolor={255,0,255}));
      connect(actuators1,singleShaft. ActuatorsBus) annotation (points=[76,-12;
            94,-12; 94,-77.6; 85.4,-77.6], style(
          color=52,
          rgbcolor={213,255,170},
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(singleShaft.shaft, sTG_3LRh.Shaft_b) annotation (points=[26,-56;
            4,-56], style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2));
    end TestSteamPlant_Sim1;
    
    model TestSteamPlant_Sim2 
      "Test total plant with levels control and ratio control on the condenser, inlet valves" 
      replaceable package FlueGasMedium = ThermoPower.Media.FlueGas extends 
        Modelica.Media.Interfaces.PartialMedium;
      replaceable package FluidMedium = ThermoPower.Water.StandardWater extends 
        Modelica.Media.Interfaces.PartialPureSubstance;
      ThermoPower.PowerPlants.HRSG.Examples.HRSG_3LRh_wa hRSG(
                                  HeatExchangersGroup(
          fluidHPNomPressure_Sh=1.22116e7,
          fluidHPNomPressure_Ev=1.22116e7,
          fluidHPNomPressure_Ec=1.22116e7,
          fluidIPNomPressure_Rh=2.63694e6,
          fluidIPNomPressure_Sh=2.63694e6,
          fluidIPNomPressure_Ev=2.63694e6,
          fluidIPNomPressure_Ec=2.63694e6,
          fluidLPNomPressure_Sh=6.0474e5,
          fluidLPNomPressure_Ev=6.0474e5,
          fluidLPNomPressure_Ec=6.0474e5,
          fluidHPNomFlowRate_Sh=62.8,
          fluidHPNomFlowRate_Ec=64.5,
          fluidIPNomFlowRate_Rh=77.36,
          fluidIPNomFlowRate_Sh=14.5,
          fluidIPNomFlowRate_Ec=13.5,
          fluidLPNomFlowRate_Sh=10.95,
          fluidLPNomFlowRate_Ec=89.8,
          Ec2_HP_Tstart_G_In=605.074,
          Ec2_HP_Tstart_G_Out=548.522,
          Ec2_HP_Tstart_M_In=488.443,
          Ec2_HP_Tstart_M_Out=588.719,
          Ec2_HP_Tstart_F_In=476.660,
          Ec2_HP_Tstart_F_Out=585.495,
          Ec1_HP_Tstart_M_In=426.384,
          Ec1_HP_Tstart_M_Out=479.885,
          Ec1_HP_Tstart_F_In=420.129,
          Ec1_HP_Tstart_F_Out=476.660,
          Ec_IP_Tstart_G_In=501.802,
          Ec_IP_Tstart_G_Out=468.900,
          Ec_IP_Tstart_M_In=427.707,
          Ec_IP_Tstart_M_Out=490.160,
          Ec_IP_Tstart_F_In=421.552,
          Ec_IP_Tstart_F_Out=488.422,
          Ec_LP_Tstart_G_In=427.671,
          Ec_LP_Tstart_M_In=336.404,
          Ec_LP_Tstart_M_Out=419.330,
          Ec_LP_Tstart_F_In=331.506,
          Ec_LP_Tstart_F_Out=418.193,
          Ev_HP_Tstart_G_In=732.000,
          Ev_HP_Tstart_G_Out=611.190,
          Ev_HP_Tstart_M_In=594.933,
          Ev_HP_Tstart_M_Out=603.160,
          Ev_HP_hstart_F_In=1.46797e6,
          Ev_HP_hstart_F_Out=1.90129e6,
          Ev_IP_Tstart_G_In=548.522,
          Ev_IP_Tstart_G_Out=503.810,
          Ev_IP_Tstart_M_In=497.865,
          Ev_IP_Tstart_M_Out=501.763,
          Ev_IP_hstart_F_In=9.64527e5,
          Ev_IP_hstart_F_Out=1.36736e6,
          Ev_LP_Tstart_G_In=468.900,
          Ev_LP_Tstart_G_Out=427.671,
          Ev_LP_Tstart_M_In=422.216,
          Ev_LP_Tstart_M_Out=434.622,
          Ev_LP_hstart_F_In=6.26623e5,
          Ev_LP_hstart_F_Out=1.22154e6,
          Sh2_HP_Tstart_G_In=884.650,
          Sh2_HP_Tstart_G_Out=849.290,
          Sh2_HP_Tstart_M_In=801.698,
          Sh2_HP_Tstart_M_Out=861.343,
          Sh2_HP_Tstart_F_In=792.680,
          Sh2_HP_Tstart_F_Out=857.106,
          Sh1_HP_Tstart_G_In=849.290,
          Sh1_HP_Tstart_G_Out=732.000,
          Sh1_HP_Tstart_M_In=624.205,
          Sh1_HP_Tstart_M_Out=803.585,
          Sh1_HP_Tstart_F_In=599.180,
          Sh1_HP_Tstart_F_Out=792.680,
          Rh2_IP_Tstart_M_In=793.962,
          Rh2_IP_Tstart_M_Out=863.890,
          Rh2_IP_Tstart_F_In=787.973,
          Rh2_IP_Tstart_F_Out=861.625,
          Rh1_IP_Tstart_M_In=641.307,
          Rh1_IP_Tstart_M_Out=793.753,
          Rh1_IP_Tstart_F_In=631.882,
          Rh1_IP_Tstart_F_Out=787.973,
          Sh_IP_Tstart_G_In=611.19,
          Sh_IP_Tstart_G_Out=605.074,
          Sh_IP_Tstart_M_In=504.237,
          Sh_IP_Tstart_M_Out=594.703,
          Sh_IP_Tstart_F_In=499.962,
          Sh_IP_Tstart_F_Out=594.001,
          Sh_LP(gamma_G=30, gamma_F=4000),
          Sh_LP_N_F=4,
          Ec_LP_Tstart_G_Out=372.309,
          Ec_LP(gamma_G=35, gamma_F=3000),
          Ev_LP(gamma_G=60, gamma_F=20000),
          Sh1HP_Rh1IP(
            gamma_G_A=70,
            gamma_G_B=70,
            gamma_F_A=4000,
            gamma_F_B=4000),
          Sh2HP_Rh2IP(
            gamma_F_A=4000,
            gamma_F_B=4000,
            gamma_G_A=70,
            gamma_G_B=70)),            cylindersBodies(
          fluidHPNomPressure=1.22116e7,
          fluidIPNomPressure=2.63694e6,
          fluidLPNomPressure=6.047e5,
          HPd_hvstart=2.61182e6,
          HPd_hlstart=1.411212e6,
          IPd_hvstart=2.79542e6,
          IPd_hlstart=9.22034e5,
          LPd_hvstart=2.75273e6,
          LPd_hlstart=6.10909e5)) 
                              annotation (extent=[-56,4; 4,64]);
      SteamTurbineGroup.Examples.STG_3LRh_valve_cc sTG_3LRh(
                                                      steamTurbines(
          steamHPNomPressure=1.2202e7,
          steamIPNomPressure=2.63681e6,
          steamLPNomPressure=6.047e5,
          HPT_hstart_in=3.56678e6,
          HPT_hstart_out=3.16451e6,
          IPT_hstart_in=3.65985e6,
          IPT_hstart_out=3.21285e6,
          LPT_hstart_in=3.16961e6,
          LPT_hstart_out=2.41849e6,
          mixLP_hstart=3.16953e6,
          mixIP_hstart=3.14446e6,
          steamHPNomFlowRate=62.8,
          steamIPNomFlowRate=14.5,
          steamLPNomFlowRate=10.9), controlledCondeser(Vlstart=5,
            setPoint_ratio=0.5)) 
        annotation (extent=[-56,-86; 4,-26]);
      annotation (Diagram, experiment(
          StartTime=-8000,
          StopTime=10000,
          NumberOfIntervals=10000));
      Gas.SourceW sourceGas(
        redeclare package Medium = FlueGasMedium,
        w0=585.5,
        T=884.65)          annotation (extent=[-98,24; -84,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_in(
                                             redeclare package Medium = 
            FlueGasMedium) annotation (extent=[-80,22; -62,40],   rotation=0);
      Gas.SinkP sinkGas(redeclare package Medium = FlueGasMedium, T=366.309) 
                       annotation (extent=[38,24; 52,38]);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_gas stateGas_out(
                                              redeclare package Medium = 
            FlueGasMedium) annotation (extent=[14,22; 30,40],   rotation=0);
    public 
      ThermoPower.PowerPlants.SteamTurbineGroup.Components.StateReader 
        stateCondOut(                     redeclare package Medium = 
            FluidMedium) 
        annotation (extent=[-10,-20; 6,-4],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-58,-4; -42,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateToMix(
                                                   redeclare package Medium = 
            FluidMedium) annotation (extent=[-32,-4; -16,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateLPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-22,-4; -6,-20],   rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateIPT_in(
                                                    redeclare package Medium = 
            FluidMedium) annotation (extent=[-40,-4; -24,-20],  rotation=90);
      ThermoPower.PowerPlants.HRSG.Components.StateReader_water stateHPT_out(
                                                redeclare package Medium = 
            FluidMedium) annotation (extent=[-50,-4; -34,-20],  rotation=270);
    public 
      HRSG.Control.levelsControl levelsControl(
        CSmin_levelHP=30,
        CSmax_levelHP=96,
        CSmin_levelIP=5,
        CSmax_levelIP=25,
        CSmax_levelLP=2400) 
        annotation (extent=[40,60; 60,80]);
    public 
      Modelica.Blocks.Sources.Ramp valveHP_com(          offset=1,
        duration=300,
        height=-0.6,
        startTime=500) 
        annotation (extent=[-96,-28; -80,-12]);
      Modelica.Blocks.Sources.Ramp valveIP_com(height=0, offset=1,
        duration=300,
        startTime=10000) 
        annotation (extent=[-96,-58; -80,-42]);
      Modelica.Blocks.Sources.Ramp valveLP_com(height=0, offset=1,
        duration=300) 
        annotation (extent=[-96,-88; -80,-72]);
    protected 
      Buses.Actuators actuators annotation (extent=[-74,-96; -66,-88]);
    public 
      Modelica.Blocks.Sources.Ramp flowRate(
        duration=500,
        offset=585.5,
        height=0,
        startTime=0)    annotation (extent=[-96,60; -80,76]);
      ThermoPower.PowerPlants.ElectricGeneratorGroup.Examples.SingleShaft_static
        singleShaft(
        Pn=50e8,
        omega_nom=314.16/2,
        eta=0.9,
        J_shaft=100,
        d_shaft=0)  annotation (extent=[26,-86; 86,-26]);
    public 
      Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=true) 
        annotation (extent=[38,-18; 50,-6]);
    protected 
      Buses.Actuators actuators1 
        annotation (extent=[70,-18; 82,-6],   rotation=0);
    equation 
      connect(sTG_3LRh.WaterOut, stateCondOut.inlet) annotation (points=[-2,-26;
            -2,-21.4; -2,-16.8; -2,-16.8], style(thickness=2));
      connect(stateCondOut.outlet, hRSG.WaterIn) 
        annotation (points=[-2,-7.2; -2,-1.6; -2,-1.6; -2,4],
                                            style(thickness=2));
      connect(sTG_3LRh.From_SH_LP, stateLPT_in.outlet) 
        annotation (points=[-14,-26; -14,-16.8], style(thickness=2));
      connect(stateLPT_in.inlet, hRSG.Sh_LP_Out) 
        annotation (points=[-14,-7.2; -14,4], style(thickness=2));
      connect(stateToMix.outlet, sTG_3LRh.From_SH_IP) annotation (points=[-24,
            -16.8; -24,-24.4; -23,-24.4; -23,-26], style(thickness=2));
      connect(stateToMix.inlet, hRSG.Sh_IP_Out) 
        annotation (points=[-24,-7.2; -24,4; -23,4], style(thickness=2));
      connect(stateIPT_in.outlet, sTG_3LRh.From_RH_IP) 
        annotation (points=[-32,-16.8; -32,-26], style(thickness=2));
      connect(stateIPT_in.inlet, hRSG.Rh_IP_Out) 
        annotation (points=[-32,-7.2; -32,4], style(thickness=2));
      connect(stateHPT_out.inlet, sTG_3LRh.To_RH_IP) 
        annotation (points=[-42,-16.8; -42,-26; -41,-26], style(thickness=2));
      connect(stateHPT_out.outlet, hRSG.Rh_IP_In) 
        annotation (points=[-42,-7.2; -42,4; -41,4], style(thickness=2));
      connect(stateHPT_in.outlet, sTG_3LRh.From_SH_HP) 
        annotation (points=[-50,-16.8; -50,-26], style(thickness=2));
      connect(stateHPT_in.inlet, hRSG.Sh_HP_Out) 
        annotation (points=[-50,-7.2; -50,4], style(thickness=2));
      connect(sinkGas.flange, stateGas_out.outlet) annotation (points=[38,31;
            26.8,31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(stateGas_out.inlet, hRSG.GasOut) annotation (points=[17.2,31; 4,
            31], style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(hRSG.GasIn, stateGas_in.outlet) annotation (points=[-56,31; -65.6,
            31],                   style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(sourceGas.flange, stateGas_in.inlet) annotation (points=[-84,31;
            -76.4,31],                 style(
          color=76,
          rgbcolor={159,159,223},
          thickness=2));
      connect(levelsControl.SensorsBus, hRSG.SensorsBus) annotation (points=[40.2,70;
            20,70; 20,54.4; 3.4,54.4], style(color=84, rgbcolor={255,170,213}));
      connect(levelsControl.ActuatorsBus, hRSG.ActuatorsBus) annotation (points=[60,70;
            82,70; 82,44.8; 3.4,44.8],        style(color=52, rgbcolor={213,255,
              170}));
      connect(actuators.Opening_valveHP,valveHP_com. y) annotation (points=[-70,-92;
            -70,-20; -79.2,-20],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveIP,valveIP_com. y) annotation (points=[-70,-92;
            -70,-50; -79.2,-50],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators.Opening_valveLP,valveLP_com. y) annotation (points=[-70,-92;
            -70,-80; -79.2,-80],               style(color=52, rgbcolor={213,
              255,170}));
      connect(actuators, sTG_3LRh.ActuatorsBus) annotation (points=[-70,-92; 12,
            -92; 12,-77.6; 3.4,-77.6], style(color=52, rgbcolor={213,255,170}));
      connect(flowRate.y, sourceGas.in_w0) annotation (points=[-79.2,68; -72,68; -72,
            40; -95.2,40; -95.2,34.5], style(color=74, rgbcolor={0,0,127}));
      connect(booleanConstant.y,actuators1. breakerClosed) 
                                                          annotation (points=[50.6,-12;
            76,-12],           style(color=5, rgbcolor={255,0,255}));
      connect(actuators1,singleShaft. ActuatorsBus) annotation (points=[76,-12;
            94,-12; 94,-77.6; 85.4,-77.6], style(
          color=52,
          rgbcolor={213,255,170},
          fillColor=30,
          rgbfillColor={230,230,230},
          fillPattern=1));
      connect(singleShaft.shaft, sTG_3LRh.Shaft_b) annotation (points=[26,-56;
            4,-56], style(
          color=0,
          rgbcolor={0,0,0},
          thickness=2));
    end TestSteamPlant_Sim2;
  end Tests;
  
end PowerPlants;
